<!DOCTYPE html>
<html lang="es" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.51" />
    <meta name="description" content="Documentation for Hugo Learn Theme">
<meta name="author" content="Mathieu Cornic">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Aplicación en Spring REST y Angular – 5ª Parte :: Documentacion en español</title>

    
    <link href="/css/nucleus.css?1564253112" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1564253112" rel="stylesheet">
    <link href="/css/hybrid.css?1564253112" rel="stylesheet">
    <link href="/css/featherlight.min.css?1564253112" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1564253112" rel="stylesheet">
    <link href="/css/auto-complete.css?1564253112" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1564253112" rel="stylesheet">
    <link href="/css/theme.css?1564253112" rel="stylesheet">
    <link href="/css/hugo-theme.css?1564253112" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1564253112"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/2018/09/06/aplicacion-en-spring-rest-y-angular-5a-parte/">
    <nav id="sidebar" class="showVisitedLinks">





	


  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/"><B>Profesor-P</B>
<img src="/images/logo1.jpg" alt="Logo">
<P>Explicando la informática esa</P>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Buscar...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1564253112"></script>
<script type="text/javascript" src="/js/auto-complete.js?1564253112"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/ww2.profesor-p.com\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1564253112"></script>

    
  </div>
  




    <div class="highlightable">
    <ul class="topics">

        
          
					
		    			
			






 
  
  	
		 
	

    
    <li data-nav-id="/1-java/" title="Java" class="dd-item 
        
        
        
        ">		
      <a href="/1-java/">
          <b>1. </b>Java
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
		  
          
			

            
				






 
  
  	
		 
	

    
    <li data-nav-id="/1-java/kotlin/" title="Kotlin" class="dd-item 
        
        
        
        ">		
      <a href="/1-java/kotlin/">
          Kotlin
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
					
		    			
			






 
  
  	
		 
	

    
    <li data-nav-id="/2-spring/" title="Spring" class="dd-item 
        
        
        
        ">		
      <a href="/2-spring/">
          <b>2. </b>Spring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
		  
          
			

            
				






 
  
  	
		 
	

    
    <li data-nav-id="/2-spring/1-testing/" title="Testing" class="dd-item 
        
        
        
        ">		
      <a href="/2-spring/1-testing/">
          <b>- </b>Testing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
			

            
				






 
  
  	
		 
	

    
    <li data-nav-id="/2-spring/2-seguridad/" title="Seguridad" class="dd-item 
        
        
        
        ">		
      <a href="/2-spring/2-seguridad/">
          <b>- </b>Seguridad
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
			

            
				






 
  
  	
		 
	

    
    <li data-nav-id="/2-spring/3-mvc/" title="MVC" class="dd-item 
        
        
        
        ">		
      <a href="/2-spring/3-mvc/">
          <b>- </b>MVC
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
			

            
				






 
  
  	
		 
	

    
    <li data-nav-id="/2-spring/4-database/" title="Database" class="dd-item 
        
        
        
        ">		
      <a href="/2-spring/4-database/">
          <b>- </b>Database
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
			

            
				






 
  
  	
		 
	

    
    <li data-nav-id="/2-spring/5-cloud/" title="Cloud" class="dd-item 
        
        
        
        ">		
      <a href="/2-spring/5-cloud/">
          <b>- </b>Cloud
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
			

            
				






 
  
  	
		 
	

    
    <li data-nav-id="/2-spring/6-webflow/" title="Webflow" class="dd-item 
        
        
        
        ">		
      <a href="/2-spring/6-webflow/">
          <b>- </b>Webflow
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
					
		    			
			






 
  
  	
		 
	

    
    <li data-nav-id="/3-hugo/" title="Hugo" class="dd-item 
        
        
        
        ">		
      <a href="/3-hugo/">
          <b>3. </b>Hugo
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
					
		    			
			






 
  
  	
		 
	

    
    <li data-nav-id="/4-angular/" title="Angular" class="dd-item 
        parent
        
        
        ">		
      <a href="/4-angular/">
          <b>4. </b>Angular
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
		  
          
			

            
				






 
  
  	
		 
	

    
    <li data-nav-id="/4-angular/curso/" title="Curso de Angular 6" class="dd-item 
        
        
        
        ">		
      <a href="/4-angular/curso/">
          <b>- </b>Curso de Angular 6
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
			

            
				






 
  
  	
		 
	

    
    <li data-nav-id="/4-angular/aplicacion/" title="Aplicación usando Java y Angular" class="dd-item 
        parent
        
        
        ">		
      <a href="/4-angular/aplicacion/">
          <b>- </b>Aplicación usando Java y Angular
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
      <li data-nav-id="/2018/10/08/aplicacion-crud-en-angular/" title="Aplicación CRUD en Angular" class="dd-item ">
        <a href="/2018/10/08/aplicacion-crud-en-angular/">
        Aplicación CRUD en Angular
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
	 
  
 

            
          
			

            
				






 
  
    
	
      <li data-nav-id="/2018/09/16/aplicacion-en-angular-rutas/" title="Aplicación en Angular – Rutas" class="dd-item ">
        <a href="/2018/09/16/aplicacion-en-angular-rutas/">
        Aplicación en Angular – Rutas
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
	 
  
 

            
          
			

            
				






 
  
    
	
      <li data-nav-id="/2018/09/14/aplicacion-en-angular-inicializando/" title="Aplicación en Angular – Inicializando aplicación" class="dd-item ">
        <a href="/2018/09/14/aplicacion-en-angular-inicializando/">
        Aplicación en Angular – Inicializando aplicación
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
	 
  
 

            
          
			

            
				






 
  
    
	
      <li data-nav-id="/2018/09/13/aplicacion-en-angular-instalacion-y-configuracion-basica/" title="Aplicación en Angular – Instalación y configuración básica" class="dd-item ">
        <a href="/2018/09/13/aplicacion-en-angular-instalacion-y-configuracion-basica/">
        Aplicación en Angular – Instalación y configuración básica
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
	 
  
 

            
          
			

            
				






 
  
    
	
      <li data-nav-id="/2018/09/06/aplicacion-en-spring-rest-y-angular-5a-parte/" title="Aplicación en Spring REST y Angular – 5ª Parte" class="dd-item active">
        <a href="/2018/09/06/aplicacion-en-spring-rest-y-angular-5a-parte/">
        Aplicación en Spring REST y Angular – 5ª Parte
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
	 
  
 

            
          
			

            
				






 
  
    
	
      <li data-nav-id="/2018/09/05/aplicacion-en-spring-rest-y-angular-4a-parte/" title="Aplicación en Spring REST y Angular – 4ª Parte" class="dd-item ">
        <a href="/2018/09/05/aplicacion-en-spring-rest-y-angular-4a-parte/">
        Aplicación en Spring REST y Angular – 4ª Parte
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
	 
  
 

            
          
			

            
				






 
  
    
	
      <li data-nav-id="/2018/09/04/aplicacion-en-spring-rest-y-angular-3a-parte/" title="Aplicación en Spring REST y Angular – 3ª Parte" class="dd-item ">
        <a href="/2018/09/04/aplicacion-en-spring-rest-y-angular-3a-parte/">
        Aplicación en Spring REST y Angular – 3ª Parte
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
	 
  
 

            
          
			

            
				






 
  
    
	
      <li data-nav-id="/2018/09/03/aplicacion-en-spring-rest-y-angular-2-parte/" title="Aplicación en Spring REST y Angular – 2 Parte" class="dd-item ">
        <a href="/2018/09/03/aplicacion-en-spring-rest-y-angular-2-parte/">
        Aplicación en Spring REST y Angular – 2 Parte
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
	 
  
 

            
          
			

            
				






 
  
    
	
      <li data-nav-id="/2018/08/31/aplicacion-en-spring-y-angular/" title="Aplicación en Spring REST y Angular" class="dd-item ">
        <a href="/2018/08/31/aplicacion-en-spring-y-angular/">
        Aplicación en Spring REST y Angular
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
					
		    			
			






 
  
  	
		 
	

    
    <li data-nav-id="/5-dba/" title="DBA" class="dd-item 
        
        
        
        ">		
      <a href="/5-dba/">
          <b>6. </b>DBA
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
					
		    			
			






 
  
  	
		 
	

    
    <li data-nav-id="/6-javaee/" title="J2EE" class="dd-item 
        
        
        
        ">		
      <a href="/6-javaee/">
          <b>6. </b>J2EE
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
					
		    			
			






 
  
  	
		 
	

    
    <li data-nav-id="/contacto/" title="Contacto" class="dd-item 
        
        
        
        ">		
      <a href="/contacto/">
          <b> > </b>Contacto
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
		  
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
			

            
				






 
  
    
	
	 
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>Más</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://ww2.profesor-p.com/acerca"><i class='fas fa-fw fa-camera'></i>Acerca de</a>
              </li>
          
              <li> 
                  <a class="padding" href="http://ww2.profesor-p.com/experiencia_laboral"><i class='fas fa-fw fa-bookmark'></i>Experiencia Laboral</a>
              </li>
          
              <li> 
                  <a class="padding" href="http://ww2.profesor-p.com/anjelica"><i class='fas fa-fw fa-bullhorn'></i> Anjelica</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Borrar Historial</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <center>
    
    <a class="github-button" href="https://github.com/matcornic/hugo-theme-learn/archive/master.zip" data-icon="octicon-cloud-download" aria-label="Download matcornic/hugo-theme-learn on GitHub">Download</a>

    
    <a class="github-button" href="https://github.com/matcornic/hugo-theme-learn" data-icon="octicon-star" data-show-count="true" aria-label="Star matcornic/hugo-theme-learn on GitHub">Star</a>

    
    <a class="github-button" href="https://github.com/matcornic/hugo-theme-learn/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork matcornic/hugo-theme-learn on GitHub">Fork</a>

    <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Aplicación en Spring REST y Angular – 5ª Parte 
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>
 					
										
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
			  
				Aplicación en Spring REST y Angular – 5ª Parte 
			  
			   
				<class id ="fecha">
				September 06, 2018 </div>
			  
            </h1>
			
          
        



<p>En esta ultima parte de la parte servidor hablare de como se crean los objetos que en el anterior articulo se devolvían.</p>

<p>Estos objetos eran del tipo _VentasAnoBean _y un <em>ArrayList</em> de _VentasSemanaBean. _Para conseguirlos se llamaban a sendas funciones en  la clase <strong>YagesBussines, </strong>que eran las que construían esos objetos.</p>

<p>Empezare describiendo la clase</p>

<pre>@Component
public class YagesBussines {  
    @Autowired
    CalendarioRepositorioService calendarioRepositorio;

    @Autowired
    HistVentasRepository histVentasRepository;

    @Autowired
    DataSource dataSource;        
  
     @Autowired
    private JdbcOperations jdbc;

    @Bean
    public JdbcTemplate jdbcTemplate() {
        return new JdbcTemplate(dataSource);
    }
.....</pre>

<p>Lo primero, marcamos nuestra clase como <em>@Component</em> para que Spring la cree y este disponible para inyectarla en otras clases. De otra manera nuestra clase <em>YagesController </em> no podría usarla.</p>

<p>Ahora inyectamos los diferentes objetos que vamos a usar, incluyendo el objeto <em>jdbc</em> que es de tipo <strong>JdbcOperations .</strong> Para que Spring pueda crear ese objeto debemos tener la función <strong>jdbcTemplate</strong>, que, usando la variable  <em>dataSource .</em> devolverá un objeto tipo <em>JdbcTemplate</em> el cual implementa el interface  <em>JdbcOperations</em> para usarlo en la variable <strong>jdbc</strong>, ya que la función esta marcarla con la anotación @Bean y eso hará que Spring sepa de donde sacar un objeto tipo <em>JdbcOperations</em>.</p>

<ul>
<li>##### Función: getVentasAno</li>
</ul>

<pre>public VentasAnoBean <strong>getVentasAno</strong>(int ano) {
        List&lt;VentasMesBean&gt; cal = getKilosPorMes(ano);
        VentasAnoBean ventasAno = new VentasAnoBean();
        cal.forEach((v) -&gt; {
            ventasAno.addMes(v);
        });
       
        if (ventasAno.getKilosVentaAct() == 0) {
            throw new VentasNotFoundException(ano);
        }
        return ventasAno;
    }
    
</pre>

<p>La función <strong>getVentasAno</strong>, simplemente llama a la función <strong>getKilosPorMes, </strong>la cual devuelve una lista de objectos tipo VentasMesBean (List<VentasMesBean>),  para después ir añadiéndolo al objeto tipo <strong>VentasAno.</strong></p>

<p>Obsérvese que la función comprueba si el acumulado de kilos de venta,  a través de la función getKilosVentaAct(), es igual a cero. Si es cero, lanza una excepción del tipo <strong>VentasNotFoundException</strong></p>

<p>Esa excepción se define en el paquete yages.yagesserver.bussines.</p>

<pre>@ResponseStatus(HttpStatus.NOT_FOUND)
class VentasNotFoundException extends RuntimeException {
    private static final long serialVersionUID = 1L;

    public VentasNotFoundException(int ano) {
        this(ano, 0);
    }
    public VentasNotFoundException(int ano, int mes) {
        super("No encontradas ventas para año '" + ano + "'"+ (mes&gt;0?" y Mes: "+mes:""));
    }
    public VentasNotFoundException(String msgError,int ano, int mes) {
        super("Error al buscar ventas para año '" + ano + "'"+ (mes&gt;0?" y Mes: "+mes:"")+" \n Error: "+msgError);
    }
}</pre>

<p>Lo destacable de esta clase es la anotación @ResponseStatus, la cual hará que cuando se lance, a través de una sentencia _throw, _sea capturada por Spring de tal manera que la respuesta a la peticion HTTP sea lo indicado, en este caso un HttpStatus.NOT_FOUND (el tipico 404: Página no encontrada). De esta manera si la consulta no devuelve ningún dato en vez de devolver un null, devolveremos un mensaje de error para que el cliente pueda tratarlo más fácilmente.</p>

<p>En otras palabras, cuando se lance una excepción del tipo <em>VentasNotFoundException</em> el cliente recibirá un error del tipo 404 (NOT FOUND).</p>

<p>La función <strong>getKilosPorMes</strong>, realiza una serie de consultas a través de <em>jdbc. </em></p>

<pre>public List&lt;VentasMesBean&gt; getKilosPorMes(int ano) {                  
          List&lt;VentasMesBean&gt; cal =
                jdbc.query(
                "SELECT c.cal_ano,c.cal_mes , sum(hve_kilven) as kilosVenta,sum(hve_impven) as impVenta,sum(hve_impgan) as impGanancia "
                    + "FROM Calendario c,  histventas h "
                    + " where  c.cal_ano =  ?" 
                    + " and h.hve_fecini between c.cal_fecini and c.cal_fecfin "
                    + " and h.hve_fecfin between c.cal_fecini and c.cal_fecfin "
                    + " group by cal_ano,cal_mes "
                    + " order by c.cal_mes",  new Object[] { ano },
                (rs, rowNum) -&gt; new VentasMesBean(rs.getInt("cal_ano"),rs.getInt("cal_mes"),rs.getDouble("kilosVenta"),rs.getDouble("impVenta"),rs.getDouble("impGanancia"))
                        );
             List&lt;VentasMesBean&gt; calAnt =
                jdbc.query(
                "SELECT c.cal_ano,c.cal_mes , sum(hve_kilven) as kilosVenta,sum(hve_impven) as impVenta,sum(hve_impgan) as impGanancia "
                    + "FROM Calendario c,  histventas h "
                    + " where  c.cal_ano =  ?" 
                   + " and h.hve_fecini between c.cal_fecini and c.cal_fecfin "
                    + " and h.hve_fecfin between c.cal_fecini and c.cal_fecfin "
                    + " group by cal_ano,cal_mes "
                    + " order by c.cal_mes",  new Object[] { ano - 1},
                  (rs, rowNum) -&gt; new VentasMesBean(rs.getInt("cal_ano"),rs.getInt("cal_mes"),rs.getDouble("kilosVenta"),rs.getDouble("impVenta"),rs.getDouble("impGanancia"))
                        );
            
            
             cal.forEach((v) -&gt; {
                 for (VentasMesBean vAnt : calAnt) {
                     if (v.getMes() == vAnt.getMes()) {
                         v.setKilosVentaAnt(vAnt.getKilosVentaAct());
                         v.setImpVentaAnt(vAnt.getImpVentaAct());
                         v.setGananAnt(vAnt.getGananAct());
                     }
                 }
            });
            return cal; 
    }

</pre>

<p>Obsérvese el uso intensivo de sentencias <em>lamba. </em> Os recuerdo que tenéis un par de entradas sobre como este tema <a href="http://www.profesor-p.com/2018/08/23/usando-lambdas/" target="_blank" rel="noopener">aquí</a> y <a href="http://www.profesor-p.com/2018/09/04/expresiones-lamba-en-spring-jdbc-data-mejorando-la-explicacion/" target="_blank" rel="noopener">aquí</a></p>

<p>Esta función consulta primero todas las ventas del año mandado, metiéndolas en un objeto <em>List<VentasMesBean></em>, después hace la misma consulta sobre el año anterior al mandado, metiendo el resultado en otro objeto List<VentasMesBean>. Después recorre la primera lista a, con la función forEach, y si existe el mismo mes en el segundo objeto, establece los parámetros del año anterior en el primer objeto <em>VentasMesBean.</em> Por ultimo devuelve la lista de objetos (<em>List<VentasMesBean></em>)</p>

<ul>
<li>##### Función: getDatosSemana</li>
</ul>

<p>Esta función es la llamada cuando queremos buscar los datos de venta de un año y semana. Ofreciendo, semana por semana, los datos del periodo solicitado.</p>

<pre>public ArrayList&lt;VentasSemanaBean&gt; getDatosSemana(int mes, int ano) {
        Calendario calAnterior = null;
        
        Optional&lt;Calendario&gt; calOpc = calendarioRepositorio.getCalendario(new CalendarioKey(mes, ano - 1));
        if (calOpc.isPresent()) {
            calAnterior = calOpc.get();
            try {
                ajustaFechas(calAnterior, ano - 1, mes);
            } catch (ParseException e) {
                throw new VentasNotFoundException(e.getMessage(), ano, mes);
            }
        }
......
    }</pre>

<p>No es mi idea explicar paso a paso la lógica de esta función solo incidir en el uso de JPA, usando la clase <strong>CalendarioRepositorioService</strong>, que se limita a usar la clase generada <em>automagicamente</em> por Spring, la cual   implementara el interface <strong>CalendarioRepository</strong>.</p>

<p>El código por si estáis interesados en curiosear como se buscan los datos lo tenéis en <a href="https://github.com/chuchip/yagesserver" target="_blank" rel="noopener">mi pagina de GitHub</a></p>

<p>Y con esto termino las entradas, explicando la parte servidor de esta aplicación.</p>

<p>Espero que haya sido de utilidad y no os perdáis las siguientes sobre como hacer la parte cliente con Angular.</p>

<p>¡¡ Hasta pronto !!</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/2018/09/13/aplicacion-en-angular-instalacion-y-configuracion-basica/" title="Aplicación en Angular – Instalación y configuración básica"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/2018/09/05/aplicacion-en-spring-rest-y-angular-4a-parte/" title="Aplicación en Spring REST y Angular – 4ª Parte" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1564253112"></script>
    <script src="/js/perfect-scrollbar.min.js?1564253112"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1564253112"></script>
    <script src="/js/jquery.sticky.js?1564253112"></script>
    <script src="/js/featherlight.min.js?1564253112"></script>
    <script src="/js/html5shiv-printshiv.min.js?1564253112"></script>
    <script src="/js/highlight.pack.js?1564253112"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1564253112"></script>
    <script src="/js/learn.js?1564253112"></script>
    <script src="/js/hugo-learn.js?1564253112"></script>

    <link href="/mermaid/mermaid.css?1564253112" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1564253112"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-105947713-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>

