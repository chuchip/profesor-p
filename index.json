[
{
	"uri": "http://ww2.profesor-p.com/4-angular/curso/",
	"title": "Curso de Angular 6",
	"tags": [],
	"description": "",
	"content": "En esta p√°gina ir√© poniendo las sucesivas entradas donde intentare dar un curso b√°sico sobre Angular 6\nEn el curso se desarrollara una aplicaci√≥n que usando peticiones RESTFUL, realizara una consulta mostrando un hist√≥rico de ventas. En la aplicaci√≥n se usara Boostrap y se explicara como utilizar rultas.\nLa aplicaci√≥n backend, en el servidor, esta hecho en Java, usando Spring Framework,¬†y se puede ver en su desarrollo en la pagina: http://www.profesor-p.com/aplicacion-usando-java-y-angular/\nEstas son las entradas creadas de momento:\n ¬°¬°Angular es reactivo!! Instalaci√≥n y configuraci√≥n b√°sica de Angular Inicializando aplicaci√≥n Manejando rutas  \u0026#8230;. continuara\n\u0026nbsp;\n"
},
{
	"uri": "http://ww2.profesor-p.com/4-angular/aplicacion/",
	"title": "Aplicaci√≥n usando Java y Angular",
	"tags": [],
	"description": "",
	"content": " A continuaci√≥n detallo las entradas donde voy explicando, paso a paso, como crear un aplicaci√≥n, que es una migraci√≥n de una consulta realizada en el ERP Anjelica, el cual es software libre .¬†Esta es la pantalla original de la aplicaci√≥n en Anjelica.\nEsta aplicaci√≥n es una consulta donde la parte del servidor se realiza en Java, usando Spring como Framework y la parte del cliente se realiza en Angular. La comunicaci√≥n entre ambas partes se realiza con servicios REST, usando JSON.\nParte servidor  Primera parte Segunda parte Tercera parte Cuarta¬†parte Quinta parte  Parte cliente  ¬°¬°Angular es reactivo!! Instalaci√≥n y configuraci√≥n b√°sica de Angular Inicializando aplicaci√≥n Manejando rutas  \u0026nbsp;\n\u0026#8230; continuaremos üòâ\n\u0026nbsp;\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/11/28/generar-paginas-web-estaticas-dinamicamente/",
	"title": "Generar paginas Web estaticas dinamicamente",
	"tags": ["hugo", "web"],
	"description": "",
	"content": "Buenas alumnos/as,\nEn esta entrada hablare de Hugo. Este un software¬†permite crear sitios web est√°ticos pero trabajando casi como si fueran din√°micos. Para ello podremos usar diferentes plantillas que configuraremos, para luego a√±adir entradas y contenido din√°mico f√°cilmente. Hugo usa markdown para a√±adir los contenidos pero tambi√©n podremos usar HTML, CSS y JavaScript si fuera necesario.\nPara crear una pagina web lo primero que tenemos que hacer es bajarnos el programa, lo cual podemos hacer desde https://github.com/gohugoio/hugo/releases Una vez tengamos instalado hugo en nuestro ordenador, podremos empezar a crear nuestra propia pagina web.\nComo primer paso abriremos un terminal y ejecutaremos la siguiente sentencia:\n \u0026gt; hugo new site mipagina  Con esto hugo creara un directorio llamado \u0026#8216;mipagina\u0026#8217; debajo del actual. Nos moveremos a el directorio para poder instalar el tema con el que queremos que funcione nuestra p√°gina web.\n\u0026gt; cd mipagina  En https://themes.gohugo.io/ tenemos todas los temas (o plantillas) sobre las que basar nuestra p√°gina web. Estos temas est√°n en su mayor√≠a alojados en GitHub por lo cual lo m√°s f√°cil para descargarlos es usar el comando git . De todos modos, siempre tenemos la opci√≥n de descargar un fichero zip que despu√©s descomprimiremos en el directorio themes\nSupongamos que queremos usar el tema initio que es el que usamos en la p√°gina de RiojaTech Alliance . Para ello iremos a su URL https://themes.gohugo.io/hugo-initio/ y pulsaremos sobre el bot√≥n \u0026#8216;Download\u0026#8216;, lo cual nos llevara a GitHub, a la direcci√≥n https://github.com/miguelsimoni/hugo-initio. All√≠ descargaremos el fichero ZIP, d√°ndole a l bot√≥n Download ZIP.\nDespu√©s descomprimiremos el fichero ZIP dentro del directorio themes , de tal manera que la estructura de nuestros directorios ser√° como la siguiente:\nSuele ser una buena idea copiar el contenido del directorio example-site dentro de nuestro directorio principal para tener una plantilla sobre la que empezar a trabajar.\n Probando nuestra pagina web  Ahora, para ver como va quedando nuestra p√°gina web, ejecutaremos este comando:\n\u0026gt; hugo -F serve  De est√° manera se lanzara un peque√±o servidor web el cual escuchara en el puerto 1313 .\nEste servidor monitorizara los cambios en los ficheros de tal manera que si modificamos cualquier fichero, nuestra pagina web ser√° recargada autom√°ticamente.\nEn la direcci√≥n http://localhost:1313/ con nuestro navegador favorito podremos ver el resultado.\n A√±adiendo contenido  Si queremos a√±adir una entrada en la pagina web usaremos este comando:\n\u0026gt; hugo new post/post0.md  Esto nos generara el fichero \u0026#8216;post0.md\u0026#8217; en el directorio content/post/\nEste fichero tendr√° el siguiente contenido.\n--- title: \u0026quot;post0\u0026quot; # Nombre del post date: 2018-11-01T11:21:58+01:00 ## fecha actual. draft: true # Poner a false para que aparezca el evento ---  Debajo deberemos poner el contenido de nuestro articulo. Recordar que se puede usar el lenguaje markdown y tambi√©n HTML.\nSi ponemos la etiqueta `\n`, si nuestra plantilla lo soporta, separaremos el sumario de nuestro articulo, del articulo completo en si.\n Configurando HUGO  El fichero principal de Hugo esta en el directorio ra√≠z y se llama config.toml\nEn este fichero configuraremos el tema a usar , el titulo de nuestra pagina web y otra serie de par√°metros. Estos par√°metros pueden variar de un tema a otro aunque siempre suele haber unos cuantos en com√∫n.\nEsto es un extracto del fichero config.toml de la web www.lariojatech.org\nbaseURL = \u0026quot;http://lariojatech.org/\u0026quot; languageCode = \u0026quot;es-es\u0026quot; title = \u0026quot;La Rioja Tech Alliance\u0026quot; theme = \u0026quot;hugo-initio\u0026quot; publishDir = \u0026quot;docs\u0026quot; [params] name = \u0026quot;La Rioja Tech Alliance\u0026quot; description = \u0026quot;Los grupos de tecnolog√≠a de La Rioja hacemos pi√±a para promover la tecnolog√≠a \u0026quot; favicon = \u0026quot;images/gt_favicon.png\u0026quot; DateForm = \u0026quot;2, January 2006\u0026quot; .....  Si queremos hacer alg√∫n cambio a la plantilla descargada deberemos cambiar los ficheros ubicados en themes/NOMBRE_PLANTILLA/layouts/partials . Ah√≠ encontraremos una serie de ficheros donde se especifica el comportamiento de la plantilla.\nEn themes/NOMBRE_PLANTILLA/_default es probable que existan los ficheros list.html y single.html. En single.html se definir√° como se deben presentar una pagina de tipo lista, es decir cuando se deben mostrar diferentes art√≠culos juntos. En single.html se especifica como se debe presentar una pagina de un sola entrada.\n Generando pagina web con HTML est√°tico  Para generar todos los ficheros que deber√°n ir en el servidor web, ejecutaremos el comando\n\u0026gt; hugo -F  Los ficheros, por defecto ser√°n generados, en el directorio public . Ese comportamiento se puede cambiar a√±adiendo la directiva publishDir en el fichero config.toml\nEl flag \u0026#8220;\u0026#8221;-F\u0026#8221; es para obligar a Hugo a incluir los posts cuya fecha sea superior a la actual, pues por defecto no los incluye. Si no la pusi√©ramos todos los eventos futuros no aparecer√≠an.\nY esto es todo, solo animaros a que utilizeis este fantastico programa con el que podreis crear paginas dinamicamente para alojarlas, por ejemplo, en GitHub. Gratuitamente por supuesto.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/10/06/aplicacion-rest-en-javaee/",
	"title": "Aplicaci√≥n CRUD usando REST en JavaEE",
	"tags": ["glassfish", "javaee", "json", "netbeans", "rest"],
	"description": "",
	"content": "Buenas, chicos, en esta ocasi√≥n voy a explicar como hacer una aplicaci√≥n CRUD, que sirva peticiones REST con el protocolo JSON, usando JavaEE y Glasfish como servidor de aplicaciones. En esta aplicaci√≥n actualizaremos y consultaremos una peque√±a tabla a trav√©s de diferentes peticiones REST.\nSi bien es cierto que JavaEE no soporta oficialmente JSON en sus especificaciones, la realidad es que es muy f√°cil el realizar una aplicaci√≥n totalmente funcional y muy f√°cilmente con la libreria JACKSON.\nLo primero, aclarar que en¬†https://github.com/chuchip/crudJavaEE teneis c√≥digo fuente del que hablo en esta entrada. Y ahora, pong√°monos manos a la obra.\nComo ya he dicho vamos a utilizar la libreria Jackson que viene incluida con JavaEE 8.0, por lo cual no necesitaremos incluir ninguna librer√≠a externa excepto las necesarias para acceder a la base de datos, a trav√©s de JPA. En este caso utilizaremos EclipseLink, por lo que deberemos incluir en nuestro fichero pom.xml las siguientes dependencias:\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.eclipse.persistence\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;org.eclipse.persistence.core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.3\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.eclipse.persistence\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;org.eclipse.persistence.jpa.jpql\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.3\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.eclipse.persistence\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.persistence\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.1\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.eclipse.persistence\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;org.eclipse.persistence.jpa\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.3\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt;  Tambi√©n incluiremos las dependencias para las libreria LOMBOK y WEB.\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javaee-web-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.16.22\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; Vale, ya tenemos nuestras librerias. Ahora empecemos con el programa.Primero¬†voy a crear la clase donde definimos el punto de entrada de nuestras peticiones REST.¬†Esto lo hacemos en la clase RestConfiguration.java\npackage profesorp.restexample.resource; import javax.ws.rs.ApplicationPath; import javax.ws.rs.core.Application; @ApplicationPath(\"api\") public class RestConfiguration extends Application { } Como pod√©is ver es una clase supersencilla. Tan solo tenemos que crear una clase que herede de Application y a√±adir la etiqueta @ApplicationPath. Con esto ya especificaremos que todas las peticiones que vayan a la trayectoria (Path para los ingleses) api seran tratadas por el servlet de la librer√≠a JACKSON.\nAhora vamos a especificar los diferentes recursos dentro de esta trayectoria o camino. Esto lo haremos en la clase LocaleResource, la cual detallo a continuaci√≥n:\n@Path(\"locale\") @Stateless public class LocaleResource { @Inject private LocaleController localeController; private Logger logger= Logger.getLogger(LocaleResource.class.getName());  ..... FUNCIONES .... } Y como dec√≠a, Jack El Destripador, vayamos por partes üòâ\nLo primero es observar la etiqueta @Path(\u0026#8220;locale\u0026#8221;) que indicara la trayectoria a la que responder√° esta clase. En este caso indicamos la trayectoria locale. Es decir, esta clase sera usada cuando vayamos a la URL: \u0026#8220;http://localhost:8080/restExample/api/locale\u0026#8221; . Aclarar que restExample es donde desplegaremos la aplicaci√≥n en el servidor Glassfish .\nLa etiqueta @Stateless es usada para poder inyectar las dependencias correctamente (vosotros, de momento, hacerme caso y creer que es necesario. ¬°¬° Un acto de fe!! üòâ\nDentro de la clase, con la etiqueta¬†@Inject inyectaremos la clase¬†LocaleController, la cual utilizaremos para interactuar con la base de datos.\nAhora vamos a explicar, una a una las diferentes funciones de¬†esta clase.\n ¬†Funcion findAllLocales  @GET @Produces(MediaType.APPLICATION_JSON) public Response findAllLocales() { logger.log(Level.INFO, \"Buscando todas las locales\"); return Response.ok(localeController.findAll()).build(); } Ahora definimos nuestra primera funci√≥n que nos devolver√° todos los Locales (pa√≠ses) disponibles en nuestra base de datos. Como se ve, ponemos la etiqueta @GET para especificar que debe ser llamada solo en peticiones HTTP tipo GET, y despu√©s a√±adimos la etiqueta\n@Produces(MediaType.APPLICATION_JSON), para especificar que devuelve un resultado en formato JSON.\nDentro de la funci√≥n ponemos usamos la clase javax.ws.rs.core.Response que a trav√©s de su metodo ok, al que debemos pasar el objeto que debe construir en formato JSON, cuando invoquemos a la funci√≥n¬†build. En este caso el objeto pasado a la funci√≥n ok¬†¬†es una colecci√≥n de clases de tipo Locales. Es decir, le pasamos esto: Collection, al llamar a la funci√≥n findAll de la clase LocaleController¬†\nComo se puede ver en el pantallazo, usando el excelente programa postman, podemos ver el resultado de la llamada a esta funci√≥n:\n ¬†Funci√≥n findLocale  @GET @Path(\"/{locale}\") @Produces(MediaType.APPLICATION_JSON) public Response findLocale(@PathParam(\"locale\") String locCodi) { Locales l= localeController.findById(locCodi); try { l.getNombre(); } catch (javax.persistence.EntityNotFoundException k) { return Response.status(Response.Status.NOT_FOUND).build(); } return Response.ok(l).build(); } Aqu√≠ devolveremos el registro que indicamos en el par√°metro mandado. Utilizaremos una vez m√°s la etiqueta @GET y despues a√±adiremos la etiqueta @Path(\u0026#8220;/{locale}\u0026#8221;) de tal manera que a esta funci√≥n se le llamara cuando se haga una peticion HTTP tipo GET y que tenga un unico parametro\nEn la declaraci√≥n de la funci√≥n vemos la anotaci√≥n @PathParam, con la cual indicamos que a la variable \u0026lt;em\u0026gt;locCodi\u0026lt;/em\u0026gt;, se le debe asignar el valor del par√°metro \u0026#8220;locale\u0026#8221;, que anteriormente hemos especificado en la anotaci√≥n @Path.\nLa funci√≥n como tal no tiene muchos misterios. Llamamos a la funcion findByID para buscar en la base de datos el codigo mandado. En caso de que no exista, al intentar recoger el nombre, con la linea l.getNombre()se lanzara una excepci√≥n tipo EntityNotFoundException, en cuyo caso devolveremos una respuesta tipo NOT_FOUND. En caso contrario devolveremos el objeto tipo Locales devuelto.\nY por hoy ya vale\u0026#8230; otro dia continuare con las funciones que a√±aden, actualizan y borran los registros.\nHasta pronto¬†!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/23/kotlin-vs-java/",
	"title": "Kotlin vs Java",
	"tags": ["java", "kotlin"],
	"description": "",
	"content": "Ultimamente se habla mucho de Kotlin, que si Google lo ha marcado como lenguaje preferente en la IO 2017, que si es un lenguaje muy mega-guay para programar en Android, que si soluciona los problemas de Null Pointer Exception.\nEn esta entrada voy a dar mi opini√≥n (sin que nadie me pague üòâ ) comparando ambos lenguajes y diciendo, en mi opini√≥n si es tan guay Kotlin, o es mas humo e intereses comerciales.\nEn primer lugar, decir que Kotlin es compatible con Java, es decir, utiliza la m√°quina virtual de Java y ademas es compatible con este, vamos que tu puedes tener tu programita en Kotlin y ejecutar c√≥digo Java ya creado, con lo cual todas las librerias de Java funcionan en Kotlin. Ahora voy a enumerar las ventajas de Kotlin y ver si realmente son tan trascendentes.\n Kotlin soluciona el problema de los Null Pointer Exception.  A este tema se le ha dado mucha publicidad. En Kotlin, efectivamente, cuando defines una variable tienes que especificarle un valor y si no,¬†marcar la variable como que¬†va a aceptar nulos, Si la marcas como que acepta nulos,¬†no te deja¬†juntarla con otras variables que no han sido marcadas como posibles nulables (vamos, que pueden ser null ).Bueno, realmente si te deja, pero te obliga a marcar el resultado como posible null.\nEl problema es que al final, si usas librerias Java¬†externas (como es lo normal), no tienes ningun control sobre si las funciones Java puras devuelven valores Null o no, con lo cual, lo mas probable es que tengas Null Pointers Exception como antes. Es decir, cuando solo uses Kotlin y todas las librerias externas sean Kotlin, pues igual a este tema¬†le sacas algun provecho pero actualmente se queda cojo.\n Kotlin tiene expresiones lambda.  Vale, Java 8.0 (que ya tiene un tiempo) tambien lo tiene. Otro tema es que se utilize mas o menos, pero vamos que no es una ventaja sobre Java.\n Kotlin soporta variables genericas.  En Kotlin, cuando defines una variable no tienes porque especificar de que tipo es.¬†O sea, puedes crear una variable tal que asi:\nvar s=\u0026quot;hola\u0026quot;  Esto esta muy guay y evita tener que andar poniendo el tipo de variable, pero\u0026#8230;. en Java 10, tambien lo tenemos disponible, usando, ademas, la misma sintaxis. (var n=1;). La unica diferencia es que en Kotlin, las lineas no tienen porque ir terminadas con el punto y coma.\n Extensiones a Funciones.  Kotlin, sobre todo programando en Android, tiene ciertas extensiones, por ejemplo la¬†que hace que puedas acceder a las variables de tu entorno grafico directamente. Otra extension es que tu defines un POJO y no hace falta poner los setters y getters de siempre. Directamente Kotlin los crea por ti. Eso esta muy bien, pero\u0026#8230; en Java tenemos el proyecto Lombok que hace lo mismo, es decir crear al vuelo, las sentencias setters , getters y alguna otra cosa m√°s (echarle un vistazo, esta fenomenal).\nBueno, por no extenderme demasiado, Kotlin es un gran lenguaje y tiene cosas muy chulas, como por ejemplo, el hecho de definir en las funciones valores por defecto, de tal manera que en una funcion puede estar definida algo asi como esto:\nfun multi(x:Int =0,y:Int=0) De tal manera que a esta funcion la podremos llamar con un parametro, con dos o con ninguno, con lo cual te evitas el¬†crear 3 funciones como tendrias que crear en Java, y que una llame a otra (es decir, es un ahorro de c√≥digo sin mas).\nMi opini√≥n: Si vais a programar en Android, aprender Kotlin, la curva de aprendizaje es muy rapida y esta claro que Google le va¬†a dar mucho soporte y a√±adirle m√°s cosas que ayudaran. Es obvio que Android no quiere depender de Java (entre otras cosas por los problemas de licencias que esta teniendo con Oracle) y por eso, al final, Kotlin sera el lenguaje que mandara en Android.\nSi usais Java, pero programando, por ejemplo, servicios Web, yo no me molestaria demasiado en aprender Kotlin: las mejoras que te ofrece no son tan grandes y las que valen la pena, las tienes en las ultimas versiones de Java. Pero claro, esto es solo mi opini√≥n üòâ\n\u0026nbsp;\n"
},
{
	"uri": "http://ww2.profesor-p.com/1-java/",
	"title": "Java",
	"tags": [],
	"description": "",
	"content": "Java Este es un caj√≥n desastre con articulos sobre diferentes temas.\n Kotlin  Articulos relacionados con el lenguaje de programaci√≥n Kotlin:\n Usando Lambdas  En esta breve entrada explicare como mejorar el ejemplo anterior, con el uso de lambdas.\n"
},
{
	"uri": "http://ww2.profesor-p.com/1-java/kotlin/",
	"title": "Kotlin",
	"tags": [],
	"description": "",
	"content": "Articulos relacionados con el lenguaje de programaci√≥n Kotlin:\n Kotlin vs Java  Ultimamente se habla mucho de Kotlin, que si Google lo ha marcado como lenguaje preferente en la IO 2017, que si es un lenguaje muy mega-guay para programar en Android, que si soluciona los problemas de Null Pointer Exception.\nEn esta entrada voy a dar mi opini√≥n (sin que nadie me pague üòâ ) comparando ambos lenguajes y diciendo, en mi opini√≥n si es tan guay Kotlin, o es mas humo e intereses comerciales.\n Aplicacion CRUD con REST en Kotlin y SpringBoot  Buenas chavales, En esta nueva entrada os ense√±are como realizar un programa CRUD, que sirva peticiones REST, usando Spring Boot y como lenguaje de programaci√≥n usar Kotlin. Creo que no har√° falta aclarar que una aplicaci√≥n CRUD es la t√≠pica aplicaci√≥n que permite consultar, insertar, modificar y borrar los datos de una tabla. Vamos, lo que se suele ir llamando un mantenimiento de una tabla. Esta aplicaci√≥n seria una variaci√≥n del que explique en la entrada http://www.\n Aplicacion CRUD con REST en Kotlin y SpringBoot (2¬™ Parte)  Hola de nuevo, chicos. Continuo con la entrada¬†http://www.profesor-p.com/2018/10/11/aplicacion-crud-en-kotlin-con-springboot/¬†para ver como realizar las peticiones REST , con protocolo JSON que es el est√°ndar de facto üòâ en Kotlin. Una vez que ya tenemos la l√≥gica de acceso a nuestra base de datos, tenemos que hacer la parte Web. Pues, aunque os parezca incre√≠ble, esto se hace con una sola clase y ademas de muy pocas lineas. La clase en cuesti√≥n es¬†ApiController.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2-spring/1-testing/",
	"title": "Testing",
	"tags": [],
	"description": "",
	"content": " Testeando aplicaciones Estos son los Articulos disponibles:\n Testeando las aplicaciones  En una pr√≥xima entrada hablare sobre como testear las aplicaciones con pruebas unitarias. Bueno, mostrare como lo hago en mi c√≥digo.\nDe momento, viendo que alguien ya la ha hecho antes (y seguramente mejor) dejo este enlace como aperitivo.\n Uso de perfiles para testear en Spring Boot  Como comentaba en el articulo anterior gracias al uso de perfiles es f√°cil personalizar las aplicaciones en Spring Boot.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/12/05/crear-pagina-web-gratuita-en-github/",
	"title": "Crear pagina web gratuita en GitHub",
	"tags": ["html", "web"],
	"description": "",
	"content": " Buenas. Alumnos,\nEn esta entrada explicare como crear una p√°gina¬†web gratuita¬†en GitHub\nEstas¬†p√°ginas deben ser estaticas¬†pero no hay limitaciones de ancho de banda, numero de ficheros y por supuesto no meteran publicidad en vuestra pagina web. Ademas, utilizara¬†https y podreis usar un dominio propio, si lo habeis comprado con anterioridad. Aclarar que un dominio se puede registrar por solo un euro al a√±o üòâ Adem√°s podeis usar Hugo como explicaba en una anterior entrada para hacer vuestro sitio web est√°tico, m√°s dinamico.\nEso s√≠, para usar GitHub debeis tener al menos ciertas nociones basicas de Git pues se utilizara esta herramienta para subir los ficheros que formaran la pagina web.\nLo primero es crear nuestro proyecto en GitHub, para lo cual deberemos estar registrados.\nTeneis muchos videos y manuales que explican como trabajar con GitHub, uno donde se explica incluso como crear una¬†p√°gina web lo teneis en devCode.la\nPor si os sirve de ayuda he creado un proyecto en https://github.com/chuchip/web que genera la pagina web https://chuchip.github.io/web/\nAclarar que una vez tengamos creado nuestro proyecto, deberemos hacer al menos un push. Es decir subir a GitHub al menos un fichero.\nAhora, para especificar que queremos tener una pagina web para nuestro proyecto, iremos a \u0026#8220;Settings\u0026#8220;\ny bajaremos hasta que veamos la secci√≥n: GitHub Pages\nAhora eligiremos el branch (es decir, la rama) donde estara nuestra pagina web. Para empezar simplemente usar el valor que aparece por defecto: master branch. El tema de \u0026#8216;ramas\u0026#8217; es ampliamente utilizado en GIT pero si solo queremos hacer una pagina web no necesitamos crear ninguna, por lo cual deberemos elegir la rama \u0026#8216;master\u0026#8217; (que sera la √∫nica que exista)\nAhora deberemos elegir que tema vamos a utilizar para nuestra pagina web. Aunque tenemos la opci√≥n de no utilizarlo como explico m√°s adelante, es obligatorio elegir un tema.\nTenemos la opci√≥n de tener un dominio propio tipo www.midominio.com, el cual, logicamente, deberemos tener registrado previamente. Si no tenemos un dominio propio nuestra pagina web sera visible bajo el dominio: http://USUARIO.github.com/PROYECTO\nTenemos dos formas de crear nuestra pagina web\n Utilizando un tema Sin tema para lo cual usaremos un fichero index.html.  * Trabajando con un tema Si elegimos usar un tema lo que se mostrara sera el fichero readme.md que tengamos en nuestro proyecto, maquetado seg√∫n el tema elegido. En este fichero readme.md podremos usar el lenguaje de maquetado MarkDown con el que podremos poner imagenes, formatear nuestro texto con negritas, cursiva, etc,¬†poner enlaces, etc.\nPara poner enlaces a las imagenes se podra usar el formato: ./IMAGEN_A_ENLAZAR\n* Pagina web estatica Si hemos creado un fichero index.html, este fichero se utilizara como p√°gina inicial de nuestra p√°gina web.\nTodas las referencias a imagenes queramos poner deberan ser con el formato:\nhttps://raw.githubusercontent.com/USUARIO/web/master/IMAGEN_A_MOSTRAR\nEs decir si el usuario es \u0026#8216;chuchip\u0026#8216; y el proyecto se llama \u0026#8216;web\u0026#8217;, todas las referencias a imagenes deberan ser con la URL:\nhttps://raw.githubusercontent.com/chuchip/web/master/\nPara las referencias a paginas web, CSS y ficheros javascript podremos usar el formato \u0026#8220;./PAGINA_XX.html\u0026#8221;\n* Notas Aclarar que si tenemos el fichero index.html no utilizara el tema ni se vera el fichero readme.md\nOtra cosa a tener en cuenta que a GitHub le cuesta un poco (menos de un minuto), refrescar la pagina web desde el ultimo push\nY con esto ya tendreis vuestra pagina web alojada gratuitamente.\n¬°¬° Hasta otra!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/10/07/aplicacion-rest-en-javaee-2a-parte/",
	"title": "Aplicaci√≥n CRUD usando REST en JavaEE  (2¬™ Parte)",
	"tags": ["glassfish", "java", "javaee", "jpa", "rest"],
	"description": "",
	"content": "Buenas otra vez.\nEn esta entrada continuo explicando la aplicaci√≥n CRUD, utilizando peticiones REST, con JavaEE.\nRecordar que ten√©is el c√≥digo fuente en https://github.com/chuchip/crudJavaEE\nEn la anterior entrada, que pod√©is ver en¬†en http://www.profesor-p.com/2018/10/06/aplicacion-rest-en-javaee/ hab√≠amos visto como consultar los lenguajes disponibles. Ahora vamos a ver como a√±adir nuevos, modificarlos y borrarlos.\n Funcion¬†create  @POST @Consumes(MediaType.APPLICATION_JSON) public Response create(Locales locale) { if ( localeController.exists(locale.getCodigo())) { return Response.status(Response.Status.CONFLICT).build(); } localeController.create(locale); URI location = UriBuilder.fromResource(LocaleResource.class) .path(\"/{locale}\") .resolveTemplate(\"locale\", locale.getCodigo()) .build(); return Response.created(location).build(); } Como pod√©is observar lo primero es especificar el tipo de petici√≥n HTTP que se va¬†a aceptar,¬†en este caso POST. Especificamos que queremos tratar solo peticiones tipo JSON y ya declaramos la funci√≥n, que recibe un objeto tipo Locales\nDespu√©s comprobamos si ese Locale no exista en la base de datos , devolviendo una respuesta tipo CONFLICT en caso de que ya exista.\nEn caso contrario, insertamos en la base de datos con la funci√≥n create de la clase LocaleController, para despues devolver una respuesta tipo created (c√≥digo 201) con la direcci√≥n donde se podr√≠a consultar el registro reci√©n creado.\nY como siempre, una imagen mejor que cien palabras üòâ\nEn este pantallazo pod√©is ver como se hace la petici√≥n POST, mandando en el cuerpo el objeto JSON, donde se especifica el c√≥digo y el nombre. La aplicaci√≥n devuelve un 201 como estado y¬†Location vemos que tenemos \u0026#8220;http://localhost:8080/restExample/api/locale/es-BO\u0026amp;#8221; que seria donde podemos consultar el registro reci√©n creado.\n Funcion update  @PUT @Path(\"/{codigo}\") public Response update(@PathParam(\"locale\") String codigo, Locales locales) { if (!Objects.equals(codigo, locales.getCodigo())) { throw new BadRequestException(\"Propiedad 'codigo' de Objeto Locale debe coincidir con el par√°metro mandado.\"); } localeController.update(locales); return Response.ok().build(); }  Con esta funci√≥n¬†se actualizara el registro mandado. Mirar como se solicita el c√≥digo del pa√≠s, ademas del objeto tipo locales . Esto es para comprobar que el objeto a modificar coincida con el c√≥digo del pa√≠s mandado. En caso contrario devolver√° una excepci√≥n tipo BadRequestException la cual devolver√° un c√≥digo¬†400 (Bad Request).\nSi todo va bien, devolvemos un c√≥digo 200 (OK).\nAqu√≠ ten√©is un pantallazo actualizando el registro anteriormente insertado.\n Funcion delete  ¬†@DELETE @Path(\"/{codigo}\") public Response delete(@PathParam(\"codigo\") String codigo) { logger.log(Level.INFO, \"Borrando Locale: \"+codigo); if ( ! localeController.exists(codigo)) { return Response.status(Response.Status.NOT_FOUND).build(); } localeController.delete(codigo); return Response.ok().build(); } Esta funci√≥n sera tratada cuando la petici√≥n HTTP sea del tipo DELETE ya que as√≠ esta especificado en la etiqueta @DELETE y deber√° recibir un par√°metro¬†con el c√≥digo del pa√≠s a borrar. Si el pa√≠s en cuesti√≥n no existe devolver√° un c√≥digo error tipo NOT_FOUND y si es borrado correctamente, un 200 (OK).\nY con esto ya tendremos nuestra maravillosa aplicaci√≥n CRUD,¬†a trav√©s de peticiones REST.\nLa l√≥gica de acceso a la base de datos no es diferente a como se har√≠a en Spring o con cualquier otro framework, as√≠ que si ten√©is curiosidad de lo que hay detr√°s, pod√©is bajaros el c√≥digo fuente de mi p√°gina de GitHub.\n¬°¬° Hasta la pr√≥xima !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2-spring/2-seguridad/",
	"title": "Seguridad",
	"tags": [],
	"description": "",
	"content": " Seguridad en Spring  Aqu√≠ tienes un listado de los articulos disponibles:\n Securizando servicios REST con Oauth2 en SpringBoot  Buenas, estudiantes. En esta entrada explicare como podemos dotar de seguridad a servicios REST en Spring Boot. La aplicaci√≥n de ejemplo es la misma que la entrada de seguridad WEB anterior, as√≠ que el c√≥digo fuente lo ten√©is en: https://github.com/chuchip/OAuthServer. Explicando la tecnologia Oauth2 Como he dicho, utilizaremos el protocolo OAuth2, as√≠ que lo primero sera explicar como funciona este protocolo. OAuth2 tiene algunas variantes pero yo os voy a explicar la que utilizare en el programa y,¬†para ello, voy a poneros un ejemplo para que entend√°is lo que pretendemos hacer.\n Seguridad WEB en Spring Boot  Hola de nuevo, estudiantes üòâ . En esta entrada voy a explicar¬†como gestiona Spring la seguridad. No todo, por supuesto, que el tema de la seguridad dar√≠a para un libro muy gordote, pero al menos aprender a securizar una pagina web. En una pr√≥xima entrada hablare de como securizar un servicio REST. Como siempre, comienzo diciendo que el c√≥digo fuente de lo que explico lo ten√©is en mi pagina de GITHUB, en https://github.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2-spring/",
	"title": "Spring",
	"tags": [],
	"description": "",
	"content": "Articulos sobre tem√°s basicos y algunos m√°s avanzadosaa\nAqu√≠ tienes un listado de los articulos disponibles:\n Testing   Seguridad   MVC   Database   Cloud   Webflow   Perfiles en Spring Boot   Lambdas en JDBC Data   Estableciendo filtros en Spring   Cacheando resultados con Spring Boot   Beans avanzados   Usando Zuul para redirigir peticiones REST   Mensajer√≠a con Kafka y Spring Boot   Personalizar salidas de c√≥digos HTTP en Spring Boot   Instalar plugin Spring Boot en NetBeans  "
},
{
	"uri": "http://ww2.profesor-p.com/3-hugo/",
	"title": "Hugo",
	"tags": [],
	"description": "",
	"content": "Articulos sobre HUGO y como crear paginas web estaticas din√°micamente.\n Generar paginas Web estaticas dinamicamente  Buenas alumnos/as,\nEn esta entrada hablare de Hugo. Este un software¬†permite crear sitios web est√°ticos pero trabajando casi como si fueran din√°micos. Para ello podremos usar diferentes plantillas que configuraremos, para luego a√±adir entradas y contenido din√°mico f√°cilmente. Hugo usa markdown para a√±adir los contenidos pero tambi√©n podremos usar HTML, CSS y JavaScript si fuera necesario.\nPara crear una pagina web lo primero que tenemos que hacer es bajarnos el programa, lo cual podemos hacer desde https://github.com/gohugoio/hugo/releases Una vez tengamos instalado hugo en nuestro ordenador, podremos empezar a crear nuestra propia pagina web.\nComo primer paso abriremos un terminal y ejecutaremos la siguiente sentencia:\n \u0026gt; hugo new site mipagina  Con esto hugo creara un directorio llamado \u0026#8216;mipagina\u0026#8217; debajo del actual. Nos moveremos a el directorio para poder instalar el tema con el que queremos que funcione nuestra p√°gina web.\n\u0026gt; cd mipagina  En https://themes.gohugo.io/ tenemos todas los temas (o plantillas) sobre las que basar nuestra p√°gina web. Estos temas est√°n en su mayor√≠a alojados en GitHub por lo cual lo m√°s f√°cil para descargarlos es usar el comando git . De todos modos, siempre tenemos la opci√≥n de descargar un fichero zip que despu√©s descomprimiremos en el directorio themes\nSupongamos que queremos usar el tema initio que es el que usamos en la p√°gina de RiojaTech Alliance . Para ello iremos a su URL https://themes.gohugo.io/hugo-initio/ y pulsaremos sobre el bot√≥n \u0026#8216;Download\u0026#8216;, lo cual nos llevara a GitHub, a la direcci√≥n https://github.com/miguelsimoni/hugo-initio. All√≠ descargaremos el fichero ZIP, d√°ndole a l bot√≥n Download ZIP.\nDespu√©s descomprimiremos el fichero ZIP dentro del directorio themes , de tal manera que la estructura de nuestros directorios ser√° como la siguiente:\nSuele ser una buena idea copiar el contenido del directorio example-site dentro de nuestro directorio principal para tener una plantilla sobre la que empezar a trabajar.\n Probando nuestra pagina web  Ahora, para ver como va quedando nuestra p√°gina web, ejecutaremos este comando:\n\u0026gt; hugo -F serve  De est√° manera se lanzara un peque√±o servidor web el cual escuchara en el puerto 1313 .\nEste servidor monitorizara los cambios en los ficheros de tal manera que si modificamos cualquier fichero, nuestra pagina web ser√° recargada autom√°ticamente.\nEn la direcci√≥n http://localhost:1313/ con nuestro navegador favorito podremos ver el resultado.\n A√±adiendo contenido  Si queremos a√±adir una entrada en la pagina web usaremos este comando:\n\u0026gt; hugo new post/post0.md  Esto nos generara el fichero \u0026#8216;post0.md\u0026#8217; en el directorio content/post/\nEste fichero tendr√° el siguiente contenido.\n--- title: \u0026quot;post0\u0026quot; # Nombre del post date: 2018-11-01T11:21:58+01:00 ## fecha actual. draft: true # Poner a false para que aparezca el evento ---  Debajo deberemos poner el contenido de nuestro articulo. Recordar que se puede usar el lenguaje markdown y tambi√©n HTML.\nSi ponemos la etiqueta `\n Crear pagina web gratuita en GitHub  Buenas. Alumnos, En esta entrada explicare como crear una p√°gina¬†web gratuita¬†en GitHub Estas¬†p√°ginas deben ser estaticas¬†pero no hay limitaciones de ancho de banda, numero de ficheros y por supuesto no meteran publicidad en vuestra pagina web. Ademas, utilizara¬†https y podreis usar un dominio propio, si lo habeis comprado con anterioridad. Aclarar que un dominio se puede registrar por solo un euro al a√±o üòâ Adem√°s podeis usar Hugo como explicaba en una anterior entrada para hacer vuestro sitio web est√°tico, m√°s dinamico.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2-spring/3-mvc/",
	"title": "MVC",
	"tags": [],
	"description": "",
	"content": " MVC Aunque ya no se utiliza tanto aqui tienes un articulo sobre Spring MVC.\n Ejemplo aplicaci√≥n MVC con Spring Boot usando NetBeans 9  En una entrada anterior explique como instalar NetBeans 9, a√±adiendole el plugin para usar Spring Boot. Ahora vamos a crear nuestro primer proyecto en este entorno. Pulsaremos New Project, lo cual nos mostrara una pantalla como la siguiente. y en el campo Filter pondremos spring,¬†para despu√©s eligir Spring Boot Inititilizr project. Pulsaremos Next y nos pedir√°¬†una serie de datos sobre¬†nuestro proyecto. Para este ejemplo podemos dejar los campos como aparecen por defecto.\n"
},
{
	"uri": "http://ww2.profesor-p.com/4-angular/",
	"title": "Angular",
	"tags": [],
	"description": "",
	"content": "Articulos diversos sobre Angular\n Curso de Angular 6  En esta p√°gina ir√© poniendo las sucesivas entradas donde intentare dar un curso b√°sico sobre Angular 6 En el curso se desarrollara una aplicaci√≥n que usando peticiones RESTFUL, realizara una consulta mostrando un hist√≥rico de ventas. En la aplicaci√≥n se usara Boostrap y se explicara como utilizar rultas. La aplicaci√≥n backend, en el servidor, esta hecho en Java, usando Spring Framework,¬†y se puede ver en su desarrollo en la pagina: http://www.\n Aplicaci√≥n usando Java y Angular  A continuaci√≥n detallo las entradas donde voy explicando, paso a paso, como crear un aplicaci√≥n, que es una migraci√≥n de una consulta realizada en el ERP Anjelica, el cual es software libre .¬†Esta es la pantalla original de la aplicaci√≥n en Anjelica. Esta aplicaci√≥n es una consulta donde la parte del servidor se realiza en Java, usando Spring como Framework y la parte del cliente se realiza en Angular.\n Angular ‚Äì Hablando espa√±ol  Angular si no se le dice lo contrario, es ingles del bueno. Las fechas las pondr√° en su formato de mes/dia/a√±o . Los n√∫meros ser√°n con las comas con separadores de miles y los decimales con puntos. Vamos, muy ingles todo. El problema es que no todo el mundo es ingles (aunque les pene a los ingleses ;- )) . As√≠ que en esta entrada voy a explicar como hacer que Angular se nos vuelva espa√±ol.\n Angular 6 ‚Äì A√±adir Bootstrap 4 con JQuery  Recordar lo primero que para utilizar toda la potencia de BootStrap, necesitamos tener instaladas las librerias de¬†JQuery y Popper¬†Hay varias maneras de¬†instalar estas librer√≠as. Localmente usando npm Una vez estemos situados el directorio principal del proyecto, desde tu terminal preferido ejecutar las instrucciones siguientes: npm install¬†bootstrap@4 jquery popper.js --save Esto nos instalara los archivos necesarios bajo el directorio¬†node-modules.¬†Ahora debemos incluir el fichero de estilos (css) de BootStrap y las librer√≠as JavaScript de BootStrap, JQuery y Pooper.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2-spring/4-database/",
	"title": "Database",
	"tags": [],
	"description": "",
	"content": "Database Entradas sobre acceso a base de datos, con JPA y JDBC\n Optimizando relaciones entre entidades en Hibernate  En esta entrada, siguiendo el proyecto de ejemplo que teneis en¬†https://github.com/chuchip/jpajoins explicando como optimizar¬†las consultas a la base de datos usando JPA. Se ver√°n diferentes tipos de consultas, explicando como realizar uniones entre tablas de modo perezoso (lazy) o agresivo (eager). Se unir√°n tablas por un solo campo, por varios e incluso por uno pero a√±adiendo una condici√≥n est√°tica. EL proyecto de ejemplo esta desarrollado en Spring Boot con Hibernate, usando como base de datos H2.\n Accediendo facilmente a los datos con Spring Rest Data  Spring Boot ofrece un fant√°stico soporte para acceder a los datos con JPA a trav√©s de sus interfaces, del tipo Repository. Si a esto le a√±adimos la facilidad con que se crean servicios REST, como explicaba en la entrada [http://www.profesor-p.com/2018/10/11/aplicacion-crud-en-kotlin-con-springboot/][2] podremos hacer una aplicaci√≥n ofreciendo una API para acceder a nuestra base de datos preferida muy facilmente. Pero si queremos implementar HATEOAS en nuestro proyecto o si hay muchos criterios sobre los que debemos acceder a los datos, deberemos escribir bastante c√≥digo.\n Querys avanzadas con JPA en Spring Boot  Hay veces en que las campos sobre los que restringir una consulta pueden variar en tiempo de ejecuci√≥n. En ese caso si queremos usar JPA no podemos usar una sentencia @Query definida en nuestro repositorio pues no sabemos los campos sobre los que se aplicaran condiciones en la consulta. Adem√°s es bastante com√∫n que el usuario pueda elegir el criterio de b√∫squeda sobre un campo, deseando que el valor de un campo deba ser igual, mayor o menor, respecto al valor introducido .\n JPA \u0026#43; Hibernate en Spring  En un entrada anterior, explique como crear nuestra conexi√≥n a la base de datos, usando JNDI. En esta entrada explicare como usar esa conexi√≥n con JPA. Recordar que el c√≥digo fuente de de este ejemplo esta en: https://github.com/chuchip/jdbc_jpa_tomcat Importante recalcar que este ejemplo solo funciona con Java 1.8 o superior. Lo primero explicar un poco de que va esto de JPA.¬†JPA son las siglas de¬†Java Persistence API. Es decir la API de persistencia en Java.\n JPA con Lombok, simplificando.  En un entrada anterior, explique que para usar JPA hay que tener nuestros objetos POJO definidos .¬†En esta entrada hablare de como mejorar la la definicion de nuestro objeto POJO, con la libreria Lombok. Recordar que el c√≥digo fuente de de este ejemplo esta en: https://github.com/chuchip/jdbc_jpa_tomcat Anteriormente teniamos definido nuestro objeto de esta manera: @Entity @Table(name = \u0026quot;usuario\u0026quot;, uniqueConstraints = { @UniqueConstraint(columnNames = {\u0026quot;login\u0026quot;})}) public class Usuario implements Serializable { @Id String login; @Column String nombre; public Usuario() { } public String getLogin() { return login; } public void setLogin(String login) { this.\n Acceso a Base de Datos con Spring Data JDBC  En el anterior articulo explicaba como crear la conexion a la base de datos en un servidor de aplicaciones Tomcat . En este articulo explicare como acceder a esos datos a traves del paquete JDBC de Spring Data JDBC El c√≥digo fuente de este ejemplo esta en: https://github.com/chuchip/jdbc_jpa_tomcat Creando nuestro POJO y Repositorio Ahora que ya tenemos nuestro acceso a la base de datos configurado y disponible, vamos a utilizarlo (por eso de que no se aburra üòâ )\n"
},
{
	"uri": "http://ww2.profesor-p.com/2-spring/5-cloud/",
	"title": "Cloud",
	"tags": [],
	"description": "",
	"content": "Cloud Entradas relaciondas con el desarrollo de aplicaciones Spring en la nube.\n Microservicios distribuidos con Eureka  En esta clase hablare de como crear microservicios distribuidos en Spring Boot utilizando las facilidades que nos da el paquete Spring Cloud NetFlix. Cualquier microservicio debe poder localizar las diferentes instancias de otro servicio del que dependa sin tener sus direcciones definidas en el c√≥digo. En el caso de que un microservicio deba acceder a otro lo ideal seria que de alguna manera pudiera saber en que direcciones esta las instancias de ese otro microservicio funcionando, pues lo m√°s com√∫n es que se levanten diferentes instancias dependiendo de la carga.\n Servidor configuraciones usando Spring Cloud  En esta ocasi√≥n vamos a usar el paquete Spring Cloud Config para poder tener configuraciones remotas para nuestras aplicaciones. La idea es que nuestro programa o programas puedan ir a buscar sus par√°metros de configuraci√≥n a un lugar externo, de tal manera que nuestra aplicaci√≥n sea f√°cilmente parametrizable e incluso se puedan cambiar sus configuraciones en caliente. Esto se utiliza ampliamente en microservicios pues una mismo servicio o aplicaci√≥n puede estar lanzada muchas veces en diferentes contenedores y es interesante tener un lugar central desde donde se puedan aplicar las configuraciones a estos servicios.\n ‚Å†‚Å†‚Å†18082188w"
},
{
	"uri": "http://ww2.profesor-p.com/5-dba/",
	"title": "DBA",
	"tags": [],
	"description": "",
	"content": "Enlaces disponibles:\n Conectando a una base de datos usando JNDI y Spring en Tomcat  1. Introducci√≥n En este ejemplo veremos como conecta a Postgresql usando JPA + Hibernate y Spring JDBC. Para ello uso como servidor de aplicaciones Tomcat. La configuraci√≥n esta realizada con anotaciones y XML y utilizo el pool de conexiones de Tomcat recogido a trav√©s de JNDI, para que la aplicaci√≥n no deba saber realmente ni donde se conecta. El c√≥digo fuente lo teneis en: https://github.com/chuchip/jdbc_jpa_tomcat En este enlace teneis este mismo documento (todas las partes) pero en PDF.\n"
},
{
	"uri": "http://ww2.profesor-p.com/6-javaee/",
	"title": "J2EE",
	"tags": [],
	"description": "",
	"content": "Ejemplos usando java EE. (La competencia de Spring üòÑ )\n Aplicaci√≥n CRUD usando REST en JavaEE  Buenas, chicos, en esta ocasi√≥n voy a explicar como hacer una aplicaci√≥n CRUD, que sirva peticiones REST con el protocolo JSON, usando JavaEE y Glasfish como servidor de aplicaciones. En esta aplicaci√≥n actualizaremos y consultaremos una peque√±a tabla a trav√©s de diferentes peticiones REST. Si bien es cierto que JavaEE no soporta oficialmente JSON en sus especificaciones, la realidad es que es muy f√°cil el realizar una aplicaci√≥n totalmente funcional y muy f√°cilmente con la libreria JACKSON.\n Aplicaci√≥n CRUD usando REST en JavaEE (2¬™ Parte)  Buenas otra vez. En esta entrada continuo explicando la aplicaci√≥n CRUD, utilizando peticiones REST, con JavaEE. Recordar que ten√©is el c√≥digo fuente en https://github.com/chuchip/crudJavaEE En la anterior entrada, que pod√©is ver en¬†en http://www.profesor-p.com/2018/10/06/aplicacion-rest-en-javaee/ hab√≠amos visto como consultar los lenguajes disponibles. Ahora vamos a ver como a√±adir nuevos, modificarlos y borrarlos. Funcion¬†create @POST @Consumes(MediaType.APPLICATION_JSON) public Response create(Locales locale) { if ( localeController.exists(locale.getCodigo())) { return Response.status(Response.Status.CONFLICT).build(); } localeController.create(locale); URI location = UriBuilder.\n Desarrollando aplicaciones Java EE en NetBeans 9  El recien salido NetBeans 9, es un excelente IDE, con soporte para Java 10 y 11, y con otra serie de caracter√≠sticas muy interesantes. Sin embargo, por temas de licencias con Oracle que es el due√±o del antiguo NetBeans, solo tiene soporte para¬†Java Standard Edition, no pudiendo, en teor√≠a, hacer aplicaciones para Java EE. Pero es solo en teoria, pues NetBeans 9, mantiene la compatibilidad con la versi√≥n 8.2, incluso a nivel de plugins.\n "
},
{
	"uri": "http://ww2.profesor-p.com/2-spring/6-webflow/",
	"title": "Webflow",
	"tags": [],
	"description": "",
	"content": "Webflow Entradas relaciondas con el desarrollo de aplicaciones Spring en la nube.\n Spring WebFlow con JSP ‚Äì Configuraci√≥n  Buenas, estudiantes. En este articulo intentare explicar como funciona Spring WebFlow y para ello, como siempre, lo har√© desarrollando un programa que pod√©is descargar de¬†https://github.com/chuchip/webflowExample El programa simulara que entras a la p√°gina de un banco donde puedes realizar una transferencia de tus cuentas personales a otra. Para ello, primero deber√°s identificarte y seg√∫n el usuario con el que te identifiques tendr√°s acceso a unas cuentas que a su vez disponen de un saldo establecido.\n Spring WebFlow con JSP  En el articulo anterior http://www.profesor-p.com/2018/10/29/spring-webflow-con-jsp-configuracion/ explicaba como configurar el programa para que Spring WebFlow funcionara. En este articulo explicare como hacer el flujo en si. La p√°gina principal del programa no esta dentro de ning√∫n flujo y sus peticiones son respondidas por Spring MVC, en la clase MyController, la cual podemos encontrar en el paquete profesorp.webflow.controller. Esta clase anotada con la etiqueta @Controller responde en la funci√≥n indice1 a las peticiones de los recursos \u0026#8220;/\u0026#8221; e \u0026#8220;index\u0026#8221;\n ‚Å†‚Å†‚Å†18082188w"
},
{
	"uri": "http://ww2.profesor-p.com/2018/10/29/spring-webflow-con-jsp-configuracion/",
	"title": "Spring WebFlow con JSP ‚Äì Configuraci√≥n",
	"tags": ["bootstrap", "java", "jdbc", "jquery", "jstl", "l", "mvc", "security", "seguridad", "spring", "tomcat", "webflow"],
	"description": "",
	"content": "¬†Buenas, estudiantes. En este articulo intentare explicar como funciona Spring WebFlow y para ello, como siempre, lo har√© desarrollando un programa que pod√©is descargar de¬†https://github.com/chuchip/webflowExample\nEl programa simulara que entras a la p√°gina de un banco donde puedes realizar una transferencia de tus cuentas personales a otra. Para ello, primero deber√°s identificarte y seg√∫n el usuario con el que te identifiques tendr√°s acceso a unas cuentas que a su vez disponen de un saldo establecido. Para realizar todo esto utilizo H2 como base de datos y la autentificaci√≥n se realiza con el paquete de seguridad de Spring, utilizando JDBC . Por hacer la p√°gina mas funcional utilizo Bootstrap y JQuery.\nEl programa esta realizado para que funcione bajo Tomcat, en el contexto: webflow. Por lo que deberemos ir a la direcci√≥n http://localhost:8080/webflow¬† para probar nuestra aplicaci√≥n:\nEn esta imagen se puede ver la definici√≥n del flujo de trabajo.\nSpring WebFlow es un paquete con el cual podemos definir el flujo de nuestra aplicaci√≥n. Es decir, definimos las acciones a realizar cuando se pulse un enlace, se cumpla cierta condici√≥n, etc. Estos flujos son definidos en ficheros XML, de tal manera que ah√≠ es donde definimos que de la PAGINA_X, al pulsar el BOTON1, vaya a la PAGINA_XY, siempre y cuando¬†la CONDICION_Z se cumpla. Esto nos permite separar la l√≥gica del programa de las vistas (los ficheros JSP), ademas de ser m√°s f√°cil el reutilizar c√≥digo.\n\u0026#8211; Estructura\nLa estructura del programa es la que se ve en la¬†imagen siguiente:\nDentro del directorio WEB-INF esta la carpeta flows, que a su vez tiene la carpeta traspaso y time donde definimos los dos flujos de trabajo que se usan en la aplicaci√≥n. Observar que los ficheros xml con la definici√≥n del flujo de trabajo tambi√©n se aloja en las mismas carpetas donde estan los JSP de su flujo. Es decir el flujo de trabajo \u0026#8220;traspaso\u0026#8221; se define en el fichero \u0026#8220;traspaso.xml\u0026#8221; y utiliza los ficheros: cuentaOrigen.jsp, importe.jsp, confirmar.jsp, _include.jsp y _navegador.jsp.\nDentro del directorio WEB-INF tambi√©n se alojan las carpetas css y img donde se guardan respectivamente las plantillas css y las im√°genes de la aplicaci√≥n.¬†\n Configurando la Base de Datos y Persistencia  Empezare mostrando las tablas usadas en la aplicaci√≥n:\ncreate TABLE clientes ( id int NOT NULL, login varchar(45) not null, nombre varchar(100) not null, dni varchar(15) not null, unique key(login) ); create table cuentas( cuenta varchar(50) not null, importe double not null, unique key(cuenta) ); create table cuentas_clientes( id int not null, cuenta varchar(50) not null, unique key(id,cuenta) ); alter table cuentas_clientes add CONSTRAINT fk_cuentas FOREIGN KEY (cuenta) REFERENCES cuentas (cuenta); create table users( username varchar(45) not null, password varchar(100) not null, enabled smallint not null default 1, unique key (username) ); CREATE TABLE user_roles ( user_role_id int(11) NOT NULL AUTO_INCREMENT, username varchar(45) NOT NULL, role varchar(45) NOT NULL, PRIMARY KEY (user_role_id), UNIQUE KEY uni_username_role (role,username) ); alter table user_roles add CONSTRAINT fk_username FOREIGN KEY (username) REFERENCES users (username) La tabla clientes, cuentas y cuentas_clientes son usadas por la l√≥gica del programa, mientras que users y user_roles son usadas por el modulo de seguridad de spring.\nLa persistencia esta definida en la clase JpaConfig. Pod√©is ver una explicaci√≥n de esta clase en la parte de la configuraci√≥n de JPA de esta entrada: http://www.profesor-p.com/2018/09/03/aplicacion-en-spring-rest-y-angular-2-parte/#jpa\n Dependencias  Necesitaremos tener el paquete de JPA, JDBC,¬†Hibernate, soporte de transaciones y por supuesto de H2.\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.data\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-data-jpa\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.9.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-jdbc\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.0.10.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.h2database\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;h2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.4.197\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.hibernate\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;hibernate-agroal\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.3.5.Final\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;!-- Paquete para dar soporte a transaciones --\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-tx\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt;  Configurando MVC y¬†WEB-FLOW   Clase WebConfig \n   En ella se configura¬†la parte MVC¬†de la aplicaci√≥n. As√≠ en la funci√≥n addResourceHandlers especifico que los recursos de las peticiones¬†a¬†\u0026#8220;webjars\u0026#8221; deber√°n ser buscadas en el directorio /webjars y que los recursos de las peticiones a resources deber√°n ser buscadas en el directorio /WEB-INF/resources/. Es decir que cuando vayamos a http://localhost:8080/webflow/resources/XX deber√° traer el fichero¬†/WEB-INF/resources/XX\n@Override public void addResourceHandlers(ResourceHandlerRegistry registry) { registry .addResourceHandler(\"/webjars/**\") .addResourceLocations(\"/webjars/\"); registry .addResourceHandler(\"/resources/**\") .addResourceLocations(\"/WEB-INF/resources/\"); } La funci√≥n viewResolver establece que se usara la JSTL (que no es sino una extensi√≥n de JSP), especificando en que directorio y que extensiones debe resolver.\n@Bean public ViewResolver viewResolver() { InternalResourceViewResolver viewResolver = new InternalResourceViewResolver(); viewResolver.setViewClass(JstlView.class); viewResolver.setPrefix(\"/WEB-INF/jsp/\"); viewResolver.setSuffix(\".jsp\"); return viewResolver; } Las funciones FlowHandlerMapping y FlowHandlerAdapter especificaran los identificadores o registros de webflow y sus correspondiente ejecutores. Ahora explicare que es eso üòâ\n Clase WebFlowConfig   En esta clase configuramos webflow como tal, para ello lo primero es extender de la clase AbstractFlowConfiguration y definir las funciones que detallo a continuaci√≥n:\n@Bean public FlowDefinitionRegistry flowRegistry() { return getFlowDefinitionRegistryBuilder() .addFlowLocation(\"/WEB-INF/flows/traspaso/traspaso.xml\",\"traspaso\") .addFlowLocation(\"/WEB-INF/flows/traspaso/time/traspaso_time.xml\",\"traspaso_time\") .build(); } En esta funci√≥n se declaran los diferentes identificadores de los flujos a usar.As√≠ tenemos que el identificador \u0026#8220;traspaso\u0026#8221; estar√° definido en el directorio \u0026#8220;/WEB-INF/flows/traspaso/traspaso.xml\u0026#8220;. Esto lo que significa es que cuando vayamos a la direcci√≥n: http://localhost:8080/webflow/traspaso entraremos en el flujo que tenemos definido en el fichero indicado. A su vez, cuando vayamos a http://localhost:8080/webflow/traspaso_time entraremos al flujo declarado en \u0026#8220;/WEB-INF/flows/traspaso/time/traspaso_time.xml\u0026#8220;.\nEn este caso yo defino individualmente los dos flujos, pero se pueden utilizar comodines para que Spring busque dentro de un directorio todos los ficheros que cumplan ciertos criterios. As√≠, la sentencia: .addFlowLocationPattern(\u0026lt;span class=\u0026quot;hl-string\u0026quot;\u0026gt;\u0026quot;/WEB-INF/flows/**/*-flow.xml\u0026quot;\u0026lt;/span\u0026gt;)especificar√≠a que a√±adiera todos los flujos que encontrara en el directorio /WEB-INF/flows¬†cuyo nombre terminara en \u0026#8220;flow.xml\u0026#8221;. Los identificadores en este caso serian los nombres de los ficheros sin la extensi√≥n xml. Es decir si tenemos el fichero: \u0026lt;span class=\u0026quot;hl-string\u0026quot;\u0026gt;/WEB-INF/flows/consulta-flow.xml\u0026lt;/span\u0026gt; el identificador seria \u0026#8220;consulta-flow\u0026#8221;\nLa siguiente funci√≥n simplemente llama a la anterior para especificar los ejecutores de los registros¬†anteriormente definidos.\n@Bean public FlowExecutor flowExecutor() { return getFlowExecutorBuilder(flowRegistry()).build(); } Aclarar que el trabajo del FlowExecutor es crear y ejecutar los flujos de trabajo que anteriormente hayamos definido en los registros.\nLas siguientes funciones unen las vistas (ficheros JSP) con el paquete webflow. Como se puede observar crea dos objetos en los cuales se definen las uniones entre el¬†paquete MVC de Spring y el paquete WebFlow. Esto es as√≠ porque el paquete WebFlow tambi√©n funciona con otros MVC como¬†JavaServer Faces de JavaEE\n¬†@Bean public FlowBuilderServices flowBuilderServices() { return getFlowBuilderServicesBuilder() .setViewFactoryCreator(mvcViewFactoryCreator()) .setDevelopmentMode(true).build(); } @Bean public MvcViewFactoryCreator mvcViewFactoryCreator() { MvcViewFactoryCreator factoryCreator = new MvcViewFactoryCreator(); factoryCreator.setViewResolvers( Collections.singletonList(this.webMvcConfig.viewResolver())); factoryCreator.setUseSpringBeanBinding(true); return factoryCreator; }  Dependencias  Ademas del paquete JSTL, tambi√©n usamos el paquete spring-security-taglibs que es una extensi√≥n de JSTL que nos permite trabajar¬†con el paquete de seguridad de Spring dentro de nuestros ficheros JSP. Por supuesto tambi√©n debemos incluir el paquete spring-webflow\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;jstl\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jstl\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-taglibs\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.webflow\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-webflow\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.5.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026#8211; Configurando la seguridad\nNo es mi intenci√≥n el volver a explicar como funciona la seguridad en Spring, pues aunque en anteriores ejemplos (http://www.profesor-p.com/2018/10/17/seguridad-web-en-spring-boot/) los usuarios los guardaba en memoria en vez en una base de datos como en esta ocasi√≥n, realmente lo √∫nico que cambia es que se incluye la¬†funci√≥n: \u0026lt;strong\u0026gt;configure(AuthenticationManagerBuilder auth)\u0026lt;/strong\u0026gt;y se quita la funci√≥n¬†UserDetailsService de la clase SecurityWebConfig.\n@Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth .jdbcAuthentication() .dataSource(dataSource) .usersByUsernameQuery( \"select username,password, enabled from users where username=?\") .authoritiesByUsernameQuery( \"select username, role from user_roles where username=?\") .passwordEncoder(passwordEncoder()); } En esta funci√≥n se configura la autentificaci√≥n por jdbc de la clase AuthenticationManagerBuilder especific√°ndole el DataSource a usar, as√≠ como las sentencias SQL¬†a ejecutar para validar los usuarios y los roles de estos.\nLa clase configure(HttpSecurity http) configura¬†la seguridad no teniendo nada en particular, solo resaltar que no deshabilito el modulo de seguridad CRSF por lo cual todas las peticiones POST deben incluir nuestro identificador CRSF. Lo veremos m√°s tarde al explicar los ficheros JSP.\n@Override protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .antMatchers(\"/\", \"/index\", \"/webjars/**\", \"/resources/**\").permitAll() .antMatchers(\"/**\").authenticated() .anyRequest().denyAll().and() .formLogin() .loginPage(\"/login\") .defaultSuccessUrl(\"/user\") // Para que registremos el usuario .permitAll() .and() .logout().logoutSuccessUrl(\"/index\") .permitAll(); } La clase SecurityWebApplicationInitializer que extiende de AbstractSecurityWebApplicationInitializer debe estar definida pues esta aplicaci√≥n al no ser Spring Boot, sino Spring a secas la necesita para implementar la seguridad web. La configuraci√≥n, simplemente es inexistente. Con que exista la clase es suficiente üòâ\n Dependencias  Definimos los paquetes de seguridad de Spring, incluyendo el de seguridad web.\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-web\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-config\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; En la pr√≥xima entrada explicare el programa paso a paso üòâ\n¬°¬° Nos vemos!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/10/11/aplicacion-crud-en-kotlin-con-springboot/",
	"title": "Aplicacion CRUD con REST en Kotlin y SpringBoot",
	"tags": ["crud", "jpa", "kotlin", "rest", "spring boot"],
	"description": "",
	"content": "Buenas chavales,\nEn esta nueva entrada os ense√±are como realizar un programa CRUD, que sirva peticiones REST, usando Spring Boot y como lenguaje de programaci√≥n usar Kotlin.\nCreo que no har√° falta aclarar que una aplicaci√≥n CRUD es la t√≠pica aplicaci√≥n que permite consultar, insertar, modificar y borrar los datos de una tabla. Vamos, lo que se suele ir llamando un mantenimiento de una tabla.\nEsta aplicaci√≥n seria una variaci√≥n del que explique en la entrada http://www.profesor-p.com/2018/10/06/aplicacion-rest-en-javaee/¬†, donde se utilizaba JavaEE. Como frontend para¬†este programa pod√©is usar el realizado en Angular, que¬†explico en esta entrada http://www.profesor-p.com/2018/10/08/aplicacion-crud-en-angular/ ya que lo he hecho totalmente compatible.\nEl c√≥digo fuente lo ten√©is en mi repositorio de GitHub, en: https://github.com/chuchip/restKotlin\nBueno, !!manos a la obra!!\nLo primero sera cambiar de IDE, ya que mi querido NetBeans no soporta el lenguaje Kotlin. Por ello utilizaremos Eclipse, habi√©ndole instalado el plugin de Kotlin y de Spring Boot. Tampoco os voy a explicar como instalar estos plugins pues ten√©is unos 600 manuales por la web y tampoco es cuesti√≥n de alargarme demasiado üòâ\nUtilizando el magnifico asistente de \u0026#8220;Spring Starter Project\u0026#8221; crearemos un proyecto Spring Boot, al que le tendremos que a√±adir los paquetes \u0026#8220;H2\u0026#8243;,\u0026#8221;JPA\u0026#8221; y \u0026#8220;WEB\u0026#8221;. ¬°¬° Acordaros de elegir Kotlin como lenguaje de programaci√≥n !!\nUna vez tenemos nuestro proyecto creado, debemos comprobar la configuraci√≥n del compilador de Kotlin, para ello nos iremos a las Propiedades del proyecto y elegiremos la pesta√±a \u0026#8220;Kotlin Compiler\u0026#8221;. Ah√≠ deberemos especificar que que la versi√≥n de java para la que debe compilar es la 1.8¬†y deberemos incluir los plugins Spring y JPA. La pantalla deber√° quedar como esta:\nAhora ya podemos ponernos a teclear üòâ\nEclipse nos habr√° creado la clase de entrada , que sera algo como esto:\nimport org.springframework.boot.autoconfigure.SpringBootApplication import org.springframework.boot.runApplication @SpringBootApplication class RestKotlinApplication fun main(args: Array\u0026amp;lt;String\u0026amp;gt;) { runApplication\u0026amp;lt;RestKotlinApplication\u0026amp;gt;(*args) }  Esta clase la dejaremos sin tocar, pues nos¬†sirve perfectamente.\nDeberemos configurar el fichero application.properties de Spring Boot, para especificarle que queremos usar una base de datos H2 y ponerle los par√°metros de conexi√≥n. Quedara algo como esto:\n# H2 spring.h2.console.enabled=true spring.h2.console.path=/h2 # Datasource spring.datasource.url=jdbc:h2:file:~/test spring.datasource.username=sa spring.datasource.password= spring.datasource.driver-class-name=org.h2.Driver  Observar las anotaciones: spring.h2.console.enabled=true y spring.h2.console.path=/h2 que nos permitira acceder a la consola de H2. Podremos acceder yendo a la URL: http://localhost:8080/h2\nTambi√©n he creado un fichero llamado data.sql que¬†Spring Boot ejecutara para precargar la base de datos con algunos valores, porque, como veis, la base de datos se crea solo en memoria.\nEl fichero deber√° estar en el directorio resources y es algo parecido a esto:\ninsert into locales values('es_ES', 'espa√±ol (Espa√±a)'); insert into locales values('fr', 'frances'); insert into locales values('fr_BE', 'franc√©s (B√©lgica)'); insert into locales values('ca_ES', 'catal√°n (Espa√±a)'); insert into locales values('es_AR', 'espa√±ol (Argentina)');  La aplicaci√≥n actualmente ya es ejecutable,¬†aunque solo podr√≠amos acceder a la consola de H2. !! Pod√©is jugar con ella, que esta muy bien hecha y tiene mucha potencia!!\nAhora pasamos a crear nuestra entidad de Idiomas, a la que yo he llamado locales.kt\nimport com.fasterxml.jackson.annotation.JsonProperty import javax.persistence.Basic import javax.persistence.Column import javax.persistence.Entity import javax.persistence.Id import javax.persistence.Table import javax.validation.constraints.NotNull import javax.validation.constraints.Size @Entity @Table(name = \u0026quot;locales\u0026quot;) data class Locales ( @Id @Basic(optional = false) @NotNull @Size(min = 1, max = 5) @JsonProperty(value = \u0026quot;codigo\u0026quot;) @Column(name = \u0026quot;loc_codi\u0026quot;) val codigo: String, @JsonProperty(value = \u0026quot;nombre\u0026quot;) @Column(name = \u0026quot;nombre\u0026quot;) val nombre: String ) { }  Como veis es una clase muy normalita. Aclarar que he puesto algunas etiquetas que no son necesarias para que ve√°is como podriais usarlas. As√≠ las etiquetas: @Table(name = \u0026#8220;locales\u0026#8221;), @JsonProperty(value = \u0026#8220;codigo\u0026#8221;) y @ColumName no son necesarias pues los nombres de las clases y variables coinciden con los de la base de datos.\nObservar como se define la clase con la etiqueta data class y lo f√°cil que es crear una entidad en Kotlin al no tener que definir setters, getters¬†y definir las propias variables globales en el constructor. Vamos, que si os fijais, la clase como tal no tiene nada ;-).\nAhora definimos la clase que hara de repositorio, a la que yo he llamado: LocaleRepository.kt\nimport org.springframework.data.jpa.repository.Query import org.springframework.data.repository.CrudRepository import profesorp.kotlin.entity.Locales interface LocaleRepository : CrudRepository\u0026amp;lt;Locales,String\u0026amp;gt; { @Query(\u0026quot;SELECT l FROM Locales l where l.codigo like ?1 and upper(l.nombre) like ?2\u0026quot;) fun findLike(codigo:String, nombre:String):Iterable\u0026amp;lt;Locales\u0026amp;gt;; }  Otra clase super compleja üòâ\n¬øHay que explicar algo ?. Bueno, quizas que he creado una nueva funci√≥n que usaremos para poder filtrar los pa√≠ses por nombre y/o c√≥digo. S√≠, esa funcion que he llamado findLike\nBueno, y por ahora ya vale. En la pr√≥xima entrada detallare la clase que sirve las peticiones REST.\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/27/testeando-las-aplicaciones/",
	"title": "Testeando las aplicaciones",
	"tags": ["java", "junit", "mvc", "test"],
	"description": "",
	"content": "En una pr√≥xima entrada hablare sobre como testear las aplicaciones con pruebas unitarias. Bueno, mostrare como lo hago en mi c√≥digo.\nDe momento, viendo que alguien ya la ha hecho antes (y seguramente mejor) dejo este enlace como aperitivo.\nhttps://platzi.com/jee/tutoriales/pruebas-usando-junit-mockito-y-mockmvc/\nEsta serie de videos hablando de JUnit de Makigas tambi√©n servir√°n aclarar ideas y conocer lo b√°sico de JUNIT, el cual es practicamente imprescindible para testear las aplicaciones.\n\nNos vemos en la siguiente entrada.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/03/01/uso-de-perfiles-en-testing-en-spring-boot/",
	"title": "Uso de perfiles para testear en Spring Boot",
	"tags": ["java", "profiles", "spring boot"],
	"description": "",
	"content": "Como comentaba en el articulo anterior gracias al uso de perfiles es f√°cil personalizar las aplicaciones en Spring Boot.\nUno de los casos mas habituales del uso de perfiles es para testear la aplicaci√≥n. Partiendo del mismo c√≥digo fuente anterior, que os recuerdo esta en https://github.com/chuchip/profilestest vamos a ver el uso de los perfiles en testing.\nMirando el c√≥digo de la clase ProfilesTestsTest.java\n@Profile(\u0026quot;test\u0026quot;) @SpringBootTest(webEnvironment= WebEnvironment.RANDOM_PORT) @ActiveProfiles(\u0026quot;test\u0026quot;) @RunWith(SpringRunner.class) public class ProfilesTestsTest { @Value(\u0026quot;${app.ID}\u0026quot;) int id; @Autowired IRead read; @Autowired Environment env; @Test public void inicio() { String name=read.readRegistry(id); assertEquals(name,\u0026quot;test\u0026quot;); String principal=env.getProperty(\u0026quot;app.principal\u0026quot;,\u0026quot;NULL\u0026quot;); assertNotEquals(principal,\u0026quot;profe\u0026quot;); String test=env.getProperty(\u0026quot;app.test\u0026quot;,\u0026quot;NULL\u0026quot;); assertEquals(test,\u0026quot;test\u0026quot;); } }  nos debemos de fijar en la etiqueta @ActiveProfiles(\u0026#8220;test\u0026#8221;) con ella indicamos a Spring que active el perfil test con lo cual ahora solo se procesaran las clases que tengan la etiqueta @Profile(\u0026#8220;test\u0026#8221;) o no tengan ninguna etiqueta @Profile.\nComo se puede ver en el directorio de test,¬†tambi√©n incluimos la clase ReadTestImpl.java que es exactamente igual que la existente en el paquete com.profesorp.profiletest.impl.def pero con la etiqueta @Profile(\u0026#8220;test\u0026#8221;).\nEn el directorio resources de test (profilestest/src/test/resources/) encontramos el fichero application.properties que usara Spring Boot¬† cuando se lance el test, pues como hemos comentado ese fichero se ejecuta siempre, sin importar el perfil activo.¬†Sin embargo no procesara el fichero application.properties general.\nPara demostrarlo en el fichero \u0026#8220;/profilestest/src/main/resources/application.properties\u0026#8221; se ha incluido la linea\napp.principal=principal Y en \u0026#8220;/profilestest/src/test/resources/application.properties\u0026#8221; est√°n las siguientes lineas\napp.ID=3 app.test=test En el test podemos ver como no encuentra la variable de entorno app.principal pero si que encuentra la variable app.test\nY esto es todo por esta entrada. Espero que haya servidor para aclarar un poco m√°s el uso de perfiles (profiles) en Spring Boot.\n¬°¬° Hasta la pr√≥xima !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/10/30/spring-webflow-con-jsp/",
	"title": "Spring WebFlow con JSP",
	"tags": ["bootstrap", "java", "mvc", "seguridad", "spring", "tomcat", "webflow"],
	"description": "",
	"content": "En el articulo anterior http://www.profesor-p.com/2018/10/29/spring-webflow-con-jsp-configuracion/ explicaba como configurar el programa para que Spring WebFlow funcionara. En este articulo explicare como hacer el flujo en si.\nLa p√°gina principal del programa no esta dentro de ning√∫n flujo y sus peticiones son respondidas por Spring MVC, en la clase MyController, la cual podemos encontrar en el paquete profesorp.webflow.controller. Esta clase anotada con la etiqueta @Controller responde en la funci√≥n indice1 a las peticiones de los recursos \u0026#8220;/\u0026#8221; e \u0026#8220;index\u0026#8221;\nAqu√≠ pod√©is ver el c√≥digo:\n@RequestMapping(value = {\"/\", \"index\"}) public ModelAndView indice1(ModelAndView mod) { logger.info(\"request index\"); mod.addObject(\"cliente\", cliente); mod.setViewName(\"index\"); return mod; } Como veis devuelve un objeto ModelAndView¬†donde guarda el objeto cliente, la cual es una @entity de la tabla Clientes, que ya vimos en la entrada anterior. La vista devuelta es \u0026#8220;index.jsp\u0026#8221; que esta en el directorio webapp/WEB-INF/jsp/\nEn \u0026#8220;index.jsp\u0026#8221; encontramos la etiqueta  que esta dentro del paquete spring-security-taglibs. Si el usuario no esta autentificado mostrara la pantalla de login, en caso contrario saludara al usuario¬†y permitir√° realizar el traspaso de dinero.\nAl usar el¬†paquete security, y para evitar ataques CSRF,¬†Spring solo permite realizar peticiones tipo POST,¬†al recurso /logout. Por ello uso la librer√≠a JQuery con la cual creo esa petici√≥n en la funci√≥n de javascript function post(path, parameters)\nEn todas las peticiones tipo POST debemos incluir la variable _csrf.parameterName¬†con el valor _csrf.token para evitar estos mismos ataques CSRF. Si no¬†las ponemos Spring Security no aceptara nuestras peticiones, pues entender√° que es un posible ataque.\n\u0026lt;input type=\"hidden\" name=\"${_csrf.parameterName}\" value=\"${_csrf.token}\"/\u0026gt; Esta es la pantalla de entrada , solicitando las credenciales.\nY est√°, la pantalla de entrada , una vez el usuario esta registrado.\nSi pulsamos el enlace \u0026#8220;Transferencia\u0026#8221; iremos al recurso \u0026#8220;traspaso\u0026#8221; que estar√° ubicado en la URL http://localhost:8080/webflow/traspaso. Este recurso es tratado por Spring Webflow, por lo cual se cargara el fichero¬†WEB-INF/flows/traspaso/traspaso.xml pues as√≠ lo definimos en la clase WebFlowConfig anteriormente vista.\nTodo fichero XML que defina un webflow deber√° empezar con las siguientes lineas.\n\u0026lt;?xml version=\"1.0\" encoding=\"UTF-8\"?\u0026gt; \u0026lt;flow xmlns=\"http://www.springframework.org/schema/webflow\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow.xsd\"\u0026gt;  A continuaci√≥n defino la variable traspasoBean con una nueva instancia del objeto profesorp.webflow.controller.TraspasoBean.\n\u0026lt;var name=\"traspasoBean\" class=\"profesorp.webflow.controller.TraspasoBean\"/\u0026gt; Esta sentencia seria el equivalente al c√≥digo java \u0026lt;strong\u0026gt;traspasoBean¬†= new profesorp.webflow.controller.TraspasoBean()\u0026lt;/strong\u0026gt;\nSeguidamente. indico que al cargar el flujo de trabajo debe evaluar la expresi√≥n logicaService.getCliente() cuyo resultado debe guardar en la variable cliente, la cual sera¬†de √°mbito flow (flowScope.cliente). Una explicaci√≥n de los √°mbitos la ten√©is en la pagina oficial de Spring (en ingles me temo). Baste decir, de momento que una variable definida dentro del √°mbito flowscope es accesible en todas las paginas que est√©n definidas en nuestro flujo.\n\u0026lt;on-start\u0026gt; \u0026lt;evaluate expression=\"logicaService.getCliente()\" result=\"flowScope.cliente\" /\u0026gt; \u0026lt;/on-start\u0026gt; Tener en cuenta que para poder acceder al objeto logicaService¬†lo hemos tenido que definir como un Bean en nuestro programa. En este ejemplo lo ten√©is en la clase LogicaService, que muestro a continuaci√≥n.\npackage profesorp.webflow.services; @Service @SessionScope public class LogicaService { .... Clientes cliente; ... public Clientes getCliente() { return cliente; } } A continuaci√≥n indico la primera vista que se debe cargar, que sera el fichero cuentaOrigen.jsp\n\u0026lt;view-state id=\"cuentaOrigen\" model=\"traspasoBean\"\u0026gt; \u0026lt;on-render\u0026gt; \u0026lt;evaluate expression=\"logicaService.getCuentasByCliente()\" result=\"flowScope.cuentas\" /\u0026gt; \u0026lt;/on-render\u0026gt; \u0026lt;transition on=\"activate\" to=\"importe\"/\u0026gt; \u0026lt;/view-state\u0026gt; Con el par√°metro model especifico¬†las variables que reciba de la vista, deber√°n ser puestas en el objeto traspasoBean.\nComo en la vista¬†definimos la variable cuentaOrigen (en un campo tipo select),y¬†el bean profesorp.webflow.controller.TraspasoBean tiene a su vez la variable cuentaOrigen definida, se llamara a la funci√≥n setCuentaOrigen() de esa clase, con el valor introducido , por el usuario en la vista.\nSi tuvi√©ramos m√°s variables en el formulario que coincidieran con sus correspondientes setters, tambi√©n serian llamadas.\nLa vista, que detallo a continuaci√≥n, es un formulario bastante simple donde se pide el numero de cuenta origen:\n\u0026lt;form method=\"post\" action=\"${flowExecutionUrl}\"\u0026gt; \u0026lt;input type=\"hidden\" name=\"${_csrf.parameterName}\" value=\"${_csrf.token}\"/\u0026gt; \u0026lt;input type=\"hidden\" name=\"_eventId\" value=\"activate\"\u0026gt; \u0026lt;div class=\"form-group\"\u0026gt; \u0026lt;label class=\"etiqueta\" for=\"Cuenta\"\u0026gt;Elija Cuenta Origen: \u0026lt;/label\u0026gt; \u0026lt;select name=\"cuentaOrigen\"\u0026gt; \u0026lt;c:forEach items=\"${cuentas}\" var=\"item\"\u0026gt; \u0026lt;option value=\"${item}\"\u0026gt;${item}\u0026lt;/option\u0026gt; \u0026lt;/c:forEach\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\"col \"\u0026gt; \u0026lt;input class=\"btn btn-primary\" type=\"submit\" value=\"Siguiente\" /\u0026gt; \u0026lt;/div\u0026gt;  \u0026lt;a class=\"nav-link\" href=\"${flowExecutionUrl}\u0026_eventId=cancel\"\u0026gt;Cancelar\u0026lt;/a\u0026gt; \u0026lt;/form\u0026gt; As√≠ se ve la vista en el navegador\n![](/img/2018/10/Captura-25.png(\nLo primero es ver como la URL a llamar por el formulario es el resultado de la variable ${flowExecutionUrl}. Esta variable es puesta autom√°ticamente por Spring WebFlow y apuntara¬†a la direcci√≥n donde continuara el flujo actual.\nLa variable \u0026#8220;_eventId\u0026#8221;¬†es la que Spring WebFlow buscara para decidir que acci√≥n llevar a cabo. En este caso le asigno el valor \u0026#8220;activate\u0026#8221; que coincide con¬†el valor de la etiqueta transition \u0026lt;transition on=\u0026quot;activate\u0026quot; to=\u0026quot;importe\u0026quot;/\u0026gt;¬†\nCon esto lo que hacemos es configurar que cuando la variable¬†_eventId tenga el valor \u0026#8220;activate\u0026#8221; el flujo vaya al ID importe. Por supuesto, el ID deber√° existir en nuestro flujo.\nAclarar que \u0026#8220;activate\u0026#8221; es un literal libre, que igual podria ser \u0026#8216;MI_SALIDA\u0026#8216; o \u0026#8216;SEGUIR\u0026#8216;.\nLo normal, en una vista, es que pueda devolver diferentes valores. As√≠ en¬†la ultima linea donde declaramos un enlace () vemos como se llama a ${flowExecutionUrl}¬†pasando el par√°metro _eventId=cancel . En el caso de que pulsemos ese enlace lo que se ejecutara sera el siguiente c√≥digo que esta al final del fichero traspaso.xml\n\u0026lt;global-transitions\u0026gt; \u0026lt;transition on=\"cancel\" to=\"cancel\" /\u0026gt; \u0026lt;/global-transitions\u0026gt; Esto es as√≠ porque hemos definido que cualquier evento tipo \u0026#8220;cancel\u0026#8221; dentro del flujo, llame al ID cancel del que luego hablare.\n\u0026lt;evaluate expression=\"logicaService.getCuentasByCliente()\" result=\"flowScope.cuentas\" /\u0026gt; La etiqueta  hace que lo que haya dentro se ejecute justo antes de renderizar la vista. En este caso llamara a la funci√≥n logicaService.getCuentasByCliente()y el valor devuelto lo almacenara en flowScope.cuentas\npublic Iterable\u0026lt;String\u0026gt; getCuentasByCliente() { return cuentasClientesRepository.findCuentasByCliente(cliente.getId()); } Este objeto cuentas que es un Array de strings que se usa en la vista para crear el desplegable¬†con las cuentas de origen disponibles, en el c√≥digo \u0026lt;c:forEach items.....\u0026gt;\nLo siguiente define la vista con ID importe, que es donde ira el usuario cuando pulse el bot√≥n siguiente, como hemos definido con las etiquetas \u0026lt;transition on=\u0026quot;activate\u0026quot; to=\u0026quot;importe\u0026quot;/\u0026gt; anteriores.\n\u0026lt;view-state id=\"importe\" model=\"traspasoBean\"\u0026gt; \u0026lt;on-render\u0026gt; \u0026lt;evaluate expression=\"false\" result=\"traspasoBean.puestoPeriodico\" /\u0026gt; \u0026lt;/on-render\u0026gt; \u0026lt;transition on=\"salir\" to=\"comprobarImporte\"\u0026gt; \u0026lt;evaluate expression=\"logicaService.hasCredit(traspasoBean)\" /\u0026gt; \u0026lt;/transition\u0026gt; \u0026lt;/view-state\u0026gt; Como en la anterior vista, los valores introducidos en el formulario ser√°n introducidos en traspasoBean,¬†al incluirse la etiqueta model.\nAntes de mostrar la vista se llama a la funci√≥n traspasoBean.puestoPeriodico() con el valor false debido a la etiqueta on-render.\nSi el valor de la variable \u0026#8220;_eventId\u0026#8221; es \u0026#8220;salir\u0026#8221; el flujo sera dirigido al ID comprobarImporte, pero antes de ir se llamara a la funci√≥n logicaService.hasCredit(traspasoBean). Si esa funci√≥n devuelve true se realizara el salto a comprobarImporte en caso contrario se volvera a mostrar la vista actual, es decir importe.\nLa vista importe esta definida en el fichero importe.jsp del cual pongo un extracto a continuaci√≥n\n\u0026lt;form method=\"post\" action=\"${flowExecutionUrl}\"\u0026gt; \u0026lt;input type=\"hidden\" name=\"${_csrf.parameterName}\" value=\"${_csrf.token}\"/\u0026gt; \u0026lt;input type=\"hidden\" name=\"_eventId\" value=\"salir\"\u0026gt; \u0026lt;div class=\"form-group\"\u0026gt; \u0026lt;label class=\"etiqueta\" for=\"CuentaOrigen\"\u0026gt;Cuenta Origen \u0026lt;/label\u0026gt; \u0026lt;input type=\"text\" name=\"cuentaOrigen\" value=\"${traspasoBean.cuentaOrigen}\" disabled \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\"form-group\"\u0026gt; \u0026lt;label class=\"etiqueta\" for=\"Importe\"\u0026gt;Introduzca Importe \u0026lt;/label\u0026gt; \u0026lt;input type=\"text\" class=\"importe\" name=\"importe\" value=\"${traspasoBean.importe}\" placeholder=\"Importe Traspaso\" required\u0026gt; \u0026lt;c:if test=\"${traspasoBean.getMsgImporte()!=null}\"\u0026gt; \u0026lt;div class=\"alert alert-warning\"\u0026gt; \u0026lt;strong\u0026gt;Atencion!\u0026lt;/strong\u0026gt; ${traspasoBean.getMsgImporte()} \u0026lt;/div\u0026gt; \u0026lt;/c:if\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\"form-group\"\u0026gt; \u0026lt;label class=\"etiqueta\" for=\"CuentaDestino\"\u0026gt;Cuenta Destino \u0026lt;/label\u0026gt; \u0026lt;input type=\"text\" name=\"cuentaFinal\" value=\"${traspasoBean.cuentaFinal}\" \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\"form-group\"\u0026gt; \u0026lt;label class=\"etiqueta\" for=\"Periodico\"\u0026gt;Traspaso Periodico\u0026lt;/label\u0026gt; \u0026lt;input type=\"checkbox\" name=\"periodico\" value=\"true\" \u0026lt;c:if test=\"${traspasoBean.periodico}\"\u0026gt; checked \u0026lt;/c:if\u0026gt; \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\"col\"\u0026gt; \u0026lt;input class=\"btn btn-primary\" type=\"submit\" value=\"Siguiente\" /\u0026gt;\u0026nbsp; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; Resaltar que como la variable periodico esta en un campo checkbox solo sera mandada cuando el usuario seleccione esa opci√≥n, por lo cual si no es marcada, la funcion setPeriodico() no sera llamada, pero no se pondr√° a false la correspondiente variable en el Bean. Es por ello que antes de mostrar la vista, con la etiqueta \u0026lt;on-render\u0026gt; se pone a false una variable auxiliar que utilizara el programa para saber que no se ha seleccionado la opci√≥n \u0026#8220;Traspaso Peri√≥dico\u0026#8220;\nUna imagen de como se muestra la vista en el navegador.\nEl id comprobarImporte se define a continuaci√≥n,\n\u0026lt;decision-state id=\"comprobarImporte\"\u0026gt; \u0026lt;if test=\"logicaService.checkImporte(traspasoBean)\" then=\"periocidad\" else=\"importe\"/\u0026gt; \u0026lt;/decision-state\u0026gt; En este estado que es tipo decisi√≥n, se llama a la funci√≥n checkImporte(traspasoBean) del objeto logicaService en caso de que devuelva true se ira al ID periocidad, en caso contrario se volver√° al ID importe . Esta funci√≥n comprueba que el cliente tenga suficiente dinero en la cuenta.\nEl ID periocidad es otro estado tipo decisi√≥n que dependiendo del resultado de la funci√≥n¬†isPeriodico, la cual comprueba si se ha selecionado la opci√≥n \u0026#8220;Traspaso Periodico\u0026#8221; en la vista, ira a periodico o a confirmar\n\u0026lt;decision-state id=\"periocidad\"\u0026gt; \u0026lt;if test=\"logicaService.isPeriodico(traspasoBean)\" then=\"periodico\" else=\"confirmar\"/\u0026gt; \u0026lt;/decision-state\u0026gt; \u0026lt;subflow-state id=\"periodico\" subflow=\"traspaso_time\"\u0026gt; \u0026lt;input name=\"traspasoBean\" /\u0026gt; \u0026lt;transition on=\"salir\" to=\"confirmar\"\u0026gt; \u0026lt;/transition\u0026gt; \u0026lt;/subflow-state\u0026gt; El ID periodico es una llamada al flujo traspaso_time, al cual se saltara pas√°ndole el objeto traspasoBean debido a la etiqueta input.\nSi ese flujo sale con el ID salir se saltara al ID confirmar\nA continuaci√≥n detallo el contenido del flujo traspaso_time que esta definido en el fichero traspaso_time.xml\n\u0026lt;?xml version=\"1.0\" encoding=\"UTF-8\"?\u0026gt; \u0026lt;flow xmlns=\"http://www.springframework.org/schema/webflow\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow.xsd\"\u0026gt; \u0026lt;input name=\"traspasoBean\" required=\"true\" /\u0026gt; \u0026lt;view-state id=\"tiempo\" model=\"traspasoBean\"\u0026gt; \u0026lt;transition on=\"salir\" to=\"salir\"/\u0026gt; \u0026lt;transition on=\"cancelar\" to=\"cancel\" /\u0026gt; \u0026lt;/view-state\u0026gt; \u0026lt;end-state id=\"salir\" /\u0026gt; \u0026lt;end-state id=\"cancel\" /\u0026gt; \u0026lt;/flow\u0026gt; Lo primero que declaramos es que debemos recibir un objeto traspasoBean . Si no lo recibieramos el programa fallara.\nEs decir el flujo lo podr√≠amos llamar con la URL: http://localhost:8080/webflow/traspaso_time pero si lo hacemos al no recibir el objeto¬†traspasoBean¬† fallara.\nEn el flujo mostramos la vista tiempo y si el _eventid es salir¬†se saltara al ID salir.\nEste ID es tipo end-state por lo cual¬†se volver√°¬†al anterior¬†flujo con el ID salir.¬†En el flujo traspaso entonces¬†se saltara al ID confirmar, como esta definido por la etiqueta: \u0026lt;transition on=\u0026quot;salir\u0026quot; to=\u0026quot;confirmar\u0026quot;\u0026gt;¬†\nSi el _eventid es cancelar tambi√©n volver√° al flujo anterior, pero¬†a trav√©s del ID cancel y por lo tanto se saltara al ID cancel , como se defini√≥ con las etiquetas anteriormente mostradas.\n\u0026lt;global-transitions\u0026gt; \u0026lt;transition on=\"cancel\" to=\"cancel\" /\u0026gt; \u0026lt;/global-transitions\u0026gt; La vista tiempo se muestra as√≠ en el navegador.\nPor √∫ltimo la vista confirmar, muestra todos los datos introducidos y solicita la confirmaci√≥n. En caso de darla se ira al ID salir con lo cual saldremos del flujo redirigiendonos al recurso index pasando la variable transferencia¬† con el valor \u0026#8220;1\u0026#8221;. En caso de que en alg√∫n momento hayamos cancelado la transferencia se saldr√° del flujo dirigi√©ndonos a index pero la variable transferencia tendr√° el valor \u0026#8220;0\u0026#8221;\n\u0026lt;view-state id=\"confirmar\"\u0026gt; \u0026lt;transition on=\"salir\" to=\"salir\"/\u0026gt; \u0026lt;/view-state\u0026gt; \u0026lt;end-state id=\"salir\" view=\"externalRedirect:./index?transferencia=1\" /\u0026gt; \u0026lt;end-state id=\"cancel\" view=\"externalRedirect:./index?transferencia=0\" /\u0026gt; Esto se nos mostrara en pantalla una vez hayamos confirmado la transferencia\nY con esto termino esta entrada tan larga, pero donde creo que he explicado bastantes conceptos de WebFlow.\nComo siempre, espero vuestros comentarios y mejoras, con la esperanza de haberme explicado bien.\n¬°¬° Hasta otra, alumnos!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/02/28/perfiles-en-spring-boot/",
	"title": "Perfiles en Spring Boot",
	"tags": ["java", "profiles", "spring boot"],
	"description": "",
	"content": " Introducci√≥n Cuando se hacen aplicaciones empresariales, lo normal es que, como m√≠nimo, primero se desplieguen en un entorno de pruebas y despu√©s¬†en el entorno de producci√≥n. Cada entorno de pruebas tendr√° diferentes bases de datos, diferentes URLs y toda una serie de par√°metros espec√≠ficos, con el fin de que una aplicaci√≥n en desarrollo no acceda nunca a datos reales.\nEstableciendo perfiles en la aplicaci√≥n Spring provee una manera sencilla de gestionar esta situaci√≥n haciendo uso de los perfiles.\nHay varias maneras de establecer el perfil a utilizar por una aplicaci√≥n:\n Pas√°ndolo como variable de entorno en JAVA. Por ejemplo:¬†\u0026#8220;java -jar -Dspring.profiles.active=MI_PROFILE application.jar\u0026#8221; Pas√°ndolo como un argumento al programa. \u0026#8220;java -jar application.jar \u0026#8211;spring.profiles.active=MI_PROFILE\u0026#8221; Especificarlo con una anotaci√≥n en el propio programa, en la etiqueta @SpringBootTest, pasandole el parametro \u0026#8220;spring.profiles.active\u0026#8221;. Muy √∫til para prueba unitarias.@SpringBootTest(\u0026#8220;spring.profiles.active=test\u0026#8221;) Con la anotaci√≥n @ActiveProfiles@ActiveProfiles(\u0026#8220;MI_PROFILE\u0026#8221;)  Creando Beans En el ejemplo que esta disponible en https://github.com/chuchip/profilestest se pueden ver como una aplicaci√≥n saca diferentes mensajes y accede a diferentes datos seg√∫n el perfil establecido.\nEl proyecto es una simple aplicaci√≥n web, que accede a una base de datos H2, mostrando diferentes datos seg√∫n el perfil. Para crear el proyecto simplemente hay que a√±adir las siguientes dependencias: JPA, H2 y WEB\nEmpezando por la clase principal veremos como definir diferentes beans dependiendo del perfil.\n@SpringBootApplication @Configuration public class ProfilesTests { @Autowired private Environment environment; public static void main(String[] args) { SpringApplication.run(ProfilesTests.class, args); } @Bean @Profile(\u0026quot;test\u0026quot;) IWrite getWriterTest() { return new WriteImpl(\u0026quot;..test.. \u0026quot;+getProfile()); } @Bean @Profile(\u0026quot;default\u0026quot;) IWrite getWriterDefault() { return new WriteImpl(\u0026quot;..default.. \u0026quot;+getProfile()); } @Bean @Profile(\u0026quot;other\u0026quot;) IWrite getWriterOther() { return new WriteImpl(\u0026quot;..other.. \u0026quot;+getProfile()); } String getProfile() { if (environment.getActiveProfiles()==null) return \u0026quot;default\u0026quot;; String[] profiles=environment.getActiveProfiles(); return profiles.length\u0026gt;0?profiles[0]:\u0026quot;default\u0026quot;; } }  En las funciones getWriterXXX, se devuelve siempre un bean que implementa el interface IWrite. La definici√≥n de este interfaz es muy simple, como se puede ver en el siguiente c√≥digo:\npublic interface IWrite { public void writeLog(String log); public String getProfile(); }  Y su implementaci√≥n en la clase WriteImpl es tambi√©n muy sencilla:\npublic class \u0026lt;strong\u0026gt;WriteImpl\u0026lt;/strong\u0026gt; implements IWrite{ private String profile; public WriteImpl(String profile) { this.profile=profile; } public String getProfile() { return profile; } @Override public void writeLog(String log) { System.out.println(\u0026quot;Profile: \u0026quot;+profile+\u0026quot; -\u0026gt; \u0026quot;+ log); } }  Volviendo a la clase principal, se ve que la funci√≥n getWriterTest() instancia un objeto WriteImpl, pasando al constructor el literal ..test.. y lo devuelto por la funci√≥n getProfile(), la cual devuelve un String con el perfil activo.\nLa funci√≥n getWriterDefault() hace lo mismo que la anterior pero instanciando un objeto WriteImpl al cual en el constructor se le pasa el literal ..default..y lo devuelto por la funci√≥n getProfile(). Y lo mismo con la funci√≥n getWriterOther() pero pasando el literal ..other..\nLo importante de estas funciones es la anotaci√≥n @Bean con la cual le decimos a Spring que cuando en alguna parte del c√≥digo se deba inyectar el objeto devuelto en esa funci√≥n que ejecute esta funci√≥n para conseguirlo.\nUn poco de teor√≠a Cuando Spring encuentre una anotaci√≥n @Autowired con un objeto tipo IWrite como ocurre en el siguiente c√≥digo:\n@Autowired IWrite out;  buscara de alguna manera un objeto que implemente ese interface o que se llame igual que el objeto en si.\nAs√≠, para conseguir el objeto, Spring tiene dos opciones:\n Buscar dentro del proyecto una class que se llame IWrite o una clase que implemente el interfaz IWrite que este anotada con la etiqueta @Component Buscar dentro de una clase anotada con la etiqueta @Configuration una funci√≥n anotada con @Bean y que devuelva un objeto de ese tipo.  Se pueden dar varios casos en este momento:\n Encuentra un objeto y lo usa. No encuentra un objeto con lo cual da un error y la aplicaci√≥n no se ejecutara. Encuentra m√°s de un objeto y como no sabe con cual quedarse da un error y la aplicaci√≥n no se ejecuta.  Como se puede ver, en el c√≥digo hay tres funciones que devuelven un objeto tipo IWrite, con lo cual Spring dar√≠a un error, para evitarlo a√±adimos la etiqueta @Profile . De esta manera si el perfil de la aplicaci√≥n no coincide con el literal dentro de @Profile esa funci√≥n ser√° ignorada. Y como se puede ver, cada funci√≥n tiene su propia anotaci√≥n @Profile con lo cual Spring solo tratara una de ellas.\nDestacar que si lanzamos la aplicaci√≥n sin especificar ning√∫n perfil, Spring elige el perfil default.\nPor supuesto, si lanz√°ramos la aplicaci√≥n con un perfil que no fuera default,test o other la aplicaci√≥n fallar√≠a, al no encontrar ning√∫n objeto que implemente el interfaz IWrite\nCreando Componentes Para tener un ejemplo del caso en que Spring deba buscar una clase, en el proyecto de ejemplo se puede ver como se define el interfaz IRead el cual es implementado por la clases ReadDefImpl y ReadOtherImpl.\nObservar como ambas clases tienen las anotaciones @Component y @Profile antes de la definici√≥n de la clase. L√≥gicamente en una clase la etiqueta @Profile tiene el par√°metro default y en otra el par√°metro es other.\nEsta es la clase ReadDefImpl\n@Component @Profile(\u0026quot;default\u0026quot;) public class \u0026lt;strong\u0026gt;ReadDefImpl\u0026lt;/strong\u0026gt; implements IRead{ @Autowired ProfileRepository customerRepository; @Autowired IWrite out; public String readRegistry(int id) { out.writeLog(\u0026quot;entry in ReadImpl\u0026quot; ); Optional\u0026lt;ProfileEntity\u0026gt; registroOpc=customerRepository.findById(id); if (!registroOpc.isPresent()) { System.out.println(\u0026quot;Customer \u0026quot;+id+\u0026quot; NOT found\u0026quot;); return null; } ProfileEntity registro=registroOpc.get(); out.writeLog(\u0026quot;Name customer \u0026quot;+id+\u0026quot; is: \u0026quot;+registro.getName()); return registro.getName(); } }  Y as√≠ empieza la clase ReadOtherImpl\n@Component @Profile(\u0026quot;other\u0026quot;) public class \u0026lt;strong\u0026gt;ReadOtherImpl\u0026lt;/strong\u0026gt; implements IRead{  El cuerpo es de la clase es exactamente igual que la de la clase ReadDefImpl\nLeyendo ficheros de propiedades El c√≥digo de la clase ProfilesController es el siguiente:\n@RestController public class ProfilesController { @Autowired IRead read; @Value(\u0026quot;${app.ID}\u0026quot;) int id; @Autowired IWrite write; @GetMapping(\u0026quot;/hello\u0026quot;) public String get(@RequestParam(value=\u0026quot;name\u0026quot;,required=false) String name) { return \u0026quot;Hello \u0026quot;+(name==null?\u0026quot;SIN NOMBRE\u0026quot;:name)+ \u0026quot;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; The name of the profile number:\u0026quot;+ id+\u0026quot; in the database H2 is: \u0026quot;+read.readRegistry(id)+ \u0026quot;\u0026lt;br\u0026gt; The profile used in the application is : \u0026quot;+write.getProfile(); } }  En esta clase podemos ver, la anotaci√≥n @Value(\u0026#8220;${app.ID}\u0026#8221;) con ella lo que le estamos diciendo a Spring es que inicialice la variable que hay a continuaci√≥n ( \u0026#8220;id\u0026#8220;) con el valor que encuentre en un fichero de properites. Como no especificamos ninguno buscara dentro de application.properties y encontrara la siguiente l√≠nea:\napp.ID=1  con lo cual la variable id tendr√° el valor 1\nPero si nos fijamos en nuestro proyecto adem√°s del fichero application.properties tambi√©n tenemos un fichero llamado application-other.properties, esto es porque Spring en el caso de que el perfil sea other buscara primero el fichero application-other.properties para establecer las propiedades.\nDe esta manera, cuando el perfil sea other leer√° el fichero application-other.properties y encontrara la l√≠nea:\napp.ID=2  con lo cual la variable id tendr√° el valor 2\nEs importante recalcar que el fichero application.properties se leer√° y procesara siempre, independientemente del perfil elegido, pero luego se buscara el del perfil activo. Si no queremos que lea ese fichero, una soluci√≥n seria renombrar el fichero a application-default.properties con lo cual solo se usar√≠a con el perfil default.\nProbando la aplicaci√≥n Para probar la aplicaci√≥n en Eclipse podremos crear dos configuraciones. Una para el perfil default donde podemos ver que no especificamos ning√∫n perfil con lo cual Spring asignara el perfil default y otra para el perfil other La del perfil default escuchara en el puerto 8080 y la de other en el 8081. Eso esta especificado con la l√≠nea server.port=8080 en el fichero application.properties y con la l√≠nea server.port:8081en el fichero application-other.properties\nComo se puede ver en las siguientes pantallas, la llamada a http://localhost:8080/hello?name=profesor devuelve la siguiente salida: Se puede ver como el valor de la variable id es 1 y como lee en la base de datos H2, el valor del registro correspondiente.\nEn la salida est√°ndar veremos el siguiente texto:\nProfile: ..default.. default -\u0026gt; entry in ReadImpl Profile: ..default.. default -\u0026gt; Name customer 1 is: default  Si llamamos a http://localhost:8081/hello?name=profesor, veremos la siguiente salida en el navegador:\nEn la salida est√°ndar veremos el siguiente texto:\nProfile: ..other.. other - entry in ReadImpl Profile: ..other.. other - Name customer 2 is: other En el articulo siguiente pod√©is ver el uso de los perfiles para testear la aplicaci√≥n con JUnit\nHasta entonces, ¬°¬° que la curiosidad no os abandone üòâ !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/22/acceso-a-base-de-datos-con-jdbc-spring/",
	"title": "Lambdas en JDBC Data",
	"tags": [],
	"description": "",
	"content": " Expresiones Lamba en Spring JDBC Data. Mejorando la explicaci√≥n. En una entrada anterior, puse un ejemplo de como usar expresiones Lambas, como me parece que es un tema interesante, este de la programaci√≥n funcional, voy a insistir en este tema.\nUna cosa¬†muy com√∫n en Java es¬†tener que pesarle como argumento a una funci√≥n externa, una objeto que implemente una funci√≥n donde nosotros pondremos el c√≥digo a ejecutar en nuestra¬†aplicaci√≥n.\nUn ejemplo practico es en el uso de¬†la clase¬†JdbcOperations, que es utilizada por Spring para poder realizar operaciones JDBC, la cual tiene la funci√≥n:¬†\nT¬†query(java.lang.String¬†sql, java.lang.Object[]¬†args, ResultSetExtractor rse) throws DataAccessException  Lo que hay que entender es que como funciona realmente esta funci√≥n query¬†. Esta funci√≥n necesita tres parametros:\n sentencia SQL¬†a ejecutar,¬† Argumentos de la sentencia SQL Clase ResultSetExtractor donde nuestro programa har√° algo con los resultados obtenidos.  As√≠, voy a suponer que queremos realizar una consulta sobre una tabla, buscando el nombre de un usuario, a trav√©s de su identificador. La tabla¬†usuarios,¬†tendr√≠a solo estos dos campos:\n identificador, que seria un varchar de 15 caracteres (un texto para los que no conocen SQL) nombre, que seria otro de varchar¬†de 50 caracteres (otro texto, vamos).  Es decir queremos buscar, el nombre de un usuario, sabiendo su identificador. La sentencia SQL para realizar esta b√∫squeda seria\nselect nombre from usuarios where identificador = ? La interrogaci√≥n final hace referencia al par√°metro que pasaremos, es decir el identificador del usuario.\nPor lo tanto, en nuestro programa pondremos una sentencia, como la siguiente:\njdbc.query(\u0026quot;select nombre from usuarios where identificador = ?\u0026quot;, new[] { \u0026quot;usuario1\u0026quot; },¬†OBJETO_RESULTSETEXTRACTOR)  El par√°metro¬†new Object[] { \u0026#8220;usuario1\u0026#8221; }¬†simplemente crea un array de Objetos con los diferentes par√°metros que necesitara nuestra sentencia SQL. En este caso solo necesita un par√°metro que es el identificador del usuario. Vamos a buscar el usuario que tiene como identificador¬†usuario1.\nY nos queda por definir el objeto del tipo¬†ResultSetExtractor, donde interactuaremos con los resultados de nuestra sentencia SQL.\nEse tipo de objeto esta definido en el interface ResultSetExtractor el cual solo tiene una funci√≥n, que detallo a continuaci√≥n:\nT¬†mapRow(java.sql.ResultSet¬†rs, int¬†rowNum) throws java.sql.SQLException\nAntes de Java 1.8, deber√≠amos crear una clase que implemente el interfaz¬†ResultSetExtractor. Esa clase seria algo as√≠ como:\nclass miResultSetExtractor implements¬†ResultSetExtractor { @Override public T¬†mapRow(java.sql.ResultSet¬†rs, int¬†rowNum) throws java.sql.SQLException { System.out.println(\"El nombre del Usuario es: \"+rs.getString(\"nombre\")); // CODIGO A EJECUTAR } } Y ejecutar√≠amos la llamada a la funci√≥n query de esta manera:\njdbc.query(\"select nombre from usuarios where identificador = ?\", new Object[] { \"usuario1\" },new¬†miResultSetExtractor ()); Tambi√©n podr√≠amos crear una clase abstracta, a la hora de llamar a la funci√≥n¬†query,¬† con una sentencia como esta:\njdbc.query(\"select nombre from usuarios where identificador = ?\", new Object[] { \"usuario1\" }, new¬†ResultSetExtractor() { @Override public T¬†mapRow(java.sql.ResultSet¬†rs, int¬†rowNum) throws java.sql.SQLException { System.out.println(\"El nombre del Usuario es: \"+rs.getString(\"nombre\")); // CODIGO A EJECUTAR } }); El caso es que tenemos que poner un mont√≥n de c√≥digo auxiliar¬†cuando nosotros solo quisi√©ramos poner nuestro System.out.println.\nY ahora es cuando viene al rescate las expresiones Lamba.\njdbc.query(\"select nombre from usuarios where identificador = ?\", new Object[] { \"usuario1\" }, (param1, param2) -\u0026gt;¬†System.out.println(\"El nombre del Usuario es: \"+param1.getString(\"nombre\")); La expresi√≥n lambda se compone de dos partes. Los par√°metros a mandar y el c√≥digo a ejecutar.\nAs√≠, nosotros mandaremos dos parametros:¬†param1¬†y param2. (le podriamos haber puesto los nombres que quisieramos)\nComo se ve, no hay que especificar de que tipo son esos par√°metros, Java, se encargara de eso. Te estar√°s preguntado, pero, ¬ø como funciona esto ?.\nBueno, en primer lugar, Java, cuando compile nuestro c√≥digo buscara que que objeto debe crear, dependiendo del par√°metro esperado por la funci√≥n¬†jdbc.query().¬†Vera que espera un objeto que implemente el interface¬†ResultSetExtractor¬†y comprobara que ese interface solo tiene una funci√≥n, por lo cual, sabr√° f√°cilmente que par√°metros se tipo de objetos se deben pasar como objetos.\nEs por eso que solo se pueden aplicar este tipo de expresiones lambda cuando el interface implemente una √∫nica funci√≥n.\nUna vez que Java, sabe que objetos debe pasar, el sustituir√° nuestras variables¬†param1¬†y param2¬†y las usara en el cuerpo de nuestra expresi√≥n Lambda. Por ello ahora nuestro c√≥digo:¬†System.out.println(\u0026#8220;El nombre del Usuario es: \u0026#8220;+param1.getString(\u0026#8220;nombre\u0026#8221;))¬†cogera la variable¬†param1¬†y la usara sabiendo que es un objeto tipo ResultSet. Observar que aunque la variable param2, no la usamos en nuestro c√≥digo, debemos definirla igualmente.\nEspero haberme explicado bien, y no dud√©is en preguntar o seguirme en mi cuenta de twitter.\n¬° Hasta la pr√≥xima !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/contacto/",
	"title": "Contacto",
	"tags": [],
	"description": "",
	"content": "Mi nombre es Jes√∫s Javier Puente,¬†vivo¬†en Logro√±o, apasionado de la inform√°tica,¬†soy programador desde hace demasiados a√±os, ademas de Administrador de sistemas, DBA.\nMi correo electr√≥nico es profe@profesor-p.com, Tambi√©n se puede contactar conmigo en chuchip@gmail.com y en mi cuenta de Twitter¬†@chuchip\nEsta es mi p√°gina en Linkedin. Tengo¬†algunos de mis provectos en GitHub\nPuedes ver mi experiencia laboral en est√° pagina.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/06/13/estableciendo-filtros-en-spring/",
	"title": "Estableciendo filtros en Spring",
	"tags": ["filters", "java", "rest", "spring"],
	"description": "",
	"content": "En esta entrada voy a hablar de como implementar filtros en Spring. Los filtros son de los que se pueden establecer cuando se recibe una petici√≥n HTTP. Es decir, suponiendo que tenemos un programa escuchando en unas URI, poder especificar que deseamos ejecutar algo antes de que las peticiones sea procesadas por el controlador.\nEsto es muy √∫til si queremos que todas las peticiones cumplan un requisito, por ejemplo incluir una cabecera especifica.\nPara entender como funcionan los filtros en Spring he realizado un programa que ir√© explicando poco a poco.\nEl c√≥digo fuente del programa lo ten√©is en mi p√°gina de GITHUB\nEmpezare mostrando el controlador para peticiones REST que esta en la clase PrincipalController.java. Este ser√° el encargado de gestionar todas las peticiones.\n@RestController public class PrincipalController { @Autowired SillyLog sillyLog; @GetMapping(\u0026quot;*\u0026quot;) public String entryOther(HttpServletRequest request,HttpServletResponse response) {\tsillyLog.debug(\u0026quot;In entryOther\u0026quot;); if (response.getHeader(\u0026quot;PROFE\u0026quot;)!=null) sillyLog.debug(\u0026quot;Header contains PROFE: \u0026quot;+response.getHeader(\u0026quot;PROFE\u0026quot;)); if (response.getHeader(\u0026quot;CAKE\u0026quot;)!=null) sillyLog.debug(\u0026quot;Header contains CAKE: \u0026quot;+response.getHeader(\u0026quot;CAKE\u0026quot;)); return \u0026quot;returning by function entryOther\\r\\n\u0026quot;+ sillyLog.getMessage(); } @GetMapping(value={\u0026quot;/\u0026quot;,\u0026quot;one\u0026quot;}) public String entryOne(HttpServletRequest request,HttpServletResponse response\t) { sillyLog.debug(\u0026quot;In entryOne\u0026quot;); if (response.getHeader(\u0026quot;PROFE\u0026quot;)!=null) { sillyLog.debug(\u0026quot;Header contains PROFE: \u0026quot;+response.getHeader(\u0026quot;PROFE\u0026quot;)); return entryTwo(response);\t} return \u0026quot;returning by function entryOne\\r\\n\u0026quot;+ sillyLog.getMessage(); } @GetMapping(\u0026quot;two\u0026quot;) public String entryTwo(HttpServletResponse response) { sillyLog.debug(\u0026quot;In entryTwo\u0026quot;); if (response.getHeader(\u0026quot;PROFE\u0026quot;)!=null) sillyLog.debug(\u0026quot;Header contains PROFE: \u0026quot;+response.getHeader(\u0026quot;PROFE\u0026quot;)); return \u0026quot;returning by function entryTwo\\r\\n\u0026quot;+ sillyLog.getMessage(); } @GetMapping(\u0026quot;three\u0026quot;) public String entryThree() { sillyLog.debug(\u0026quot;In entryThree\u0026quot;); return \u0026quot;returning by function entryThree\\n\u0026quot;+ sillyLog.getMessage(); } @GetMapping(\u0026quot;redirected\u0026quot;) public String entryRedirect(HttpServletRequest request) { sillyLog.debug(\u0026quot;In redirected\u0026quot;); return \u0026quot;returning by function entryRedirect\\n\u0026quot;+ sillyLog.getMessage(); } }  En la funci√≥n entryOther se capturaran todas las peticiones tipo GET que vayan a alguna URI que no tengamos definidas expl√≠citamente. En la funci√≥n entryOne se procesaran las peticiones tipo GET que vayan a la URL http://localhost:8080/one o http://localhost:8080/ y as√≠ sucesivamente.\nLa clase sillyLog es una clase donde simplemente iremos a√±adiendo l√≠neas de log para luego devolverlas en el body de la respuesta, de tal manera que podremos ver por donde ha pasado nuestra petici√≥n.\nEn esta aplicaci√≥n se definen tres filtros: MyFilter.java ,OtherFilter.java y CakesFilter.java. El primero tiene preferencia sobre el segundo, por estar as√≠ establecido en el par√°metro de la etiqueta @Order. Del tercero hablo al final del articulo.\nEn el fichero MyFilter.java definimos nuestro primer filtro.\n@Component @Order(1) public class MyFilter implements Filter{ @Autowired SillyLog sillyLog; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\tthrows IOException, ServletException { HttpServletRequest httpRequest = (HttpServletRequest) request; HttpServletResponse myResponse= (HttpServletResponse) response; sillyLog.debug(\u0026quot;Filter: URL\u0026quot; + \u0026quot; called: \u0026quot;+httpRequest.getRequestURL().toString()); if (httpRequest.getRequestURL().toString().endsWith(\u0026quot;/one\u0026quot;))\t{\tmyResponse.addHeader(\u0026quot;PROFE\u0026quot;, \u0026quot;FILTERED\u0026quot;);\tchain.doFilter(httpRequest, myResponse); return; } if (httpRequest.getRequestURL().toString().endsWith(\u0026quot;/none\u0026quot;))\t{ myResponse.setStatus(HttpStatus.BAD_GATEWAY.value()); myResponse.getOutputStream().flush(); myResponse.getOutputStream().println(\u0026quot;-- I don't have any to tell you --\u0026quot;); return; // No hago nada. } if (httpRequest.getRequestURL().toString().endsWith(\u0026quot;/redirect\u0026quot;))\t{\tmyResponse.addHeader(\u0026quot;PROFE\u0026quot;, \u0026quot;REDIRECTED\u0026quot;); myResponse.sendRedirect(\u0026quot;redirected\u0026quot;); chain.doFilter(httpRequest, myResponse); return; } if (httpRequest.getRequestURL().toString().endsWith(\u0026quot;/cancel\u0026quot;))\t{\tmyResponse.addHeader(\u0026quot;PROFE\u0026quot;, \u0026quot;CANCEL\u0026quot;); myResponse.setStatus(HttpStatus.BAD_REQUEST.value()); myResponse.getOutputStream().flush(); myResponse.getOutputStream().println(\u0026quot;-- Output by filter error --\u0026quot;); chain.doFilter(httpRequest, myResponse); return; } chain.doFilter(request, response); } }  La clase OtherFilter es m√°s simple:\n@Component @Order(2) public class OtherFilter implements Filter{ @Autowired SillyLog sillyLog; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { HttpServletRequest httpRequest= (HttpServletRequest) request; HttpServletResponse myResponse= (HttpServletResponse) response; sillyLog.debug(\u0026quot;OtherFilter: URL\u0026quot; + \u0026quot; called: \u0026quot;+httpRequest.getRequestURL().toString()); if (myResponse.getHeader(\u0026quot;PROFE\u0026quot;)!=null) { sillyLog.debug(\u0026quot;OtherFilter: Header contains PROFE: \u0026quot;+myResponse.getHeader(\u0026quot;PROFE\u0026quot;)); } chain.doFilter(request, response); } }  Lo primero que tenemos que hacer para definir un filtro general es etiquetar la clase con @Component . Despu√©s deberemos implementar el interface Filter . Tambi√©n podr√≠amos extender de la clase OncePerRequestFilter la cual implementa el interface Filter y a√±ade ciertas funcionalidades para que un filtro solo se ejecute una vez por ejecuci√≥n. En este ejemplo vamos a simplificarlo al m√°ximo y directamente implementaremos el interface Filter.\nEl interface Filter tiene tres funciones.\n void init(FilterConfig filterConfig) throws ServletException\nEsta funci√≥n ser√° ejecutada por el contenedor web. En otras palabras: esta funci√≥n solo es ejecutada una vez, cuando el componente es instanciado por Spring.\n void doFilter(ServletRequest request,ServletResponse response, FilterChain chain) throws IOException, ServletException\nEsta funci√≥n ser√° ejecutada cada vez que se realiza una petici√≥n HTTP. En ella es donde podremos ver el contenido de la petici√≥n HTTP, en el objeto ServletRequest y modificar la respuesta en el objeto ServletResponse . FilterChain es lo que debemos ejecutar si queremos continuar la petici√≥n.\n void destroy()\nEsta funci√≥n es llamada por el contenedor web de Spring para indicarle al filtro, que va a dejar de estar activo.\n  Como he comentado anteriormente, la etiqueta @Order nos permitir√° especificar el orden en que los filtros ser√°n ejecutados. En este caso, este filtro tendr√° el valor 1 y el siguiente tendr√° el valor 2, por lo cual MyFilter se ejecutara antes que OtherFilter.\nLa clase MyFilter realiza diferentes acciones seg√∫n la URL llamada. La clase OtherFiltersolamente a√±ade un log cuando pasa por ella.\nEn el c√≥digo del ejemplo nosotros solo utilizamos la funci√≥n doFilter. En ella, lo primero, convertimos la clase ServletResponse a HttpServletResponse y la clase ServletRequest a HttpServletRequest. Esto es necesario para poder acceder a ciertas propiedades de los objetos que de otra manera no estar√≠an disponibles.\nVoy a explicar paso a paso los diferentes casos contemplados en la clase MyFilter, dependiendo de la URL invocada.\n /one: A√±adimos una cabecera PROFE con el valor FILTERED a la respuesta. Es importante recalcar que solo podremos modificar la respuesta, la petici√≥n es inalterable.\nDespu√©s ejecutamos la funci√≥n doFilterde la clase chain con lo cual se continuara el flujo de la petici√≥n. En este caso se ejecutar√≠a el segundo filtro y despu√©s se pasar√≠a por a la funci√≥n entryOne del controlador, donde podr√≠amos ver que existe un header con el valor PROFE, por lo cual se llama a la funci√≥n entryTwo.\nUna llamada a esta URL nos devolver√≠a lo siguiente:\n\u0026gt; curl -s http://localhost:8080/one returning by function entryTwo SillyLog: 15eb34c2-cfac-4a27-9450-b3b07f44cb50/1 Filter: URL called: http://localhost:8080/one SillyLog: 15eb34c2-cfac-4a27-9450-b3b07f44cb50/2 OtherFilter: URL called: http://localhost:8080/one SillyLog: 15eb34c2-cfac-4a27-9450-b3b07f44cb50/3 OtherFilter: Header contains PROFE: FILTERED SillyLog: 15eb34c2-cfac-4a27-9450-b3b07f44cb50/4 In entryOne SillyLog: 15eb34c2-cfac-4a27-9450-b3b07f44cb50/5 Header contains PROFE: FILTERED SillyLog: 15eb34c2-cfac-4a27-9450-b3b07f44cb50/6 In entryTwo SillyLog: 15eb34c2-cfac-4a27-9450-b3b07f44cb50/7 Header contains PROFE: FILTERED   La primera l√≠nea es devuelta por la funci√≥n entryTwo. A continuaci√≥n se muestran los logs a√±adidos.\nLo mejor es mirar el c√≥digo fuente si no se tiene claro de donde salen tantas l√≠neas üòâ\n /redirect A√±adimos una cabecera PROFE con el valor REDIRECTED al response. Despu√©s especificamos que se debe incluir una redirecci√≥n a la URL redirected con la instrucci√≥n myResponse.sendRedirect. Finalmente ejecutamos la funci√≥n doFilter por lo cual se procesara el segundo filtro y se llamara a la funci√≥n entryOther ya que no tenemos ning√∫n punto de entrada definido para /cancel.   Esta es la salida que tendremos si realizamos una petici√≥n con curl:\n\u0026gt; curl -s http://localhost:8080/redirect  Efectivamente, no hay salida. ¬øPor qu√©?. Pues porque hemos incluido una directiva redirected y curl por defecto no sigue esas directivas, con lo cual simplemente no muestra nada.\nVeamos, que esta pasando a√±adi√©ndole a curl el par√°metro -v (verbose)\n\u0026gt; curl -v -s http://localhost:8080/redirect * Trying ::1... * TCP_NODELAY set * Connected to localhost (::1) port 8080 (#0) \u0026gt; GET /redirect HTTP/1.1 \u0026gt; Host: localhost:8080 \u0026gt; User-Agent: curl/7.60.0 \u0026gt; Accept: */* \u0026gt; \u0026lt; HTTP/1.1 302 \u0026lt; PROFE: REDIRECTED \u0026lt; Location: http://localhost:8080/redirected \u0026lt; Content-Length: 0 \u0026lt; Date: Thu, 13 Jun 2019 13:57:44 GMT \u0026lt; * Connection #0 to host localhost left intact  Esto es otra cosa, ¬øverdad?. Ahora muestra en la cabecera nuestro valor para PROFE Y vemos la orden de redirigir a http://localhost:8080/redirected. Observar que el c√≥digo HTTP es 302, que es redirect.\nS√≠ le decimos a curl que siga la redirecci√≥n, pas√°ndole el par√°metro -L, veremos lo que esper√°bamos.\n \u0026gt; curl -L -s http://localhost:8080/redirect returning by function entryRedirect SillyLog: dcfc8b09-84a4-40a1-a2d6-43340abdf50c/1 Filter: URL called: http://localhost:8080/redirected SillyLog: dcfc8b09-84a4-40a1-a2d6-43340abdf50c/2 OtherFilter: URL called: http://localhost:8080/redirected SillyLog: dcfc8b09-84a4-40a1-a2d6-43340abdf50c/3 In redirected  Bueno, casi lo que esper√°bamos. Obs√©rvese que ha habido dos peticiones HTTP a nuestro servicio y solo se muestra los datos de la segunda.\n /none . Establezco el c√≥digo HTTP a devolver a BAD_GATEWAY y en el cuerpo pongo el texto \u0026#8220;I don\u0026#8217;t have any to tell you\u0026#8221;. No ejecuto la funci√≥n doFilter por lo cual ni ser√° llamado el segundo filtro, ni seria pasada al controlador.  \u0026gt; curl -s http://localhost:8080/none -- I don't have any to tell you --   /cancel . Establezco el c√≥digo HTTP a devolver a BAD_REQUEST y en el cuerpo pongo el texto \u0026#8220;Output by filter error\u0026#8221;. Ejecuto la funci√≥n doFilter por lo cual ser√° ejecutado el filtro OtherFilter y se pasara por la funci√≥n entryOther del controlador, ya que no tenemos ning√∫n punto de entrada definido para /cancel   \u0026gt; curl -s http://localhost:8080/cancel -- Output by filter error -- returning by function entryOther SillyLog: 1cf7f7f9-1a9b-46a0-9b97-b8d5caf734bd/1 Filter: URL called: http://localhost:8080/cancel SillyLog: 1cf7f7f9-1a9b-46a0-9b97-b8d5caf734bd/2 OtherFilter: URL called: http://localhost:8080/cancel SillyLog: 1cf7f7f9-1a9b-46a0-9b97-b8d5caf734bd/3 OtherFilter: Header contains PROFE: CANCEL SillyLog: 1cf7f7f9-1a9b-46a0-9b97-b8d5caf734bd/4 In entryOther SillyLog: 1cf7f7f9-1a9b-46a0-9b97-b8d5caf734bd/5 Header contains PROFE: CANCEL  Observar que el cuerpo a√±adido en el filtro es anterior a lo devuelto por el controlador.\n Otros En cualquier otra llamada se invocara la funci√≥n doFilterde la clase chain por lo cual se pasara al siguiente filtro y despu√©s a la funci√≥n del controlador adecuado.  \u0026gt; curl -L -s http://localhost:8080/three returning by function entryThree SillyLog: a2dd979f-4779-4e34-b8f6-cae814370426/1 Filter: URL called: http://localhost:8080/three SillyLog: a2dd979f-4779-4e34-b8f6-cae814370426/2 OtherFilter: URL called: http://localhost:8080/three SillyLog: a2dd979f-4779-4e34-b8f6-cae814370426/3 In entryThree  Para especificar que un filtro solo sea activo para ciertas URL, hay que registrarlo expl√≠citamente y no marcar la clase con la etiqueta @Component. En el proyecto de ejemplo en la clase FiltrosApplication vemos la funci√≥n donde se a√±ade un filtro:\n@Bean public FilterRegistrationBean\u0026lt;CakesFilter\u0026gt; cakesFilter() { FilterRegistrationBean\u0026lt;CakesFilter\u0026gt; registrationBean = new FilterRegistrationBean\u0026lt;\u0026gt;(); registrationBean.setFilter(new CakesFilter()); registrationBean.addUrlPatterns(\u0026quot;/cakes/*\u0026quot;); return registrationBean; }  La clase CakesFilter es la siguiente:\n@Order(3) public class CakesFilter implements Filter{ @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { HttpServletResponse myResponse= (HttpServletResponse) response; myResponse.addHeader(\u0026quot;CAKE\u0026quot;, \u0026quot;EATEN\u0026quot;); chain.doFilter(request, response); } }  Al hacer una llamada a una url que empiece por /cakes/* veremos como se ejecuta el ultimo filtro.\n\u0026gt; curl -s http://localhost:8080/cakes returning by function entryOther SillyLog: 41e2c9b9-f8d2-42cc-a017-08ea6089e646/1 Filter: URL called: http://localhost:8080/cakes SillyLog: 41e2c9b9-f8d2-42cc-a017-08ea6089e646/2 OtherFilter: URL called: http://localhost:8080/cakes SillyLog: 41e2c9b9-f8d2-42cc-a017-08ea6089e646/3 In entryOther SillyLog: 41e2c9b9-f8d2-42cc-a017-08ea6089e646/4 Header contains CAKE: EATEN  Por la manera en que tiene Spring de gestionar sus variables de contexto, no es posible inyectar el objeto SillyLog con un @Autowired . Si lo inyectamos veremos como la variable tiene el valor null\nY con esto doy por finalizada esta entrada ¬°¬° Hasta la pr√≥xima !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/05/12/cacheando-datos-en-spring-boot/",
	"title": "Cacheando resultados con Spring Boot",
	"tags": ["cache", "java", "spring boot"],
	"description": "",
	"content": " Usando cache en Spring Boot Vamos a imaginar una aplicaci√≥n web, donde por cada petici√≥n recibida, debe leer ciertos datos de configuraci√≥n desde una base de datos. Esos datos no cambiaran normalmente pero nuestra aplicaci√≥n, en cada petici√≥n, debe conectarse, ejecutar las sentencias adecuadas para leer los datos, traerlos por la red, etc. Imaginemos, adem√°s, que la base de datos a la que nos conectamos esta saturada o la conexi√≥n de red que nos une a la base de datos es inestable. ¬øQu√© pasar√≠a?. Pues que tendr√≠amos una aplicaci√≥n lenta por el hecho de leer continuamente unos datos que sabemos que apenas cambian.\nPara solucionar ese problema podr√≠amos utilizar una Cache, pero ¬ø como implementarlo ?. En este articulo explicare como usar una cache b√°sica en Spring Boot.\nUn poco de teor√≠a La cache se aplica sobre funciones, donde para un mismo valor de entrada esperamos un mismo valor de salida. Es por ello que siempre debemos tener al menos un par√°metro de entrada y una salida.\nUn ejemplo t√≠pico seria este:\n@Cacheable(cacheNames=\u0026quot;headers\u0026quot;) public int funcionCacheada(int valor) { ... calculos muy complejos y costosos .... return N; }  Y ahora supongamos que tenemos el siguiente c√≥digo donde llamamos a esa funci√≥n:\nint valor=funcionCacheada(1); int otroValor=funcionCacheada(2); int tercerValor=funcionCacheada(1);  Al ejecutar el programa, en la primera l√≠nea, Spring, ejecutara la funci√≥n y guardara el resultado que devuelve. En la segunda l√≠nea, como no sabe el valor que se debe devolver para la entrada con valor \u0026#8220;2\u0026#8221; har√° lo mismo. Sin embargo en la tercera l√≠nea Spring detectara que una funci√≥n marcada con @Cacheable con el nombre de cache \u0026#8220;headers\u0026#8221; ya ha sido llamada con el valor \u0026#8220;1\u0026#8221; y no ejecutara la funci√≥n, simplemente devolver√° el valor que en la primera llamada guardo.\nEl nombre de la cache es importante pues, entre otras cosas, nos permite tener diferentes caches independientes, las cuales podremos, entre otras cosas limpiar, para obligar a a Spring Boot a ejecutar de nuevo las funciones.\nAs√≠, la idea b√°sicamente es que en cada llamada a una funci√≥n marcada como @Cacheable se guarda en una tabla interna los resultados para cada llamada, de tal manera que si ya tiene la salida para una entrada, no llama a la funci√≥n.\nPractica Y ahora, vamos a la pr√°ctica:\nEl proyecto de ejemplo sobre el que esta basado este articulo esta en: https://github.com/chuchip/cacheExample\nLo primero que se necesita es incluir la siguiente dependencia en nuestro proyecto:\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-cache\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt;  Ahora ya podremos utilizar las etiquetas que nos permitir√°n usar Cache en nuestra aplicaci√≥n.\nLa primera etiqueta a poner es @EnableCaching. Con esta etiqueta le indicamos a Spring que prepare el soporte para usar cache. Si no se la ponemos simplemente no la usara, independientemente de si indicamos posteriormente que cachee los resultados de unas funciones.\n@SpringBootApplication @EnableCaching public class CacheExampleApplication { public static void main(String[] args) { SpringApplication.run(CacheExampleApplication.class, args); } }  En este ejemplo se leer√°n unos datos de una base de datos a trav√©s de unas peticiones REST.\nLos datos como tal se leen en la clase CacheDataImpl.java que esta en el paquete com.profesorp.cacheexample.impl\nLa funci√≥n que lee los datos es la siguiente:\n@Cacheable(cacheNames=\u0026quot;headers\u0026quot;, condition=\u0026quot;#id \u0026gt; 1\u0026quot;) public DtoResponse getDataCache(int id) {\ttry { Thread.sleep(500); } catch (InterruptedException e) { }\tDtoResponse requestResponse=new DtoResponse();\tOptional\u0026lt;Invoiceheader\u0026gt; invoice=invoiceHeaderRepository.findById(id); ..... MAS CODIGO NO IMPORTANTE ... }  Como se puede ver tenemos la etiqueta @Cacheable(cacheNames=\u0026#8221;headers\u0026#8221;, condition=\u0026#8221;#id \u0026gt; 1\u0026#8243;)\nCon ella, le estamos indicando a Spring dos cosas.\n Que deseamos que cachee el resultado de esta funci√≥n. Le ponemos como condici√≥n, que solo cachee los resultados si el valor de entrada es superior a 1.  M√°s adelante, en la funci√≥n flushCache, le ponemos la etiqueta @CacheEvict la cual limpia la cache indicada. En este caso, adem√°s, le indicamos que borre todas las entradas que tengan cacheadas.\n@CacheEvict(cacheNames=\u0026quot;headers\u0026quot;, allEntries=true) public void flushCache() { }  En la funci√≥n update actualizamos la base de datos y con la etiqueta @CachePut le indicamos a Spring que actualice los datos para el valor que hay en dtoRequest.id\n@CachePut(cacheNames=\u0026quot;headers\u0026quot;, key=\u0026quot;#dtoRequest.id\u0026quot;) public DtoResponse update(DtoRequest dtoRequest) { .... ACTUALIZADA LA BASE DE DATOS ... }  Por supuesto esta funci√≥n tiene que devolver un objeto del mismo tipo que el de la marcada con la etiqueta @Cacheable y debemos indicarle el valor de entrada, para el que se desea actualizar los datos.\nFuncionando Para entender mejor la aplicaci√≥n vamos a arrancarla y realizarle algunas peticiones.\nLa aplicaci√≥n al arrancar guarda en la tabla invoiceHeader las cabeceras de 4 facturas (pod√©is ver como lo hace en el fichero data.sql).\nVamos a ejecutar la funci√≥n get de la clase PrincipalController, para ello escribimos:\n\u0026gt; curl -s http://localhost:8080/2  Nos devolver√° lo siguiente:\n{\u0026quot;interval\u0026quot;:507,\u0026quot;httpStatus\u0026quot;:\u0026quot;OK\u0026quot;,\u0026quot;invoiceHeader\u0026quot;:{\u0026quot;id\u0026quot;:2,\u0026quot;activo\u0026quot;:\u0026quot;N\u0026quot;,\u0026quot;yearFiscal\u0026quot;:2019,\u0026quot;numberInvoice\u0026quot;:2,\u0026quot;customerId\u0026quot;:2}}  El campo interval el tiempo en milisegundos que le ha costado realizar la consulta. Como se puede ver le ha costado mas de medio segundo, pues en la funci√≥n getDataCache de CacheDataImpl.javatenemos un sleep de 500 milisegundos.\nAhora ejecutamos de nuevo la llamada:\ncurl -s http://localhost:8080/2 {\u0026quot;interval\u0026quot;:1,\u0026quot;httpStatus\u0026quot;:\u0026quot;OK\u0026quot;,\u0026quot;invoiceHeader\u0026quot;:{\u0026quot;id\u0026quot;:2,\u0026quot;activo\u0026quot;:\u0026quot;N\u0026quot;,\u0026quot;yearFiscal\u0026quot;:2019,\u0026quot;numberInvoice\u0026quot;:2,\u0026quot;customerId\u0026quot;:2}}  Ahora el tiempo que ha tomado la llamada es 1 , porque realmente Spring NO ha ejecutado el c√≥digo de la funci√≥n y simplemente ha devuelto el valor que tenia cacheado.\nSin embargo si solicitamos el id 1 como hemos indicado que no lo cachee siempre ejecutara la funci√≥n y por lo tanto tendremos un tiempo superior a 500 milisegundos:\n\u0026gt;curl -s http://localhost:8080/1 {\u0026quot;interval\u0026quot;:503,\u0026quot;httpStatus\u0026quot;:\u0026quot;OK\u0026quot;,\u0026quot;invoiceHeader\u0026quot;:{\u0026quot;id\u0026quot;:1,\u0026quot;activo\u0026quot;:\u0026quot;S\u0026quot;,\u0026quot;yearFiscal\u0026quot;:2019,\u0026quot;numberInvoice\u0026quot;:1,\u0026quot;customerId\u0026quot;:1}} \u0026gt;curl -s http://localhost:8080/1 {\u0026quot;interval\u0026quot;:502,\u0026quot;httpStatus\u0026quot;:\u0026quot;OK\u0026quot;,\u0026quot;invoiceHeader\u0026quot;:{\u0026quot;id\u0026quot;:1,\u0026quot;activo\u0026quot;:\u0026quot;S\u0026quot;,\u0026quot;yearFiscal\u0026quot;:2019,\u0026quot;numberInvoice\u0026quot;:1,\u0026quot;customerId\u0026quot;:1}} \u0026gt;curl -s http://localhost:8080/1 {\u0026quot;interval\u0026quot;:503,\u0026quot;httpStatus\u0026quot;:\u0026quot;OK\u0026quot;,\u0026quot;invoiceHeader\u0026quot;:{\u0026quot;id\u0026quot;:1,\u0026quot;activo\u0026quot;:\u0026quot;S\u0026quot;,\u0026quot;yearFiscal\u0026quot;:2019,\u0026quot;numberInvoice\u0026quot;:1,\u0026quot;customerId\u0026quot;:1}}  Si llamamos a la funci√≥n flushcache limpiaremos la cache y por lo tanto la pr√≥xima llamada a la funci√≥n cacheada deber√° ejecutar la funci√≥n:\n\u0026gt; curl -s http://localhost:8080/flushcache Cache Flushed! \u0026gt; curl -s http://localhost:8080/2 {\u0026quot;interval\u0026quot;:508,\u0026quot;httpStatus\u0026quot;:\u0026quot;OK\u0026quot;,\u0026quot;invoiceHeader\u0026quot;:{\u0026quot;id\u0026quot;:2,\u0026quot;activo\u0026quot;:\u0026quot;N\u0026quot;,\u0026quot;yearFiscal\u0026quot;:2019,\u0026quot;numberInvoice\u0026quot;:2,\u0026quot;customerId\u0026quot;:2}} \u0026gt; curl -s http://localhost:8080/2 {\u0026quot;interval\u0026quot;:0,\u0026quot;httpStatus\u0026quot;:\u0026quot;OK\u0026quot;,\u0026quot;invoiceHeader\u0026quot;:{\u0026quot;id\u0026quot;:2,\u0026quot;activo\u0026quot;:\u0026quot;N\u0026quot;,\u0026quot;yearFiscal\u0026quot;:2019,\u0026quot;numberInvoice\u0026quot;:2,\u0026quot;customerId\u0026quot;:2}}  Por ultimo veremos como si cambiamos el valor del campo activo a N , como la funci√≥n que realiza el cambio esta marcada con @CacheEvict nos actualizara el valor de la cache, pero en la pr√≥xima llamada a la funci√≥n getDataCache se seguir√° sin ejecutar el c√≥digo, devolviendo, sin embargo, el objeto actualizado.\n curl -X PUT http://localhost:8080/ -H \"Content-Type: application/json\" -d \"{\\\"id\\\": 2, \\\"active\\\": \\\"N\\\"}\" curl -s http://localhost:8080/2 {\"interval\":0,\"httpStatus\":\"OK\",\"invoiceHeader\":{\"id\":2,\"activo\":\"N\",\"yearFiscal\":2019,\"numberInvoice\":2,\"customerId\":2}}  Conclusiones Spring Boot, sin ninguna dificultad, nos permite cachear los resultados de las funciones, sin embargo hay que tener en cuenta que esa cache es muy b√°sica y la realiza en memoria. Sin embargo Spring Boot permite usar librer√≠as externas que nos permitir√°n cachear en disco, en bases de datos, etc.\nEn https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-caching.html ten√©is las diferentes implementaciones de Cache que Spring Boot soporta, entre las que esta EhCache , con la cual podr√©is definir diferentes tipos de backend para los datos, as√≠ como especificar tiempos de validez para los datos y muchas m√°s opciones.\nComo veis, todo un mundo para explorar.\n¬°¬°Nos vemos en la proxima entrada!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/04/18/beans-avanzados-en-spring/",
	"title": "Beans avanzados",
	"tags": ["beans", "spring"],
	"description": "",
	"content": "En esta ocasi√≥n he cogido un proyecto de SimpleProgramming el cual tiene un video en Youtube donde explica como cargar Beans din√°micamente usando Spring (en Ingles).\nImaginemos que tenemos un programa que dependiendo de unos par√°metros deba cargar un clase u otra, donde est√° definida la l√≥gica a seguir. Por supuesto podemos anidar condiciones e instanciar las clases debidas, pero eso tiene un problema y es que si ma√±ana debemos a√±adir una l√≥gica nueva, deberemos incluir una condici√≥n m√°s para cargar la nueva clase, y podr√≠amos introducir errores en el c√≥digo.\nLo ideal seria que tuvi√©ramos una interfaz, y despu√©s una serie de clases que implementaran esa interfaz. Despu√©s, de alguna manera, deber√≠amos cargar la clase adecuada sin tener una sola condici√≥n en el c√≥digo.\nPues con Spring eso se puede hacer usando la clase ServiceLocatorFactoryBean. Esta clase definida en la siguiente URL https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/config/ServiceLocatorFactoryBean.html implementa una fabrica de Beans, creando un proxy de tal manera que devuelve una clase tipo BeanFactory, la cual nos permitir√° crear nuestros Beans din√°micamente.\nEsto que parece bastante confuso explicado as√≠ es realmente muy f√°cil de realizar. Pong√°monos manos a la obra.\nEn el ejemplo que ten√©is en https://github.com/chuchip/springboot-servicelocatorfactorybean esta la interfaz AdapterService, cuyo c√≥digo como veis a continuaci√≥n es muy simple:\npublic interface AdapterService { public String process(); }  Se crean 4 clases que implementan ese interface BikeService, BusService, TruckService y CarService. A continuaci√≥n ten√©is el c√≥digo de CarService\n@Service(\u0026quot;Car\u0026quot;) public class CarService implements AdapterService { int numberExecution=1; @Override public String process() {\treturn \u0026quot;inside car service - number of executions: \u0026quot;+(numberExecution++); } }  Lo importante de esta clase es la etiqueta @Service(\u0026quot;car\u0026quot;) pues especificamos el nombre con el que deberemos cargar la clase.\nEn las dem√°s clases existen las etiquetas: @Service(\u0026quot;Bike\u0026quot;), @Service(\u0026quot;Bus\u0026quot;) y @Service(\u0026quot;Truck\u0026quot;)siendo su c√≥digo pr√°cticamente id√©ntico, solo cambiando el mensaje a devolver.\nAhora se debe crear el interface que pasaremos a la clase ServiceLocatorFactoryBean en este ejemplo es la clase ServiceRegistry\npublic interface ServiceRegistry { public AdapterService getService(String serviceName); }  En esta clase deberemos definir la funci√≥n getService que es la que ServiceLocatorFactoryBean invocara. Esta funci√≥n debe recibir un par√°metro que ser√° el nombre del bean (el definido con las etiquetas @service), adem√°s devolver√° un objeto que implemente el interfaz adecuado (en este caso AdapterService).\nEn la clase VehicleConfig definimos la funci√≥n que nos devolver√° el FactoryBean\n@Configuration public class VehicleConfig { @Bean public FactoryBean\u0026amp;lt;?\u0026amp;gt; factoryBean() { final ServiceLocatorFactoryBean bean = new ServiceLocatorFactoryBean(); bean.setServiceLocatorInterface(ServiceRegistry.class); return bean; } }  En ella, instanciamos una clase tipo ServiceLocatorFactoryBean, especificando el interface que debe devolver y luego retornamos ese objeto ServiceLocatorFactoryBean que por supuesto implementa el interfaz FactoryBean\nPara ver la funcionalidad de estos beans, en el proyecto de ejemplo, hemos creado un controlador rest muy simple.\n@RestController public class VehicleController { @Autowired private ServiceRegistry serviceRegistry; @GetMapping(\u0026quot;{vehicle}\u0026quot;) public String processGet(@PathVariable String vehicle) { return serviceRegistry.getService(vehicle).process(); } }  En ella, dependiendo de la URL llamada, que ser√° volcada en la variable vehicle se llamara a una de las clases que implementan el interfaz AdapterService y todo ello sin un solo if\nAs√≠ si ejecutamos:\n$ curl -s http://localhost:8080/Car inside car service - number of executions: 1 $ curl -s http://localhost:8080/Car inside car service - number of executions: 2  se puede observar como es cargada la clase CarServicey como se mantiene en el contexto de Spring, pues se puede ver como el numero de ejecuciones aumenta con cada llamada.\nSi ejecutamos las siguientes sentencias:\n$ curl -s http://localhost:8080/Truck inside truck service - number of executions: 1 $ curl -s http://localhost:8080/Truck inside truck service - number of executions: 2 $ curl -s http://localhost:8080/Car inside car service - number of executions: 3  podemos observar como funciona todo correctamente.\nPor supuesto si intentamos cargar un Bean no definido dar√° un error:\n$ curl -s http://localhost:8080/Boat {\u0026quot;timestamp\u0026quot;:\u0026quot;2019-04-18T21:07:23.139+0000\u0026quot;,\u0026quot;status\u0026quot;:500,\u0026quot;error\u0026quot;:\u0026quot;Internal Server Error\u0026quot;,\u0026quot;message\u0026quot;:\u0026quot;No bean named 'Boat' available\u0026quot;,\u0026quot;path\u0026quot;:\u0026quot;/Boat\u0026quot;}  Y de esta manera tan simple. gracias a la magia de Spring, se pueden crear programas f√°cilmente ampliables y modulares.\nHasta otra y no olvid√©is seguirme en Twitter para estar al tanto de nuevas entradas de este blog.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/04/05/optimizando-consultas-con-hibernate/",
	"title": "Optimizando relaciones entre entidades en Hibernate",
	"tags": ["h2", "hibernate", "java", "jpa", "spring boot"],
	"description": "",
	"content": " En esta entrada, siguiendo el proyecto de ejemplo que teneis en¬†https://github.com/chuchip/jpajoins explicando como optimizar¬†las consultas a la base de datos usando JPA.\nSe ver√°n diferentes tipos de consultas, explicando como realizar uniones entre tablas de modo perezoso (lazy) o agresivo (eager). Se unir√°n tablas por un solo campo, por varios e incluso por uno pero a√±adiendo una condici√≥n est√°tica.\nEL proyecto de ejemplo esta desarrollado en Spring Boot con Hibernate, usando como base de datos H2.\nLas tablas est√°n definidas en el fichero schema.sql y se cargan datos para pruebas en el fichero data.sql\nEste es el esquema de la base de datos:\nEn esa ocasi√≥n no voy a explicar el c√≥digo pues es muy parecido al de otros programas que he explicado detalladamente en otras entradas. Me centrare en como realizar las diferentes consultas realizadas en el programa.\n Nota aclaratoria:\nSi el nombre de la entidad o de la columna en las clases Java tiene una may√∫scula en medio, JPA interpretara que su hay un guion en medio y ese ser√° la tabla o columna que buscara en la base de datos. De esta manera si a la clase Invoiceheader.java le renombr√°ramos a InvoiceHeader.java Hibernate, buscar√≠a la tabla invoice_header en la base de datos y fallar√≠a pues no la encontrar√≠a.\nComo ejemplo se puede ver el campo line_details de la tabla invoiceDetails, que en la clase Invoicedetails.java (obs√©rvese que la D es min√∫scula) es llamada con la variable lineDetails.\n Realizando una \u0026#8216;select join\u0026#8216; entre la tabla cabeceras de factura (invoiceHeader) y clientes (customer)  Enlace perezoso  @ManyToOne(fetch=FetchType.LAZY) @JoinColumn(name=\"customerid\",referencedColumnName=\"id\") Customer customer;  Al realizar la b√∫squeda la consulta resultante sera:\nselect invoicehea0_.id as id1_3_0_, invoicehea0_.customerid as customer2_3_0_, invoicehea0_.fiscalyear as fiscalye3_3_0_, invoicehea0_.numberinvoice as numberin4_3_0_ from invoiceheader invoicehea0_ where invoicehea0_.id=?  y cuando se realice un consulta sobre la columna customer ejecutara la sentencia select necesaria para buscar los datos del cliente:\n select customer0_.id as id1_1_0_, customer0_.active as active2_1_0_, customer0_.address as address3_1_0_, customer0_.name as name4_1_0_ from customer customer0_ where customer0_.id=?   Enlace duro\n@ManyToOne(fetch=FetchType.EDGER) @JoinColumn(name=\u0026ldquo;customerid\u0026rdquo;,referencedColumnName=\u0026ldquo;id\u0026rdquo;)\nCustomer customer;\n  Al estar el tipo de b√∫squeda establecido a FetchType.EDGER realizara una √∫nica select con su correspondiente left outer join\n select invoicehea0_.id as id1_3_0_, invoicehea0_.customerid as customer2_3_0_, invoicehea0_.fiscalyear as fiscalye3_3_0_, invoicehea0_.numberinvoice as numberin4_3_0_, customer1_.id as id1_1_1_, customer1_.active as active2_1_1_, customer1_.address as address3_1_1_, customer1_.name as name4_1_1_ from invoiceheader invoicehea0_ left outer join customer customer1_ on invoicehea0_.customerid=customer1_.id where invoicehea0_.id=?   Rizando el rizo.A√±adiendo valores fijos  Pero, ¬øy si queremos que nos enlace las dos tablas por una columna y adem√°s con un valor fijo en otra?\nEn la tabla customer se defini√≥ la columna active y queremos que solo nos muestre los datos de la factura cuando el valor de esa columna sea 1 Para ello necesitaremos la ayuda de la etiqueta @JoinColumnsOrFormulas que nos permite realizar uniones tanto entre dos columnas como estableciendo valores a la columna de la tabla destino (en este caso customer)\n@ManyToOne(fetch=FetchType.EDGER) @JoinColumnsOrFormulas({ @JoinColumnOrFormula(column=@JoinColumn(name=\u0026quot;customerid\u0026quot;, referencedColumnName =\u0026quot;id\u0026quot;) ), @JoinColumnOrFormula(formula = @JoinFormula(value=\u0026quot;1\u0026quot;,referencedColumnName = \u0026quot;active\u0026quot;)) }) Customer customer;  La select ejecutada ser√°:\nselect invoicehea0_.id as id1_3_0_, invoicehea0_.customerid as customer2_3_0_, invoicehea0_.fiscalyear as fiscalye3_3_0_, invoicehea0_.numberinvoice as numberin4_3_0_, 1 as formula1_0_, customer1_.id as id1_1_1_, customer1_.active as active2_1_1_, customer1_.address as address3_1_1_, customer1_.name as name4_1_1_ from invoiceheader invoicehea0_ left outer join customer customer1_ on invoicehea0_.customerid=customer1_.id and 1=customer1_.active where invoicehea0_.id=?  En el caso de que no encuentre ning√∫n registro, la variable customer tendr√° un valor nulo.\nSi el tipo de enlace fuera lazy como en el caso anterior se har√≠a primero una query sobre la tabla invoiceheader y cuando se pidiera el valor de la variable customer se realizar√≠a sobre su correspondiente tabla.\nUniendo tabla cabeceras facturas y l√≠neas de facturas. Para unir las dos tablas pondremos el siguiente c√≥digo en la clase Invoicedetails.java\n@OneToMany @JoinColumns( { @JoinColumn(name=\"fiscalyear\",referencedColumnName=\"fiscalyear\"), @JoinColumn(name=\"numberinvoice\",referencedColumnName=\"numberinvoice\") } ) @OrderBy(\"linea desc\") List\u0026lt;Invoicedetails\u0026gt; details;  Como se ve, al ser dos campos los que unen ambas tablas haremos uso de la etiqueta @JoinColumns con sus correspondientes @JoinColumn dentro.\nComo no hemos especificado nada, la uni√≥n se har√° del tipo EAGER por lo cual la consulta realizada a la base de datos ser√° la siguiente:\n select invoicehea0_.id as id1_3_0_, invoicehea0_.customerid as customer2_3_0_, invoicehea0_.fiscalyear as fiscalye3_3_0_, invoicehea0_.numberinvoice as numberin4_3_0_, 1 as formula1_0_, details1_.fiscalyear as fiscalye2_2_1_, details1_.numberinvoice as numberin5_2_1_, details1_.id as id1_2_1_, details1_.id as id1_2_2_, details1_.articleid as articlei6_2_2_, details1_.fiscalyear as fiscalye2_2_2_, details1_.linea_details as linea_de3_2_2_, details1_.numberarticles as numberar4_2_2_, details1_.numberinvoice as numberin5_2_2_, article2_.id as id1_0_3_, article2_.description as descript2_0_3_, article2_.price as price3_0_3_ from invoiceheader invoicehea0_ left outer join invoicedetails details1_ on invoicehea0_.fiscalyear=details1_.fiscalyear and invoicehea0_.numberinvoice=details1_.numberinvoice left outer join article article2_ on details1_.articleid=article2_.id where invoicehea0_.id=?  El ultimo \u0026#8220;left outer join\u0026#8221; haciendo referencia a la tabla article lo pone Hibernate porque en la clase Invoicedetails.java tenemos el c√≥digo:\n@ManyToOne(fetch=FetchType.EAGER) @JoinColumns({ @JoinColumn(name=\u0026quot;articleid\u0026quot;,referencedColumnName=\u0026quot;id\u0026quot;) }) Article articles;  para que nos muestre los datos del articulo por cada l√≠nea del articulo, y como esta marcada la uni√≥n a tipo EAGER, Hibernate es lo suficientemente listo para hacer una sola consulta a la base de datos.\nSi realizamos un llamada a http://localhost:8080/1 observaremos la siguiente salida que devuelve la clase Invoiceheader.java veremos lo siguiente:\n{ \u0026quot;id\u0026quot;: 1, \u0026quot;yearFiscal\u0026quot;: 2019, \u0026quot;numberInvoice\u0026quot;: 1, \u0026quot;customerId\u0026quot;: 1, \u0026quot;customer\u0026quot;: { \u0026quot;id\u0026quot;: 1, \u0026quot;name\u0026quot;: \u0026quot;customer 1 name\u0026quot;, \u0026quot;address\u0026quot;: \u0026quot;customer 1 address\u0026quot;, \u0026quot;active\u0026quot;: 1 }, \u0026quot;details\u0026quot;: [ { \u0026quot;id\u0026quot;: 2, \u0026quot;year\u0026quot;: 2019, \u0026quot;invoice\u0026quot;: 1, \u0026quot;linea\u0026quot;: 2, \u0026quot;numberarticles\u0026quot;: 3, \u0026quot;articles\u0026quot;: { \u0026quot;id\u0026quot;: 2, \u0026quot;description\u0026quot;: \u0026quot;article 2 description\u0026quot;, \u0026quot;price\u0026quot;: 12.3 } }, { \u0026quot;id\u0026quot;: 1, \u0026quot;year\u0026quot;: 2019, \u0026quot;invoice\u0026quot;: 1, \u0026quot;linea\u0026quot;: 1, \u0026quot;numberarticles\u0026quot;: 5, \u0026quot;articles\u0026quot;: { \u0026quot;id\u0026quot;: 1, \u0026quot;description\u0026quot;: \u0026quot;article 1 description\u0026quot;, \u0026quot;price\u0026quot;: 10.1 } } ] }  ¬ø No veis algo raro ?. ¬°Efectivamente!. Las lineas las saca ordenadas de mayor a menor (primero la linea 2, luego la 1). Evidentemente eso es debido a la etiqueta @OrderBy(\u0026ldquo;linea desc\u0026rdquo;) , de la cual hay que destacar dos cosas:\n El campo al que hacemos referencia es como es nombrado en la entidad. As√≠ aunque en la base de datos se llama lineaDetails se referencia por la etiqueta linea que es como se nombra la variable  @Column (name=\"lineaDetails\") int linea; // La 'D' esta en mayuscualas adrede para que mapee el campo linea_details  En la consulta que hace a la base de datos no introduce la clausula \u0026#8216;order by\u0026#8217; . Es decir es el propio hibernate el que encarga de ordenar los resultados. Tenerlo en cuenta cuando haya miles de registros devueltos.  Y as√≠ queda demostrado la importancia de establecer el tipo de uni√≥n pues si imaginamos una factura que tenga miles de l√≠neas (improbable lo s√©), si establecemos el m√©todo de uni√≥n a lazy en vez de hacer una sola consulta a la base de datos, har√≠a 1000 lo cual, por supuesto ralentizar√≠a much√≠simo nuestra consulta, aparte de sobrecargar innecesariamente el servidor de la base de datos\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/03/25/accediendo-facilmente-a-los-datos-con-spring-rest-data/",
	"title": "Accediendo facilmente a los datos con Spring Rest Data",
	"tags": ["java", "jpa", "json", "rest", "spring boot"],
	"description": "",
	"content": " Spring Boot ofrece un fant√°stico soporte para acceder a los datos con JPA a trav√©s de sus interfaces, del tipo Repository. Si a esto le a√±adimos la facilidad con que se crean servicios REST, como explicaba en la entrada [http://www.profesor-p.com/2018/10/11/aplicacion-crud-en-kotlin-con-springboot/][2] podremos hacer una aplicaci√≥n ofreciendo una API para acceder a nuestra base de datos preferida muy facilmente.\nPero si queremos implementar HATEOAS en nuestro proyecto o si hay muchos criterios sobre los que debemos acceder a los datos, deberemos escribir bastante c√≥digo. Para solucionar este problema Spring Boot provee el paquete Spring Data Rest con el cual con apenas c√≥digo podremos crear una API para acceder a las tablas de nuestra base de datos.\nEn el ejemplo que ten√©is disponible en mi p√°gina de GITHUB veremos como poder realizar el mantenimiento de una tabla de clientes (customers) sin escribir ni una sola l√≠nea para definir las diferentes APIS REST.\nCreando el proyecto Como siempre, podremos ir a la pagina https://start.spring.io para crear nuestro proyecto maven. Para el proyecto de ejemplo que vamos a crear, deberemos incluir las siguientes dependencias:\nSpring Data Rest, H2, JPA, Lombok como se ve en la siguiente captura de pantalla\nUna vez tengamos hayamos importado el proyecto en nuestro IDE preferido, deberemos modificar el fichero application.properties para definir ciertos par√°metros:\n#H2 spring.h2.console.enabled=true spring.h2.console.path=/h2 #JPA spring.jpa.show-sql=true spring.jpa.hibernate.ddl-auto=create-drop # Datasource spring.datasource.url=jdbc:h2:file:~/test spring.datasource.username=sa spring.datasource.password= spring.datasource.driver-class-name=org.h2.Driver # Data Rest spring.data.rest.base-path: /api  De este fichero la √∫nica entrada relativa a la librer√≠a Data Rest es la √∫ltima. En ella especificamos la direcci√≥n donde se deben implementar las llamadas REST para acceder a las diferentes tablas que implemente nuestra aplicaci√≥n. Es decir, en nuestro caso, se acceder√° a trav√©s de la URL: http://localhost:8080/api\nLas dem√°s l√≠neas configuran la base de datos H2 que usaremos, as√≠ como ciertas propiedades de JPA. Por supuesto dejaremos a JPA que cree la estructura de la base de datos a trav√©s de las entidades definidas, gracias a la sentencia: spring.jpa.hibernate.ddl-auto=create-drop\n ### Estructura del proyecto  Nuestro proyecto final tendr√° la siguiente estructura:\nComo se puede ver, definiremos dos tablas (entities) , que son: City y Customer. Tambi√©n definimos los correspondientes repositorios CustomerRepository y CityRepository\nLa clase CityEntity.java es la siguiente:\n@Entity @Data @RestResource(rel=\u0026quot;customers\u0026quot;, path=\u0026quot;customer\u0026quot;) public class CustomerEntity {\t@Id long id;\t@Column String name;\t@Column String address;\t@Column String telephone;\t@Column @JsonIgnore String secret; @OneToOne CityEntity city; }  Las particularidades de esta clase son las siguientes:\n la l√≠nea @RestResource donde con el par√°metro rel especificamos como debe llamarse el objeto en la salida JSON. Con el par√°metro path se indica donde se debe realizar la petici√≥n HTTP. La anotaci√≥n @JsonIgnore aplicada a la columna secret. Con esta etiqueta ese campo ser√° ignorado, de tal manera que ni se mostrara en las salidas, ni se actualizara, aunque se incluya, en las peticiones.  Si no pusi√©ramos la etiqueta @RestResource Spring presentar√≠a el recurso para acceder a la entidad en http://localhost:8080/api/customerEntities es decir usar√≠a el nombre de la clase, poni√©ndolo en plural , por lo cual le a√±ade \u0026#8216;es\u0026#8217;.\nEl repositorio de esta entidad esta en CustomerRepository y contiene solo estas l√≠neas:\npublic interface CustomerRepository extends CrudRepository\u0026amp;lt;CustomerEntity, Long\u0026amp;gt; {\tpublic List\u0026amp;lt;CustomerEntity\u0026amp;gt; findByNameIgnoreCaseContaining(@Param(\u0026quot;name\u0026quot;) String name); }  La funci√≥n findByNameIgnoreCaseContaining que he definido permitir√° buscar los clientes, ignorando may√∫sculas y min√∫sculas, cuyo nombre contengan la cadena mandada. M√°s adelante explicare como poder realizar una consulta a trav√©s de esta llamada con Spring Data Rest\nTen√©is m√°s documentaci√≥n sobre como crear consultas personalizadas en Spring en esta otra entrada m√≠a.\nLa clase CityEntity.java contiene las siguientes l√≠neas:\n@Entity @Data @RestResource(exported=false) public class CityEntity {\t@Id int id; @Column String name; @Column String province; }  En este caso la etiqueta @RestResource tiene indicada la propiedad exported igual a false para que esta entidad no sea tratada por¬†Data Rest y no sera accesible a traves de ninguna API.\nAccediendo al API de Data Rest Los recursos que est√°n publicados estar√°n disponibles en la URL: http://localhost:8080/api, como hemos definido en el fichero application.properties. Esta ser√° la salida en este proyecto:\n\u0026gt; curl -s http://localhost:8080/api/ { \u0026quot;_links\u0026quot; : { \u0026quot;customers\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer\u0026quot; }, \u0026quot;profile\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/profile\u0026quot; } } }  El profile se refiere a lo definido en el RFC 6906, donde se incluye detalles de la aplicaci√≥n, pero no tratare de ello en esta entrada.\nPara acceder al √∫nico recurso disponible en nuestro proyecto, al que hemos llamado customer,¬†navegaremos a: http://localhost:8080/api/customer .\nPrimero a√±adamos un registro. Esto lo realizaremos realizando una petici√≥n tipo POST como la siguiente:\n\u0026gt; curl -s --request POST localhost:8080/api/customer -d '{\u0026quot;id\u0026quot;: 1, \u0026quot;name\u0026quot;:\u0026quot;nombre cliente 1\u0026quot;,\u0026quot;address\u0026quot;:\u0026quot;direccion cliente 1\u0026quot;,\u0026quot;telephone\u0026quot;:\u0026quot;telefono cliente 1\u0026quot;, \u0026quot;secret\u0026quot;: \u0026quot;no guardar\u0026quot;}' -H \u0026quot;Content-Type: application/json\u0026quot; { \u0026quot;name\u0026quot; : \u0026quot;nombre cliente 1\u0026quot;, \u0026quot;address\u0026quot; : \u0026quot;direccion cliente 1\u0026quot;, \u0026quot;telephone\u0026quot; : \u0026quot;telefono cliente 1\u0026quot;, \u0026quot;city\u0026quot; : null, \u0026quot;_links\u0026quot; : { \u0026quot;self\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/1\u0026quot; }, \u0026quot;customerEntity\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/1\u0026quot; } }  Podemos comprobar que ha realizado la inserci√≥n gracias a la consola de H2. Para ello iremos a la URL http://localhost:8080/h2/ y pulsaremos el bot√≥n Connect. Una vez conectados, si realizamos una query sobre la tabla CUSTOMER_ENTITY veremos la siguiente salida:\nObservar que aunque hemos a√±adido el valor para el campo \u0026#8220;secret\u0026#8221; en la anterior petici√≥n POST, este no se ha guardado en la base de datos.\nComo no podemos acceder a la tabla city_entity a trav√©s de nuestra API pues as√≠ lo hemos especificado, Vamos a aprovechar que estamos en la consola y a√±adir un registro en la tabla, el cual asignaremos al cliente insertado.\ninsert into city_entity values(1,'Logro√±o','La Rioja'); update customer_entity set city_id=1;  ![Consultando datos en tabla customer_entity][/img/2019/03/consola-h2.png]\nAhora si realizamos una petici√≥n GET obtendremos la siguiente salida:\n\u0026gt; curl -s localhost:8080/api/customer { \u0026quot;_embedded\u0026quot; : { \u0026quot;customers\u0026quot; : [ { \u0026quot;name\u0026quot; : \u0026quot;nombre cliente 1\u0026quot;, \u0026quot;address\u0026quot; : \u0026quot;direccion cliente 1\u0026quot;, \u0026quot;telephone\u0026quot; : \u0026quot;telefono cliente 1\u0026quot;, \u0026quot;city\u0026quot; : { \u0026quot;name\u0026quot; : \u0026quot;Logro√±o\u0026quot;, \u0026quot;province\u0026quot; : \u0026quot;La Rioja\u0026quot; }, \u0026quot;_links\u0026quot; : { \u0026quot;self\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/1\u0026quot; }, \u0026quot;customerEntity\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/1\u0026quot; } } } ] }, \u0026quot;_links\u0026quot; : { \u0026quot;self\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer\u0026quot; }, \u0026quot;profile\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/profile/customer\u0026quot; }, \u0026quot;search\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/search\u0026quot; } } }  Observar como HATEOAS muestra los diferentes enlaces disponibles automagicamente\nPor ejemplo podr√≠amos consultar directamente el cliente con el c√≥digo 1 navegando a http://localhost:8080/api/customer/1\n\u0026gt; curl -s localhost:8080/api/customer/1 { \u0026quot;name\u0026quot; : \u0026quot;nombre cliente 1\u0026quot;, \u0026quot;address\u0026quot; : \u0026quot;direccion cliente 1\u0026quot;, \u0026quot;telephone\u0026quot; : \u0026quot;telefono cliente 1\u0026quot;, \u0026quot;city\u0026quot; : { \u0026quot;name\u0026quot; : \u0026quot;Logro√±o\u0026quot;, \u0026quot;province\u0026quot; : \u0026quot;La Rioja\u0026quot; }, \u0026quot;_links\u0026quot; : { \u0026quot;self\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/1\u0026quot; }, \u0026quot;customerEntity\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/1\u0026quot; } } }  Como he explicado antes, en el repositorio de Customer he definido la funci√≥n findByNameIgnoreCaseContaining. Para realizar una consulta usando esa funci√≥n usaremos los enlaces tipo search\nhttp://localhost:8080/api/customer/search/findByNameIgnoreCaseContaining{?name}\n\u0026gt; curl -s http://localhost:8080/api/customer/search/findByNameIgnoreCaseContaining?name=Clien { \u0026quot;_embedded\u0026quot; : { \u0026quot;customers\u0026quot; : [ { \u0026quot;name\u0026quot; : \u0026quot;nombre cliente 1\u0026quot;, \u0026quot;address\u0026quot; : \u0026quot;direccion cliente 1\u0026quot;, \u0026quot;telephone\u0026quot; : \u0026quot;telefono cliente 1\u0026quot;, \u0026quot;city\u0026quot; : { \u0026quot;name\u0026quot; : \u0026quot;Logro√±o\u0026quot;, \u0026quot;province\u0026quot; : \u0026quot;La Rioja\u0026quot; }, \u0026quot;_links\u0026quot; : { \u0026quot;self\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/1\u0026quot; }, \u0026quot;customerEntity\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/1\u0026quot; } } } ] }, \u0026quot;_links\u0026quot; : { \u0026quot;self\u0026quot; : { \u0026quot;href\u0026quot; : \u0026quot;http://localhost:8080/api/customer/search/findByNameIgnoreCaseContaining?name=Clien\u0026quot; } } }  Por no hacer m√°s larga la entrada no explicare como actualizar un registro, con peticiones HTTP tipo PUT, borrar registros con peticiones HTTP tipo DELETE o actualizar parte de un registro con PATCH, pues creo que es obvio y lo dejo como ejercicio para el lector.\nComentar que lo mostrado en este articulo es solo un esbozo de la potencia de Spring Data Rest.\nEstas son algunas de las otras muchas caracter√≠sticas que implementa:\n Permite a√±adir eventos de tal manera que cuando se inserte, modifique, borre o incluso consulte un registro ese evento sea disparado y se puedan ejecutar el c√≥digo deseado, el cual incluso puede modificar o anular la petici√≥n realizada. Por supuesto soporta navegaci√≥n Soporta navegaci√≥n entre los registros consultados. Validaci√≥n de los datos insertados Los Links pueden ser totalmente personalizados.  Y esto es todo, esperando que el articulo haya resultado interesante me despido hasta el siguiente. Como siempre se agradecer√° cualquier feedback.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/03/16/zuul-para-redirigir-peticiones-rest-en-spring-boot/",
	"title": "Usando Zuul para redirigir peticiones REST",
	"tags": ["cloud", "gateway", "java", "spring boot", "zuul"],
	"description": "",
	"content": " En este articulo explicare como crear una pasarela para peticiones REST (una gateway) utilizando Zuul.\nZuul es parte del paquete Spring Cloud NetFlix y permite redirigir peticiones REST, realizando diversos tipos de filtros.\nEn casi cualquier proyecto donde haya microservicios, es deseable que todas las comunicaciones entre esos microservicios pasen por un lugar com√∫n, de tal manera que se registren las entradas y salidas, se pueda implementar seguridad o se puedan redirigir las peticiones dependiendo de diversos par√°metros.\nCon Zuul esto es muy f√°cil de implementar ya que esta perfectamente integrado con Spring Boot.\nComo siempre en mi p√°gina de GitHub pod√©is ver los fuentes sobre los que esta basado este articulo.\nCreando el proyecto. Si tenemos instalado Eclipse con el plugin de Spring Boot (lo cual recomiendo), el crear el proyecto seria tan f√°cil como a√±adir un nuevo proyecto del tipo Spring Boot incluyendo el starter Zuul. Para poder hacer algunas pruebas tambi√©n incluiremos el starter Web, como se ve en la imagen:\nTambien tenemos la opci√≥n de crear un proyecto Maven desde la p√°gina web https://start.spring.io/ que luego importaremos desde nuestro IDE preferido.\nEmpezando Partiendo que nuestro programa esta escuchando en http://localhost:8080/ , vamos a a suponer que queremos que todo lo que vaya a la URL, http://localhost:8080/google sea redirigida a https://www.google.com.\nPara ello deberemos crear el fichero application.yml dentro del directorio resources, como se ve en la imagen\nEn este fichero incluiremos las siguientes l√≠neas:\nzuul: routes: google: path: /google/** url: https://www.google.com/  Con ellas especificaremos que todo lo que vaya a la ruta /google/ y algo m√°s (**) sea redirigido a https://www.google.com/ , teniendo en cuenta que si por ejemplo la petici√≥n es realizada http://localhost:8080/google/search?q=profesor_p esta ser√° redirigida a https://www.google.com/search?q=profesor_p. Es decir lo que a√±adamos despu√©s de /google/ ser√° incluido en la redirecci√≥n, debido a los dos asteriscos a√±adidos al final del path.\nPara que el programa funcione solo ser√° necesario a√±adir la anotaci√≥n @EnableZuulProxyen la clase de inicio, en este caso en: ZuulSpringTestApplication\nimport org.springframework.cloud.netflix.zuul.EnableZuulProxy; @SpringBootApplication @EnableZuulProxy public class ZuulSpringTestApplication { public static void main(String[] args) { SpringApplication.run(ZuulSpringTestApplication.class, args); } }  Para poder demostrar las diversas funcionalidades de ZUUL, en http://localhost:8080/api estar√° escuchando un servicio REST que esta implementada en la clase TestController de este proyecto. Esta clase simplemente devuelve en el cuerpo, los datos de la petici√≥n recibida.\n@RestController public class TestController { final static String SALTOLINEA=\u0026quot;\\n\u0026quot;; Logger log = LoggerFactory.getLogger(TestController.class); @RequestMapping(path=\u0026quot;/api\u0026quot;) public String test(HttpServletRequest request) { StringBuffer strLog=new StringBuffer(); strLog.append(\u0026quot;................ RECIBIDA PETICION EN /api ...... \u0026quot;+SALTOLINEA); strLog.append(\u0026quot;Metodo: \u0026quot;+request.getMethod()+SALTOLINEA); strLog.append(\u0026quot;URL: \u0026quot;+request.getRequestURL()+SALTOLINEA); strLog.append(\u0026quot;Host Remoto: \u0026quot;+request.getRemoteHost()+SALTOLINEA); strLog.append(\u0026quot;----- MAP ----\u0026quot;+SALTOLINEA); request.getParameterMap().forEach( (key,value) -\u0026amp;gt; { for (int n=0;n\u0026amp;lt;value.length;n++) { strLog.append(\u0026quot;Clave:\u0026quot;+key+ \u0026quot; Valor: \u0026quot;+value[n]+SALTOLINEA); } } ); strLog.append(SALTOLINEA+\u0026quot;----- Headers ----\u0026quot;+SALTOLINEA); Enumeration\u0026amp;lt;String\u0026amp;gt; nameHeaders=request.getHeaderNames();\twhile (nameHeaders.hasMoreElements()) { String name=nameHeaders.nextElement(); Enumeration\u0026amp;lt;String\u0026amp;gt; valueHeaders=request.getHeaders(name); while (valueHeaders.hasMoreElements()) { String value=valueHeaders.nextElement(); strLog.append(\u0026quot;Clave:\u0026quot;+name+ \u0026quot; Valor: \u0026quot;+value+SALTOLINEA); } } try { strLog.append(SALTOLINEA+\u0026quot;----- BODY ----\u0026quot;+SALTOLINEA); BufferedReader reader= request.getReader(); if (reader!=null) { char[] linea= new char[100]; int nCaracteres; while ((nCaracteres=reader.read(linea,0,100))\u0026amp;gt;0) {\tstrLog.append( linea); if (nCaracteres!=100) break; } } } catch (Throwable e) { e.printStackTrace(); } log.info(strLog.toString()); return SALTOLINEA+\u0026quot;---------- Prueba de ZUUL ------------\u0026quot;+SALTOLINEA+ strLog.toString(); } }  Filtrando: Dejando logs En esta parte vamos a ver como crear un filtro de tal manera que se deje un registro de las peticiones realizadas.\nPara ello crearemos la clase PreFilter.java la cual debe extender de ZuulFilter\npublic class PreFilter extends ZuulFilter { Logger log = LoggerFactory.getLogger(PreFilter.class); @Override public Object run() { RequestContext ctx = RequestContext.getCurrentContext(); StringBuffer strLog=new StringBuffer(); strLog.append(\u0026quot;\\n------ NUEVA PETICION ------\\n\u0026quot;); strLog.append(String.format(\u0026quot;Server: %s Metodo: %s Path: %s \\n\u0026quot;,ctx.getRequest().getServerName() ,ctx.getRequest().getMethod(), ctx.getRequest().getRequestURI())); Enumeration\u0026lt;String\u0026gt; enume= ctx.getRequest().getHeaderNames(); String header; while (enume.hasMoreElements()) { header=enume.nextElement(); strLog.append(String.format(\u0026quot;Headers: %s = %s \\n\u0026quot;,header,ctx.getRequest().getHeader(header))); }; log.info(strLog.toString()); return null; } @Override public boolean shouldFilter() { return true; } @Override public int filterOrder() { return FilterConstants.SEND_RESPONSE_FILTER_ORDER; } @Override public String filterType() { return \u0026quot;pre\u0026quot;; } }  En esta clase deberemos sobrescribir las funciones que vemos en el fuente. A continuaci√≥n explico que haremos en cada de ellas\n public Object run()Aqu√≠ pondremos lo que queremos que se ejecute por cada petici√≥n recibida. En ella podremos ver el contenido de la petici√≥n y manipularla si fuera necesario. public boolean shouldFilter()Si devuelve true se ejecutara la funci√≥n run . public int filterOrder()Devuelve cuando que se ejecutara este filtro, pues normalmente hay diferentes filtros, para cada tarea. Hay que tener en cuenta que ciertas redirecciones o cambios en la petici√≥n hay que hacerlas en ciertos ordenes, por la misma l√≥gica que tiene zuul a la hora de procesar las peticiones. public String filterType() Especifica cuando se ejecutara el filtro. Si devuelve \u0026#8220;pre\u0026#8221; se ejecutara antes de que se haya realizado la redirecci√≥n y por lo tanto antes de que se haya llamado al servidor final (a google en nuestro ejemplo).Si devuelve \u0026#8220;post\u0026#8221; se ejecutara despu√©s de que el servidor haya respondido a la petici√≥n.En la clase org.springframework.cloud.netflix.zuul.filters.support.FilterConstants tenemos definidos los tipos a devolver, PRE_TYPE , POST_TYPE,ERROR_TYPE o ROUTE_TYPE.  En la clase de ejemplo vemos como antes de realizar la petici√≥n al servidor final, se registran algunos datos de la petici√≥n, dejando un log con ellos.\nPor √∫ltimo, para que Spring Boot utilize este filtro debemos a√±adir la funci√≥n siguiente en nuestra clase principal.\n@Bean public PreFilter preFilter() { return new PreFilter(); }  Zuul buscara beans hereden de la clase ZuulFilter y los usara.\nEn este ejemplo, tambi√©n esta la clase PostFilter.java que implementa otro filtro pero que se ejecuta despu√©s de realizar la petici√≥n al servidor final. Como he comentado esto se consigue devolviendo \u0026#8220;post\u0026#8221; en la funci√≥n filterType().\nPara que Zuul use esta clase deberemos crear otro bean con una funci√≥n como esta:\n @Bean public PostFilter postFilter() { return new PostFilter(); }  Recordar que tambi√©n hay un filtro para tratar los errores y otro para tratar justo despu√©s de la redirecci√≥n (\u0026#8220;route\u0026#8221;), pero en este articulo solo hablare de los filtros tipo \u0026#8220;post\u0026#8221; y tipo \u0026#8220;pre\u0026#8221;\nAclarar que aunque no lo trato en este articulo con Zuul no solo podemos redirigir hacia URL est√°ticas sino tambi√©n a servicios, suministrados por Eureka Server, del cual hable en un articulo articulo. Adem√°s se integra con Hystrix para tener tolerancia a fallos, de tal manera que si no puede alcanzar un servidor se puede especificar que acci√≥n tomar.\n ## Filtrando. Implementando seguridad  A√±adamos una nueva redirecci√≥n al fichero application.yml\n sensitiveHeaders: usuario, clave privado: path: /privado/** url: http://www.profesor-p.com  Esta redirecci√≥n llevara cualquier petici√≥n tipo http://localhost:8080/privado/LO_QUE_SEA a la pagina donde esta este articulo (http://www.profesor-p.com )\nLa linea sensitiveHeaders la explicare m√°s adelante.\nEn la clase PreRewriteFilterhe implementando otro filtro tipo pre que trata solo esta redirecci√≥n. ¬ø como ?. F√°cil, poniendo este c√≥digo en la funci√≥n shouldFilter()\n@Override public boolean shouldFilter() { return RequestContext.getCurrentContext().getRequest().getRequestURI().startsWith(\u0026quot;/privado\u0026quot;); }  Ahora en la funci√≥n run incluimos el siguiente c√≥digo\n Logger log = LoggerFactory.getLogger(PreRewriteFilter.class); @Override public Object run() {\tRequestContext ctx = RequestContext.getCurrentContext();\tStringBuffer strLog=new StringBuffer(); strLog.append(\u0026quot;\\n------ FILTRANDO ACCESO A PRIVADO - PREREWRITE FILTER ------\\n\u0026quot;);\ttry {\tString url=UriComponentsBuilder.fromHttpUrl(\u0026quot;http://localhost:8080/\u0026quot;).path(\u0026quot;/api\u0026quot;).build().toUriString(); String usuario=ctx.getRequest().getHeader(\u0026quot;usuario\u0026quot;)==null?\u0026quot;\u0026quot;:ctx.getRequest().getHeader(\u0026quot;usuario\u0026quot;); String password=ctx.getRequest().getHeader(\u0026quot;clave\u0026quot;)==null?\u0026quot;\u0026quot;:ctx.getRequest().getHeader(\u0026quot;clave\u0026quot;); if (! usuario.equals(\u0026quot;\u0026quot;)) { if (!usuario.equals(\u0026quot;profesorp\u0026quot;) || !password.equals(\u0026quot;profe\u0026quot;)) { String msgError=\u0026quot;Usuario y/o contrase√±a invalidos\u0026quot;; strLog.append(\u0026quot;\\n\u0026quot;+msgError+\u0026quot;\\n\u0026quot;);\tctx.setResponseBody(msgError); ctx.setResponseStatusCode(HttpStatus.FORBIDDEN.value()); ctx.setSendZuulResponse(false); log.info(strLog.toString());\treturn null; } ctx.setRouteHost(new URL(url)); }\t} catch ( IOException e) { // TODO Auto-generated catch block e.printStackTrace(); } log.info(strLog.toString()); return null; }  Esta funci√≥n busca en las cabeceras de la petici√≥n (headers) si¬†existe la cabecera usuario, en caso de no encontrarla no hace nada con lo cual redireccionara a http://www.profesor-p.com como se indica en el filtro. En el caso de que exista la cabecera usuario con el valor profesorpy que la variable clave tenga el valor profe, se redirigir√° a http://localhost:8080/api. En caso contrario devolver√° un c√≥digo HTTP FORBIDEN devolviendo la cadena \u0026quot;Usuario y/o contrase√±a invalidos\u0026quot; en el cuerpo de la respuesta HTTP. Ademas se cancela el flujo de la petici√≥n debido a que se llama a ctx.setSendZuulResponse(false)\nDebido a la linea sensitiveHeaders del fichero application.yml que he mencionado anteriormente las cabeceras \u0026#8216;usuario\u0026#8216; y \u0026#8216;clave\u0026#8216; no ser√°n pasadas en el flujo de la petici√≥n.\nEs muy importante que este filtro se ejecute despues del filtro de PRE_DECORATION, pues en caso contrario la llamada a ctx.setRouteHost() no tendra efecto. Por ello en la funci√≥n filterOrder tenemos este c√≥digo:\n@Override public int filterOrder() { return FilterConstants.PRE_DECORATION_FILTER_ORDER+1; }  As√≠ una llamada pasando el usuario y la constrase√±a correctas, nos redirigira a http://localhost:8080/api\n\u0026gt; curl -s -H \u0026quot;usuario: profesorp\u0026quot; -H \u0026quot;clave: profe\u0026quot; localhost:8080/privado ---------- Prueba de ZUUL ------------ ................ RECIBIDA PETICION EN /api ...... Metodo: GET URL: http://localhost:8080/api Host Remoto: 127.0.0.1 ----- MAP ---- ----- Headers ---- Clave:user-agent Valor: curl/7.63.0 Clave:accept Valor: */* Clave:x-forwarded-host Valor: localhost:8080 Clave:x-forwarded-proto Valor: http Clave:x-forwarded-prefix Valor: /privado Clave:x-forwarded-port Valor: 8080 Clave:x-forwarded-for Valor: 0:0:0:0:0:0:0:1 Clave:accept-encoding Valor: gzip Clave:host Valor: localhost:8080 Clave:connection Valor: Keep-Alive ----- BODY ----  Si se pone mal la contrase√±a la salida seria esta:\n\u0026gt; curl -s -H \u0026quot;usuario: profesorp\u0026quot; -H \u0026quot;clave: ERROR\u0026quot; localhost:8080/privado Usuario y/o contrase√±a invalidos  ###Filtrando. Filtrado din√°mico\nPara terminar incluiremos dos nuevas redirecciones en el fichero applicaction.yml\n local: path: /local/** url: http://localhost:8080/api url: path: /url/** url: http://url.com  En la primera cuando vayamos a la URL http://localhost:8080/local/LO_QUE_SEA seremos redirigidos a http://localhost:8080/api/LO_QUE_SEA. Aclarar que la etiqueta local:es arbitraria y podr√≠a poner pepe no teniendo porque coincidir con el path que deseamos redirigir.\nEn la segunda cuando vayamos a la URL http://localhost:8080/url/LO_QUE_SEA seremos redirigidos a http://localhost:8080/api/LO_QUE_SEA\nLa clase RouteURLFilter sera la encargada de realizar tratar el filtro URL. Recordar que para que Zuul utilize los filtros debemos crear su correspondiente bean.\n@Bean public RouteURLFilter routerFilter() { return new RouteURLFilter(); }  En la funci√≥n shouldFilter de RouteURLFilter tendremos este c√≥digo para que trate solo las peticiones a /url.\n@Override public boolean shouldFilter() { RequestContext ctx = RequestContext.getCurrentContext(); if ( ctx.getRequest().getRequestURI() == null || ! ctx.getRequest().getRequestURI().startsWith(\u0026quot;/url\u0026quot;)) return false; return ctx.getRouteHost() != null \u0026amp;\u0026amp; ctx.sendZuulResponse(); }  Este filtro ser√° declarado del tipo pre en la funci√≥n filterType por lo cual se ejecutara despu√©s de los filtros pre y antes de ejecutar la redirecci√≥n y llamar al servidor final.\n @Override public String filterType() { return FilterConstants.PRE_TYPE; }  En la funci√≥n run esta el c√≥digo que realiza la magia. Una vez hayamos capturado la URL de destino y el path, como explico m√°s adelante, es utilizada la funci√≥n setRouteHost() del RequestContext para redirigirla adecuadamente.\n @Override public Object run() { try { RequestContext ctx = RequestContext.getCurrentContext(); URIRequest uriRequest; try { uriRequest = getURIRedirection(ctx); } catch (ParseException k) { ctx.setResponseBody(k.getMessage()); ctx.setResponseStatusCode(HttpStatus.BAD_REQUEST.value()); ctx.setSendZuulResponse(false); return null; } UriComponentsBuilder uriComponent = UriComponentsBuilder.fromHttpUrl(uriRequest.getUrl()); if (uriRequest.getPath() == null) uriRequest.setPath(\u0026quot;/\u0026quot;); uriComponent.path(uriRequest.getPath()); String uri = uriComponent.build().toUriString(); ctx.setRouteHost(new URL(uri)); } catch (IOException k) { k.printStackTrace(); } return null; }  Si encuentra en el header la variable hostDestino ser√° donde mandara la petici√≥n recibida. Tambi√©n buscara en la cabecera de la petici√≥n la variables pathDestino para¬†a√±adirla al hostDestino.\nPor ejemplo, supongamos una petici√≥n como esta:\n\u0026gt; curl --header \u0026quot;hostDestino: http://localhost:8080\u0026quot; --header \u0026quot;pathDestino: api\u0026quot; \\ localhost:8080/url?nombre=profesorp  La llamada ser√° redirigida a http://localhost:8080/api?q=profesor-p y mostrara la siguiente salida:\n---------- Prueba de ZUUL ------------ ................ RECIBIDA PETICION EN /api ...... Metodo: GET URL: http://localhost:8080/api Host Remoto: 127.0.0.1 ----- MAP ---- Clave:nombre Valor: profesorp ----- Headers ---- Clave:user-agent Valor: curl/7.60.0 Clave:accept Valor: */* Clave:hostdestino Valor: http://localhost:8080 Clave:pathdestino Valor: api Clave:x-forwarded-host Valor: localhost:8080 Clave:x-forwarded-proto Valor: http Clave:x-forwarded-prefix Valor: /url Clave:x-forwarded-port Valor: 8080 Clave:x-forwarded-for Valor: 0:0:0:0:0:0:0:1 Clave:accept-encoding Valor: gzip Clave:host Valor: localhost:8080 Clave:connection Valor: Keep-Alive ----- BODY ----  Tambi√©n puede recibir la URL a redireccionar en el cuerpo de la petici√≥n. El objeto JSON recibido debe tener el formato definido por la clase GatewayRequest que a su vez contiene un objeto URIRequest\npublic class GatewayRequest { URIRequest uri; String body; } public class URIRequest { String url; String path; byte[] body=null;  Este es un ejemplo de una redirecci√≥n poniendo la URL destino en el body:\ncurl -X POST \\ 'http://localhost:8080/url?nombre=profesorp' \\ -H 'Content-Type: application/json' \\ -d '{ \u0026quot;body\u0026quot;: \u0026quot;El body chuli\u0026quot;, \u0026quot;uri\u0026quot;: { \u0026quot;url\u0026quot;:\u0026quot;http://localhost:8080\u0026quot;, \u0026quot;path\u0026quot;: \u0026quot;api\u0026quot; } }'  URL: \u0026#8220;http://localhost:8080/url?nombre=profesorp\u0026#8221;\nCuerpo de la petici√≥n:\n{ \"body\": \"El body chuli\", \"uri\": { \"url\":\"http://localhost:8080\", \"path\": \"api\" } }  La salida recibida ser√°:\n---------- Prueba de ZUUL ------------ ................ RECIBIDA PETICION EN /api ...... Metodo: POST URL: http://localhost:8080/api Host Remoto: 127.0.0.1 ----- MAP ---- Clave:nombre Valor: profesorp ----- Headers ---- Clave:user-agent Valor: curl/7.60.0 Clave:accept Valor: */* Clave:content-type Valor: application/json Clave:x-forwarded-host Valor: localhost:8080 Clave:x-forwarded-proto Valor: http Clave:x-forwarded-prefix Valor: /url Clave:x-forwarded-port Valor: 8080 Clave:x-forwarded-for Valor: 0:0:0:0:0:0:0:1 Clave:accept-encoding Valor: gzip Clave:content-length Valor: 91 Clave:host Valor: localhost:8080 Clave:connection Valor: Keep-Alive ----- BODY ---- El body chuli  Como se ve el cuerpo es tratado y al servidor final solo es mandado lo que se env√≠a en el par√°metro body de la petici√≥n JSON\nComo se ve, Zuul tiene mucha potencia y es una excelente herramienta para realizar redirecciones. En este articulo solo he ara√±ado las principales caracter√≠sticas de esta fant√°stica herramienta, pero espero que haya servido para ver las posibilidades que ofrece.\n¬°¬°Nos vemos en la pr√≥xima entrada!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/02/14/querys-avanzadas-con-jpa-en-spring-boot/",
	"title": "Querys avanzadas con JPA en Spring Boot",
	"tags": ["hibernate", "java", "jpa", "spring boot"],
	"description": "",
	"content": "Hay veces en que las campos sobre los que restringir una consulta pueden variar en tiempo de ejecuci√≥n. En ese caso si queremos usar JPA no podemos usar una sentencia @Query definida en nuestro repositorio pues no sabemos los campos sobre los que se aplicaran condiciones en la consulta. Adem√°s es bastante com√∫n que el usuario pueda elegir el criterio de b√∫squeda sobre un campo, deseando que el valor de un campo deba ser igual, mayor o menor, respecto al valor introducido .\nEn Spring Boot podemos dar una soluci√≥n a este problema usando un la clase CriteriaBuilder de nuestro EntityManager . En esta entrada os mostrare como hacerlo f√°cilmente.\nPara ello he creado un proyecto que he dejado en https://github.com/chuchip/CustomJpaQuery\nEn este programa podremos hacer una petici√≥n REST a la URL http://localhost:8080/get donde podremos pasar los siguientes par√°metros, todos ellos opcionales:\n Identificador del cliente: idCustomer Nombre del Cliente: nameCustomer Direcci√≥n del cliente: addressCustomer Fecha creaci√≥n del registro: createdDate. La fecha se debera mandar en formato espa√±ol, es decir: \u0026#8220;dd-MM-yyyy\u0026#8221;. Por ejemplo: 31-01-2018. Condici√≥n del campo anterior: dateCondition. Tiene que ser una de estas tres cadenas de texto: \u0026#8220;greater\u0026#8221;,\u0026#8221;less\u0026#8221;, \u0026#8220;equal\u0026#8221; En caso de no poner ninguna condici√≥n o poner una condici√≥n no valida se usara greater  URLs de b√∫squeda podr√≠an ser:\nhttp://localhost:8080/get?createdDate=21-01-2018\u0026amp;dateCondition=equal http://localhost:8080/get?createdDate=21-01-2018\u0026amp;dateCondition=greater\nhttp://localhost:8080/get?nameCustomer=Smith\u0026amp;createdDate=21-01-2018\nEl programa usa una base de datos H2 para crear una tabla simple de clientes (customers) con los campos: id,name,address,email y created_date. Llena despu√©s la tabla con los datos que podemos ver en el fichero data.sql\nPara realizar nuestra QUERY personalizada, en primer lugar, se crea un interface en CustomersRepository que extiende de JpaRepository . En este interface definimos la funci√≥n getData como se ve en el siguiente c√≥digo:\npublic interface CustomersRepository extends JpaRepository\u0026lt;CustomersEntity, Integer\u0026gt; { public List\u0026lt;CustomersEntity\u0026gt; getData(HashMap\u0026lt;String, Object\u0026gt; conditions);\t}  La funci√≥n getData recibir√° un HashMap donde iremos poniendo las condiciones de b√∫squeda. As√≠ si queremos buscar los clientes cuyo c√≥digo de cliente sea igual a 1, a√±adiremos una la llave \u0026#8216;id\u0026#8217; y el valor \u0026#8216;1\u0026#8243;\nHashMap\u0026lt;String,Object\u0026gt; hm= new HashMap\u0026lt;\u0026gt;(); hm.put(\u0026quot;id\u0026quot;,1);  Si deseamos que el nombre sea como \u0026#8216;Smith\u0026#8217;, a√±adir√≠amos este elemento al HashMap:\nhm.put(\u0026quot;name\u0026quot;,\u0026quot;Smith\u0026quot;);  Y as√≠ sucesivamente con todos los campos o condiciones deseadas. Una vez definido nuestro repositorio creamos una clase a la que obligatoriamente deberemos llamar CustomersRepositoryImpl es decir se debe llamar igual que nuestro interface del repositorio pero a√±adiendo la terminaci√≥n impl (de implementaci√≥n). En esta clase deberemos tener una funci√≥n igual que la definida en el repositorio pues es la funci√≥n que Spring Boot ejecutara cuando llamemos a la funci√≥n definida en el interface. Este es el c√≥digo de la clase que permitir√° personalizar nuestra query:\npublic class CustomersRepositoryImpl{ @PersistenceContext private EntityManager entityManager; public List\u0026lt;CustomersEntity\u0026gt; getData(HashMap\u0026lt;String, Object\u0026gt; conditions) { CriteriaBuilder cb = entityManager.getCriteriaBuilder(); CriteriaQuery\u0026lt;CustomersEntity\u0026gt; query= cb.createQuery(CustomersEntity.class); Root\u0026lt;CustomersEntity\u0026gt; root = query.from(CustomersEntity.class); List\u0026lt;Predicate\u0026gt; predicates = new ArrayList\u0026lt;\u0026gt;(); conditions.forEach((field,value) -\u0026gt; { switch (field) { case \u0026quot;id\u0026quot;: predicates.add(cb.equal (root.get(field), (Integer)value)); break; case \u0026quot;name\u0026quot;: predicates.add(cb.like(root.get(field),\u0026quot;%\u0026quot;+(String)value+\u0026quot;%\u0026quot;)); break; case \u0026quot;address\u0026quot;: predicates.add(cb.like(root.get(field),\u0026quot;%\u0026quot;+(String)value+\u0026quot;%\u0026quot;)); break; case \u0026quot;created\u0026quot;: String dateCondition=(String) conditions.get(\u0026quot;dateCondition\u0026quot;);\tswitch (dateCondition) { case GREATER_THAN: predicates.add(cb.greaterThan(root.\u0026lt;Date\u0026gt;get(field),(Date)value)); break; case LESS_THAN: predicates.add(cb.lessThan(root.\u0026lt;Date\u0026gt;get(field),(Date)value)); break; case EQUAL: predicates.add(cb.equal(root.\u0026lt;Date\u0026gt;get(field),(Date)value)); break; } break; } }); query.select(root).where(predicates.toArray(new Predicate[predicates.size()])); return entityManager.createQuery(query).getResultList(); } }  Como se ve, lo primero es inyectar una referencia al objeto EntityManager con la etiqueta @PersistenceContext. En la funci√≥n sobre el EntityManager crearemos un objeto CriteriaBuilder y sobre este objeto creamos un CriteriaQuery donde iremos poniendo las diferentes condiciones de nuestra Query. Para poder buscar las columnas sobre las que queremos realizar la consulta necesitaremos un objeto Root , que crearemos a partir del anterior objeto CriteriaQuery\nAhora creamos una lista de objeto Predicate . En esa lista ir√°n todos los Predicate que no son sino las condiciones de nuestra query.\nUtilizando Lambdas y Streams para hacer el c√≥digo mas limpio y sencillo, vamos recorriendo el HashMap y a√±adiendo a la lista de Predicates las condiciones definidas.\nPartiendo del objeto CriteriaQuery se ira llamando a la funci√≥n deseada seg√∫n el criterio a aplicar. De esta manera, si queremos establecer como condici√≥n que un campo sea igual a un valor llamaremos a la funci√≥n equal(), pasando como primer par√°metro la Expresion que hace referencia al campo de la entidad, y despu√©s el valor deseado. El objeto Expresion se creara simplemente cogiendo del objeto Root anteriormente definido, el nombre de la columna sobre el que se establecer√° la condici√≥n.\nSi deseamos a√±adir una condici√≥n donde un campo sea como a un texto introducido se llamara a la funci√≥n like(). En caso de que deseemos que el campo tenga un valor superior al introducido se usara greaterThan() y as√≠ sucesivamente.\nSi el campo es de tipo Date, es necesario especificar el tipo de dato del campo como se muestra en el c√≥digo root.get(field), pues de otra manera no sabr√° parsear correctamente la fecha.\nResaltar que el nombre del campo es el definido en nuestra entity que l√≥gicamente no tiene porque ser el de la columna en la base de datos. Por ejemplo, el campo de fecha en la entity del proyecto de ejemplo, esta creada con las siguientes sentencias:\n@Column(name=\u0026quot;created_date\u0026quot;) @Temporal(TemporalType.DATE) Date created;  De tal manera que en la base de datos la columna se llamara created_date pero todas las referencias a la entidad se har√°n a trav√©s del nombre created y es por ello que cuando busquemos el nombre del campo deberemos en Root deberemos buscar el campo created y no el campo created_dateque no lo encontrar√≠a y nos dar√≠a error.\nUna vez tenemos las condiciones de la consulta establecidas no tenemos m√°s que preparar la consulta llamando a la funci√≥n select a la que primero le indicaremos el Root con la entidad a consultar y despu√©s, las condiciones establecidas en el ArrayList de Predicate, el cual deberemos convertir previamente a un simple Array. Esto lo haremos con la sentencia: \u0026#8216;query.select(root).where(predicates.toArray(new Predicate[predicates.size()]));\nAhora ejecutaremos la select y recogeremos los resultados en un objeto List con el comando entityManager.createQuery(query).getResultList()\nListo, ya tendremos nuestra Query personalizada funcionado. üôÇ Como siempre no dud√©is en hacer cualquier consulta o mandar feedbacks. ¬°¬° Hasta otra!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/01/24/mensajeria-con-kafka-y-spring-boot/",
	"title": "Mensajer√≠a con Kafka y Spring Boot",
	"tags": ["docker", "java", "kafka", "spring"],
	"description": "",
	"content": " Kafka es un programa de mensajer√≠a pensado para comunicaciones as√≠ncronas. B√°sicamente la idea es que los clientes o consumidores se subscriben a un tipo de noticia o topic y cuando un emisor o broker manda un mensaje sobre ese topic Kafka lo distribuye a los consumidores suscritos.\nPara probar este programa deberemos tener un servidor funcionando con los topics ya definidos . En la p√°gina https://kafka.apache.org/quickstart hay un manual r√°pido y muy claro de como levantar uno en apenas 10 minutos.\nHay una extensa documentaci√≥n sobre Kafka en internet, por lo cual no voy a profundizar demasiado en su funcionamiento, ni instalaci√≥n. No obstante, aclarare dos conceptos b√°sicos de Kafka.\n Siempre se trabaja sobre topics. Poniendo un s√≠mil con la prensa escrita, un topic seria el peri√≥dico al que nos hemos subscrito. Solo recibiremos las ediciones (mensajes en Kafka) de ese peri√≥dico. Por supuesto una misma persona (suscriptor) mismo puede estar subscrito a muchos peri√≥dicos.\n Los subscritores siempre forman grupos , aunque en el grupo no haya mas que una sola subscritor.Kafka se encargara que un mensaje solo sea enviado a un subscritor de un grupo.Hay que pensar que Kafka es una tecnolog√≠a enfocada a la nube y lo normal es que un mismo programa (normalmente un microservicio) este ejecut√°ndose en varios servidores, para poder tener tolerancia a fallos. Sin embargo cuando un emisor env√≠a un mensaje de un topic solo queremos que ese mensaje sea procesado por una de las instancias del servicio y no por todas ellas.\n  De esta manera suponiendo que el mensaje implicar√≠a realizar un apunte en una base de datos central, solo se realizar√≠a un √∫nico apunte y no uno por cada una de las instancias. \nEn esta entrada voy a explicar como mandar y recibir mensajes usando Spring Boot a un servidor Kafka. Adem√°s usaremos Docker para realizar ciertas pruebas.\nEl fuente de esta entrada est√°n en https://github.com/chuchip/KafkaTest Empezaremos creando un proyecto Spring Boot, con los siguientes starters. - Web - kafka\nEl starter Web lo vamos a necesitar para las pruebas que haremos, pero no lo necesitaremos en un caso real.\n1. Configuraci√≥n La configuraci√≥n es muy simple. Solo tendremos que poner en el fichero application.properties, la direcci√≥n del servidor Kafka con el par√°metro spring.kafka.bootstrap-server\nmessage.topic.name=${topicname} message.topic.name2=${topicname2} message.group.name=${groupid} spring.kafka.bootstrap-servers=kafkaserver:9092 spring.kafka.consumer.group-id=myGroup  Si tuvi√©ramos varios servidores Kakfa como suele ser el caso en producci√≥n, los indicar√≠amos separ√°ndolos por comas. (server1:9092,server2:9092, server3:9093 \u0026#8230;)\nCon el par√°metro spring.kafka.consumer.group-id podemos definir el grupo al que por defecto pertenecer√°n los listeners pero esto es configurable en cada uno de ellos y no es necesario.\nLos dem√°s par√°metros los usaremos m√°s adelante y son solo para poder realizar pruebas.\n2. Enviando mensajes Los mensajes los enviaremos desde la clase KafkaMessageProducer, la cual pongo a continuaci√≥n.\n@Component public class KafkaMessageProducer { @Autowired private KafkaTemplate\u0026lt;String, String\u0026gt; kafkaTemplate; @Value(value = \u0026quot;${message.topic.name:profesorp}\u0026quot;) private String topicName;\tpublic void sendMessage(String topic,String message) { if (topic==null || topic.trim().equals(\u0026quot;\u0026quot;)) topic=topicName; ListenableFuture\u0026lt;SendResult\u0026lt;String, String\u0026gt;\u0026gt; future = kafkaTemplate.send(topic, message); future.addCallback(new ListenableFutureCallback\u0026lt;SendResult\u0026lt;String, String\u0026gt;\u0026gt;() { @Override public void onSuccess(SendResult\u0026lt;String, String\u0026gt; result) { System.out.println(\u0026quot;Sent message=[\u0026quot; + message + \u0026quot;] with offset=[\u0026quot; + result.getRecordMetadata().offset() + \u0026quot;]\u0026quot;); } @Override public void onFailure(Throwable ex) {System.err.println(\u0026quot;Unable to send message=[\u0026quot; + message + \u0026quot;] due to : \u0026quot; + ex.getMessage()); } }); }\tl }  Lo primero ser√° pedir a Spring que nos inyecte un objeto tipo KafkaTemplate .\nEl topic por defecto, sobre el que enviaremos los mensajes lo definimos en la variable topicname que, por defecto, tendr√° el valor de message.topic.name establecida en el fichero properties de Spring Boot\nEn la funci√≥n sendMessage sobre el topic mandado mandaremos el mensaje deseado.\nPara ello crearemos un ListenableFuture a partir de kafkaTemplate. De esta manera la llamada al servidor de Kafka ser√° as√≠ncrona. Para hacerla simplemente usaremos la funci√≥n addCallback de la clase ListenableFuture, pas√°ndole el interface ListenableFutureCallback.\nLa funci√≥n onSuccess ser√° ejecutada si todo va bien y la funci√≥n onFailure en caso de error.\n3. Recibiendo mensajes Los mensajes los recibiremos en la clase KafkaTestListener\n@Component public class KafkaTestListener { @KafkaListener(topics = \u0026quot;${message.topic.name:profesorp}\u0026quot;, groupId = \u0026quot;${message.group.name:profegroup}\u0026quot;) public void listenTopic1(String message) { System.out.println(\u0026quot;Recieved Message of topic1 in listener: \u0026quot; + message); } @KafkaListener(topics = \u0026quot;${message.topic.name2:profesorp-group}\u0026quot;, groupId = \u0026quot;${message.group.name:profegroup}\u0026quot;) public void listenTopic2(String message) { System.out.println(\u0026quot;Recieved Message of topic2 in listener \u0026quot;+message); } }  En la funci√≥n listenTopic1 con la etiqueta @KafkaListener, definiremos el topics , en plural pues pueden ser varios, que queremos escuchar. En este caso escucharemos los definidos en la variable message.topic.name del fichero properties de Spring Boot. Si esa variable no estuviera definida, tendr√° el valor profesorp. Adem√°s especificamos el grupo al que pertenece el listener. Recordar si no lo definimos coger√° el que hayamos configurado con el parametro spring.kafka.consumer.group-id\nEn la funci√≥n listenTopic2 recibiremos los mensajes del topic message.topic.name2.\nProbando la aplicaci√≥n En la clase KafkaTestControllerhe puesto un controlador REST muy sencillo que escucha en /add/{topic} . Acepta peticiones POST y lo √∫nico que hace es llamar a kafkaMessageProducer.sendMessage mandando un mensaje al servidor Kafka. Este es el c√≥digo.\n@RestController public class KafkaTestController { @Autowired KafkaMessageProducer kafkaMessageProducer; @PostMapping(\u0026quot;/add/{topic}\u0026quot;) public void addIdCustomer( @PathVariable String topic,@RequestBody String body) { kafkaMessageProducer.sendMessage(topic,body); } }  Para hacer las pruebas he creado el fichero jar a trav√©s de maven (maven package) y he creado este peque√±o script al que he llamado javaapp.sh que lo ejecuta:\njava -Dtopicname=$TOPICNAME -Dtopicname2=$TOPICNAME2 -Dgroupid=$GROUPID -jar ./kafkatest.jar ```` Como variables de entorno habremos definido TOPICNAME,TOPICNAME2 y GROUPID. ```export TOPICNAME=\u0026quot;mytopic_1\u0026quot; export TOPICNAME2=\u0026quot;mytopic_2\u0026quot; EXPORT GROUPID=\u0026quot;profe_group\u0026quot;  Recordar que tenemos que tener creados los topics en el servidor de kafka. Eso se puede hacer con el comando\n\u0026gt; bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic mytopic_1 \u0026gt; bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic mytopic_2  Para comprobar que est√°n creados los topics podemos ejecutar el comando\nbin/kafka-topics.sh --list --zookeeper localhost:2181  Una vez tengamos la aplicaci√≥n corriendo en un terminal, abrimos otro, y ejecutamos la sentencia:\n\u0026gt; curl --request POST localhost:8080/add/mytopic_1 -d \u0026quot;Mensaje para topic1 \u0026quot;  La cual hace una petici√≥n POST a la URL localhost:8080/add/topic2 . En el cuerpo de esta petici√≥n ira el texto \u0026#8220;Mensaje para topic profegroup\u0026#8221;\nLa salida que veremos en nuestro programa ser√° la siguiente\nSent message=[Mensaje+para+topic+mytopic_1=] with offset=[13] Recieved Message of mytopic_1 in listener: Mensaje+para+topic1=  Con lo cual vemos, como se ha enviado y luego recibido correctamente en el topic1.\nSi ahora ejecutamos la sentencia:\ncurl --request POST localhost:8080/add/mytopic_2 -d \u0026quot;Mensaje para topic2\u0026quot;  Observaremos la siguiente salida:\nSent message=[Mensaje+para+topic+mytopic_2=] with offset=[32] Recieved Message of topic1 in listener: Mensaje+para+topic+topic2=  Dockerizando la aplicaci√≥n Para probar la aplicaci√≥n en un entorno m√°s real vamos a dockerizar nuestra aplicaci√≥n.\nEl fichero DockerFile sera el siguiente:\nVOLUME /tmp ENV JAR_FILE kafkatest.jar ENV TOPICNAMER rofesorp ENV TOPICNAME2 profegroup ENV GROUPID profe_group COPY $JAR_FILE /tmp/kafkatest.jar COPY javaapp.sh /tmp/ EXPOSE 8080 ENTRYPOINT \u0026quot;/tmp/javaapp.sh\u0026quot;  En el directorio donde este el fichero DockerFile deberemos tener tambi√©n javaapp.sh y kafakatest.jar\nCreamos la imagen con el comando:\ndocker build -t kafkatest .  Antes de ejecutarlo debemos asegurarnos que nuestro servidor de Kafka este bien configurado.\nUna vez un consumidor llama al servidor, lo primero que hace este servidor es comunicarle al cliente la direcci√≥n donde esta el servidor lider con el que debe comunicarse. Normalmente esto no es problema, pero cuando la red es un poco compleja, como en el caso de Docker o m√°quinas virtuales hay que asegurarse que el nombre del lider que suministra Kafka, es accesible por el consumidor.\nComo Docker crea siempre un interface virtual en la direcci√≥n 172.17.0.1, a√±adiremos esta IP al fichero /etc/hosts, a√±adi√©ndole la l√≠nea\n172.17.0.1 kafkaserver  Y en el fichero config/server.properties definiremos las siguientes variables:\nlisteners=PLAINTEXT://kafkaserver:9092 advertised.listeners=PLAINTEXT://kafkaserver:9092  La primera l√≠nea especifica donde debe escuchar el servidor de Kafka y la segunda el nombre que mandara al consumidor cuando pregunte por el lider con el que debe conectarse.\nReiniciamos el servidor de Kafka, y ejecutamos el contenedor docker con la siguiente sentencia:\ndocker run -i -t --name=kafkatest1 -p 8880:8080 --hostname kafkatest1 -e \u0026quot;TOPICNAME=my_topic1\u0026quot; -e \u0026quot;TOPICNAME2=my_topic2\u0026quot; -e \u0026quot;GROUPID=profe_group\u0026quot; --add-host kafkaserver:172.17.0.1 kafkatest  En otro terminal ejecutamos el mismo comando cambiando el nombre del contenedor y mapeando el puerto 8080 al 8881\ndocker run -i -t --name=kafkatest2 -p 8881:8080 --hostname kafkatest2 -e \u0026quot;TOPICNAME=my_topic2\u0026quot; -e \u0026quot;TOPICNAME2=my_topic2\u0026quot; -e \u0026quot;GROUPID=profe_group\u0026quot; --add-host kafkaserver:172.17.0.1 kafkatest  Si en un tercer terminal ejecutamos la sentencia\ncurl --request POST localhost:8880/add/my_topic1 -d \u0026quot;Mensaje para topic numero 1\u0026quot;  Observaremos que solo uno de los dos programas recibe el mensaje de Kafka pues ambos pertenecen al mismo grupo (profe_group)\nAbriendo un nuevo terminal, volvemos a lanzar una nueva instancia de docker, especificando otro_grupo.\ndocker run -i -t --name=kafkatest3 -p 8881:8080 --hostname kafkatest2 -e \u0026quot;TOPICNAME=my_topic1\u0026quot; -e \u0026quot;TOPICNAME2=my_topic2\u0026quot; -e \u0026quot;GROUPID=otro_grupo\u0026quot; --add-host kafkaserver:172.17.0.1 kafkatest  Veremos que la anterior petici√≥n curl hace que los mensajes sean recibidos en dos instancias en docker. En una de las dos, que tiene el grupo profe_group y en la que tiene el grupo otro_grupo\nPor supuesto este programa se puede mejorar mucho, pues no hemos utilizado serializaci√≥n para recibir objetos directamente, ni hemos hablado de las particiones de Kafka, ni del tratamiento de errores, seguridad, etc, pero como una peque√±a introducci√≥n al mundo de Kafka y la mensajer√≠a. Como siempre se agradecer√° cualquier comentario aqu√≠ o en mi cuenta de Twitter @chuchip.\n¬°¬°Hasta la pr√≥xima clase!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2019/01/03/microservicios-distribuidos-con-eureka/",
	"title": "Microservicios distribuidos con Eureka",
	"tags": ["java", "microservicios", "rest", "spring boot"],
	"description": "",
	"content": " En esta clase hablare de como crear microservicios distribuidos en Spring Boot utilizando las facilidades que nos da el paquete Spring Cloud NetFlix.\nCualquier microservicio debe poder localizar las diferentes instancias de otro servicio del que dependa sin tener sus direcciones definidas en el c√≥digo.\nEn el caso de que un microservicio deba acceder a otro lo ideal seria que de alguna manera pudiera saber en que direcciones esta las instancias de ese otro microservicio funcionando, pues lo m√°s com√∫n es que se levanten diferentes instancias dependiendo de la carga.\nPara ello en Spring se utiliza Eureka Server del paquete Spring Cloud NetFlix. Utilizando este paquete adem√°s de Ribbon y Feign conseguiremos que nuestra aplicaci√≥n sea capaz de encontrar las diferentes instancias de un microservicio y balancear las peticiones de tal manera que se reparta la carga.\nEn este articulo voy a explicar como crear un servicio que al que llamaremos para solicitar la capital de un pa√≠s. Este servicio a su vez llamara a otro servicio para localizar los datos solicitados, pues el solo ser√° un punto de entrada.\nLos programas utilizados ser√°n estos:\n Proyecto: capitals-service Puerto:: 8100 Proyecto: countries-service Puerto:: 8000 y 8001 proyecto: eureka-server Puerto: 8761  El proyecto \u0026#8216;countries-service\u0026#8216; ser√° el que tenga la base de datos con los datos de los diferentes pa√≠ses. Se lanzaran dos instancias del mismo servicio para que podamos comprobar como \u0026#8216;capitals-service\u0026#8216; hace una llamada a una instancia y luego, balanceando la carga.\nEl c√≥digo de ejemplo de este articulo esta en GitHub.\n Creando un servidor Eureka  Lo primero que necesitamos es tener un lugar donde todos los microservicios se registren cuando se inicialicen. Ese servicio es el que a su vez se consultara cuando queramos localizar las diferentes instancias. En esta ejemplo vamos a utilizar Eureka Server el cual es muy f√°cil de crear.\nPara ello crearemos un nuevo proyecto Spring Boot con tan solo el Starter Eureka Server.\nEn este proyecto cambiaremos el fichero application.properties para que incluya las siguientes l√≠neas:\nspring.application.name=eureka-server\nserver.port=8761\n‚Äãeureka.client.register-with-eureka=false\neureka.client.fetch-registry=false Es decir especificamos el nombre del programa con la l√≠nea spring.application.name . El puerto en el que estar√° escuchando el servicio con server.port. Y lo m√°s importante, pues los anteriores valores son opcionales, los par√°metros del servidor Eureka.\n eureka.client.register-with-eureka=false para que el servidor no se intente registrar a si mismo. eureka.client.fetch-registry=false con este par√°metro especificamos a los clientes que no se guarden en su cache local las direcciones de los diferentes instancias. Esto es para que consulte al servidor Eureka cada vez que necesite acceder a un servicio. En producci√≥n a menudo se pone a true para agilizar las peticiones. Comentar que esa cache se actualiza cada 30 segundos por defecto.  Ahora en nuestra clase principal, por donde entra Spring Boot deberemos poner las anotaci√≥n EnableEurekaServer:\n@SpringBootApplication @EnableEurekaServer public class NetflixEurekaNamingServerApplication { ‚Äã public static void main(String[] args) { SpringApplication.run(NetflixEurekaNamingServerApplication.class, args); } }  ¬°Y ya esta listo!. Nuestro servidor Eureka esta creado. Para ver su estado podemos usar nuestro navegador preferido y navegar a: http://localhost:8761/ para ver las aplicaciones que se han registrado. Como se ve en la captura de pantalla todav√≠a no hay ninguna.En la misma pantalla se muestra el estado del servidor.Observar que lo normal es que tengamos varios servidores Eureka levantados. En nuestro ejemplo solo levantaremos uno, aunque eso nos ser√° lo normal en producci√≥n.\n2. Microservicio \u0026#8216;countries-service\u0026#8217; Ahora que tenemos nuestro servidor vamos a crear nuestro primer cliente. Para ello crearemos otro proyecto de Spring Boot con los siguientes starters\n Eureka Discovery Web Lombok H2 JPA  Como he comentado anteriormente, este microservicio es el que va a tener la base de datos y el que ser√° consultado por \u0026#8216;capitales-service\u0026#8217; para buscar las capitales de un pa√≠s.\nLo destacable de este proyecto esta en el fichero application.properties de Spring Boot\nspring.application.name=paises-service\neureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka\nserver.port=8000\n# Configuacion JPA\nspring.jpa.show-sql=true\nspring.h2.console.enabled=true Como se puede ver, con el paramero eureka.client.service-url.default-zone especificamos donde esta el servidor Eureka. Spring Boot autom√°ticamente al ver que tiene el paquete Eureka Discovery disponible intentara registrarse en su correspondiente servidor.\nPara poder lanzar con Eclipse la segunda instancia de la aplicaci√≥n paises-service en el puerto 8001, deberemos ir a la opci√≥n Run Configurations en el men√∫ Runy copiar la que Eclipse habra creado de countries-service una vez hayamos ejecutado la aplicaci√≥n por primera vez. En la pesta√±a Arguments deberemos a√±adir el par√°metro --server.port=8001En la siguiente captura de pantalla se puede ver como si lanzamos dos instancias de este programa, una en el puerto 8000 y otra en el puerto 8001, en Eureka Server podemos ver como se han registrado las diferentes instancias. El nombre que se han registrado y por el que el se podr√°n buscar es el nombre de la aplicaci√≥n como se ha declarado en la variable spring.application.name del fichero application.propertiesAs√≠ vemos que la aplicaci√≥n COUNTRIES-SERVICEtiene dos instancias, levantadas ambas en el host port-chuchiuna en el puerto 8000 y otra en el puerto 8001.\nMi ordenador se llama port-chuchi\nEsta sencilla aplicaci√≥n usara H2 para la persistencia de datos teniendo una simple tabla llamada countriescon los datos de los pa√≠ses, a la que accederemos por JPA. La estructura de la tabla esta definida en com.profesorp.countriesservice.entities.Countries.java\nEn la clase CapitalsServiceControllerse definen los siguientes puntos de entrada.\n Petici√≥n GET. /{country}   Recibe: C√≥digo de Pais. (\u0026#8216;es\u0026#8217;,\u0026#8217;eu\u0026#8217;,\u0026#8217;en\u0026#8217;\u0026#8230;.) Devolver√° un objeto CapitalsBean   Petici√≥n GET. /time/{time}  Establece el tiempo que la entrada /{country} realizara una pausa antes de devolver el resultado.\n3. Microservicio \u0026#8216;capitals-service\u0026#8217; Este servicio es el que llamara al anterior para solicitar todos los datos de un pa√≠s, pero mostrara solo la capital, el puerto del servicio al que realizo la llamada y el nombre del pa√≠s.\nNecesitaremos tener los siguientes starters\n Eureka Discovery Feign Lombok Web  En primer lugar, como en el anterior servicio, en el fichero application.propertiestendremos el siguiente contenido:\nspring.application.name=capitals-service\neureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka\nserver.port=8100 Es decir, definimos el nombre de la aplicaci√≥n, despu√©s especificamos donde esta el servidor Eureka donde nos debemos registrar y por fin el puerto donde escuchara el programa.\n Utilizando RestTemplate.  Para realizar una petici√≥n RESTFUL a countries-service la forma m√°s simple seria usar la clase RestTemplatedel paquete org.springframework.web.client.\n@GetMapping(\u0026quot;/template/{country}\u0026quot;) public CapitalsBean getCountryUsingRestTemplate(@PathVariable String country) { Map\u0026lt;String, String\u0026gt; uriVariables = new HashMap\u0026lt;\u0026gt;(); uriVariables.put(\u0026quot;country\u0026quot;, country); ResponseEntity\u0026lt;CapitalsBean\u0026gt; responseEntity = new RestTemplate().getForEntity( \u0026quot;http://localhost:8000/{country}\u0026quot;, CapitalsBean.class, uriVariables ); CapitalsBean response = responseEntity.getBody(); return response; }  Como se ve, simplemente, metemos en un hashmap las variables que vamos a pasar en la petici√≥n, que en este caso es solo el par√°metro pais, para despu√©s realizar crear un objeto ResponseEntity llamando a la funci√≥n est√°ticaRestTemplate.getForEntity() pasando como par√°metros, la URL que deseamos llamar, la clase donde debe dejar la respuesta de la petici√≥n REST y las variables pasadas en la petici√≥n.\nDespu√©s, capturamos el objeto CapitalsBeanque tendremos en el Body del objeto ResponseEntity.\nPero usando este m√©todo tenemos el problema de que debemos tener definido en nuestro programa las URLs donde est√°n las diferentes instancias del microservicio al que llamamos, adem√°s como se ve, tenemos que escribir mucho c√≥digo para hacer una simple llamada.\n Petici√≥n FEIGN simple  Una manera m√°s elegante de hacer esa llamada seria utilizando Feign. Feign es una herramienta de Spring que nos permite realizar llamadas usando funciones declarativas.\nPara utilizar Feign debemos incluir la etiqueta @EnableFeignClients en nuestra clase principal. En nuestro ejemplo la ponemos en la clase CapitalsServiceApplication\n@SpringBootApplication @EnableFeignClients(\u0026quot;com.profesorp.capitalsservice\u0026quot;) public class CapitalsServiceApplication { public static void main(String[] args) { SpringApplication.run(CapitalsServiceApplication.class, args); } }  Si no pasamos ning√∫n par√°metro a la etiqueta @EnableFeignClients buscara clientes Feign en nuestro paquete principal, si le ponemos un valor solo buscara clientes en el paquete mandado. As√≠ en el ejemplo solo buscar√≠a en el paquete com.profesorp.capitalsservice\nAhora definimos el cliente Feing con el interface CapitalsServiceProxy\n@FeignClient(name=\u0026quot;simpleFeign\u0026quot;,url=\u0026quot;http://localhost:8000/\u0026quot;) public interface CapitalsServiceProxySimple { @GetMapping(\u0026quot;/{country}\u0026quot;) public CapitalsBean getCountry(@PathVariable(\u0026quot;country\u0026quot;) String country); }  Lo primero es etiquetar la clase con @FeignClient especificando la URL donde esta el servidor REST que queremos llamar. Prestar atenci√≥n al hecho de que ponemos la direcci√≥n base, en este caso solo el nombre del host y su puerto localhost:8000. El par√°metro namedebe ser puesto pero no es importante su contenido.\nDespu√©s definiremos las diferentes entradas que queremos tener disponibles. En nuestro caso solo hay una definida, pero podr√≠amos incluir la llamada a /time/{time} .\n@Autowired private CapitalsServiceProxySimple simpleProxy; @GetMapping(\u0026quot;/feign/{country}\u0026quot;) public CapitalsBean getCountryUsingFeign(@PathVariable String country) { CapitalsBean response = simpleProxy.getCountry(country); return response; }  Usamos el inyector de dependencias de Spring para crear un objeto CapitalsServiceProxySimple y despu√©s simplemente llamamos a la funci√≥n getCountry()del interface.\nMucho m√°s limpio, ¬øverdad?. Suponiendo que nuestro servidor REST tuviera muchos puntos de entrada nos ahorrar√≠amos much√≠simo de teclear, adem√°s de tener un c√≥digo mucho m√°s limpio.\nPero a√∫n tenemos el problema de que la direcci√≥n del servidor RESTFUL esta escrita en nuestro c√≥digo lo cual nos hace imposible poder llegar a las diferentes instancias del mismo servicio y nuestro microservicio no ser√° verdaderamente escalable.\n Petici√≥n FEIGN usando el servidor Eureka  Para resolver el problema en vez de poner la direcci√≥n del servidor, pondremos el nombre de la aplicaci√≥n y Spring Boot se encargara de llamar el servidor Eureka, pidi√©ndole la direcci√≥n donde esta ese servicio .\nPara ello crear√≠amos un interface Feign de esta manera\n@FeignClient(name=\u0026quot;countries-service\u0026quot;) public interface CapitalsServiceProxy { @GetMapping(\u0026quot;/{country}\u0026quot;) public CapitalsBean getCountry(@PathVariable(\u0026quot;country\u0026quot;) String country); }  Como se puede ver aqu√≠ no especificamos la direcci√≥n del servicio, simplemente ponemos el nombre. En este caso countries-service que es como esta registrada la aplicaci√≥n en el servidor Eureka.\nAhora cada petici√≥n que se haga ira balance√°ndose de una instancia a otra. De tal manera que la primera petici√≥n ira a la del puerto 8000 y la siguiente a la del puerto 8001.De esta manera nuestra aplicaci√≥n ya utilizara todas las instancias del servicio autom√°ticamente.\n Configurando RIBBON  El paquete Feign usa el paquete Ribbon por debajo y realmente es este es el que se encarga de balancear las peticiones. Por defecto Ribbon usara la regla RoundRobinRule. Con esta regla escoger√° secuencialmente cada uno de las instancias que Eureka le muestre levantadas, sin tener en cuenta el tiempo que a cada instancia le cuesta responder.\nSi deseamos que use alguna de las otras tres disponibles por defecto o incluso una regla que nosotros definamos deberemos crear una clase de configuraci√≥n para Ribbon, como la siguiente:\nimport org.springframework.context.annotation.Bean;\nimport com.netflix.loadbalancer.IPing;\nimport com.netflix.loadbalancer.IRule;\nimport com.netflix.loadbalancer.NoOpPing;\nimport com.netflix.loadbalancer.WeightedResponseTimeRule;\npublic class RibbonConfiguration {\n@Bean\npublic IPing ribbonPing() {\n\u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp;return new NoOpPing();\n} @Bean public IRule ribbonRule() {\n\u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp;return new WeightedResponseTimeRule();\n}\n} En la funci√≥n ribbonRule()devolveremos el objeto WeightedResponseTimeRule si queremos que la l√≥gica de balanceo tenga en cuenta el tiempo de respuesta de cada instancia.\nAhora, para especificar que queremos usar esta clase para configurar Ribbon a√±adiremos la etiqueta\n@RibbonClient(name=\u0026quot;countries-service\u0026quot;, configuration = RibbonConfiguration.class)en nuestra clase CapitalsServiceApplication\nimport org.springframework.context.annotation.Bean; import com.netflix.loadbalancer.IPing; import com.netflix.loadbalancer.IRule; import com.netflix.loadbalancer.NoOpPing; import com.netflix.loadbalancer.WeightedResponseTimeRule; public class RibbonConfiguration { @Bean public IPing ribbonPing() { return new NoOpPing(); } @Bean public IRule ribbonRule() { return new WeightedResponseTimeRule(); } }  Para comprobar como funciona el balanceo por peso, estableceremos una pausa de 10 milisegundos al servidor del puerto 8001 y una de 300 al servidor del puerto 8000, usando la llamada a /time/{time} del servicio countries-service\n\u0026gt; curl localhost:8001/time/10\n\u0026gt; curl localhost:8000/time/300 Suponiendo que estamos trabajando en Linux, usando Bash haremos 100 peticiones.\nCONTADOR=0; while [ $CONTADOR -lt 100 ]; do curl http://localhost:8100/es\nlet CONTADOR=CONTADOR+1\ndone Al cabo de un tiempo podremos ver las peticiones que se han realizado a cada puerto llamando a http://localhost:8100/puertosComo se puede ver hay muchas m√°s peticiones al puerto 8001 que al puerto 8000, lo cual es normal teniendo en cuenta que el puerto 8000 tiene un retraso de 300 milisegundos, mientras que el 8001 solo de 10.\nPara terminar este articulo comentar que Ribbon se puede usar sin tener Feign, utilizando directamente RestTemplate pero el estudio de ese caso lo dejare para otra ocasi√≥n.\nMencionar, adem√°s que para realizar pruebas de balanceo he utilizado Docker por lo cual en el c√≥digo fuente de GitHub, veremos que en el fichero application.propertiesdel proyecto countries-service est√°n estas l√≠neas:\neureka.client.serviceUrl.defaultZone:http://eurekaserver:8761/eureka\nserver.port=${SERVER_PORT} En vez de las mostradas anteriormente. Esto esta puesto as√≠ para poder definir din√°micamente cuando se lanza el contenedor docker , con la variable de entorno SERVER_PORT el puerto donde debe escuchar cada instancia.\nGracias por leer este articulo y hasta la pr√≥xima lecci√≥n üòâ\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/12/10/servidor-configuraciones-usando-spring-cloud/",
	"title": "Servidor configuraciones usando Spring Cloud",
	"tags": ["cloud", "java", "spring boot"],
	"description": "",
	"content": " En esta ocasi√≥n vamos a usar el paquete Spring Cloud Config para poder tener configuraciones remotas para nuestras aplicaciones.\nLa idea es que nuestro programa o programas puedan ir a buscar sus par√°metros de configuraci√≥n a un lugar externo, de tal manera que nuestra aplicaci√≥n sea f√°cilmente parametrizable e incluso se puedan cambiar sus configuraciones en caliente.\nEsto se utiliza ampliamente en microservicios pues una mismo servicio o aplicaci√≥n puede estar lanzada muchas veces en diferentes contenedores y es interesante tener un lugar central desde donde se puedan aplicar las configuraciones a estos servicios.\nPara ello vamos a crear un servidor de configuraciones y un cliente que buscara su configuraci√≥n en ese servidor.\nEl servidor de configuraciones, usara un repositorio GIT de GitHub donde estar√°n los ficheros de configuraci√≥n.\nLos datos de las aplicaciones ser√°n los siguientes.\n*** Servidor de configuraciones**  Proyecto: config-server Puerto: 8888 Nombre Spring : config-server Servidor GIT: https://github.com/chuchip/servercloudconfig.git  * Cliente de configuraciones  Proyecto: config-client Puerto: 8080 Nombre Spring: config-client  Los fuentes de los programas est√°n en: https://github.com/chuchip/servercloudconfig\n Servidor de configuraciones  La √∫nica dependencia para poder crear un servidor de configuraciones es incluir este paquete en nuestro proyecto maven\n\u0026lt;dependency \u0026lt;groupIdorg.springframework.cloud\u0026lt;/groupId \u0026lt;artifactIdspring-cloud-config-server\u0026lt;/artifactId \u0026lt;/dependency  El starter de Spring seria Config Server\nEl servidor de configuraciones se compone de una sola clase, que detallo a continuaci√≥n:\npackage com.profesorp.configserver; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.config.server.EnableConfigServer; @EnableConfigServer @SpringBootApplication public class ConfigServerApplication { public static void main(String[] args) { SpringApplication.run(ConfigServerApplication.class, args); } }  Como se ve, lo √∫nico destacable es la anotaci√≥n @EnableConfigServer .\nEn el fichero application.properties pondremos donde debe buscar las configuraciones, con el par√°metro: spring.cloud.config.server.git.uri\nspring.application.name=config-server server.port=8888 spring.cloud.config.server.git.uri=https://github.com/chuchip/servercloudconfig.git  En este caso le decimos que use un servidor Git que tenemos alojado en GitHub. Tambi√©n podr√≠amos especificar que el use un repositorio GIT local de este modo:\nspring.cloud.config.server.git.uri=file://eclipe/spring-config/  Los servidores de configuraci√≥n de Spring Cloud soportan los siguientes or√≠genes (backends):\n GIT Vault JDBC ,  Estos or√≠genes incluso se pueden mezclar, de tal manera que dependiendo del perfil elegido se use uno u otro. Pero esto se escapa al √°mbito de este documento.\nEn el caso del servidor GIT, que es el utilizado en el ejemplo, lo importante es tener un fichero que se llame como el cliente que va a solicitar los datos, terminado en .properties. As√≠ si queremos guardar configuraci√≥n para una aplicaci√≥n cliente que se llame config-client , es decir que en la variable spring.application.namesea igual a config-client, deberemos tener un fichero llamado config-client.propertiesEn este fichero pondremos los valores, de esta manera:\ndatosservidor.minimum=11 datosservidor.maximum=20 limites.minimum=-1 limites.maximum=2 valores.valor_fijo: VALORFIJO valores.valor_funcion: \"VALORDEFUNCION\";  Obs√©rvese que el valor puede ser asignado con : (dos puntos) o = (igual)\nNO usar comillas para delimitar los literales, a no ser que se quiera que nuestro literal (String) incluya esas comillas.\nPara ver los valores pasados a nuestros cliente, realizaremos una petici√≥n GET especificando el nombre del cliente y el perfil. \nEn este caso solicitamos la configuraci√≥n para el cliente config-clienty el perfil defaultque es el perfil utilizado si no especifica ninguno.\nPara ver la configuraci√≥n para el perfil production se llamar√≠a a la URL:http://localhost:8888/config-client/production. Lo cual muestra la siguiente salida:\nComo se puede observar, muestra el contenido del fichero config-client-production.propertiesy despu√©s el contenido del ficheroconfig-client.properties.\nDe esta manera, si un cliente solicita un valor y ese valor existe en el perfil solicitado, se devolver√° ese valor. En caso contrario se buscar√≠a en el perfil default , devolviendo el valor asignado si lo tuviera.\n Cliente de configuraciones  Una vez tenemos nuestro servidor de configuraciones y levantado, pasaremos a crear el cliente.\nLa √∫nica dependencia en nuestro fichero maven ser√° la siguiente:\n\u0026lt;dependency \u0026lt;groupIdorg.springframework.cloud\u0026lt;/groupId \u0026lt;artifactIdspring-cloud-starter-config\u0026lt;/artifactId \u0026lt;/dependency  Usando Spring Initializr seria a√±adir la dependencia Config Client . Adem√°s, para poder refrescar la configuraci√≥n en caliente, a√±adiremos el starter Actuator\nAhora deberemos configurar la aplicaci√≥n para especificar donde esta el servidor de configuraciones, para ello, lo primero ser√° cambiar el fichero config.properties por bootstrap.properties. De esta manera Spring Boot sabr√° que debe buscar un servidor de configuraciones\nEn este fichero a√±adiremos la propiedad spring.cloud.config.uriespecificando la URL de nuestro servidor de configuraciones.\nspring.application.name=config-client spring.cloud.config.uri=http://localhost:8888 #spring.profiles.active=production management.endpoints.web.exposure.include=refresh  Tambi√©n estableceremos la propiedad management.endpoints.web.exposure.include a refreshpara configurar el paquete actuator de tal modo que se pueda acceder a la URL http://localhost:8080/actuator/refreshque ser√° la que obligara a refrescar las diferentes propiedades.\nRecordar que la variable spring.application.nameestablecera el nombre de la aplicaci√≥n e indicara el fichero del repositorio git donde se buscaran los valores de configuraci√≥n.\nCon la variable spring.profiles.activeindicariamos que perfil es el que debemos usar. Si no ponemos ninguno (como es el caso pues esta comentada la l√≠nea), se utilizara el perfil default\nEn este ejemplo uso varios m√©todos para leer la configuraci√≥n.\n Crear un componente que incluye la etiqueta @ConfigurationProperties  En este m√©todo, que es el mas sencillo, indicamos cual es la ra√≠z de las propiedades a leer y luego definimos las variables que Spring debe rellenar.\nEn la clase configuration.java especificamos que queremos coger las variables que empiecen por limites.\nimport org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.stereotype.Component; import lombok.Data; @Data @Component @ConfigurationProperties(\"limites\") public class Configuration { private int minimum; private int maximum; }  De este modo la variable dato1 tendr√° el valor especificado en limites.dato1\nSi limites.dato1tuviera un valor que no se puede pasar a un entero nuestra aplicaci√≥n fallar√≠a, sin embargo si no encuentra el valor simplemente no lo rellena, sin dar ning√∫n tipo de error.\nEste componente ser√° inyectado a trav√©s de una etiqueta @Autowired\n@Autowired private Configuration configuration;  2. Crear una variable con la anotaci√≥n @Value\nDe esta manera tambi√©n se leer√° el valor del servidor de configuraciones. La mayor diferencia es que ese valor ser√° fijo pues ser√° asignado al ejecutar la aplicaci√≥n y no se refrescara nunca.\n@Value(\"${valores.valor_fijo}\") String valorFijo;  La variable valorFijotendra el valor asignado en la l√≠nea: valores.valor_fijo\n3. Usar la anotaci√≥n @Value en el par√°metro de una funci√≥n\n Igualmente el valor se leer√° desde el servidor de configuraciones con la ventaja de que el valor podr√° ser refrescado.  @GetMapping(\"/refrescado\") public BeanConfiguration getConfiguracionRefrescada(@Value(\"${valores.valor_funcion}\") String valorFuncion) { .... }  \u0026nbsp;Funcionamiento  En nuestro ejemplo se exponen las URL /limites, refrescadoy datos.\nLa llamada a limitesnos devolver√° esta salida:\n  Suponiendo que realiz√°ramos un commit de tal manera que los valores en nuestro servidor GIT hayan cambiado, sucesivas llamadas a esta URL nos mostrar√≠an los antiguos datos, pues el cliente solo lee la configuraci√≥n al principio, a no ser que se le obligue a refrescar sus datos.\nImaginemos que cambiamos el fichero `config-client.properties\u0026#8217; de tal manera que ahora tiene estos valores\ndatosservidor.minimum=10 datosservidor.maximum=20 limites.minimum=-101 limites.maximum=201 valores.valor_fijo: OTROVALORFIJO valores.valor_funcion: \"OTROVALORDEFUNCION\"  Hacemos el correspondiente commit y push\n git commit -a -m \"cambiada configuracion\";git push  Cuando llamemos a la URL http://localhost:8080/actuator/refresh con un m√©todo POST obligaremos a Spring a llamar al servidor de configuraciones y refrescar los valores.\nComo se ve, la salida de esta petici√≥n nos devuelve las variables refrescadas.\nAhora, si llamamos a http://localhost:8080/limites ver√≠amos que el valor de minResultados y maxResultados han cambiado. Sin embargo ni valorFijo ni valorFuncion no lo han hecho.\nSi llamamos a la URL http://localhost:8080/refrescado veremos que la variable valorFuncion se ha actualizado pues en la llamada esta puesta la etiqueta @Value de tal manera que la variable es le√≠da en ese momento. Sin embargo la variable valorFijo no es cambiada pues se estableci√≥ al inicio del programa y su valor permanece inalterado.\nEs importante destacar que si quitamos una variable en nuestro fichero de configuraci√≥n, el valor de la variable no se pondr√° a null sino que mantendr√° el valor anteriormente establecido. Esto es valido tanto si la variable es le√≠da con @Value como si utilizamos un @ConfigurationProperties en un @Bean\nY eso es todo por ahora, en pr√≥ximas lecciones explicare como hacer que las configuraciones se refresquen automagicamenteutilizando el componente Spring Bus Cloud\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/11/20/personalizar-codigo-http-en-spring-boot/",
	"title": "Personalizar salidas de c√≥digos HTTP en Spring Boot",
	"tags": ["java", "rest", "spring boot"],
	"description": "",
	"content": "Buenas, Alumnos/as.\nEn esta articulo os voy a explicar como devolver errores HTTP personalizados. Para ello crearemos un proyecto llamado httpErrorPersonalizado. Teneis el c√≥digo fuente de este proyecto en mi p√°gina de¬†GitHub\nCuando realizamos una petici√≥n HTTP a un recurso en Spring Boot, es com√∫n que esa petici√≥n tenga que considerar la opci√≥n de devolver un error.\nEs el caso t√≠pico de que realizamos una petici√≥n RESTful para solicitar un registro, pero ese registro no existe. En este caso lo normal es devolver un c√≥digo HTTP tipo 404 (Not Found) lo cual se hace lanzando una excepci√≥n que hayamos anotado con la etiqueta @ResponseStatus(HttpStatus.NOT_FOUND) lo que ocurre es que el objeto JSON que acompa√±a a esa respuesta 404 en Spring Boot ser√° con un formato definido de este tipo:\n{ \u0026quot;timestamp\u0026quot;: \u0026quot;2018-11-20T11:46:10.255+0000\u0026quot;, \u0026quot;status\u0026quot;: 404, \u0026quot;error\u0026quot;: \u0026quot;Not Found\u0026quot;, \u0026quot;message\u0026quot;: \u0026quot;bean: 8 not Found\u0026quot;, \u0026quot;path\u0026quot;: \u0026quot;/get/8\u0026quot; }  Si nosotros queremos que la salida sea algo as√≠ como esto:\n{ \u0026quot;timestamp\u0026quot;: \u0026quot;2018-11-20T12:51:42.699+0000\u0026quot;, \u0026quot;mensaje\u0026quot;: \u0026quot;bean: 8 not Found\u0026quot;, \u0026quot;detalles\u0026quot;: \u0026quot;uri=/get/8\u0026quot;, \u0026quot;httpCodeMessage\u0026quot;: \u0026quot;Not Found\u0026quot; }  tendremos que poner una serie de clases a nuestro proyecto. Aqu√≠ os explico como üòâ\nEl c√≥digo fuente lo ten√©is en mi repositorio de GitHub\nPartiendo de una proyecto basico de Spring Boot, donde tenemos una simple objeto llamado MiBean con solo dos campos: codigo y valor que es el que devolveremos en las peticiones rest al recurso \u0026#8220;/get\u0026#8220;, de tal manera que una petici√≥n a: http://localhost:8080/get/1 nos devolvera un objeto JSON como este:\n{ \u0026quot;codigo\u0026quot;: 1, \u0026quot;valor\u0026quot;: \u0026quot;valor uno\u0026quot; }  Si intentamos acceder a un elemento superior al 3 nos devolver√° un error pues solo 3 registros disponibles.\nAqu√≠ pong la clase ErrorResource que procesa las peticiones al recurso \u0026#8220;/get\u0026#8220;\npublic class ErrorResource { @Autowired MiBeanService service; @GetMapping(\u0026quot;/get/{id}\u0026quot;) public MiBean getBean(@PathVariable int id) { MiBean bean = null; try { bean = service.getBean(id); } catch (NoSuchElementException k) { throw new BeanNotFoundException(\u0026quot;bean: \u0026quot;+id+ \u0026quot; not Found\u0026quot; ); } return bean; } }  Como se ve en getBean() se llama a la funci√≥n getBean(int id) de la clase MiBeanService, la cual pego a continuaci√≥n\n@Component public class MiBeanService { private static List\u0026lt;MiBean\u0026gt; miBeans = new ArrayList\u0026lt;\u0026gt;(); static { miBeans.add(new MiBean(1, \u0026quot;valor uno\u0026quot;)); miBeans.add(new MiBean(2, \u0026quot;valor dos\u0026quot;)); miBeans.add(new MiBean(3, \u0026quot;valor tres\u0026quot;)); } public MiBean getBean(int id) { MiBean miBean = miBeans.stream() .filter(t -\u0026gt; t.getCodigo()==id) .findFirst() .get(); return miBean; } }  Observe que la funci√≥n getBean(int id) lanzara una excepci√≥n tipo NoSuchElementException si no encuentra el c√≥digo en la List miBeans . Esta excepci√≥n ser√° capturada en el controlador el cual lanzara una excepci√≥n tipo BeanNotFoundException\nLa clase BeanNotFoundException es la siguiente:\n@ResponseStatus(HttpStatus.NOT_FOUND) public class BeanNotFoundException extends RuntimeException { public BeanNotFoundException(String message) { super(message); } }  Una simple clase que extiende RuntimeException y que esta anotada con al etiqueta @ResponseStatus(HttpStatus.NOT_FOUND)con lo cual al ser lanzada devolvera un c√≥digo HTTP 404 (Not Found).\nSi dej√°ramos as√≠ el proyecto al pedir un c√≥digo superior a 3, seria esta:\npero como hemos dicho queremos que el mensaje de error sea personalizado.\nPara ello vamos a crear una nueva clase donde definiremos los campos de nuestro mensaje de error. Esta clase el proyecto es ExceptionResponse la cual es un simple pojo como se puede ver en el c√≥digo que adjunto:\npublic class ExceptionResponse { private Date timestamp; private String mensaje; private String detalles; private String httpCodeMessage; public ExceptionResponse(Date timestamp, String message, String details,String httpCodeMessage) { super(); this.timestamp = timestamp; this.mensaje = message; this.detalles = details; this.httpCodeMessage=httpCodeMessage; } public String getHttpCodeMessage() { return httpCodeMessage; } public Date getTimestamp() { return timestamp; } public String getMensaje() { return mensaje; } public String getDetalles() { return detalles; } }  Ahora se definir√° la clase que indicara a Spring que objeto JSON debe devolver en caso de que se produzca lance una excepci√≥n del tipo BeanNotFoundException . Esa clase es: CustomizedResponseEntityExceptionHandler la cual adjunto a continuaci√≥n:\n//@ControllerAdvice // @RestController @RestControllerAdvice public class CustomizedResponseEntityExceptionHandler extends ResponseEntityExceptionHandler { @ExceptionHandler(BeanNotFoundException.class) public final ResponseEntity\u0026lt;ExceptionResponse\u0026gt; handleNotFoundException(BeanNotFoundException ex, WebRequest request) { ExceptionResponse exceptionResponse = new ExceptionResponse(new Date(), ex.getMessage(), request.getDescription(false),HttpStatus.NOT_ACCEPTABLE.getReasonPhrase()); return new ResponseEntity\u0026lt;ExceptionResponse\u0026gt;(exceptionResponse, HttpStatus.NOT_ACCEPTABLE); } }  Esta clase debe heredar de ResponseEntityExceptionHandler la cual ya tratara las excepciones m√°s comunes.\nLa deberemos anotarla con las etiquetas @ControllerAdvice y @RestControllero como me sugiri√≥ Marcelo Martins¬†en DZone sustistuir esas dos por la etiqueta: @RestControllerAdvice\n@ControllerAdvice es una etiqueta derivada de @Component que se usara para clases que traten excepciones. Al tener la clase la etiqueta @RestContoller tratara las excepciones lanzadas en los controladores de peticiones REST.\nY crearemos la funci√≥n donde especificar el objeto a utilizar cuando se produzca un tipo de excepci√≥n.\nAs√≠, en el ejemplo, hemos definido que cuando se se lance la excepci√≥n BeanNotFoundException ser√° devuelto un objeto ExceptionResponse. Esto se hace creando un objeto ResponseEntityconvenientemente iniciado.\nEs importante observar que tambi√©n definimos el c√≥digo HTTP devuelto. En este caso devolveremos el c√≥digo 406, en vez del 404. De hecho en nuestro ejemplo podr√≠amos quitar la etiqueta @ResponseStatus(HttpStatus.NOT_FOUND)a la clase BeanNotFoundException y todo seguir√≠a funcionando igual.\nY as√≠ tendremos una salida personalizada como se ve en la siguiente imagen:\nY esto es todo por hoy. ¬°¬° Nos vemos en la pr√≥xima clase !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/10/18/securizando-servicios-rest-con-oauth2-en-springboot/",
	"title": "Securizando servicios REST con Oauth2 en SpringBoot",
	"tags": ["java", "oauth2", "rest", "seguridad", "spring boot"],
	"description": "",
	"content": " Buenas, estudiantes. En esta entrada explicare como podemos dotar de seguridad a servicios REST en Spring Boot. La aplicaci√≥n de ejemplo es la misma que la entrada de seguridad WEB anterior, as√≠ que el c√≥digo fuente lo ten√©is en: https://github.com/chuchip/OAuthServer.\nExplicando la tecnologia Oauth2 Como he dicho, utilizaremos el protocolo OAuth2, as√≠ que lo primero sera explicar como funciona este protocolo.\nOAuth2 tiene algunas variantes pero yo os voy a explicar la que utilizare en el programa y,¬†para ello, voy a poneros un ejemplo para que entend√°is lo que pretendemos hacer.\nVoy a poner una escena cotidiana: El pago con una tarjeta de cr√©dito en un comercio.En este caso hay tres interlocutores: La tienda, el banco y nosotros. En el protocolo Oauth2 pasa algo parecido. Estos son los pasos:\n El cliente , o sea, el comprador, solicita al banco una tarjeta de cr√©dito, para que el banco nos la de,¬†comprobara quienes somos, y nos otorga un cr√©dito dependiendo de la pasta que tengamos en la cuenta o bien nos dice que no le hagamos perder el tiempo ;-). En el protocolo OAuth2 al que otorga las tarjetas se le llama Servidor de Autentificaci√≥n. Si el banco nos ha dado la tarjeta, podremos ir a la tienda, es decir al servidor web, y le presentamos la tarjeta de cr√©dito. La tienda no nos conoce de nada, pero puede preguntar al banco, a trav√©s del lector de tarjetas si puede confiar en nosotros y hasta que punto (el saldo de cr√©dito). La tienda seria el Servidor de Recursos. La tienda¬†dependiendo del dinero que le diga el banco que tenemos nos permitir√° comprar unos productos u otros. En la analog√≠a OAuth2, el servidor web nos permitir√° acceder a unas paginas u a otras dependiendo de si¬†somos muy ricos, ricos, medios¬†o pobres.  Como comentario, decir, por si no os hab√©is dado cuenta, que se utilizan servidores de autentificaci√≥n habitualmente. Cuando vais a una pagina web y os pide registraros, pero como opci√≥n os deja hacerlo a trav√©s de Facebook o Google, est√°is utilizando esta tecnolog√≠a. Google o Facebook se convierte en el \u0026#8216;banco\u0026#8217; que emite esa \u0026#8216;tarjeta\u0026#8217;, la pagina web que os pide registraros, la usara para comprobar que ten√©is \u0026#8216;credito\u0026#8217; y dejaros entrar. Espero que se entienda el ejemplo ;-).\nAqu√≠ pod√©is ver la pagina web de el peri√≥dico \u0026#8220;El Pais\u0026#8217;, creando una cuenta. Si utilizamos Google o Facebook, el peri√≥dico (la tienda) confiara en lo que les digan esos proveedores de autentificaciones. En este caso lo √∫nico que necesita la pagina web es que teng√°is una tarjeta de cr√©dito, sin importar el saldo üòâ\nCreando un Servidor de Autorizaciones (AuthServer) ¬ø Entendido ?. OK, pues vamos a ver como crear un banco, la tienda y toda la parafernalia üòâ\nLo primero, en nuestro proyecto,¬†necesitamos tener las dependencias adecuadas, necesitaremos los inicializadores (starters en ingles) : Cloud OAuth2, Security y Web\nBien, empecemos por definir el banco, esto lo hacemos en la clase: AuthorizacionServerConfiguration\n@Configuration @EnableAuthorizationServer public class AuthorizacionServerConfiguration extends AuthorizationServerConfigurerAdapter { @Autowired @Qualifier(\u0026quot;authenticationManagerBean\u0026quot;) private AuthenticationManager authenticationManager; @Autowired private TokenStore tokenStore; @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception { clients.inMemory() .withClient(\u0026quot;cliente\u0026quot;) .authorizedGrantTypes(\u0026quot;password\u0026quot;, \u0026quot;authorization_code\u0026quot;, \u0026quot;refresh_token\u0026quot;, \u0026quot;implicit\u0026quot;) .authorities(\u0026quot;ROLE_CLIENT\u0026quot;, \u0026quot;ROLE_TRUSTED_CLIENT\u0026quot;,\u0026quot;USER\u0026quot;) .scopes(\u0026quot;read\u0026quot;,\u0026quot;write\u0026quot;) .autoApprove(true)\t.secret(passwordEncoder().encode(\u0026quot;password\u0026quot;)); } @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception { endpoints .authenticationManager(authenticationManager)\t.tokenStore(tokenStore); } @Bean public TokenStore tokenStore() { return new InMemoryTokenStore(); }\t}  Empezamos la clase anotandola como de configuraci√≥n con la etiqueta @Configuration y despu√©s usamos la etiqueta @EnableAuthorizationServer para decirle a Spring que active el servidor de autorizaciones. Para definir las propiedades del servidor especificamos que nuestra clase extiende de AuthorizationServerConfigurerAdapter , la cual implementa el interface AuthorizationServerConfigurerAdapter, por lo cual, Spring usara esta clase para parametrizar el servidor.\nDefinimos un bean tipo AuthenticationManager¬† que Spring provee automagicamente y que nosotros recogeremos con la etiqueta @Autowired.¬†Tambi√©n definimos un objeto¬†TokenStore, pero para poder injectarlo debemos definirlo, lo cual hacemos en la funci√≥n public TokenStore tokenStore().\nEl AuthenticationManager¬†¬†o Controladores de Autentificaciones, como he dicho lo provee Spring pero tenderemos que configurarlo nosotros. M√°s tarde explicare como se hace. El TokenStore o Almac√©n de Identificadores es¬†donde se guardaran los identificadores que nuestro servidor de autentificaciones vaya suministrando, para que cuando el servidor de recursos (la tienda) le pregunte el cr√©dito sobre una tarjeta de cr√©dito este pueda responderle. En este caso usamos la clase InMemoryTokenStore que guardara los identificadores en memoria. En una aplicaci√≥n real podr√≠amos usar un JdbcTokenStore para guardarlos en una base de datos, para que si se cae la aplicaci√≥n los clientes no tengan que renovar sus tarjetas de credito üòâ\nEn la funci√≥n configure(ClientDetailsServiceConfigurer clients) especificamos las credenciales del banco, digo del administrador de autentificaciones. ademas de los servicios que ofrece. S√≠, hablando en plural, porque para poder acceder al banco debemos tener un usuario y contrase√±a para cada uno de los servicios que ofrece. Esto es¬†un concepto muy importante: El usuario y contrase√±a es del banco no del cliente, para cada servicio que ofrezca el banco habr√° una √∫nica autentificaci√≥n, si bien podr√° ser la misma para diferentes servicios.\nDetallare las lineas:\n clients.inMemory()¬†Especifica que vamos a guardar los servicios en memoria. En una aplicaci√≥n \u0026#8216;real\u0026#8217; lo guardar√≠amos en una base de datos, un servidor LDAP, etc. withClient(\u0026#8220;cliente\u0026#8221;) Es el usuario con el que nos identificaremos en el banco. En este caso se llamara \u0026#8216;cliente\u0026#8217;. ¬ø Igual habria sido mejor llamarle \u0026#8216;user\u0026#8217; üòâ ? authorizedGrantTypes(\u0026#8220;password\u0026#8221;, \u0026#8220;authorization_code\u0026#8221;, \u0026#8220;refresh_token\u0026#8221;, \u0026#8220;implicit\u0026#8221;). Especificamos los servicios que estamos configurando para el usuario definido , para \u0026#8216;cliente\u0026#8216;. En nuestro ejemplo solo usaremos el servicio password. authorities(\u0026#8220;ROLE_CLIENT\u0026#8221;, \u0026#8220;ROLE_TRUSTED_CLIENT\u0026#8221;,\u0026#8221;USER\u0026#8221;). Especifica roles o grupos que tiene el servicio ofrecido. Tampoco lo usaremos en nuestro ejemplo asi que dejemoslo correr de momento. scopes(\u0026#8220;read\u0026#8221;,\u0026#8221;write\u0026#8221;). El ambito del servicio. Tampoco lo usaremos en nuestra aplicaci√≥n. autoApprove(true). Si debe aprobar automaticamente las peticiones del cliente. Pondremos que si para hacer m√°s sencilla la aplicaci√≥n. secret(passwordEncoder().encode(\u0026#8220;password\u0026#8221;)). Contrase√±a del cliente. Observar que se llama la funci√≥n encode que tenemos definida un poco m√°s abajo, para especificar con que tipo de encriptaci√≥n se guardara la contrase√±a. La funci√≥n encode, esta anotada con la etiqueta @Bean porque spring, cuando le suministremos la contrase√±a en una petici√≥n HTTP, buscara un objeto PasswordEncoder para comprobar la validez de la contrase√±a entregada.  Y por √∫ltimo tenemos la funci√≥n configure(AuthorizationServerEndpointsConfigurer endpoints) donde definimos que controlador de autentificaciones y que almac√©n de identificadores deben usar los puntos de salida. Aclarar que los puntos de salida¬†son las URLs por donde \u0026#8216;hablaremos con nuestro banco\u0026#8217;, para solicitar las tarjetas de cerdito üòâ\nDe acuerdo, ya tenemos nuestro servidor de autentificaciones creado pero aun nos falta la manera de que este sepa quienes somos y nos ponga en diferentes grupos, seg√∫n las credenciales introducidas. Bien, para hacer esto usaremos la misma clase que en utilizamos para proteger una pagina web. Si hab√©is le√≠do el articulo anterior: http://www.profesor-p.com/2018/10/17/seguridad-web-en-spring-boot/¬†recordareis que cre√°bamos una clase que heredaba de WebSecurityConfigurerAdapter , donde sobrescribiamos la funci√≥n UserDetailsService userDetailsService().\npublic class WebSecurityConfiguration extends WebSecurityConfigurerAdapter { .... @Bean @Override public UserDetailsService userDetailsService() { UserDetails user=User.builder().username(\u0026quot;user\u0026quot;).password(passwordEncoder().encode(\u0026quot;secret\u0026quot;)). roles(\u0026quot;USER\u0026quot;).build(); UserDetails userAdmin=User.builder().username(\u0026quot;admin\u0026quot;).password(passwordEncoder().encode(\u0026quot;secret\u0026quot;)). roles(\u0026quot;ADMIN\u0026quot;).build(); return new InMemoryUserDetailsManager(user,userAdmin); } .... }  Pues los usuarios con sus roles o grupos se definen de la misma manera. Deberemos tener una clase que extienda WebSecurityConfigurerAdapter¬† y definir nuestros usuarios.\nAhora y podemos comprobar si nuestro servidor de autorizaciones funciona. Vamos¬†a ver como, utilizando el excelente programa PostMan.\nPara hablar con el \u0026#8216;banco\u0026#8217; para solicitar nuestras credenciales, y como no hemos definido lo contrario, deberemos ir a la URI \u0026#8220;/oauth/token\u0026#8221;. Este es uno de los puntos finales de los que hablaba anteriormente. Hay m√°s pero en nuestro ejemplo y como solo vamos a usar el servicio \u0026#8216;password\u0026#8217; no usaremos m√°s.\nUsaremos una petici√≥n HTTP tipo POST, indicando que queremos usar validaci√≥n b√°sica, pondremos el usuario y contrase√±a, que ser√°n los del \u0026#8220;banco\u0026#8221;, en nuestro ejemplo: \u0026#8216;cliente\u0026#8217; y \u0026#8216;password\u0026#8217; respectivamente.\nEn el cuerpo de la petici√≥n, en formato form-url-encoded introduciremos el servicio a solicitar, nuestro usuario y nuestra contrase√±a.\ny lanzamos la petici√≥n, la cual nos deber√° sacar una salida como esta:\nEse \u0026#8216;access_token\u0026#8217; \u0026#8220;8279b6f2-013d-464a-b7da-33fe37ca9afb\u0026#8221; es nuestra tarjeta de cr√©dito y es la que deberemos presentar a nuestro servidor de recursos (la tienda) para poder ver paginas (recursos) que no sean p√∫blicos.\nCreando un Servidor de Recursos (ResourceServer) Ahora que ya tenemos nuestra tarjeta de cr√©dito vamos a crear la tienda que acepte esa tarjeta üòâ\nEn nuestro ejemplo vamos a crear el servidor de recursos y de autentificaci√≥n en el mismo programa, con lo cual Spring Boot, se encargara de hacer que confi√© una parte en otra, sin tener que configurar nada. Si, como es habitual en la vida real, el servidor de recursos esta en un sitio¬†y el servidor de autentificaciones en otro, deber√≠amos indicarle al servidor de recursos, cual es nuestro \u0026#8216;banco\u0026#8217; y como debe hablar con el. Pero eso lo dejaremos para otra entrada.\nLa √∫nica clase del servidor de recursos es ResourceServerConfiguration\n@EnableResourceServer @RestController public class ResourceServerConfiguration extends ResourceServerConfigurerAdapter { ..... }  Observar la anotaci√≥n¬†@EnableResourceServer que hara que Spring active el servidor de recursos.¬†La etiqueta @RestController es porque en esta misma clase nosotros tendremos los recursos, pero podr√≠an estar perfectamente en otra clase.\nPor ultimo fijaros que la clase extiende de ResourceServerConfigurerAdapter esto es as√≠ porque vamos a sobrescribir metodos de esa clase para configurar nuestro servidor de recursos.\nComo he dicho antes al estar el servidor de autentificaci√≥n y de recursos en el mismo programa no tenemos mas que configurar la seguridad de nuestro servidor de recursos. Esto se hace en la funci√≥n:\n@Override public void configure(HttpSecurity http) throws Exception { http .authorizeRequests().antMatchers(\u0026quot;/oauth/token\u0026quot;, \u0026quot;/oauth/authorize**\u0026quot;, \u0026quot;/publica\u0026quot;).permitAll(); //\t.anyRequest().authenticated(); http.requestMatchers().antMatchers(\u0026quot;/privada\u0026quot;) // Denegamos el acceso a \u0026quot;/privada\u0026quot; .and().authorizeRequests() .antMatchers(\u0026quot;/privada\u0026quot;).access(\u0026quot;hasRole('USER')\u0026quot;) .and().requestMatchers().antMatchers(\u0026quot;/admin\u0026quot;) // Denegamos el acceso a \u0026quot;/admin\u0026quot; .and().authorizeRequests() .antMatchers(\u0026quot;/admin\u0026quot;).access(\u0026quot;hasRole('ADMIN')\u0026quot;); }  En la entrada anterior cuando defin√≠amos la seguridad en la web, explicaba una funci√≥n llamada configure(HttpSecurity http), ¬ø a que se parece mucho a esta ?. Pues si b√°sicamente es la misma, y de hecho recibe un objeto HttpSecurity que debemos configurar.\nExplico linea a linea las sentencias:\n http.authorizeRequests().antMatchers(\u0026ldquo;/oauth/token\u0026rdquo;, \u0026ldquo;/oauth/authorize\u0026rdquo;, \u0026ldquo;/publica\u0026rdquo;).permitAll() Permitimos todas las peticiones a¬†\u0026#8220;/oauth/token\u0026#8221;, \u0026#8220;/oauth/authorize**\u0026#8221;, \u0026#8220;/publica\u0026#8221; sin ning√∫n tipo de validaci√≥n. anyRequest().authenticated() Esta linea esta comentada, si no lo estuviera todos los recursos serian accesibles solo si se el usuario ha sido validado. requestMatchers().antMatchers(\u0026ldquo;/privada\u0026rdquo;) Denegamos el acceso a la url \u0026#8220;/privada\u0026#8221; authorizeRequests().antMatchers(\u0026ldquo;/privada\u0026rdquo;).access(\u0026ldquo;hasRole(\u0026lsquo;USER\u0026rsquo;)\u0026rdquo;) Permitimos el acceso a \u0026#8220;/privada\u0026#8221; si el usuario validado tiene el role \u0026#8216;USER\u0026#8217; requestMatchers().antMatchers(\u0026ldquo;/admin\u0026rdquo;) Denegamos el acceso a la url \u0026#8220;/admin\u0026#8221; authorizeRequests().antMatchers(\u0026ldquo;/admin\u0026rdquo;).access(\u0026ldquo;hasRole(\u0026lsquo;ADMIN\u0026rsquo;)\u0026rdquo;) Permitimos el acceso a \u0026#8220;/admin\u0026#8221; si el usuario validado tiene el role \u0026#8216;ADMIN\u0026#8217;  Una vez que tenemos nuestra servidor de recursos creado solo debemos crear los servicios lo cual se hace con estas lineas:\n @RequestMapping(\u0026quot;/publica\u0026quot;) public String publico() { return \u0026quot;Pagina Publica\u0026quot;; } @RequestMapping(\u0026quot;/privada\u0026quot;) public String privada() { return \u0026quot;Pagina Privada\u0026quot;; } @RequestMapping(\u0026quot;/admin\u0026quot;) public String admin() { return \u0026quot;Pagina Administrador\u0026quot;; }  Como veis son 3 funciones basicas que solo devuelven sus correspondientes Strings.\nVeamos ahora como funciona la validaci√≥n.\nPrimero comprobamos que podemos acceder a \u0026#8220;/publica\u0026#8221; sin ning√∫n tipo de validaci√≥n:\nCorrecto. ¬°¬° Esto funciona!!\nSi intento acceder a la pagina \u0026#8220;/privada\u0026#8221; recibo un error \u0026#8220;401 unauthorized\u0026#8221;, lo cual nos indica que no tenemos permiso para ver esa pagina, as√≠ que vamos a usar¬†el token emitido por nuestro servidor de autorizaciones, para el usuario \u0026#8216;user\u0026#8217;, a ver que pasa üòâ\nAnda, si podemos ver nuestra pagina privada. Probemos con la pagina del administrador\u0026#8230;\nCorrecto, no podemos verla. Asi que vamos a solicitar un nuevo token al administrador de credenciales, pero identificandonos con el usuario \u0026#8216;admin\u0026#8217;.\nEl token devuelto es: \u0026#8221; \u0026#8220;ab205ca7-bb54-4d84-a24d-cad4b7aeab57\u0026#8221;. Lo usamos a ver que pasa:\nBueno, pues ya esta, ya podemos ir de compras con seguridad!!. Ahora ya solo falta montar la tienda y tener los productos üòâ\nNos vemos en la pr√≥xima, estudiantes üôÇ\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/10/17/seguridad-web-en-spring-boot/",
	"title": "Seguridad WEB en Spring Boot",
	"tags": ["java", "mvc", "seguridad", "spring", "spring boot", "thymeleaf"],
	"description": "",
	"content": "Hola de nuevo, estudiantes üòâ . En esta entrada voy a explicar¬†como gestiona Spring la seguridad. No todo, por supuesto, que el tema de la seguridad dar√≠a para un libro muy gordote, pero al menos aprender a securizar una pagina web. En una pr√≥xima entrada hablare de como securizar un servicio REST.\nComo siempre, comienzo diciendo que el c√≥digo fuente de lo que explico lo ten√©is en mi pagina de GITHUB, en https://github.com/chuchip/OAuthServer. El programa esta realizado en Java, usando Spring Boot.\nBien, empecemos por como securizar una pagina web en Spring.\nRealmente usando Spring Boot, es muy sencillo, pues haremos uso de lo que Spring denomina starters, que no son sino grupos de paquetes los cuales agrupan ciertas¬†funcionalidades. As√≠ en este caso, incluiremos el paquete Web, Thymeleaf y, por supuesto, Security.\nAqu√≠ ten√©is un pantallazo de Eclipse seleccionando los paquetes necesarios.\nDe todos modos,¬†ya sab√©is que en el fichero pom.xml pod√©is ver las dependencias m√°s detalladamente.\nThymeleaf, por si alguien no lo sabe, es un software que se integra perfectamente con Spring y que permite realizar plantillas de p√°ginas WEB.¬†Como JSP, pero muy mejorado o si lo prefer√≠s un JavaServer Faces si conoc√©is m√°s el mundo JavaEE. El caso es que permite realizar paginas HTML que se integran perfectamente con nuestras clases desarrolladas con Spring.\nComo queremos poder ver en nuestra p√°gina web el nombre del usuario con el que nos hemos registrado, debemos usar la librer√≠a de seguridad de Thymeleaf para Spring. Para ello incluiremos las siguientes lineas en nuestro fichero pom.xml de Maven.\n\u0026lt;groupId\u0026gt;org.thymeleaf.extras\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;thymeleaf-extras-springsecurity4\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.3.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; Y aqu√≠ pod√©is ver como quedara la estructura de nuestro programa\nAhora empecemos a declarar nuestra primera clase, a la que he llamado WebSecurityConfiguration.java\n@SpringBootApplication @EnableWebSecurity public class WebSecurityConfiguration extends WebSecurityConfigurerAdapter { public static void main(String[] args) { SpringApplication.run(WebSecurityConfiguration.class, args); } @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception { return super.authenticationManagerBean(); } @Bean @Override public \u0026lt;a href=\u0026quot;#UserDetailsService\u0026quot;\u0026gt;UserDetailsService\u0026lt;/a\u0026gt; userDetailsService() { UserDetails user=User.builder().username(\u0026quot;user\u0026quot;) .password(passwordEncoder().encode(\u0026quot;secret\u0026quot;)) .roles(\u0026quot;USER\u0026quot;).build(); UserDetails userAdmin = User.builder().username(\u0026quot;admin\u0026quot;) .password(passwordEncoder().encode(\u0026quot;secret\u0026quot;)) .roles(\u0026quot;ADMIN\u0026quot;).build(); return new InMemoryUserDetailsManager(user,userAdmin); } @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } @Override protected void configure(HttpSecurity http) throws Exception { http .csrf().disable() .authorizeRequests() .antMatchers(\u0026quot;/\u0026quot;,\u0026quot;/index\u0026quot;,\u0026quot;/webpublico\u0026quot;).permitAll() .antMatchers(\u0026quot;/webprivado\u0026quot;).authenticated() .antMatchers(\u0026quot;/webadmin\u0026quot;).hasRole(\u0026quot;ADMIN\u0026quot;).and() .formLogin() .loginPage(\u0026quot;/login\u0026quot;) .permitAll() .and() .logout() // Metodo get pues he desabilitado CSRF .permitAll(); } }  Lo primero es poner las etiquetas @SpringBootApplication y @EnableWebSecurity. La primera etiqueta es obvia, ya que nuestra aplicaci√≥n queremos que funcione con Spring Boot ;-). Vamos, que o la pon√©is o no seria una aplicaci√≥n Spring Boot y ya nos podemos ir a casa :-D. La segunda es para especificar que queremos que se active la seguridad Web, realmente esta etiqueta no es obligatorio ponerla porque Spring Boot que es muy listo, en cuanto ve que tenemos el paquete security¬†(en el pom.xml, recordad) en nuestro proyecto la incluye, pero no es mala cosa ponerla por claridad, aunque sea redundante.\nAhora especificamos que nuestra clase va a heredar de WebSecurityConfigurerAdapter pues vamos a sobrescribir algunas de las funciones de esa clase. Para que lo entend√°is, b√°sicamente Spring mira a ver si hay alguna clase que implemente el interface WebSecurityConfigurer, el cual implementa la clase WebSecurityConfigurerAdapter , y si lo hay pues utiliza las funciones que tiene ese interface para configurar la seguridad de la aplicaci√≥n.\nSi no tuvi√©ramos una clase que implementara ese interface, Spring simplemente no dejar√≠a acceder a ninguna pagina de nuestra aplicaci√≥n, lo que, como comprender√©is no es muy pr√°ctico üòâ\nBien, ahora sobrescribimos la funci√≥n authenticationManagerBean que devolver√° la clase encargada de manejar las autentificaciones (como su propio nombre indica üòâ ). Vale, os estar√©is preguntando, ¬ø pero si solo llama a la funci√≥n padre para que la definimos?. Muy simple porque le ponemos la etiqueta @Bean, para que Spring sepa de donde sacar (inyectar) un objeto tipo AuthenticationManager¬†pues lo necesita para controlar la seguridad.\nEn la funci√≥n userDetailsService definimos los usuarios que van a tener acceso a nuestra web. En este caso creamos dos usuarios: user y admin (s√≠ lo se, no es que me haya currado mucho el tema de los nombres üòâ ). Cada uno de ellos con su contrase√±a y su ROL. Aclarar que el ROL es un literal libre, es decir que ah√≠ podemos poner lo que queramos, por ejemplo USUARIO_CON_PECAS. El caso es que luego ese ROL lo utilizaremos y debe coincidir letra a letra con el establecido.\nObservar tambi√©n que la contrase√±a se la damos encriptada, en este caso con el algoritmo BCrypt. Esto lo hacemos llamando a la funci√≥n passwordEncoder, la cual esta anotada con la etiqueta @Bean para que Spring la use.\nEs decir, Spring necesita saber que sistema de encriptaci√≥n estamos usando para guardar nuestras contrase√±as, y para ello busca un objeto que implemente el interface PasswordEncoder. Si no lo encuentra nos fallara la aplicaci√≥n.\nAclarar que estamos usando la forma m√°s sencilla de declarar los usuarios, guard√°ndolos en memoria con la clase¬†InMemoryUserDetailsManager.¬†En un programa de verdad, se usar√≠a¬†JdbcUserDetailsManager¬†que nos permitir√≠a guardarlos en una base de datos o cualquier otra clase que implemente el interface¬†UserDetailsManager¬†como podr√≠a ser¬†LdapUserDetailsManager¬†si quisi√©ramos usar un servicio LDAP.\nY ya solo nos falta definir que partes de nuestra aplicaci√≥n vamos a proteger y que roles deben de tener permisos para acceder a cada parte de ella. S√≠, he escrito roles y no usuarios porque como hemos dicho antes, al definir un usuario, lo debemos asignar a un rol¬†(o grupo que es m√°s espa√±ol, si lo prefer√≠s). Y, normalmente, las reglas de filtrado se aplican por el grupo al que pertenece el usuario. Para definir los permisos de cada recurso lo haremos configurando el objeto¬†HttpSecurity recibido en la funci√≥n protected void configure(HttpSecurity http)\nVoy explicando linea a linea lo que se hace en esta funci√≥n:\n csrf().disable()  Deshabilita el control de csrf. CRSF son las siglas de¬†Cross-site request forgery¬† como explica la Wikipedia\nCRSF del ingl√©s Cross-site request forgery o falsificaci√≥n de petici√≥n en sitios cruzados) es un tipo de exploit malicioso de un sitio web en el que comandos no autorizados son transmitidos por un usuario en el cual el sitio web conf√≠a. Esta vulnerabilidad es conocida tambi√©n por otros nombres como XSRF, enlace hostil, ataque de un click, cabalgamiento de sesi√≥n, y ataque autom√°tico.  El deshabilitar el CRSF tiene como efecto secundario que se pueda realizar un logout de una sesi√≥n con una petici√≥n HTTP tipo GET, pues por defecto solo se puede hacer con una petici√≥n POST.\n .authorizeRequests()\n.antMatchers(\u0026#8220;/\u0026#8221;,\u0026#8221;/index\u0026#8221;,\u0026#8221;/webpublico\u0026#8221;).permitAll()\n  Especificamos que las peticiones que en la ruta este cualquiera de las cadenas¬†\u0026#8220;/\u0026#8221;,\u0026#8221;/index\u0026#8221;,\u0026#8221;/webpublico\u0026#8221;¬†no tendr√°n seguridad. Es decir estar√°n permitidas para todo el mundo.\n antMatchers(\u0026#8220;/webprivado\u0026#8221;).authenticated()  Especificamos que las peticiones a la ruta \u0026#8220;/webprivado\u0026#8221;¬†solo podr√°n ser procesadas si el usuario esta autentificado, sin especificar a que ROL debe pertenecer.\n .antMatchers(\u0026#8220;/webadmin\u0026#8221;).hasRole(\u0026#8220;ADMIN\u0026#8221;)  Solo los usuarios que sean del grupo¬†ADMIN¬†tendr√°n acceso a la URL \u0026#8220;/webadmin\u0026#8221;\nLa funci√≥n antMatchers¬†permite el uso de expresiones regulares, por lo que si, por ejemplo, quisi√©ramos aplicar una regla a todo lo que dependa de una ruta, podr√≠amos poner esto :\nhttp.antMatchers(\u0026#8220;/users/\u0026#8221;).hasRole(\u0026#8220;USER\u0026#8221;)¬†**para especificar que cualquier petici√≥n a la URL /users/Y_LO_QUE_SEA solo tendr√°n acceso los usuarios¬†que pertenezcan al grupo¬†USER.\n .formLogin().loginPage(\u0026#8220;/login\u0026#8221;).permitAll()  Especificamos que la pagina de login sera \u0026#8220;/login\u0026#8221; (valga la repugnancia ;-)) y que¬†que puede acceder¬†todo el mundo.\n logout().permitAll()  Especificamos que a la pagina de desconexi√≥n (logout) pude acceder a todo el mundo. Por defecto esta pagina responde en la URL \u0026#8220;/logout\u0026#8221;\nPerfecto, ya tenemos definida la seguridad de nuestras paginas web, ahora solo queda definir los puntos de entrada a las p√°ginas. Eso se hace en la clase¬†WebController.java\n@Controller public class WebController { @RequestMapping({\u0026quot;/\u0026quot;,\u0026quot;index\u0026quot;}) public String inicio() { return \u0026quot;index\u0026quot;; } @RequestMapping(\u0026quot;/webprivado\u0026quot;) public String privado() { return \u0026quot;privado\u0026quot;; } @RequestMapping(\u0026quot;/webpublico\u0026quot;) public String loginpub() { return \u0026quot;publico\u0026quot;; } @RequestMapping(\u0026quot;/webadmin\u0026quot;) public String admin() { return \u0026quot;admin\u0026quot;; } @RequestMapping(\u0026quot;/login\u0026quot;) public String login() { return \u0026quot;login\u0026quot;; } }  La clase como se ve no tiene muchos misterios,simplemente especificamos con la etiqueta¬†@Controller¬†que sera una clase donde vamos a definir puntos de entrada para las peticiones web.\nEn las diferentes funciones tenemos la etiqueta¬†@RequestMapping¬†para especificar la URL que debe procesar cada funci√≥n. As√≠ la funci√≥n¬†inicio sera llamada cuando haya una petici√≥n a la URL \u0026#8220;/\u0026#8221; o a \u0026#8220;/index\u0026#8221;. Observar que no hay que poner la barra inicial en \u0026#8220;index\u0026#8221;.\nLa cadena devuelta sera la plantilla Thymeleaf devuelta, de tal manera que la llamada¬†funci√≥n inicio¬†devolver√° la plantilla \u0026#8220;index.html\u0026#8221; que es la siguiente:\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:th=\"http://www.thymeleaf.org\" xmlns:sec=\"http://www.thymeleaf.org/thymeleaf-extras-springsecurity5\"\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;P√°gina Inicio\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Pagina Inicio\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Pulsa \u0026lt;a th:href=\"@{/webpublico}\"\u0026gt;aqui\u0026lt;/a\u0026gt; para ver una pagina publica.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;Si eres un usuario normal pulsa \u0026lt;a th:href=\"@{/webprivado}\"\u0026gt;aqui\u0026lt;/a\u0026gt; para ver una pagina privada\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;Si eres un administrador normal pulsa \u0026lt;a th:href=\"@{/webadmin}\"\u0026gt;aqui\u0026lt;/a\u0026gt; para ver la pagina del administrador\u0026lt;/p\u0026gt; \u0026lt;div sec:authorize=\"isAuthenticated()\"\u0026gt; Hello \u0026lt;span sec:authentication=\"name\"\u0026gt;someone\u0026lt;/span\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a th:href=\"@{/logout}\"\u0026gt;Desconectar\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ¬øA que casi parece HTML puro?. Es una de las ventajas de Thymeleaf¬†que usa¬†etiquetas HTML est√°ndar. No voy a explicar este lenguaje, pero os explicare un poco las etiquetas usadas:\n\u0026lt;a th:href=‚Äù@{/webpublico}‚Äù\u0026gt;\nCrea un enlace a la URL \u0026ldquo;/webpublico\u0026rdquo;;. Seria como poner la etiqueta \u0026#8220;\n\u0026lt;div sec:authorize=‚ÄùisAuthenticated()‚Äù\u0026gt;\nSolo se renderizara el c√≥digo en el DIV si el usuario esta autentificado. En otras palabras si el usuario no esta logueado no se mostrara en la p√°gina web lo que hay entre las etiquetas¬†DIV (de hecho no se mostrara ni el DIV).\n\u0026lt;span sec:authentication=‚Äùname‚Äù\u0026gt;someone\u0026lt;/span\u0026gt; Si el usuario esta autentificado mostrara el nombre del usuario, en caso contrario mostrara lo que haya entre las etiquetas span.¬†En este caso mostrar√≠a¬†someone.\nY con esto ya tenemos una aplicaci√≥n securizada. !S√≠!, con solo dos clases java y sus correspondientes ficheros HTML.\nPara terminar esta entrada, os dejo unos capturas de pantalla de la aplicaci√≥n:\n¬°¬° Hasta otra !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/10/11/aplicacion-crud-en-kotlin-y-springboot-2a-parte/",
	"title": "Aplicacion CRUD con REST en Kotlin y SpringBoot (2¬™ Parte)",
	"tags": ["crud", "jpa", "kotlin", "spring boot"],
	"description": "",
	"content": "Hola de nuevo, chicos.\nContinuo con la entrada¬†http://www.profesor-p.com/2018/10/11/aplicacion-crud-en-kotlin-con-springboot/¬†para ver como realizar las peticiones REST , con protocolo JSON que es el est√°ndar de facto üòâ en Kotlin.\nUna vez que ya tenemos la l√≥gica de acceso a nuestra base de datos, tenemos que hacer la parte Web. Pues, aunque os parezca incre√≠ble, esto se hace con una sola clase y ademas de muy pocas lineas.\nLa clase en cuesti√≥n es¬†ApiController.kt\n@RestController @RequestMapping(\u0026quot;/api/\u0026quot;) class ApiController { @Autowired lateinit var localeRepository: LocaleRepository @CrossOrigin(\u0026quot;http://localhost:4200\u0026quot;) @GetMapping(\u0026quot;/\u0026quot;) fun getAll(): Iterable\u0026amp;lt;Locales\u0026amp;gt; { return localeRepository.findAll();\t} ‚Äã\t..... }  Bueno, lo primero es poner la anotaci√≥n @RestController para que Spring sepa que esta clase responder√° a las peticiones REST y despues especificar la ruta que tratara esta clase con la anotaci√≥n¬†@RequestMapping(\u0026#8220;/api/\u0026#8221;).¬†Es decir esta clase responder√° en la URL: http://localhost:8080/api/\nInyectamos una referencia a la clase LocaleRepository¬†con la etiqueta @AutoWired, para poder acceder a nuestro repositorio (la base de datos, vamos). Observar el modificador¬†lateinit para que Kotlin no se queje de que la variable es null.\n Funci√≥n¬†getAll  Esta responder√° a las peticiones GET¬†en \u0026#8220;/\u0026#8221; devolviendo una lista con todos los objetos¬†tipo Locales disponibles. Observar la anotaci√≥n¬†@CrossOrigin(\u0026#8220;http://localhost:4200\u0026amp;#8221;)¬†para que se pueda acceder desde un navegador solo si el cliente esta accediendo a http://localhost:4200.\nEsto es porque, por seguridad, los navegadores no permiten hacer peticiones AJAX (con las cuales se hacen las peticiones REST en angular normalmente) a una direcci√≥n que no sea la de la URL principal. Vamos, para que si tu estas en www.google.com, la p√°gina por debajo no pueda acceder a www.elpais.com. Sin embargo con la etiqueta @CrossOrigin¬†nuestra aplicaci√≥n informara al navegador¬†de que permita acceder siempre y cuando la URL de origen sea la especificada.\nTener en cuenta que esta limitaci√≥n la imponen los navegadores Web (Chrome, Firefox, IE, etc), si accedemos directamente con otro programa a la direcci√≥n¬†http://localhost:8000/api no tendr√° efecto esta directiva.\nAqu√≠ os muestro un pantallazo de la salida de¬†PostMan:\n Funci√≥n getByQuery  @CrossOrigin(\u0026quot;http://localhost:4200\u0026quot;) @GetMapping(\u0026quot;/{codigo}/{nombre}\u0026quot;) fun getByQuery(@PathVariable codigo:String,@PathVariable nombre:String): Iterable\u0026amp;lt;Any\u0026amp;gt; { return localeRepository.findLike(\u0026quot;%\u0026quot;+codigo+\u0026quot;%\u0026quot;,\u0026quot;%\u0026quot;+nombre.toUpperCase()+\u0026quot;%\u0026quot;); }  Aqu√≠ vemos de nuevo la etiqueta @CrossOrign y la etiqueta¬†@GetMapping(\u0026#8220;/{codigo}/{nombre}\u0026#8221;) con lo cual especificamos que esta funci√≥n tratara las llamadas a la URL: http://localhost:8080/api/XX/YY¬†. Observar las etiquetas¬†@PathVariable¬†en los par√°metros de la funci√≥n para especificar que debe pasar las diferentes partes de la ruta a las variables de la funci√≥n.\nLlamamos a la funci√≥n¬†findLike de nuestro clase repositorio la cual nos devolver√° todos los objetos Locales que cumplan los criterios de la b√∫squeda.\n Funci√≥n insertar   @CrossOrigin(\u0026quot;http://localhost:4200\u0026quot;) @PostMapping(\u0026quot;/\u0026quot;)\tfun insertar(@RequestBody locales:Locales): ResponseEntity\u0026amp;lt;Any\u0026amp;gt; { if (localeRepository.existsById(locales.codigo ) )\treturn ResponseEntity(HttpStatus.CONFLICT); localeRepository.save(locales) return ResponseEntity .created( URI(\u0026quot;/api/\u0026quot;+locales.codigo)).body(\u0026quot;\u0026quot;); }  Esta funci√≥n sera invocada cuando la petici√≥n HTTP sea de tipo POST, a la ruta \u0026#8220;/\u0026#8221;, como as√≠ se indica con la etiqueta¬†@PostMapping(\u0026#8220;/\u0026#8221;).¬†En la funci√≥n incluimos la etiqueta¬†@RequestBody¬†para indicarle a Spring que en el cuerpo de la petici√≥n HTTP ira un objeto tipo Locales. en formato¬†JSON, al no especificar lo contrario.\nComprobamos si el c√≥digo ya existe, para devolver¬†una respuesta con el c√≥digo CONFLICT, con lo cual indicar√≠amos al cliente que hay un error.\nDespu√©s guardamos la entidad y devolvemos un c√≥digo CREATED, con la URL que indica el c√≥digo del pa√≠s insertado.\nEsto es un pantallazo donde se ve como insertar√≠amos un nuevo pa√≠s en la base de datos.\n Funci√≥n deleteByCodigo  @CrossOrigin(\u0026quot;http://localhost:4200\u0026quot;) @DeleteMapping (\u0026quot;/{codigo}\u0026quot;) fun deleteByCodigo(@PathVariable codigo:String):ResponseEntity\u0026amp;lt;Any\u0026amp;gt; { if (!localeRepository.existsById(codigo) )\tthrow NotFoundException(codigo) localeRepository.deleteById(codigo); return ResponseEntity( HttpStatus.OK) }  Esta funci√≥n sera llamada cuando recibamos una petici√≥n HTTP tipo DELETE, a la ruta /XX. Es decir responder√° con una petici√≥n DELETE como la del pantallazo que adjunto:\nObservar que si el pa√≠s no existe lanzamos una excepci√≥n tipo¬†NotFoundException .¬†\nDetallo la clase a continuaci√≥n:\n@ResponseStatus(HttpStatus.NOT_FOUND) class NotFoundException: RuntimeException { constructor(codigo: String?): super(\u0026quot;No encontrados registro \u0026quot;+codigo); }  Esta clase tiene la etiqueta¬†@ResponseStatus¬†que indica que tipo de respuesta recibir√° el cliente cuando se lance esta excepci√≥n. En este caso recibir√° un tipo¬†NOT_FOUND (404), con el mensaje¬†\u0026#8220;No encontrados registro xxx\u0026#8221;,¬†como se ve en la siguiente pantalla.\n Funci√≥n update   @CrossOrigin(\u0026quot;http://localhost:4200\u0026quot;) @PutMapping (\u0026quot;/{codigo}\u0026quot;) fun update(@PathVariable codigo:String,@RequestBody locales:Locales):ResponseEntity\u0026amp;lt;Any\u0026amp;gt; { if (!localeRepository.existsById(codigo) )\tthrow NotFoundException(codigo) if (!codigo.equals(locales.codigo)) throw ConflictException(codigo) localeRepository.save(locales); return ResponseEntity( HttpStatus.OK) }  Esta funci√≥n actualizara el nombre de un pa√≠s mandado. Observar que recibe en la ruta el c√≥digo del pa√≠s a modificar y en el cuerpo de la petici√≥n (Body) un objeto Locales.\nSi el c√≥digo del pa√≠s¬†mandado es diferente al del objeto, lanza una excepci√≥n tipo ConflictException¬†que es muy parecida a¬†NotFoundException¬†pero devolviendo un c√≥digo HTTP CONFLICT.\nY ya esta chicos. Para probar la aplicaci√≥n usaremos el programa realizado en Angular, que explicaba en la entrada http://www.profesor-p.com/2018/10/08/aplicacion-crud-en-angular/ , teniendo cuidado de cambiar el valor de la variable URL de la clase¬†datosserver.service.ts para que apunte a donde escucha nuestra aplicaci√≥n.\n export class DatosserverService { url:string; constructor(private _http:HttpClient) { this.url=\u0026quot;http://localhost:8080/api/\u0026quot;; } ....  Y veremos como apenas 4 sencillas clases tenemos una aplicaci√≥n totalmente funcional. ¬ø A que es incre√≠ble la potencia de Spring y m√°s si la juntamos con Kotilin?. ¬°¬° Pues a programar que es la mejor manera de aprender üòâ !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/10/08/aplicacion-crud-en-angular/",
	"title": "Aplicaci√≥n CRUD en Angular",
	"tags": ["angular", "frontend", "json", "rest"],
	"description": "",
	"content": "Buenas chavales. En esta ocasi√≥n os traigo un programa realizado en Angular, el cual a trav√©s de peticiones REST, da de alta, modifica, borra¬†y consulta los diferentes pa√≠ses disponibles en una base de datos. Lo que se viene diciendo una aplicacion CRUD.\nPor supuesto el protocolo para las comunicaciones es JSON.\nEl c√≥digo fuente lo ten√©is en: https://github.com/chuchip/crud-rest-angular\nEste programa es el frontend del realizado en JavaEE, y que explico como funciona en las entradas: http://www.profesor-p.com/2018/10/06/aplicacion-rest-en-javaee/ y¬†http://www.profesor-p.com/2018/10/07/aplicacion-rest-en-javaee-2a-parte/\nEs decir, este programa realizara sera el cliente¬†que correr√° en el navegador de los usuarios y el anterior programa estar√° corriendo en un servidor y tendr√° acceso a la base de datos correspondiente, para actualizarla seg√∫n las peticiones REST realizadas por el cliente.\nEsto es un pantallazo de como queda en modo consulta.\nY este otro, un pantallazo del alta:\nOs invito a que ech√©is un vistazo al programa, sobre todo al fichero datosserver.service.ts que es donde se se hacen las diferentes peticiones GET, POST, PUT y DELETE para interactuar con el servidor .\nSi veo inter√©s ya explicare con detalle como funciona.\nEspero vuestros comentarios y sugerencias.\n¬°¬° Hasta pronto!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/acerca/",
	"title": "Acerca de",
	"tags": [],
	"description": "",
	"content": "Este es mi blog profesional, hecho con mimo personal.\nDetr√°s del Profesor P. esta Jes√∫s Javier Puente S√°nchez. Un analista/programador, que tambi√©n es administrador de sistemas y bases de datos. Defensor del software libre, y con varios ERPs a sus espaldas, he querido aportar mi granito de arena a la comunidad, creando Anjelica.\nEn esta pagina, ir√© poniendo ejemplos (pr√°cticos a poder ser) de programaci√≥n, ademas de alguna que otra entrada sobre¬†cosas de la Inform√°tica esa, que he convertido en mi pasi√≥n desde mi m√°s tierna juventud üòâ\nPara saber m√°s de mi¬†visitar mi p√°gina de Linkedin o ver mi experiencia profesional en este mismo blog.\nPuedes contactar conmigo a trav√©s de mi correo o seguir mi cuenta de¬†Twitter¬†que es @chuchip\nTambi√©n Pod√©is ver algunos de mis proyectos en mi p√°gina de GitHub.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/24/hablando-espanol/",
	"title": "Angular ‚Äì Hablando espa√±ol",
	"tags": ["angular", "i18n", "internacionalizacion"],
	"description": "",
	"content": " Angular si no se le dice lo contrario, es ingles del bueno. Las fechas las pondr√° en su formato de mes/dia/a√±o . Los n√∫meros ser√°n con las comas con separadores de miles y los decimales con puntos. Vamos, muy ingles todo.   El problema es que no todo el mundo es ingles (aunque les pene a los ingleses ;- )) . As√≠ que en esta entrada voy a explicar como hacer que Angular se nos vuelva espa√±ol.     Lo primero es editar el fichero app.module.ts, para importar nuestros ficheros de locale (lease localizaci√≥n üòâ ) .    import localeEs from '@angular/common/locales/es'; registerLocaleData(localeEs, 'es'); Ahora tendremos que incluir un¬†provider para que cuando mostremos un valor por pantalla¬†y queramos formatearlo lo formatee con nuestro locale espa√±ol.\nDe hecho, si no ponemos este provider, Angular cascara con gran alegr√≠a, si intentamos utilizar un pipe.\n  @NgModule({ ..... providers: [ { provide: LOCALE_ID, useValue: 'es' } ], ..... })  Ahora si en nuestra aplicaci√≥n tenemos este c√≥digo:   import { Component } from '@angular/core'; @Component({ selector: 'app-prueba', template: ` \u0026lt;p\u0026gt; Numero: {{numero | number: '1.2-2'}}\u0026lt;br\u0026gt; Fecha: {{fecha | date: 'shortDate'}} \u0026lt;/p\u0026gt; ` }) export class PruebaComponent { numero=1234.5; fecha=new Date(); }   \u0026lt;p\u0026gt; Donde, como podemos ver utilizamos pipes, para formatear un numero:¬†\u0026lt;strong\u0026gt;{{numero | number: \u0026amp;#8216;1.2-2\u0026amp;#8217;}}¬†\u0026lt;/strong\u0026gt;y una fecha:¬†\u0026lt;strong\u0026gt;{{fecha | date: \u0026amp;#8216;shortDate\u0026amp;#8217;}}¬†\u0026lt;/strong\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;p\u0026gt; El resultado sera el siguiente, que como se ve, es la salida en nuestro querido lenguaje espa√±ol. \u0026lt;/p\u0026gt; \u0026lt;p\u0026gt; \u0026lt;img class=\u0026quot;alignnone size-full wp-image-336\u0026quot; src=\u0026quot;http://www.profesor-p.com/wp-content/uploads/2018/09/Captura-1.png\u0026quot; alt=\u0026quot;\u0026quot; width=\u0026quot;312\u0026quot; height=\u0026quot;125\u0026quot; srcset=\u0026quot;http://www.profesor-p.com/wp-content/uploads/2018/09/Captura-1.png 312w, http://www.profesor-p.com/wp-content/uploads/2018/09/Captura-1-300x120.png 300w\u0026quot; sizes=\u0026quot;(max-width: 312px) 100vw, 312px\u0026quot; /\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;p\u0026gt; Ahora ya solo falta que hag√°is vuestra aplicaci√≥n multi-lenguaje.¬†O sea, que se pueda elegir el idioma en que se van a presentar tanto los textos como los lenguajes. \u0026lt;/p\u0026gt; \u0026lt;p\u0026gt; Pero eso, chavales, es para nota.. y si me apetece ya lo explicare otro d√≠a. \u0026lt;/p\u0026gt;   \n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/20/angular-6-anadir-bootstrap-4-con-jquery/",
	"title": "Angular 6 ‚Äì A√±adir Bootstrap 4 con JQuery",
	"tags": ["angular", "bootstrap", "jquery", "pooper"],
	"description": "",
	"content": "Recordar lo primero que para utilizar toda la potencia de BootStrap, necesitamos tener instaladas las librerias de¬†JQuery y Popper¬†Hay varias maneras de¬†instalar estas librer√≠as.\n Localmente usando npm  Una vez estemos situados el directorio principal del proyecto, desde tu terminal preferido ejecutar las instrucciones siguientes:\nnpm install¬†bootstrap@4 jquery popper.js --save Esto nos instalara los archivos necesarios bajo el directorio¬†node-modules.¬†\nAhora debemos incluir el fichero de estilos (css) de BootStrap y las librer√≠as JavaScript de BootStrap, JQuery y Pooper.\nUna de las opciones es editando el fichero angular.json, e incluirlas¬†en los campos styles y scripts.\nEl fichero quedar√≠a algo as√≠ como esto:\n...... CODIGO ANTERIOR .... \"styles\": [ \"src/styles.css\", \"./node_modules/bootstrap/dist/css/bootstrap.min.css\" ], \"scripts\": [ \"./node_modules/jquery/dist/jquery.min.js\", \"./node_modules/bootstrap/dist/js/bootstrap.min.js\", \"./node_modules/pooper.js/dist/js/pooper.min.js\", ] ...... CODIGO POSTERIOR .... Recordar que hay que parar el servidor de node.js y volverlo a ejecutar con ng serve¬†si modificamos el fichero angular.json\nOtra manera de incluir estos ficheros seria a√±adirlos en¬†index.html, dentro de HEAD. Esto si fuera un proyecto habitual en HTML.\n .... \u0026lt;head\u0026gt; \u0026lt;link rel=\"stylesheet\" href=\"../node_modules/bootstrap/dist/css/bootstrap.min.css\"\u0026gt; \u0026lt;script src=\"../node_modules/jquery/dist/jquery.min.js\"\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\"../node_modules/bootstrap/dist/js/bootstrap.min.js\"\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\"../node_modules/pooper.js/dist/js/pooper.min.js\"\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; ....   Usando CDN  En este caso, no bajamos nada locamente y lo que hacemos es incluir los enlaces hacia los correspondientes ficheros en interner.\nAs√≠, como explican en la pagina de¬†BootStrap CDN, a√±adir√≠amos esta linea para incluir bootstrap versi√≥n 4.1.3\n\u0026lt;span class=\"nt\"\u0026lt;link\u0026lt;/span \u0026lt;span class=\"na\"rel=\u0026lt;/span\u0026lt;span class=\"s\"\"stylesheet\"\u0026lt;/span \u0026lt;span class=\"na\"href=\u0026lt;/span\u0026lt;span class=\"s\"\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css\"\u0026lt;/span \u0026lt;span class=\"na\"integrity=\u0026lt;/span\u0026lt;span class=\"s\"\"sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\"\u0026lt;/span \u0026lt;span class=\"na\"crossorigin=\u0026lt;/span\u0026lt;span class=\"s\"\"anonymous\"\u0026lt;/span\u0026lt;span class=\"nt\"\u0026gt;\u0026lt;/span \u0026lt;span class=\"nt\"\u0026lt;script \u0026lt;/span\u0026lt;span class=\"na\"src=\u0026lt;/span\u0026lt;span class=\"s\"\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\"\u0026lt;/span \u0026lt;span class=\"na\"integrity=\u0026lt;/span\u0026lt;span class=\"s\"\"sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\"\u0026lt;/span \u0026lt;span class=\"na\"crossorigin=\u0026lt;/span\u0026lt;span class=\"s\"\"anonymous\"\u0026lt;/span\u0026lt;span class=\"nt\"\u0026gt;\u0026lt;/script\u0026gt;\u0026lt;/span Y esta linea para incluir JQuery y Pooper\n\u0026lt;span class=\"nt\"\u0026lt;script \u0026lt;/span\u0026lt;span class=\"na\"src=\u0026lt;/span\u0026lt;span class=\"s\"\"https://code.jquery.com/jquery-3.3.1.slim.min.js\"\u0026lt;/span \u0026lt;span class=\"na\"integrity=\u0026lt;/span\u0026lt;span class=\"s\"\"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\"\u0026lt;/span \u0026lt;span class=\"na\"crossorigin=\u0026lt;/span\u0026lt;span class=\"s\"\"anonymous\"\u0026lt;/span\u0026lt;span class=\"nt\"\u0026gt;\u0026lt;/script\u0026gt;\u0026lt;/span \u0026lt;span class=\"nt\"\u0026lt;script \u0026lt;/span\u0026lt;span class=\"na\"src=\u0026lt;/span\u0026lt;span class=\"s\"\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\"\u0026lt;/span \u0026lt;span class=\"na\"integrity=\u0026lt;/span\u0026lt;span class=\"s\"\"sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\"\u0026lt;/span \u0026lt;span class=\"na\"crossorigin=\u0026lt;/span\u0026lt;span class=\"s\"\"anonymous\"\u0026lt;/span\u0026lt;span class=\"nt\"\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/span   ¬°¬°Y a trabajar con BootStrap y crear aplicaciones profesionales!!  "
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/19/curso-angular-6-reactivo/",
	"title": "Curso Angular 6 ‚Äì Reactivo!",
	"tags": ["angular", "angular6", "reactivo"],
	"description": "",
	"content": "Antes de continuar con el curso quiero dejar claro que Angular es¬†reactivo.\n¬ø Que significa eso ?.\nPues b√°sicamente que cualquier cambio que se haga en el modelo sera transmitido a la vista y viceversa. El modelo, enti√©ndase que son nuestros _Componentes.¬†_Es decir, nuestras clases definidas en los ficheros TypeScript. La vista es el c√≥digo HTML que se visualizara en nuestro navegador.\nAs√≠, si cambiamos el valor de un campo¬†INPUT¬†del HTML, que este unido con la directiva¬†[(ngModel)]¬†a una variable. Esa variable se modificara en tiempo real.\nObs√©rvese el siguiente c√≥digo:\n import { Component} from '@angular/core'; @Component({ selector: 'app-datos-mes', template: '\u0026lt;p\u0026gt;Teclea aqu√≠: \u0026lt;input [(ngModel)]=\"variable\"/\u0026gt; \u0026lt;br\u0026gt;lo que estas tecleando: {{variable}} \u0026lt;/p\u0026gt;', }) export class DatosMesComponent{ variable:string=\"\"; }  Esto nos mostrar√≠a una pantalla como esta:   .   Al modificar el valor del input, cambiara el valor mostrado.     En cuanto tecleemos una letra, el valor de¬†variable¬†cambiara y, por lo tanto, el valor mostrado con¬†{{variable}}¬†tambi√©n cambiara.   Esto funciona a todos los niveles. Incluyendo las condiciones.    import { Component} from '@angular/core'; @Component({ selector: 'app-datos-mes', template: `\u0026lt;p\u0026gt;Teclea aqu√≠: \u0026lt;input [(ngModel)]=\"variable\"/\u0026gt; \u0026lt;br\u0026gt;lo que estas tecleando: {{variable}} \u0026lt;/p\u0026gt; \u0026lt;div *ngIf=\"variable=='0'\"\u0026gt;Variable es cero\u0026lt;/div\u0026gt; `, }) export class DatosMesComponent{ variable:string=\"\"; }  As√≠, en el momento que el valor de¬†variable¬†sea igual a \u0026#8220;0\u0026#8221; Nos mostrara el texto Variable es cero.¬†Como se puede ver en el siguiente v√≠deo .    http://www.profesor-p.com/wp-content/uploads/2018/09/prueba4.mp4  "
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/19/curso-angular-6-formularios-1/",
	"title": "Curso Angular 6 ‚Äì Formularios (1)",
	"tags": ["angular", "formularios"],
	"description": "",
	"content": "En¬†la aplicaci√≥n que estamos desarrollando, de la cual, os recuerdo ten√©is el c√≥digo fuente en¬†https://github.com/chuchip/yagesclient-angular, tenemos que poder solicitar al usuario el ejercicio sobre el que vamos a realizar la consulta.\nPara introducir ese dato, vamos a utilizar un formulario muy simple, pero que nos servir√° para entender algunos conceptos b√°sicos de Angular.\nTrabajando con el componente AppComponent, definido en el fichero src/app/app.component.ts nos centramos primero en¬†el c√≥digo HTML¬†el cual,¬†es el siguiente:\napp.component.html\n\u0026lt;form (ngSubmit)=\"buscar()\"\u0026gt; \u0026lt;label value=\"Introduzca a√±o\"\u0026gt;Introduzca A√±o \u0026lt;/label\u0026gt; \u0026lt;input [(ngModel)]=\"ejercicio\" /\u0026gt; \u0026lt;span *ngIf=\"msgError !=''\" \u0026gt; {{msgError}} \u0026lt;/span\u0026gt; \u0026lt;div\u0026gt;\u0026lt;button \u0026gt;Consultar\u0026lt;/button\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; En la etiqueta form con el modificador¬†(ngSubmit)=\u0026#8221;buscar()\u0026#8221;¬†indicaremos que llame a la funci√≥n buscar del componente¬†AppComponent¬†cuando se envi√© el formulario con el bot√≥n correspondiente.\nEn el input, vemos la etiqueta [(ngModel)] ,¬†a la que le asignamos el valor¬†\u0026#8220;ejercicio\u0026#8221;. Esta etiqueta sirve para unir el valor de la variable¬†ejercicio con la vista. Esa uni√≥n es bidireccional; si se modifica el valor de la variable en¬†AppComponent¬† se cambiara el valor en la vista y viceversa. Estos cambios son inmediatos, es decir en cuanto introduzcamos una letra (o la borremos) en la pagina web, el valor de la variable¬†ejercicio¬†cambiara inmediatamente.\nLa¬†variable, esta definida como otra cualquiera, sin ning√∫n tipo de decorador o etiqueta especial.\nA continuaci√≥n, en¬†la etiqueta¬†span vemos la directiva¬†*ngIf . Con ella indicamos que la etiqueta¬†span¬†y todo lo que haya dentro de ella solo se debe procesar (y por lo tanto mostrar) si se cumple la condici√≥n indicada.\nEn este caso, si la variable¬†msgError es diferente de \u0026#8220;\u0026#8221; (o sea si no esta vac√≠a)¬†se ejecutara la etiqueta¬†span. En caso contrario, simplemente saltara hasta donde se cierre esa etiqueta con \nDentro de¬†span encontramos el texto¬†{{msgError}}. Con las dobles llaves le indicamos a Angular que lo que hay en su interior es una variable de nuestro¬†_componente¬†_que debe mostrar.¬†Digamos que es un poco como la directiva¬†ngModel¬†pero de solo salida. De tal modo que si cambia el valor de la variable, cambiara el valor mostrado en nuestro navegador.\nLa variable entre las dobles llaves puede ser de cualquier tipo. Una cadena de texto, un objeto, un n√∫mero, etc.\napp.component.ts\nexport class AppComponent {  ejercicio=2018; ejercicioActual=0; msgError=\"\"; constructor( private router: Router) { } buscar(): void { let num:number=+this.ejercicio; if (num == 0 ) { this.msgError=\"Ejercicio no ES valido\"; return; } this.msgError=\"\"; this.ejercicioActual=this.ejercicio; this.router.navigate([''+this.ejercicioActual]) } } De este modo, cuando muestre el formulario en la p√°gina web, el input aparecer√° con el valor 2018.\nObservemos ahora la funci√≥n buscar.¬†Esa funci√≥n, como hemos dicho,¬†sera llamada¬†cuando pulsemos el bot√≥n de nuestro formulario.\nLo primero que hacemos es asignar a una variable local, a la que hemos llamado¬†num el valor de¬†la variable global ejercicio. Obs√©rvese la palabra¬†this antes de ejercicio, para indicar que esa variable es global. Si pondr√≠amos¬†ejercicio¬†sin la palabra reservada this, Angular dar√≠a un error, avisando de que esa variable no existe.\nSi nos fijamos vemos que se pone un m√°s (+) antes de¬†this.ejercicio¬† esto es una facilidad que nos da JavaScript para transformar una variable a tipo num√©rico. De ese modo, si el usuario ha introducido en el campo de texto algo que no sea un numero, por ejemplo \u0026#8220;pepe\u0026#8221;, como no se podr√° transformar¬†this.ejercicio¬†a un n√∫mero, el valor de¬†num¬†sera igual a cero.\nEn el caso de que¬†num sea cero, ponemos la variable global this.msgError¬†con el texto de error y saldr√° de la funci√≥n.\nEn caso de que num sea diferente a cero ponemos la variable¬†this.msgError¬†a \u0026#8220;\u0026#8221; (cadena vac√≠a) , y la variable¬†ejercicioActual la hacemos igual¬†a¬†ejercicio, para despu√©s navegar a la ruta¬†ejercicioActual, llamando a la funci√≥n¬†navigate del objeto this.router¬†que Angular habr√° inyectado¬†en nuestra clase al haber puesto en el constructor que recibimos la variable¬†router del tipo¬†Router.\nEnti√©ndase que¬†_navegar¬†_es a todos efectos como si el usuario pusiera en la barra de navegaci√≥n lo que nosotros hemos programado. En este caso, si se ha introducido el valor¬†2018¬†en el formulario, ir√≠amos a la direcci√≥n http://localhost:8080/2018\nResumiendo, cuando se pulse el bot√≥n¬†Consultar, si el usuario introduce un n√∫mero valido en el formulario, navegaremos al ejercicio tecleado. En caso contrario aparecer√° el mensaje¬†Ejercicio no ES valido.\n¬°¬° Nos vemos en la pr√≥xima clase üòâ !!\n\u0026nbsp;\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/16/aplicacion-en-angular-rutas/",
	"title": "Aplicaci√≥n en Angular ‚Äì Rutas",
	"tags": ["angular", "angular6", "curso", "routes"],
	"description": "",
	"content": "Una vez he explicado en la anterior entrada¬†como inicializa Angular la aplicaci√≥n, voy a explicar como hacer para que esta pueda aceptar par√°metros a trav√©s de la URL introducida en el navegador. B√°sicamente, lo que deseo hacer es que, suponiendo que nuestra aplicaci√≥n este corriendo en http://localhost:4200/ (es la direcci√≥n por defecto en la que escucha Node.js cuando lo lanzamos con el comando ng serve¬†), si vamos a la direcci√≥n http://localhost:4200/2018¬† nos muestre las ventas del ejercicio 2018. A su vez, si vamos a la direcci√≥n¬†http://localhost:4200/2018/3 nos deber√° mostrara los datos del ejercicio 2018 y en el detalle los datos del mes 3. Es decir, el primer n√∫mero sera el ejercicio y el segundo el mes. Si no se pone el segundo par√°metro iremos al mes 1 del ejercicio mandado. En el caso de no poner ning√∫n par√°metro, el programa nos preguntara el ejercicio con el correspondiente formulario.\nEn Angular, las rutas se definen creando un fichero TypeScript,¬†al que las buenas normas, nos aconsejan llamar app-routing.module.ts. Este fichero se dejara en el directorio src/app/.\nVeamos el fichero creado en nuestra aplicaci√≥n:\n import { NgModule } from '@angular/core'; import { CommonModule } from '@angular/common'; import { RouterModule, Routes } from '@angular/router'; import {DatosEjercicioComponent} from './datos-ejercicio/datos-ejercicio.component'; const routes: Routes = [ {path: ':year', component: DatosEjercicioComponent }, {path: ':year/:month', component: DatosEjercicioComponent } ]; @NgModule({ imports: [ CommonModule, RouterModule.forRoot(routes) ], exports: [ RouterModule ], declarations: [] }) export class AppRoutingModule { }  Como se ve, lo primero tenemos una serie de imports que necesitaremos.¬†A continuaci√≥n declaramos una variable, a la que llamamos routes¬† (le podriamos haber llamado mis_rutitas_chulis pero es por ser serios üòõ ) y que es un array de objetos tipo¬†Routes .¬†En esa variable es donde vamos a definir nuestras rutas.\nAs√≠, el primer elemento del array tiene el elemento path cuyo valor es \u0026#8220;year\u0026#8221;, y el elemento component cuyo valor es: DatosEjercicioComponent. Esto, Angular lo traducir√° por: cuando la URL tenga un √∫nico par√°metro (year) carga el componente¬†DatosEjercicioComponent.¬†El especificar que es un par√°metro lo hacemos con los dos puntos (\u0026#8220;:\u0026#8221;) antes de la palabra :year. Y el nombre de esa variable podremos capturarla y utilizarla en nuestro componente DatosEjercicioComponent.\nEn el caso de que la linea fuera:\n{path: '/paco', component: DatosEjercicioComponent }, Angular cargar√≠a el componente indicado cuando fu√©ramos a la ruta http://localhost:4200/paco . Ojo, si la direcci√≥n fuera, otra, como http://localhost:4200/paco/el_guapo no funcionaria.\nAclarar, ademas, que DatosEjercicioComponent es el componente que hemos definido en¬†la linea import {DatosEjercicioComponent} from \u0026#8216;./datos-ejercicio/datos-ejercicio.component\u0026#8217;. Si no tuvieramos ese import Angular nos dar√≠a un error.\nLa carga de la variable route, en el¬†modulo de rutas de Angular se hace con la linea: RouterModule.forRoot(routes)\nHay maneras de cargar diferentes rutas para una misma aplicaci√≥n, pero no vamos a hablar de ello en este curso.\nPara especificar que debe cargar el componente marcado por la ruta, debemos incluir en el c√≥digo HTML la siguiente etiqueta: . Esa etiqueta incrustara el correspondiente componente de la ruta, como hacia la etiqueta  con el componente AppComponent en la anterior entrada.\nAhora veamos parte de nuestra clase datos-ejercicio.component.ts\nimport { ActivatedRoute, Router} from '@angular/router'; @Component({ selector: 'app-datos-ejercicio', templateUrl: './datos-ejercicio.component.html', styleUrls: ['./datos-ejercicio.component.css'] }) export class DatosEjercicioComponent { constructor( private route: ActivatedRoute, private router: Router, private _datosserver: DatosserverService) { } ngOnInit() { this.year = +this.route.snapshot.paramMap.get('year'); .... Como vemos, lo primero es importar los componentes para tratar rutas. Despu√©s especificamos que nuestra clase es del tipo¬†componente con la etiqueta @Component para despu√©s definirla.\nLo primero que encontramos es la palabra constructor, con esa palabra definimos un tipo de funci√≥n especial dentro de nuestra clase que sera llamada cuando el objeto sea creado. En nuestro ejemplo, cuando Angular encuentre la etiqueta  y deba cargar nuestra clase, lo primero que har√° sera ejecutar el c√≥digo existente en esa funci√≥n.\nEn este caso, como veis, no hay nada dentro de la funci√≥n, sin embargo si que recibe una serie de par√°metros. Esas variables estar√°n disponibles dentro de nuestra clase, a nivel global. Eso es una caracter√≠stica de TypeScript, las variables recibidas en un constructor estar√°n disponibles para toda la clase y no solo dentro del constructor como ocurre en todos los dem√°s tipos de funciones.\nEn la funci√≥n ngOnInit, se le asigna a la variable global year el valor recibido por el componente de la ruta. Observ√©se el s√≠mbolo m√°s (+) . Esto convertir√° el texto recibido en un n√∫mero.\nLa funci√≥n ngOnInit es una funci√≥n especial de Angular y sera llamada una vez el componente a sido construido (o sea, despu√©s de llamar al constructor), pero antes de incrustarlo (por as√≠ decirlo) en la pantalla dentro del c√≥digo HTML. Hay otra serie de funciones especiales que pod√©is consultar en la pagina oficial de Angular.\nY con esto termino esta entrada hablando sobre las rutas en Angular. Pod√©is profundizar m√°s en este tema en la documentaci√≥n oficial de Angular¬†o visitando este otro excelente manual https://academia-binaria.com/paginas-y-rutas-angular-spa/\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/14/aplicacion-en-angular-inicializando/",
	"title": "Aplicaci√≥n en Angular ‚Äì Inicializando aplicaci√≥n",
	"tags": ["angular", "angular 6", "frontend", "html"],
	"description": "",
	"content": "Continuando con la entrada donde instalaba Angular, seguimos desarrollando la aplicaci√≥n que detallo en esta p√°gina.\nUna vez tenemos creado el esqueleto de nuestro programa, con el comando \u0026#8220;ng new\u0026#8221; ,¬† entraremos al directorio src.¬†En este directorio es donde realmente vamos a trabajar.\nLos dem√°s directorios son donde est√°n las librer√≠as y utilidades que nuestra aplicaci√≥n usara pero que son propias de Angular y nosotros no las tocaremos (al menos en este ejemplo).\nPrimero vamos a explicar los pasos que sigue Angular para ejecutar nuestra reci√©n creada aplicaci√≥n.\nCuando ejecutamos el comando \u0026#8220;ng serve \u0026#8211;open\u0026#8221; desde nuestro directorio yagesclient,Angular, una vez que ha compilado, comprobado dependencias y otra serie de tareas, en las que no voy a entrar, lee el fichero src/main.ts, el cual detallo a continuaci√≥n.\nsrc/main.ts\nimport { enableProdMode } from '@angular/core'; import { platformBrowserDynamic } from '@angular/platform-browser-dynamic'; import { AppModule } from './app/app.module'; import { environment } from './environments/environment'; if (environment.production) { enableProdMode(); } platformBrowserDynamic().bootstrapModule(AppModule) .catch(err =\u0026gt; console.log(err)); En este fichero se importan (import)¬†es decir, se cargan¬†una serie de ficheros para despu√©s arrancar nuestra aplicaci√≥n. con la ultima linea:\nplatformBrowserDynamic().bootstrapModule(AppModule) .catch(err =\u0026gt; console.log(err)); Como se puede intuir este comando ejecuta una funci√≥n, a la que se le pasa el par√°metro¬†AppModule. No voy a entrar a explicar los detalles , pues se escapa al √°mbito de este curso, lo que voy a¬†explicar es donde definimos ese par√°metro¬†AppModule¬†.\nLa clave esta en la linea:\nimport { AppModule } from './app/app.module'; Ah√≠ importamos ese par√°metro,¬†especificando¬†que lo debe cargar del fichero \u0026#8220;./app/app.module.ts\u0026#8221;. La extensi√≥n¬†ts¬†(TypeScript) la pone Angular pues busca un fichero de ese tipo, pero nosotros no debemos ponerlo.\nEn este¬†fichero est√°n definidos los¬†m√≥dulos de nuestra aplicaci√≥n.\nEl contenido del fichero es el siguiente:\nsrc/app/app.module.ts\nimport { BrowserModule } from '@angular/platform-browser'; import { NgModule } from '@angular/core'; import { AppComponent } from './app.component'; @NgModule({ declarations: [ AppComponent ], imports: [ BrowserModule, ], providers: [], bootstrap: [AppComponent] }) export class AppModule { } Este fichero define un modulo, porque as√≠ se lo especificamos a¬†Angular¬†con la etiqueta¬†@NgModule. El modulo se llamara¬†AppModule, que no deja de ser una clase u objeto, que exportamos a la vez que creamos,¬†con la sentencia:\nexport class AppModule { } Esta clase AppModule¬†es el objeto que import√°bamos en nuestro anterior fichero con la linea import { AppModule } from \u0026#8216;./app/app.module\u0026#8217;¬†\nEl nombre de la clase podr√≠a haber sido perfectamente miMaravillosaClase¬†con lo cual habr√≠amos puesto:\nexport class miMaravillosaClase¬†{ } Y en el import seria **import { miMaravillosaClase¬†} from \u0026#8216;./app/app.module\u0026#8217;\n**\nLo que quiero resaltar es que el nombre de la clase¬†no¬†debe coincidir con el del fichero ni tiene porque acabar en Module, sin embargo, por claridad en el c√≥digo y buenas practicas los m√≥dulos siempre se terminan con Module y coincide el nombre del modulo con la del fichero.\nVolviendo al fichero /app/app.module.ts, centr√©monos en el siguiente¬†import.\nimport { AppComponent } from './app.component'; Donde importamos el componente¬†AppComponent .¬†Este¬†componente esta definido en el fichero¬†\u0026#8216;./app.component.ts\u0026#8217;\nsrc/app/app.component.ts\nimport { Component } from '@angular/core'; @Component({  selector: 'app-root',  templateUrl: './app.component.html', styleUrls: ['./app.component.css'] }) export class AppComponent { title = 'Cliente de Aplicacion de prueba'; } Aqu√≠ definimos un¬†componente (obs√©rvese la etiqueta¬†@Component)¬†que sera una clase llamada¬†AppComponent anteriormente importada.\nCon la etiqueta¬†selector indicamos como llamaremos a este componente en nuestros fichero HTML (en la parte de la vista, vamos). Es decir, se llamara app-root.\nCon¬†templateUrl indicaremos el fichero html a cargar cuando pongamos la etiqueta¬†app-root en algun otro fichero html que Angular ya haya cargado (index.html en nuestro ejemplo). Con styleUrls indicaremos la hoja de estilo a cargar para el anterior fichero html.\nUn¬†componente en angular no es sino una objeto que nosotros definimos. Ese objeto tendr√° un c√≥digo HTML, su hoja de estilos (CSS) y por supuesto JavaScript.\n¬ø JavaScript ?. S√≠, porque aunque en angular nosotros usamos TypeScript,¬†a¬†la hora de compilar el programa, ese c√≥digo se¬†convertir√°¬†en JavaScript, que es el lenguaje que entienden los navegadores (Chrome, Firefox, Opera, IE, etc).  Nuestra aplicaci√≥n, como vemos,¬†ya tiene su primer¬†_componente¬†_creado, el objeto¬†AppComponent, y este componente es usado por el fichero¬†index.html, del cual ense√±amos una versi√≥n simplificada a continuaci√≥n.\n/src/index.html\n\u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\"en\"\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\"utf-8\"\u0026gt; \u0026lt;title\u0026gt;Yagesclient\u0026lt;/title\u0026gt; \u0026lt;base href=\"/\"\u0026gt; \u0026lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"\u0026gt; \u0026lt;link rel=\"icon\" type=\"image/x-icon\" href=\"favicon.ico\"\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;app-root\u0026gt;\u0026lt;/app-root\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Como se puede ver es un fichero HTML¬†casi normal. Lo √∫nico que nos debe llamar la atenci√≥n es¬†la etiqueta:\n . ¬ø Os suenan ?. Exacto, son las que hemos definido con el par√°metro¬†selector: \u0026#8216;app-root\u0026#8217;.\nResumiendo, cuando Angular ejecute nuestra aplicaci√≥n cargara el fichero index.html y cuando encuentre las etiqueta  sabr√° que debe incluir el componente definido en el fichero src/app/app.component.ts.\nLo que incrustara sera el contenido del fichero html definido en la anteriormente citada etiqueta templateUrl, ademas de instanciar (crear) el objeto¬†AppComponent.\nSin entrar en detalles, para ver la relaci√≥n entre la clase y el fichero HTML, o dicho de otra manera, la relaci√≥n vista / controlador, obs√©rvese que dentro de la clase AppComponent se crea la variable¬†title asign√°ndole¬†el valor \u0026#8221;Cliente de Aplicacion de prueba\u0026#8216;. Como en el fichero src/app.component.html tenemos solo la siguiente linea\nEsto es el titulo {{ title }} El c√≥digo¬† del fichero index.html sera sustituido por:\nEsto es el titulo Cliente de Aplicacion de prueba Y con esto termino esta entrada, en la pr√≥xima hablare de las rutas. Espero haberme explicado bien. En caso contrario no dud√©is en realizar todas las preguntas necesarias.\n\u0026nbsp;\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/13/aplicacion-en-angular-instalacion-y-configuracion-basica/",
	"title": "Aplicaci√≥n en Angular ‚Äì Instalaci√≥n y configuraci√≥n b√°sica",
	"tags": ["angular", "rest"],
	"description": "",
	"content": "En anteriores entradas se creo la parte del servidor de nuestra aplicaci√≥n¬†.¬†Para la parte cliente o frontend usaremos Angular 6.\nEl c√≥digo fuente del programa lo ten√©is, como siempre,¬†en mi p√°gina de GitHub.\nLo primero sera instalar Angular, para ello tenemos¬†un excelente manual de¬†como hacerlo en la p√°gina web de Angular. B√°sicamente es instalar el servidor de aplicaciones Node.js. y su aplicaci√≥n incluida¬†npm (es un solo ejecutable) de¬†https://nodejs.org/en/download/¬†y luego, en una shell¬†(cmd en windows), ejecutar:\nnpm install -g @angular/cli lo cual nos instalara Angular, bajando de Internet todos los ficheros necesarios (que son bastantes).\nAhora crearemos nuestro proyecto a trav√©s del interprete de comandos (shell) de Angular (Angular CLI) que acabamos de instalar.\nPara ello abriremos un terminal en nuestro sistema operativo (Windows con CMD y Linux con una shell), nos posicionaremos en la carpeta donde vamos a crear nuestro proyecto y ejecutaremos el siguiente comando:\nng new yagesclient Este comando creara la estructura b√°sica (o template que dir√≠an los ingleses) para el proyecto. Es normal que le cueste un rato, ya que descarga muchos ficheros¬†de internet .\nEsta es una salida t√≠pica del comando ng new¬†en una ventana windows:\nY podemos ver que nos ha creado el directorio yagesclient,¬†debajo del directorio donde est√°bamos:\nAhora mismo ya podr√≠amos ver esa aplicaci√≥n m√≠nima que hemos creado en nuestro navegador. Para ello, lanzamos nuestro servidor web con el comando:\nng serve --open  Este comando nos mostrara la siguiente salida:\nCambien abrir√° una ventana de nuestro navegador donde podremos ver nuestra aplicaci√≥n.\nPulse encima de la imagen para ampliarla\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\nF√°cil, ¬ø verdad ?. Como se puede observar con muy poco esfuerzo se ha creado una aplicaci√≥n en Angular, totalmente funcional que el servidor de Node¬†que hemos instalado sirve.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/06/aplicacion-en-spring-rest-y-angular-5a-parte/",
	"title": "Aplicaci√≥n en Spring REST y Angular ‚Äì 5¬™ Parte",
	"tags": [],
	"description": "",
	"content": "En esta ultima parte de la parte servidor hablare de como se crean los objetos que en el anterior articulo se devolv√≠an.\nEstos objetos eran del tipo _VentasAnoBean¬†_y un ArrayList de _VentasSemanaBean.¬†_Para conseguirlos se llamaban a sendas funciones en¬†la clase YagesBussines,¬†que eran las que constru√≠an esos objetos.\nEmpezare describiendo la clase\n@Component public class YagesBussines { @Autowired CalendarioRepositorioService calendarioRepositorio; @Autowired HistVentasRepository histVentasRepository; @Autowired DataSource dataSource; @Autowired private JdbcOperations jdbc; @Bean public JdbcTemplate jdbcTemplate() { return new JdbcTemplate(dataSource); } ..... Lo primero, marcamos nuestra clase como @Component para que Spring la cree y este disponible para inyectarla en otras clases. De otra manera nuestra clase¬†YagesController¬† no podr√≠a usarla.\nAhora inyectamos los diferentes objetos que vamos a usar, incluyendo el objeto jdbc que es de tipo¬†JdbcOperations .¬†Para que Spring pueda crear ese objeto debemos tener la funci√≥n¬†jdbcTemplate, que, usando la variable¬†dataSource¬†. devolver√° un objeto tipo JdbcTemplate el cual implementa el interface¬†JdbcOperations para usarlo en la variable¬†jdbc, ya que la funci√≥n esta¬†marcarla con la anotaci√≥n @Bean y eso har√° que Spring sepa de donde sacar un objeto tipo JdbcOperations.\n ##### Funci√≥n:¬†getVentasAno  public VentasAnoBean getVentasAno(int ano) { List\u0026lt;VentasMesBean\u0026gt; cal = getKilosPorMes(ano); VentasAnoBean ventasAno = new VentasAnoBean(); cal.forEach((v) -\u0026gt; { ventasAno.addMes(v); }); if (ventasAno.getKilosVentaAct() == 0) { throw new VentasNotFoundException(ano); } return ventasAno; }  La funci√≥n¬†getVentasAno, simplemente llama a la funci√≥n¬†getKilosPorMes,¬†la cual devuelve una lista de objectos tipo¬†VentasMesBean (List),¬†para despu√©s ir a√±adi√©ndolo al objeto tipo VentasAno.\nObs√©rvese que la funci√≥n comprueba si el acumulado de kilos de venta,¬†a trav√©s de la funci√≥n getKilosVentaAct(), es igual a cero. Si es cero, lanza una excepci√≥n del tipo¬†VentasNotFoundException\nEsa excepci√≥n se define en el paquete yages.yagesserver.bussines.\n@ResponseStatus(HttpStatus.NOT_FOUND) class VentasNotFoundException extends RuntimeException { private static final long serialVersionUID = 1L; public VentasNotFoundException(int ano) { this(ano, 0); } public VentasNotFoundException(int ano, int mes) { super(\"No encontradas ventas para a√±o '\" + ano + \"'\"+ (mes\u0026gt;0?\" y Mes: \"+mes:\"\")); } public VentasNotFoundException(String msgError,int ano, int mes) { super(\"Error al buscar ventas para a√±o '\" + ano + \"'\"+ (mes\u0026gt;0?\" y Mes: \"+mes:\"\")+\" \\n Error: \"+msgError); } } Lo destacable de esta clase es la anotaci√≥n¬†@ResponseStatus, la cual har√° que cuando se lance, a trav√©s de una sentencia _throw,¬†_sea capturada por Spring de tal manera que la respuesta a la peticion HTTP sea lo indicado, en este caso un¬†HttpStatus.NOT_FOUND (el tipico 404: P√°gina no encontrada). De esta manera si la consulta no devuelve ning√∫n dato en vez de devolver un null, devolveremos un mensaje de error para que el cliente pueda tratarlo m√°s f√°cilmente.\nEn otras palabras, cuando se lance una excepci√≥n del tipo VentasNotFoundException el cliente recibir√° un error del tipo 404 (NOT FOUND).\nLa funci√≥n¬†getKilosPorMes, realiza una serie de consultas a trav√©s de¬†jdbc.¬†\npublic List\u0026lt;VentasMesBean\u0026gt; getKilosPorMes(int ano) { List\u0026lt;VentasMesBean\u0026gt; cal = jdbc.query( \"SELECT c.cal_ano,c.cal_mes , sum(hve_kilven) as kilosVenta,sum(hve_impven) as impVenta,sum(hve_impgan) as impGanancia \" + \"FROM Calendario c, histventas h \" + \" where c.cal_ano = ?\" + \" and h.hve_fecini between c.cal_fecini and c.cal_fecfin \" + \" and h.hve_fecfin between c.cal_fecini and c.cal_fecfin \" + \" group by cal_ano,cal_mes \" + \" order by c.cal_mes\", new Object[] { ano }, (rs, rowNum) -\u0026gt; new VentasMesBean(rs.getInt(\"cal_ano\"),rs.getInt(\"cal_mes\"),rs.getDouble(\"kilosVenta\"),rs.getDouble(\"impVenta\"),rs.getDouble(\"impGanancia\")) ); List\u0026lt;VentasMesBean\u0026gt; calAnt = jdbc.query( \"SELECT c.cal_ano,c.cal_mes , sum(hve_kilven) as kilosVenta,sum(hve_impven) as impVenta,sum(hve_impgan) as impGanancia \" + \"FROM Calendario c, histventas h \" + \" where c.cal_ano = ?\" + \" and h.hve_fecini between c.cal_fecini and c.cal_fecfin \" + \" and h.hve_fecfin between c.cal_fecini and c.cal_fecfin \" + \" group by cal_ano,cal_mes \" + \" order by c.cal_mes\", new Object[] { ano - 1}, (rs, rowNum) -\u0026gt; new VentasMesBean(rs.getInt(\"cal_ano\"),rs.getInt(\"cal_mes\"),rs.getDouble(\"kilosVenta\"),rs.getDouble(\"impVenta\"),rs.getDouble(\"impGanancia\")) ); cal.forEach((v) -\u0026gt; { for (VentasMesBean vAnt : calAnt) { if (v.getMes() == vAnt.getMes()) { v.setKilosVentaAnt(vAnt.getKilosVentaAct()); v.setImpVentaAnt(vAnt.getImpVentaAct()); v.setGananAnt(vAnt.getGananAct()); } } }); return cal; }  Obs√©rvese el uso intensivo de sentencias¬†lamba.¬† Os recuerdo que ten√©is un par de entradas sobre como este tema aqu√≠ y aqu√≠\nEsta funci√≥n consulta primero todas las ventas del a√±o mandado, meti√©ndolas en un objeto List, despu√©s hace la misma consulta sobre el a√±o anterior al mandado, metiendo el resultado en otro objeto List. Despu√©s recorre la primera lista a, con la funci√≥n forEach, y si existe el mismo mes en el segundo objeto, establece los par√°metros del a√±o anterior en el primer objeto VentasMesBean. Por ultimo devuelve la lista de objetos (List)\n ##### Funci√≥n: getDatosSemana  Esta funci√≥n es la llamada cuando queremos buscar los datos de venta de un a√±o y semana. Ofreciendo, semana por semana, los datos del periodo solicitado.\npublic ArrayList\u0026lt;VentasSemanaBean\u0026gt; getDatosSemana(int mes, int ano) { Calendario calAnterior = null; Optional\u0026lt;Calendario\u0026gt; calOpc = calendarioRepositorio.getCalendario(new CalendarioKey(mes, ano - 1)); if (calOpc.isPresent()) { calAnterior = calOpc.get(); try { ajustaFechas(calAnterior, ano - 1, mes); } catch (ParseException e) { throw new VentasNotFoundException(e.getMessage(), ano, mes); } } ...... } No es mi idea explicar paso a paso la l√≥gica de esta funci√≥n solo incidir en el uso de JPA, usando la clase CalendarioRepositorioService, que se limita a usar la clase generada automagicamente por Spring, la cual implementara el interface CalendarioRepository.\nEl c√≥digo por si est√°is interesados en curiosear como se buscan los datos lo ten√©is en mi pagina de GitHub\nY con esto termino las entradas, explicando la parte servidor de esta aplicaci√≥n.\nEspero que haya sido de utilidad y no os perd√°is las siguientes sobre como hacer la parte cliente con Angular.\n¬°¬° Hasta pronto !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/05/desarrollando-aplicaciones-java-ee-en-netbeans-9/",
	"title": "Desarrollando aplicaciones Java EE en NetBeans 9",
	"tags": ["java", "Java ee", "netbeans9", "tomcat"],
	"description": "",
	"content": "El recien salido NetBeans 9, es un excelente IDE, con soporte para Java 10 y 11, y con otra serie de caracter√≠sticas muy interesantes. Sin embargo, por temas de licencias con Oracle que es el due√±o del antiguo NetBeans, solo tiene soporte para¬†Java Standard Edition, no pudiendo, en teor√≠a, hacer aplicaciones para Java EE.\nPero es solo en teoria, pues NetBeans 9, mantiene la compatibilidad con la versi√≥n 8.2, incluso a nivel de plugins. As√≠ que podemos a√±adir las fuentes de la versi√≥n anterior y podremos crear aplicaciones Java EE.\nEso es tan simple como ir al men√∫ Tools y elegir la opci√≥n Plugins.¬†En la ventana de plugins, iremos a la pesta√±a settings y pulsaremos el bot√≥n Add. El cual nos mostrara la siguiente ventana:\nAh√≠ pondremos rellenaremos los 2 campos, de esta manera:\n Name: NetBeans 8.2\nURL: http://updates.netbeans.org/netbeans/updates/8.2/uc/final/distribution/catalog.xml.gz\n Despu√©s, volveremos de darle al bot√≥n OK, volveremos a a√±adir una nueva entrada con estos datos:\n Name: Plugin Portal\nURL: http://plugins.netbeans.org/nbpluginportal/updates/9.0/catalog.xml.gz\n La pagina debe quedar como la siguiente.\nA partir de ah√≠, ya veremos que nos aparecen como disponibles muchos m√°s plugins, entre los que veremos Java EE Base. Una vez instalado este plugin ya podremos realizar nuestras aplicaciones Java EE.\n¬°¬°¬° A seguir estudiando!!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/05/aplicacion-en-spring-rest-y-angular-4a-parte/",
	"title": "Aplicaci√≥n en Spring REST y Angular ‚Äì 4¬™ Parte",
	"tags": ["java", "json", "rest", "spring", "tomcat"],
	"description": "",
	"content": "Continuo con la serie de art√≠culos explicando una aplicaci√≥n donde la parte de servidor esta creada con Java, apoy√°ndose en el framework Spring y la parte del cliente usara Angular. Para la comunicaci√≥n entre la aplicaci√≥n usare peticiones REST, por supuesto utilizando el protocolo JSON.\nEn la anterior entrada¬†empece a explicar como se desplegar√≠a la aplicaci√≥n y en que URLs se procesar√≠an las diferentes peticiones. Ahora explicare como funcionan las diferentes peticiones.\nEn la clase YagesController¬†es donde se hace toda la magia üòâ\n@RestController @RequestMapping(\"/rest\") public class YagesController { @Autowired private YagesBussines yagesBussines; @RequestMapping(value = \"/{anoId}\", method=RequestMethod.GET, produces=\"application/json\") public VentasAnoBean getAno(@PathVariable int anoId) { System.out.println(\"getAno.A√±o: \"+anoId); return yagesBussines.getVentasAno(anoId); } @RequestMapping(value =\"/{anoId}/{mesId}\", method=RequestMethod.GET,produces=\"application/json\") public ArrayList\u0026lt;VentasSemanaBean\u0026gt; getSemanas(@PathVariable int anoId,@PathVariable int mesId) { System.out.println(\"GetSemanas. Mes \"+mesId+\" A√±o: \"+anoId); return yagesBussines.getDatosSemana(mesId, anoId); } } Como ya comente, lo primero es la anotaci√≥n¬†@RestController, que le dice a Spring que nuestra clase va a procesar peticiones tipo REST. A continuaci√≥n, la anotaci√≥n¬†@RequestMapping(\u0026#8220;/rest\u0026#8221;) especifica que debe responder a las peticiones que vayan a la URL /rest¬†\nComo dije en la entrada anterior, por claridad en los ejemplos vamos a suponer que nuestra aplicaci√≥n responde en la direcci√≥n (URL) : http://localhost:8080/yagesserver . Aclarar, que el 8080 es el puerto donde escuchara y¬†yagesserver es el directorio o contexto base donde estar√° nuestra aplicaci√≥n.\nLa clase¬†define un √∫nico objeto tipo¬†YagesBussines¬†a trav√©s del sistema de inyecci√≥n de Spring y tiene dos funciones, que explico a continuaci√≥n:\n #### Funci√≥n:¬†getAno  @RequestMapping(value = \"/{anoId}\", method=RequestMethod.GET, produces=\"application/json\") public VentasAnoBean getAno(@PathVariable int anoId) { System.out.println(\"getAno.A√±o: \"+anoId); return yagesBussines.getVentasAno(anoId); } Como se ve, la funci√≥n esta anotada con la directiva¬†@RequestMapping. Con esta directiva vamos a especificar que direcci√≥n (dentro de /rest/ )¬†vamos a tratar en esta funci√≥n. As√≠, en este caso le decimos que vamos a procesar aquellas peticiones que tengan un solo par√°metro y, que ademas,¬†la petici√≥n sea del tipo GET. Tambi√©n especificamos que la respuesta a la petici√≥n sera del tipo¬†application/json.\nEs decir, el esta funci√≥n sera llamada ( y su c√≥digo ejecutado ) cuando hagamos una petici√≥n del tipo http://localhost:8080/yagesserver/rest/2018¬†. Aclarar que no sera llamada si el numero de par√°metros no es exactamente uno. Por ejemplo esta petici√≥n¬†http://localhost:8080/yagesserver/rest/2018/2 no sera tratada ya que recibe dos par√°metros¬†(2018 y 2).\nCuando definimos la funci√≥n, se a√±ade la anotaci√≥n¬†@PathVariable que indica que la variable puesta a continuaci√≥n deber√° contener el par√°metro de la URL. As√≠ en la petici√≥n¬†http://localhost:8080/yagesserver/rest/2018¬†nuestra variable anoId¬†tendr√° el valor 2018. L√≥gicamente, esto obliga a que el par√°metro sea del tipo entero, pues hemos definido que nuestra variable anoId es del tipo¬†int.\nEsta funci√≥n, devuelve un objeto¬†VentasAnoBean que esta definida en la siguiente clase:\n@Data public class VentasAnoBean { private ArrayList\u0026lt;VentasMesBean\u0026gt; ventasMes = new ArrayList(); private double kilosVentaAct, impVentaAct, kilosVentaAnt, impVentaAnt,gananciaAct,gananciaAnt; .... } Como se ve, la clase es una simple clase POJO, con unas variables, accesibles a trav√©s de sus correspondientes m√©todos getter, que la librer√≠a Lombok, a trav√©s de la anotaci√≥n @Data creara. Teneis mas detalles de la librer√≠a¬†Lombok en otra entrada de mi pagina.\nAl haber¬†especificado que debe devolver un objeto con la codificaci√≥n¬†_json,¬†_Spring, apoy√°ndose en las librer√≠as¬†de¬†jackson,¬†devolver√° la correspondiente cadena de texto, formateada adecuadamente. No voy a hablar de como¬†se codifica o descodifica una cadena JSON¬†en esta entrada y realmente tampoco nos importa. De eso ya se encargaran las correspondientes librer√≠as. Lo que importa es que esta funci√≥n un objeto del tipo _VentasAnoBean_¬†en un formato que luego una aplicaci√≥n cliente va a saber reconstruir.\n\u0026nbsp;\nAqu√≠ se ve una captura de pantalla de como accediendo a la URL:\nhttp://localhost:8080/yagesserver/rest/2018¬†es devuelto un objeto VentasAnoBean, que incluye un array de objetos tipo _ventasMes,¬†_y las variables kilosVentaAct, impVentaAct, kilosVentaAnt, impVentaAnt,gananciaAct y gananciaAnt.\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\nSi usamos el comando curl, para hacer la petici√≥n HTTP, veremos que la salida, en crudo,¬†seria la siguiente:\n\n #### Funci√≥n: getSemanas  @RequestMapping(value =\"/{anoId}/{mesId}\", method=RequestMethod.GET, produces=\"application/json\") public ArrayList\u0026lt;VentasSemanaBean\u0026gt; getSemanas(@PathVariable int anoId,@PathVariable int mesId) { System.out.println(\"GetSemanas. Mes \"+mesId+\" A√±o: \"+anoId); return yagesBussines.getDatosSemana(mesId, anoId); } En esta funci√≥n se van a tratar todas aquellas peticiones como la siguiente¬†localhost:8080/yagessever/rest/2018/2¬†es decir, aquellas que tengan dos parametros.\nEsto se especifica por la anotaci√≥n¬†@RequestMapping donde especificamos que el valor debe ser _\u0026#8220;/{anoId}/{mesId}\u0026#8221;,¬†_despues, en la declaraci√≥n de nuestra funci√≥n, especificamos en que variables deben ser introducidos los par√°metros de la URL. As√≠, el primer par√°metro sera introducido en la variable anoId y el segundo, en la variable mesId.\nEsta funci√≥n devuelve un Array de objetos tipo VentasSemanaBean, que no es sino un simple POJO definido en la siguiente clase:\n@Data public class VentasMesBean { private int ano, mes; private double kilosVentaAct, impVentaAct, kilosVentaAnt, impVentaAnt; private double gananAct, gananAnt; .... } Si realizamos una petici√≥n, usando curl, obtendremos la siguiente salida:\nEn la ultima entrada¬†de la parte servidor, explicare como se consiguen los objetos¬†VentasMesBean y¬†VentasAnoBean.\n¬°¬° Hasta pronto !!\n\u0026nbsp;\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/04/aplicacion-en-spring-rest-y-angular-3a-parte/",
	"title": "Aplicaci√≥n en Spring REST y Angular ‚Äì 3¬™ Parte",
	"tags": ["java", "rest", "spring", "tomcat"],
	"description": "",
	"content": "En esta entrada, continuare con la parte servidor, que ya comenc√© en el articulo anterior.\nVoy a desarrollar la parte donde se responden a las peticiones REST. Para el que no sepa que es eso de REST, pod√©is empezar leyendo este articulo de la wikipedia, pero os podeis quedar con la idea de que es como una petici√≥n web normal, solo que en vez de trabajar con paginas HTML enteras, se trabaja con intercambio de datos m√°s o menos en crudo.\nEn este ejemplo, el codigo que trata esas peticiones esta en la clase: YagesController\n@RestController @RequestMapping(\"/rest\") public class YagesController { @Autowired private YagesBussines yagesBussines; @RequestMapping(value = \"/{anoId}\", method=RequestMethod.GET, produces=\"application/json\") public VentasAnoBean getAno(@PathVariable int anoId) { System.out.println(\"getAno.A√±o: \"+anoId); return yagesBussines.getVentasAno(anoId); } @RequestMapping(value =\"/{anoId}/{mesId}\", method=RequestMethod.GET,produces=\"application/json\") public ArrayList\u0026lt;VentasSemanaBean\u0026gt; getSemanas(@PathVariable int anoId,@PathVariable int mesId) { System.out.println(\"GetSemanas. Mes \"+mesId+\" A√±o: \"+anoId); return yagesBussines.getDatosSemana(mesId, anoId); } } Con solo este c√≥digo vamos a ser capaces de responder a las peticiones.\nLo primero es anotar la clase como del tipo @RestContoller. Despu√©s especificamos la ruta que este controlador debe responder. Eso lo hago con la anotaci√≥n @RequestMapping(\u0026#8220;/rest\u0026#8221;). Eso har√° que todas las peticiones que vayan a la URL¬†MIDOMINIO/MICONTEXTO/rest sean tratadas por esta clase.\nComo dije anteriormente un servidor REST, atiende peticiones HTTP, como son las que se utilizan habitualmente en un navegador web, y como cualquier petici√≥n web, siempre debe haber una URL (o direcci√≥n) de la p√°gina que debemos visitar. As√≠, cuando visitamos Google, en nuestro navegador ponemos la direcci√≥n: http://www.google.com. Pues bien, si nuestro servicio REST responde, por ejemplo en la pagina www.profesor-p.com, para interactuar con √©l deber√≠amos hacer una petici√≥n web (es decir visitar la pagina web) : http://www.profesor-p.com/rest/LO_QUE_SEA\n¬ø Y que es entonces eso de MI_CONTEXTO ? . Bueno, es muy com√∫n que en un servidor de aplicaciones (Tomcat, por ejemplo) haya varias aplicaciones corriendo al mismo tiempo, sobre todo, para optimizar recursos. De esta manera si tenemos un servidor de Tomcat corriendo en la direcci√≥n www.servidor-profesorp.com, cuando queramos acceder a la aplicaci√≥n de contabilidad pondremos: www.servidor-profesorp.com/contabilidad y si queremos acceder a la aplicaci√≥n de nominas iremos a www.servidor-profesorp.com/nominas y as√≠ con las diferentes aplicaciones. Es decir todas las peticiones de la aplicaci√≥n web de contabilidad responder√°n bajo el contexto de www.servidor-profesorp.com/contabilidad y todas las peticiones de la aplicaci√≥n nominas responder√°n bajo el contexto de www.servidor-profesorp.com/nominas. A todos los efectos, la idea es como cuando se ejecuta una aplicaci√≥n¬†de escritorio en Windows, como puede ser Word, Excel o el Bloc de Notas, cada aplicaci√≥n del escritorio tiene su propia ventana, pues en una aplicaci√≥n web, cada¬†una tiene su contexto o directorio donde responde a las peticiones.\nAclarar, que hay veces, que el¬†contexto puede no existir en el caso de que solo tengamos una aplicaci√≥n corriendo en esta direcci√≥n web o bien, porque es la direcci√≥n principal y no haga falta ponerla. En esos casos las peticiones REST ser√°n respondidas en MIDOMINIO/rest.\nPara el resto del articulo vamos a suponer que nuestra aplicaci√≥n esta respondiendo en la URL http://localhost:8080/yagesserver que es donde normalmente se realizan las pruebas. Localhost, como todo el mundo sabe, es la direcci√≥n interna¬†del servidor (que sera probablemente tu ordenador personal en este ejemplo) donde se esta corriendo el programa. Y yaggesserver es el contexto donde responder√° la aplicaci√≥n.\nY como un ejemplo, vale m√°s que mil palabras, aqu√≠ vemos un ejemplo de la una petici√≥n REST, haciendo uso de la funci√≥n getAno() de la clase YagesController.\n\u0026nbsp;\nY como esta entrada me esta quedando un poco larga, continuare con ella en un pr√≥ximo articulo.\n¬°¬° A seguir estudiando !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/09/03/aplicacion-en-spring-rest-y-angular-2-parte/",
	"title": "Aplicaci√≥n en Spring REST y Angular ‚Äì 2 Parte",
	"tags": ["java", "jndi", "json", "rest", "spring", "spring boot", "tomcat"],
	"description": "",
	"content": "En esta segunda parte voy a empezar a explicar como hacer la parte del servidor, usando, como dije en la primera parte de este articulo utilizare¬†JAVA 8, apoy√°ndome en el framework Spring, versi√≥n 5.\nEsta aplicaci√≥n la he realizado con NetBeans 9, usando Tomcat 9 como servidor de aplicaciones. La pod√≠a haber realizado usando Spring Boot, lo que habr√≠a realizado m√°s f√°cilmente y con menos configuraci√≥n pero he querido hacerlo con Tomcat como ejercicio.\nEsta el c√≥digo fuente en: https://github.com/chuchip/yagesserver\nEstos ser√°n los archivos usados en mi aplicaci√≥n:\nLas dependencias, aparte de las b√°sicas de Spring, son tener las siguientes librer√≠as , de H2 Database e Hibernate.\ndependency\u0026gt; \u0026lt;groupId\u0026gt;com.fasterxml.jackson.core\u0026lt;/groupId\u0026gt; \u0026lt;!-- Jackson (JSON) --\u0026gt; \u0026lt;artifactId\u0026gt;jackson-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.9.6\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.fasterxml.jackson.core\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jackson-databind\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.9.6\u0026lt;/version\u0026gt; \u0026lt;/dependedncy\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;!-- H2 DATABASE --\u0026gt; \u0026lt;groupId\u0026gt;com.h2database\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;h2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.4.197\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;!-- LOMBOK --\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.18.2\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;!-- HIBERNATE --\u0026gt; \u0026lt;groupId\u0026gt;org.hibernate\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;hibernate-agroal\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.3.5.Final\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;/dependency\u0026gt; Para m√°s detalles y otras librer√≠as menores, mirar el fichero pom.xml del proyecto.\nEn este ejemplo no uso¬†anotaciones XML, , todo se hace con anotaciones Java. Esta es el fichero con que se configura la base de datos.\n@Configuration @EnableJpaRepositories(\"yages.yagesserver\") @EnableTransactionManagement public class JpaConfig { @Bean public DataSource dataSource() { EmbeddedDatabaseBuilder builder = new EmbeddedDatabaseBuilder(); EmbeddedDatabase db = builder .setType(EmbeddedDatabaseType.H2) .setName(\"yagesh2\") .ignoreFailedDrops(true) .addScript(\"db/sql/create-db.sql\") .addScript(\"db/sql/insert-data.sql\") .generateUniqueName(false) .build(); return db; } @Bean public HibernateExceptionTranslator hibernateExceptionTranslator() { return new HibernateExceptionTranslator(); } @Bean public LocalContainerEntityManagerFactoryBean entityManagerFactory(DataSource dataSource) throws NamingException { LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean(); em.setDataSource(dataSource()); em.setPackagesToScan(new String[]{\"yages.yagesserver\", \"yages.yagesserver.dao\"}); em.setPersistenceUnitName(\"yages-server\"); em.setJpaVendorAdapter(jpaVendorAdapter()); em.afterPropertiesSet(); return em; } @Bean public JpaVendorAdapter jpaVendorAdapter() { HibernateJpaVendorAdapter jpaVendorAdapter = new HibernateJpaVendorAdapter(); jpaVendorAdapter.setGenerateDdl(false); jpaVendorAdapter.setDatabase(Database.H2); jpaVendorAdapter.setShowSql(false); return jpaVendorAdapter; } @Bean public PlatformTransactionManager transactionManager(EntityManagerFactory emf) { JpaTransactionManager transactionManager = new JpaTransactionManager(); transactionManager.setEntityManagerFactory(emf); return transactionManager; } } La configuraci√≥n es una t√≠pica para cualquier base de de datos. Lo √∫nico destacable es el uso de la clase EmbeddedDatabaseBuilder , en la funci√≥n dataSource. Esta clase es muy √∫til para crear una base de datos embebida del tipo H2, HSQL o incluso DERBY. Como se ve en el c√≥digo el uso es tan simple como especificar el tipo de base de datos, y despu√©s a√±adir los scripts necesarios (en este caso el de creaci√≥n de las tablas y el de carga de datos). Esto nos creara un objeto EmbeddedDatabase que implementa el interface DataSource. Observerse que¬†los ficheros create-db.sql¬†e insert-db.sql, contienen sentencias SQL puras.**\n**\ncreate table calendario ( cal_ano int, -- A√±o cal_mes int, -- Mes cal_fecini date, -- Fecha Inicial cal_fecfin date, -- Fecha Final. constraint ix_calendario primary key (cal_ano,cal_mes) ); ...... NSERT INTO calendario (cal_ano,cal_mes,cal_fecini,cal_fecfin) VALUES (2018,1,{d '2018-01-01'},{d '2018-01-27'}); INSERT INTO calendario (cal_ano,cal_mes,cal_fecini,cal_fecfin) VALUES (2018,2,{d '2018-01-28'},{d '2018-02-24'}); ....... Estos dos ficheros, deber√°n estar ubicados en la carpeta de resources (es decir, en el classpath)\nUna vez que tenemos nuestro objeto DataSource ya solo resta crear nuestro EntityManager en la funci√≥n entityManagerFactory, apoy√°ndonos en las dem√°s funciones de la clase.\nAhora creare las clases que representan los objetos de la base de datos, estos objetos est√°n en la carpeta:\n ### Implementando nuestras tablas **como objetos.   **\nEn el paquete yages.yagesserver.model¬†tendremos las siguientes clases:\nCalendario.java \n@Entity @Table(name=\"calendario\") @NoArgsConstructor @Data public class Calendario implements Serializable{ private static final long serialVersionUID = 1L; @Column(name = \"cal_fecini\",nullable = false) @Temporal(javax.persistence.TemporalType.DATE) private Date fechaInicio; @Column(name = \"cal_fecfin\",nullable = false) @Temporal(javax.persistence.TemporalType.DATE) private Date fechaFinal; @Transient private Date fechaFinalSemana; @EmbeddedId private CalendarioKey calendarioKey; public Calendario(int ano,int mes,Date fecInicio,Date fecFinal) { calendarioKey = new CalendarioKey(ano,mes); setFechaInicio(fecInicio); setFechaFinal(fecFinal); } } CalendarioKey.java\n@Embeddable @Data @AllArgsConstructor @NoArgsConstructor public class CalendarioKey implements Serializable { private static final long serialVersionUID = 2L; @Column (name=\"cal_mes\", nullable=false) private int mes; @Column (name=\"cal_ano\", nullable=false) private int ano; }  Como se puede ver son dos simples POJOS, con una serie de anotaciones para su uso con JPA.\nSolo destacar el uso de que como la tabla Calendario tiene un indice multiple, haremos uso de la anotaci√≥n EmbebedId de tal manera que la clase Calendario¬†sera una @Entity y la clase CalendarioKey , que tendra los campos mes y ano (a√±o üòÄ ) sera la que tenga el indice y estara marcada como¬†@Embeddable.\nEn el paquete yages.yagesserver.dao creare mi repositoio crud con el siguiente interface:\npublic interface CalendarioRepository extends CrudRepository\u0026lt;yages.yagesserver.model.Calendario, yages.yagesserver.model.CalendarioKey\u0026gt; { } Para mas datos sobre este interface que nos hace la vida tan f√°cil, pod√©is mirar el siguiente articulo de mi p√°gina.\nEn la clase CalendarioRepositorioService creo mi clase auxiliar que hace uso del repositorio.\n@Service @Transactional public class CalendarioRepositorioService { @Autowired CalendarioRepository calendarioRepository; public Optional\u0026lt;Calendario\u0026gt; getCalendario(CalendarioKey calendarioKey) { return calendarioRepository.findById(calendarioKey); } public Iterable\u0026lt;Calendario\u0026gt; getAllCalendarios() { return calendarioRepository.findAll(); } } Observese como anoto la clase¬†con la etiqueta @Service y @Transacional. Despues inyectamos el interface CalendarioRepository que es el que usare en las dos unicas funciones que tiene esta clase.\nLa tabla histVentas es pr√°cticamente igual que la tabla calendario, tambi√©n con un indice m√∫ltiple y la configuraci√≥n es b√°sicamente la misma, por lo cual no creo necesario explicarla.\nY por hoy ya vale. En la pr√≥xima entrada, veremos como implementar las peticiones REST\n¬°¬° Hasta pronto!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/31/aplicacion-en-spring-y-angular/",
	"title": "Aplicaci√≥n en Spring REST y Angular",
	"tags": ["angular", "java", "spring"],
	"description": "",
	"content": "En Anjelica, el ERP desarrollado por mi hace unos a√±os, hay un programa que saca un comparativo de ventas, entre dos a√±os, mostrando mes a mes, los kilos, importes y ganancias.\nLa idea es realizar esta misma consulta pero usando Spring con REST en el backend y como frontend usar Angular.\nPara ello se realizaran los siguientes pasos:\n ¬†Crear tablas y cargar datos de prueba en la base de datos. Usare H2 embebido, en vez de postgresql, que es la base de datos que usa Anjelica. Crear aplicaci√≥n servidor, bajo TOMCAT 9, usando Spring 5.¬†No usare Spring Boot para este ejemplo, aunque podr√≠a hacerlo perfectamente y de hecho har√≠a la aplicaci√≥n m√°s sencilla. Crear aplicaci√≥n cliente, para lo cual usare Angular 6.  La aplicaci√≥n, como se ve en el anterior pantallazo, nos mostrara las ventas por meses, haciendo un comparativo del ejercicio introducido contra el anterior. Pulsando en cada mes, veremos las ventas por semanas.\nPara empezar vamos a definir las tablas que usaremos en esta consulta:\n-- -- Tabla calendarios -- create table calendario ( cal_ano int, -- A√±o cal_mes int, -- Mes cal_fecini date, -- Fecha Inicial cal_fecfin date, -- Fecha Final. constraint ix_calendario primary key (cal_ano,cal_mes) ); create table histventas ( hve_fecini date not null, -- Fecha Inicial hve_fecfin date not null, -- Fecha Final hve_kilven float, -- Kilos Venta (Total) hve_impven float, -- Importe Ventas (Total) hve_impgan float, -- Importe ganancia div_codi int not null default 1, -- Divisa constraint ix_histventas primary key (hve_fecini ,hve_fecfin,div_codi ) ); Como se ve, tenemos una tabla calendario donde definimos, para cada mes, cual es la fecha inicial y fecha final. Esto es porque nosotros definimos cuando empieza un mes y cuando termina, la raz√≥n de hacerlo as√≠ es porque, en muchas empresas se vende por semanas enteras y como queremos hacer comparativos nos puede interesar especificar que semanas consideramos que son de un mes.\nAs√≠, en los datos que cargaremos, el mes de enero del 2018, empieza el d√≠a 1\u0026frasl;1 (lunes) y termina el d√≠a 27\u0026frasl;1 s√°bado, y el mes de febrero empieza el 28\u0026frasl;1 y termina el 24\u0026frasl;2. Es decir en nuestra empresa ficticia la semana comienza el domingo y termina el s√°bado siguiente (ambos inclusive). Excepto al principio del a√±o, que empieza siempre el 1\u0026frasl;1 y termina el 31\u0026frasl;12.\nEn la tabla histventas tenemos una serie de acumulados para los periodos marcados por hve_fecini (fecha Inicio) y hve_fecfin¬†(Fecha Final) y para una divisa dada.Esta tabla no tiene un indice √∫nico, pero buscaremos por los datos por esos 3 campos\nEsta tabla la llena un proceso autom√°tico del ERP, a trav√©s de las tablas de ventas, pero en este ejemplo no explicare como se llenan esos datos, sino que precargare unos datos en la propia aplicaci√≥n, cuando se instancie la base de datos.\nEn la siguiente entrada, empezare con el programa de la parte del servidor, pero pod√©is echarle un vistazo al c√≥digo en https://github.com/chuchip/yagesserver.git\n\u0026nbsp;\n¬°¬° Nos vemos pronto!!\n\u0026nbsp;\n\u0026nbsp;\n\u0026nbsp;\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/28/ejemplo-aplicacion-mvc-con-spring-boot-usando-netbeans-9/",
	"title": "Ejemplo aplicaci√≥n MVC con Spring Boot  usando NetBeans 9",
	"tags": ["java", "mvc", "netbeans", "spring boot"],
	"description": "",
	"content": "En una entrada anterior explique como instalar NetBeans 9, a√±adiendole el plugin para usar Spring Boot.\nAhora vamos a crear nuestro primer proyecto en este entorno.\nPulsaremos New Project, lo cual nos mostrara una pantalla como la siguiente.\ny en el campo Filter pondremos spring,¬† para despu√©s eligir Spring Boot Inititilizr project. Pulsaremos Next y nos pedir√°¬†una serie de datos sobre¬†nuestro proyecto. Para este ejemplo podemos dejar los campos como aparecen por defecto.\nPulsamos siguiente (Next) y ahora debemos especificar de que tipo es nuestro proyecto:\nComo se ve hay muchas opciones, nosotros solo marcaremos la casilla WEB, porque va a ser una aplicaci√≥n WEB y Thymeleaf, porque es el motor de plantillas (Template Engines) que vamos a usar. Thymeleaf es un sustituto o evoluci√≥n de JSP con diferentes mejoras y que se integra perfectamente con Spring. Su pagina web es: https://www.thymeleaf.org/ y ten√©is una buena documentaci√≥n. De todos modos, en este ejemplo solo usaremos c√≥digo HTML sin poner c√≥digo en nuestras plantillas.\nVolveremos a pulsar Next, para, en el ultimo paso poner el nombre de nuestro provecto\n\u0026nbsp;\nPulsaremos Finish¬† y esperaremos a que Maven baje los paquetes necesarios y configure el entorno de trabajo.\nAhora vamos a crear un par de paginas web. La primera sera index.html, la otra sera otrapagina.html. Esas paginas las debemos crear en OtherResources src/main/resources¬†templates, como se ve en la siguiente imagen:\nLos ficheros creados son tipo HTML.\nLos Ficheros quedaran as√≠\nindex.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:th=\"http://www.thymeleaf.org\" xmlns:sec=\"http://www.thymeleaf.org/thymeleaf-extras-springsecurity3\"\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Pagina de Inicio\u0026lt;/title\u0026gt; \u0026lt;meta charset=\"UTF-8\"/\u0026gt; \u0026lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div\u0026gt;Mi pagina de inicio\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;\u0026lt;a href=\"otra\"\u0026gt;ir a la otra pagina\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; otrapagina.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Otra pagina de prueba\u0026lt;/title\u0026gt; \u0026lt;meta charset=\"UTF-8\"\u0026gt; \u0026lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div\u0026gt;Mi otra pagina de prueba\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Ahora mismo ya podr√≠amos ejecutar nuestra aplicaci√≥n, y ver√≠amos nuestro index.html, pero vamos a crear el controlador para que se pueda mostrar la pagina otrapagina.html. Para ello, en Source Packages, dentro del paquete com.example.demo crearemos un nuevo fichero java al que llamaremos Controlador.java\nEn este fichero tendremos lo siguiente:\npackage com.example.demo; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; @Controller public class Controlador { @GetMapping(\u0026quot;otra\u0026quot;) public String login() {\treturn \u0026quot;otrapagina\u0026quot;; } }  Esta clase marcada con @Controller, tendr√° una √∫nica funci√≥n que tiene la etiqueta @GetMapping. El par√°metro de esa etiqueta sera la URL o p√°gina que debe tratar la funci√≥n que tenemos debajo.\nEs decir, que cuando nosotros pongamos en nuestro navegador:\nhttp://localhost:8080/otra\nSpring ejecutara lo que haya en la funci√≥n login().\nSi quisi√©ramos tener mas paginas simplemente a√±adiremos m√°s funciones, con la etiqueta @GetMapping(\u0026#8220;PAGINA QUE NOS DE LA GANA\u0026#8221;)\nTerminar, comentando que el String devuelto por nuestra funci√≥n es la pagina web (el fichero) creado bajo el directorio templates (sin la extensi√≥n html). Resumiendo, en este ejemplo, al ir a:\nhttp://localhost:8080/otra\nSpring parseara el fichero otrapagina.html y devolver√° la pagina¬†HTML¬†creada por el.\nY con esto, ya hemos creado nuestra primera pagina web con Spring üòâ\nTerminar diciendo que el c√≥digo fuente de este proyecto lo ten√©is en mi repositorio de GITHUB.\n"
},
{
	"uri": "http://ww2.profesor-p.com/anjelica/",
	"title": "ERP Anjelica",
	"tags": [],
	"description": "",
	"content": "Para aquellas peque√±as empresas que necesitan tener una trazabilidad sencilla pero potente, y ademas gratis, prueba mi ERP.\nTotalmente funcional, te sorprender√° gratamente.\nM√°s informaci√≥n aqu√≠.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/27/instalar-plugin-spring-boot-con-netbeans-9-en-ubuntu-18-04/",
	"title": "Instalar plugin Spring Boot en NetBeans",
	"tags": ["java", "linux", "netbeans", "spring boot"],
	"description": "",
	"content": "En esta entrada explicare como crear un aplicaci√≥n con el framework Spring Boot, usando el IDE NetBeans 9.\nAdemas haremos todo esto en un Linux Ubuntu 18.04\nSi no sab√©is lo que es Spring Boot, ya est√°is tardando en aprender al menos los conceptos b√°sicos.\n Spring Boot es Spring hecho (m√°s) f√°cil. ¬†Con Spring Boot, entre otras cosas, se puede realizar una aplicaci√≥n Web, con una m√≠nima configuraci√≥n. Una aplicaci√≥n¬†demo se crea en apenas¬†5 minutos. Y ademas, sin tener que usar un servidor de aplicaciones, pues Spring Boot, ya incluye una versi√≥n de Tomcat embebida. Spring Boot usa un sistema de paquetes, que hace mas f√°cil las dependencias de Maven (o Gradle). Spring Boot, la versi√≥n 5, funciona con Java 1.8 o superior, haciendo mucho uso de Lambdas, Streams y todas las nuevas capacidades de este lenguaje.  Este es un video con una charla de introducci√≥n, de la gente de Paradigma Digital.\n\nYa se que Spring tiene su propio IDE, basado en Eclipse, pero la ultima versi√≥n al menos, esta tan pensada para Spring Boot, que intentar utilizar otro servidor de aplicaciones es muy engorroso.¬†Y bueno, que hay gente que nos sentimos c√≥modos con NetBeans y no nos apetece cambiar de IDE üôÇ\nPero si os apetece probar un IDE, totalmente configurado para¬†Spring Boot , usar¬†Spring Tool Suite baj√°ndolo de https://spring.io/tools/sts. No es mal IDE, pero \u0026#8230;. no es mi IDE üòâ\nBueno, lo primero es tener NetBeans 9 instalado, para ello, lo primero seria ir a la siguiente p√°gina: https://netbeans.apache.org/download/nb90/nb90.html y bajarnos el IDE.\nUna vez tengamos el IDE descargado, como es un ZIP, simplemente lo descomprimimos. En este ejemplo voy a suponer que lo instalamos en /nb (s√≠, ya se que no es lo normal, pero es para hacer mas f√°cil el tutorial).\nPara ejecutar NetBeans 9, deberemos ir al directorio bin y ejecutar el fichero netbeans.sh. Es decir en nuestro ejemplo deberemos ejecutar /nb/bin/netbeans.sh.\nUn momento,¬†¬ø que versi√≥n de Java ten√©is instalado en vuestro Ubuntu?.\nMe temo que NetBeans solo funciona con el Java de Oracle. OpenJDK no le gusta y no os arrancara, as√≠ que no os queda otra¬†(que yo sepa) que iros a la pagina web de Oracle y bajaros su JDK. En este caso yo me he bajado JDK 10.0.2. Bajaros el tar.gz de este enlace y lo descomprim√≠s¬†en el directorio /nb (podr√≠amos dejarlo en cualquier otro lugar pero es por facilitar el tutorial una vez mas). As√≠, ahora, tendr√©is el JDK en /nb/jdk-10.0.2/\nAhora hay que decirle a NetBeans que use el nuevo JDK que hemos instalado, para ello deber√©is editar el fichero situado¬†en /nb/etc/netbeans.conf¬†y cambiar la linea¬†netbeans_jdkhome¬† para que ponga esto:\nnetbeans_jdkhome=\"/nb/jdk-10.0.2/\" Ok. Ya podemos ejecutar Netbeans, con el comando /nb/bin/netbeans.sh\nLa primera vez que ejecutamos NetBeans 9, nos solicita que instalemos la librer√≠a nbjavac, para mejorar el editor de textos y la funcionalidad en general. Le hacemos caso y la instalamos.\n![](/img/2018/08/Captura-1024x680.png]\nUna vez instalada, nos pedir√° que reiniciemos el IDE. Somos buenos chicos y lo reiniciamos.\nAhora toca instalar el plugin para poder funcionar con Spring Boot. Para ello nos vamos al men√∫ Tools y elegimos la opci√≥n plugins. En la ventana que nos sale nos iremos a la pesta√±a de \u0026#8220;Available Plugins\u0026#8221;¬†y elegiremos NB SpringBoot. Despu√©s le daremos al bot√≥n Install.\n\u0026nbsp;\nReiniciamos, una vez m√°s nuestro IDE, y ya podremos crear nuestro proyecto Spring Boot, en NetBeans 9. Como crearlo lo contare en la pr√≥xima entrada.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/25/jpa-hibernate-en-spring/",
	"title": "JPA + Hibernate en Spring",
	"tags": [],
	"description": "",
	"content": "En un entrada anterior, explique como crear nuestra conexi√≥n a la base de datos, usando JNDI. En esta entrada explicare como usar esa conexi√≥n con JPA.\nRecordar que el c√≥digo fuente de de este ejemplo esta en: https://github.com/chuchip/jdbc_jpa_tomcat\nImportante recalcar que este ejemplo solo funciona con Java 1.8 o superior.\nLo primero explicar un poco de que va esto de JPA.¬†JPA son las siglas de¬†Java Persistence API. Es decir la API de persistencia en Java. Vale, que te has quedado como antes, ¬ø no ? üòâ . Bueno, la idea es tener una metodolog√≠a de tener objetos en nuestro entorno Java y que esos objetos sean un reflejo de las diferentes tablas de la base de datos, de tal manera que nosotros modifiquemos nuestros objetos y en la base de datos se vean reflejados esos cambios.\nLa idea parece interesante, ¬ø verdad ?. Bueno, pues encima no es nada complicado el hacerlo.\nManos a la obra.\nLo primero vamos a crear el objeto que representa la tabla de nuestra base de datos. As√≠, en nuestra base de datos tenemos la tabla usuario que solo tiene dos campos, el login y el nombre del usuario. Ambos campos son cadenas de caracteres (String, vamos). En nuestra tabla¬†usuario no puede haber dos login igual, es lo que se llama un indice unico o \u0026#8220;unique constraint\u0026#8221; que dicen los ingleses.\nDefinamos entonces nuestro objeto (usando la librer√≠a Lombok, de la que ya hablaba en otra entrada)\n@Data @Entity @Table(name = \u0026quot;usuario\u0026quot;, uniqueConstraints = { @UniqueConstraint(columnNames = {\u0026quot;login\u0026quot;})}) // Esto no es necesario en este ejemplo public class Usuario implements Serializable { @Id String login; @Column String nombre; public Usuario() {} public Usuario(String login, String nombre) { this.login = login; this.nombre = nombre; } }  Como se ve f√°cilmente, es una simple clase POJO, que implementa el interface Serializable. Solo tiene dos campos y unas cuantas anotaciones, que ahora explicare.\nLo primero es declarar la clase del tipo¬†Entidad, para eso usaremos la anotaci√≥n @Entity. Gracias¬†a eso, JPA marcara esa clase para poder usarla en su entorno de persistencia.\nEl siguiente par√°metro @Table indica a que tabla de nuestra base de datos, hace referencia esa clase, ademas de cual es su¬†indice √∫nico . Si, como es el caso, el indice es simple y ademas la tabla se llama como nuestra clase no hace falta poner ese par√°metro pero yo lo he puesto para que sep√°is que exista ( y por man√≠as üòâ )\nLuego, dentro de la clase veis que antes de la definici√≥n de la variable login tenemos la anotaci√≥n @Id,¬†eso indicara que ese es nuestro campo indice o √∫nico. Antes de la definici√≥n de la variable nombre tenemos la anotaci√≥n @Column para indicar que es una columna m√°s de nuestra tabla. Aclarar que todas esas anotaciones permiten m√°s par√°metros.\nHay much√≠sima documentaci√≥n en la red, sobre JPA, pod√©is empezar, por ejemplo, por este PDF de la Universidad de Oviedo\nBien, una vez tenemos nuestra entidad vamos a trabajar con ella. Por hacerlo simple vamos a hacer uso Spring y de su interfaz CrudRepository. Este interfaz nos permite con apenas 3 lineas de c√≥digo acceder a los datos que representa nuestro POJO.\nSi, aunque parezca incre√≠ble, con solo crear esta interface ya podremos acceder a nuestra base de datos.\npublic interface UsuarioRepositorio extends CrudRepository{ } Veis que he creado un interface, al que he llamado UsuarioRepositorio que extiende del interface CrudRepository y le he a√±adido el nombre de la clase Usuario, que es mi @Entity, y el tipo de campo (String) que es el indice √∫nico.\n¬ø Ya esta ?. Pues s√≠, ya esta. Ya pod√©is acceder a vuestra base de datos. ¬ø Qu√© como ?. Pues l√≥gicamente usando las funciones que implementa el interfaz CrudRepository. Por ejemplo existe la funci√≥n findById, si ejecut√°is esa funci√≥n pas√°ndole el nombre del usuario os devolver√° un objeto¬†Optional\u0026lt;usuario \u0026gt; . Os lo explico mejor con un ejemplo.\nCreamos esta clase en nuestro proyecto.\npublic class buscaUsuario { @Autowired UsuarioRepositorio usuRep; public String getNombreUsuario(String loginUsuario) { Optional usu=usuRep.findById(loginUsuario); String usuario = (usu.isPresent() ? usu.get().getNombre() : \u0026quot;Usuario \u0026quot;+loginUsuario+\u0026quot; No encontrado\u0026quot;); } } }  Teniendo inyectada¬†una referencia, con la¬†anotaci√≥n @Autowired,¬†a nuestro interface¬†UsuarioRepositorio (Spring hace la magia), en la funci√≥n getNombreUsuario, invocamos a findById , la cual nos devuelve una clase tipo Optional. Este tipo de objeto es para poder encapsular un posible valor null de tal manera que siempre se devuelva algo, aun en el caso de que no se encuentre ning√∫n valor.¬†Para saber si se ha encontrado algo usaremos isPresent el cual nos devolver√° true si ha encontrado alg√∫n registro.\nOs estar√©is preguntando, como m√≠nimo, dos cosas:\n \u0026#8211; ¬ø Como hace esto Java, si realmente no hemos creado ninguna clase, solo un interfaz ?  2.- ¬ø Qu√© pasa si yo quiero acceder a a campos que no son indices o varios campos simult√°neamente ?\nLa respuesta a la primera pregunta, esta en la Programaci√≥n Orientada a Objetos de Spring (echar un vistazo a JAspect). Gracias a esta tecnolog√≠a, cuando Spring recorre nuestras clases (al desplegarse la aplicaci√≥n en nuestro servidor de aplicaciones) y ve un interfaz que extiende de la clase¬†CrudRepository (hay otras clases que mejoran esta, pero no hablare de ellas en¬†este ejemplo) crea al vuelo una clase que implementa vuestro interfaz (en este caso UsuarioRepositorio) con sus correspondientes funciones. Por eso, en nuestras clases, podemos ejecutar algo que ni siquiera hemos creado.\nLa respuesta a la segunda pregunta es la anotaci√≥n @Query. Gracias a ella en nuestro interfaz podemos crear nuevas funciones, que ejecuten las sentencias SQL que necesitemos.\nAs√≠ si ponemos la siguiente funci√≥n en nuestra clase UsuarioRepositorio\n@Query(\u0026quot;select u from Usuario u where u.nombre like :nombre order by u.nombre\u0026quot;) List\u0026lt;Usuario\u0026gt; buscaPorNombre(@Param(\u0026quot;nombre\u0026quot;) String nombre);  Podremos buscar todos los usuarios cuyo nombre contenga el String pasado a la funci√≥n buscaPorNombre.\nObservar que la sentencia SQL no es una sentencia SQL est√°ndar sino que hace uso de Java Persistence Query (JPQ) Este lenguaje es muy parecido a SQL pero tiene sus particularidades üòâ\nPara facilitar m√°s las cosas,¬†Spring es capaz de interpretar, a trav√©s del nombre de la funci√≥n lo que quieres hacer con esa funci√≥n.\nAs√≠, en el ejemplo anterior, si a nuestra funci√≥n le llamamos findIsLikeNombreOrderByNombre, har√≠a lo mismo, pero no tendriamos que tener la anotaci√≥n @Query. Spring la crea por nosotros, interpretando el nombre de la funci√≥n.\nAs√≠ nuestra clase quedar√≠a as√≠:\npublic interface UsuarioRepositorio extends CrudRepository\u0026lt;Usuario, String\u0026gt; { @Query(\u0026quot;select u from Usuario u where u.nombre like :nombre order by u.nombre\u0026quot;) List\u0026lt;Usuario\u0026gt;buscaPorNombre(@Param(\u0026quot;nombre\u0026quot;) String nombre); /** * Esta funcion hace exactamente lo mismo que la funcion buscaPorNombre pero utilizando DSL (Domain Specificic Lenguage) de Spring * @param nombre Nombre de usuario a buscar (sin wildcards, ya lo pone JPL) * @return Lista de Usuarios a buscar */ List\u0026lt;Usuario\u0026gt; findIsLikeNombreOrderByNombre(String nombre); }  Esto se hace gracias a la Spring y su Domain Specificic Lenguage (DSL). Ten√©is una referencia de como formar Querys usando esta nomenclatura en esta p√°gina de Spring\nY nada m√°s por hoy, solo recordaros que ten√©is much√≠sima documentaci√≥n sobre JPA y Spring en la web, os dejo un par de enlaces (en espa√±ol) donde se habla m√°s de ello:\n http://acodigo.blogspot.com/2017/03/spring-data-jpa-acceso-datos-simple-y.html https://www.adictosaltrabajo.com/tutoriales/spring-data-jpa/  Espero que os haya gustado la entrada.\nUn saludo\nEl profe.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/24/jpa-con-lombok/",
	"title": "JPA con Lombok, simplificando.",
	"tags": [],
	"description": "",
	"content": "En un entrada anterior, explique que para usar JPA hay que tener nuestros objetos POJO definidos .¬†En esta entrada hablare de como mejorar la la definicion de nuestro objeto POJO, con la libreria Lombok.\nRecordar que el c√≥digo fuente de de este ejemplo esta en: https://github.com/chuchip/jdbc_jpa_tomcat\nAnteriormente teniamos definido nuestro objeto de esta manera:\n@Entity @Table(name = \u0026quot;usuario\u0026quot;, uniqueConstraints = { @UniqueConstraint(columnNames = {\u0026quot;login\u0026quot;})}) public class Usuario implements Serializable { @Id String login; @Column String nombre; public Usuario() { } public String getLogin() { return login; } public void setLogin(String login) { this.login = login; } public String getNombre() { return nombre; } public void setNombre(String nombre) { this.nombre = nombre; } public Usuario(String login, String nombre) { this.login = login; this.nombre = nombre; } }``` Ahora amos a hacer la clase mas facil, gracias a la Lombok. Para ello, a mi proyecto Maven (en el fichero pom.xml) a√±ado la siguiente dependencia:  ¬† org.projectlombok lombok 1.18.2 provided \n Teneis documentaci√≥n de este proyecto en \u0026lt;a href=\u0026quot;https://projectlombok.org/\u0026quot; target=\u0026quot;_blank\u0026quot; rel=\u0026quot;noopener\u0026quot;\u0026gt;su pagina web\u0026lt;/a\u0026gt;. De momento baste decir que gracias a la anotacion @Data nuestra clase **usuario** se queda as√≠.  import lombok.Data;\n@Data @Entity @Table(name = \u0026ldquo;usuario\u0026rdquo;, uniqueConstraints = { @UniqueConstraint(columnNames = {\u0026ldquo;login\u0026rdquo;})}) public class Usuario implements Serializable {\n@Id String login; @Column String nombre;  public Usuario(String login, String nombre) { this.login = login; this.nombre = nombre; } } ```\nMucho mas limpia, ¬ø a que si ?. Lombok se encargara de crear el constructor vacio, los setters y getters gracias la anotacion @Data.\nGracias a Lombok, a la hora de compilar Java crea funciones al vuelo, para que nosotros no tengamos que teclear tanto y no nos cansemos üòâ\nEn esta p√°gina (una vez m√°s en un perfecto ingles) teneis las diferentes anotaciones que proporciona la libreria Lombok\n\u0026nbsp;\n\u0026nbsp;\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/23/usando-lambdas/",
	"title": "Usando Lambdas",
	"tags": ["java", "lambda"],
	"description": "",
	"content": "En esta breve entrada explicare como mejorar el ejemplo anterior, con el uso de lambdas.\nComo siempre el c√≥digo fuente de este ejemplo lo ten√©is en: https://github.com/chuchip/jdbc_jpa_tomcat\nLas lambdas, son un mecanismo introducido en Java 8, pero que realmente en el mundo de la programaci√≥n no es nuevo.\nGracias a las lambdas se puede entre otras cosas, evitar, en gran medida el uso de las clases auxiliares. Ten√©is muchos manuales en la web, solo preguntarle a google, que lo sabe \u0026#8216;casi\u0026#8217; todo ;-), pero os aconsejo que le ech√©is un vistazo al siguiente enlace:\nhttps://www.oracle.com/technetwork/es/articles/java/expresiones-lambda-api-stream-java-2633852-esa.html\nYo, lo que os voy a dar un ejemplo de como usar lambda, para mejorar el uso de Swing Data JDBC. ¬°¬°Vamos a ello!!.\nEn nuestra clase anterior ten√≠amos el siguiente c√≥digo:\npublic class JdbcEjemplo { ..... public List\u0026amp;lt;Usuario\u0026amp;gt; findAllUsernames() { return jdbc.queryForObject( \u0026quot;select login,nombre from usuario \u0026quot;, new usuarioListaRowMapper() ); } private class usuarioListaRowMapper implements RowMapper\u0026amp;lt;List\u0026amp;lt;Usuario\u0026amp;gt;\u0026amp;gt; { @Override public List\u0026amp;lt;Usuario\u0026amp;gt; mapRow(ResultSet rs, int rowNum) throws SQLException { ArrayList\u0026amp;lt;Usuario\u0026amp;gt; listaUsuarios = new ArrayList(); do { listaUsuarios.add(new Usuario(rs.getString(\u0026quot;login\u0026quot;), rs.getString(\u0026quot;nombre\u0026quot;))); } while (rs.next()); return listaUsuarios; } } }  Ahora vamos a ver como usar una expresion lambda de tal manera que no tengamos que crear la clase usuarioListaRowMapper y, ademas nuestro c√≥digo quede mucho mas limpio.\npublic List\u0026amp;lt;Usuario\u0026amp;gt; findAllUsernames() { return jdbc.query( \u0026quot;select login,nombre from usuario \u0026quot;, (rs, rowNum) -\u0026amp;gt; new Usuario(rs.getString(\u0026quot;login\u0026quot;),rs.getString(\u0026quot;nombre\u0026quot;)) ); }  ¬ø Sorprendido ?. S√≠, gracias al uso de expresiones lambda hemos dejado nuestro c√≥digo anterior en solo esas lineas. Y por supuesto no es necesario tener la clase usuarioListaRowMapper¬†\nLo que hemos hecho es cambiar la llamada a la funci√≥n queryForObject por la llamada a la funci√≥n query que esta definida de tal manera\n\u0026lt;T\u0026gt; List\u0026lt;T\u0026gt; query(String sql, RowMapper\u0026lt;T\u0026gt; rowMapper) throws DataAccessException;  Es decir espera una sentencia SQL y un clase que implemente la interfaz funcional RowMapper (que es una interfaz funcional esta explicado en la p√°gina anteriormente referenciada)\nPues bien, hemos creado esa clase a trav√©s de la expresi√≥n lambda, y nos hemos ahorrado un mont√≥n de c√≥digo y dejado todo mucho m√°s limpio.\nChicos, aprender a usar expresiones lambda. ¬°¬° Mejoraran vuestro c√≥digo !!\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/22/acceso-a-base-de-datos-con-jdbc-spring/",
	"title": "Acceso a Base de Datos con  Spring Data JDBC",
	"tags": ["java", "jdbc", "spring"],
	"description": "",
	"content": " En el anterior articulo explicaba como crear la conexion a la base de datos en un servidor de aplicaciones Tomcat . En este articulo explicare como acceder a esos datos a traves del paquete JDBC de Spring Data JDBC\nEl c√≥digo fuente de este ejemplo esta en: https://github.com/chuchip/jdbc_jpa_tomcat\nCreando nuestro POJO y Repositorio Ahora que ya tenemos nuestro acceso a la base de datos configurado y disponible, vamos a utilizarlo (por eso de que no se aburra üòâ )\nLo primero definimos nuestro POJO. Ya sabeis Plain Object Java Object, es decir Objeto Plano de Java, o en otras palabras ‚ÄòClase Tonta donde almacenar y que no tiene nada o muy poco de l√≥gica),\nEste POJO que har√° referencia a la tabla usuario, sera tal que as√≠:\n@Entity @Table(name = \u0026quot;usuario\u0026quot;, uniqueConstraints = { @UniqueConstraint(columnNames = {\u0026quot;login\u0026quot;})}) public class Usuario implements Serializable { @Id String login; @Column String nombre; public Usuario() { } public String getLogin() { return login; } public void setLogin(String login) { this.login = login; } public String getNombre() { return nombre; } public void setNombre(String nombre) { this.nombre = nombre; } public Usuario(String login, String nombre) { this.login = login; this.nombre = nombre; } }  Creo que esto no har√° falta explicarlo mucho. Si no entend√©is lo que es una @Entitty y tal os recomiendo que le√°is los siguientes manuales:\nhttps://www.arquitecturajava.com/ejemplo-de-jpa/\nhttps://www.oscarblancarteblog.com/2016/10/27/declarar-entidades-entity/\nUna vez que ya tenemos una clase (una @Entity) donde almacenar los registros de nuestra tabla usuario, vamos a ver como trabajar usando el paquete JDBC de Spring. Para ser mas exactos, utilizando JDBC Templates de Spring.\nEn la clase JdbcEjemplo tenemos lo siguiente:\n@Repository public class JdbcEjemplo { @Autowired private JdbcOperations jdbc; @Bean public JdbcTemplate jdbcTemplate(DataSource dataSource) { return new JdbcTemplate(dataSource); } public Usuario findByUsername(String username) { return jdbc.queryForObject( \u0026quot;select login,nombre from usuario where login=?\u0026quot;, new usuarioRowMapper(), username); } public List\u0026lt;Usuario\u0026gt; findAllUsernames() { return jdbc.queryForObject( \u0026quot;select login,nombre from usuario \u0026quot;, new usuarioListaRowMapper() ); } private class usuarioRowMapper implements RowMapper\u0026lt;Usuario\u0026gt; { @Override public Usuario mapRow(ResultSet rs, int rowNum) throws SQLException { return new Usuario( rs.getString(\u0026quot;login\u0026quot;), rs.getString(\u0026quot;nombre\u0026quot;)); } } private class usuarioListaRowMapper implements RowMapper\u0026lt;List\u0026lt;Usuario\u0026gt;\u0026gt; { @Override public List\u0026lt;Usuario\u0026gt; mapRow(ResultSet rs, int rowNum) throws SQLException { ArrayList\u0026lt;Usuario\u0026gt; listaUsuarios = new ArrayList(); do { listaUsuarios.add(new Usuario(rs.getString(\u0026quot;login\u0026quot;), rs.getString(\u0026quot;nombre\u0026quot;))); } while (rs.next()); return listaUsuarios; } } }  Explico la clase, poco a poco. Lo primero es marcarla como repositorio, eso se hace con la anotaci√≥n @Repository. Con esto conseguiremos que Spring cargue la clase y este disponible para otras clases a trav√©s del sistema de inyecci√≥n de dependencias (realmente para nuestro ejemplo nos habr√≠a valido con marcarla como @Component)\nCreamos la funci√≥n jdbcTemplate(DataSource dataSource) , la cual nos devolver√° un nuevo JdbcTemplate con el datasource que Spring ya tiene definido en su contexto. Como se puede ver, la funci√≥n esta marcada con @Bean, para que la variable jdbc, que tenemos al principio de la clase, la llame y pueda asignarle un valor. JdbcOperations es el interface que usan las clases del paquete JDBC de Spring. La clase JdbcTemplate, por supuesto, lo implementa.\nNosotros usaremos la funci√≥n findByUserName , para buscar el nombre del usuario (como nos gusta el ingles, madre m√≠a üòâ ). Y esta funci√≥n lo √∫nico que har√° sera usando la variable global jdbc, invocando el m√©todo queryForObject. Este m√©todo usa los siguientes par√°metros:\n La sentencia SQL a ejecutar, teniendo en cuenta que los par√°metros a sustituir deben ser puestas con un ? , como si fuera un PreparedStatement, vamos.\n El objeto donde se van a guardar los resultados. Este objeto debe implementar el interface RowMapper. En nuestro ejemplo creamos la clase usuarioRowMapper donde definimos la funci√≥n mapRow(ResultSet rs, int rowNum) la cual sera llamada por la funci√≥n queryForObject, de tal manera que devuelva un objeto Usuario.\n Las variables a sustituir en la sentencia SQL. Tendra que haber tantas variables como ? hemos puesto en nuestra sentencia SQL.\n  El caso es que cuando llamemos la funci√≥n findByUserName nos devolver√° una clase tipo Usuario o null si no encuentra nada.\nEn la siguiente funci√≥n, llamada findAllUsernames buscaremos todos los usuarios que haya en la base de datos, por lo cual necesesitamos que devolver una lista de usuarios, es decir una List. Como se ve la llamada es casi igual que la de findByUserName , con la diferencia de que el RowMapper a devolver es usuarioListaRowMapper que como se ve en su funci√≥n mapRow devuelve un objeto List que contiene Usuarios, es decir List.\nObs√©rvese lo c√≥modo que es usar Templates JDBC. No tenemos que abrir Conexiones ni crear Statements ni nada, Spring lo hace todo por debajo. Simplemente ponemos la sentencia SQL y recibimos un objeto que contiene los resultados.\nEn el proximo articulo explicare como realizar busquedas en la base de datos a traves de JPA e Hibernate.\n"
},
{
	"uri": "http://ww2.profesor-p.com/2018/08/21/conectando-con-postgresql-usando-jndi-y-spring-en-tomcat-parte-1/",
	"title": "Conectando a una base de datos usando JNDI y Spring en Tomcat",
	"tags": ["hibernate", "java", "jndi", "jpa", "spring", "tomcat"],
	"description": "",
	"content": " 1. Introducci√≥n En este ejemplo veremos como conecta a Postgresql usando JPA + Hibernate y Spring JDBC. Para ello uso como servidor de aplicaciones Tomcat. La configuraci√≥n esta realizada con anotaciones y XML y utilizo el pool de conexiones de Tomcat recogido a trav√©s de JNDI, para que la aplicaci√≥n no deba saber realmente ni donde se conecta.\nEl c√≥digo fuente lo teneis en: https://github.com/chuchip/jdbc_jpa_tomcat\nEn este enlace teneis este mismo documento (todas las partes) pero en PDF.\nEl ejemplo usa Maven y explicare como deber√° estar configurado Tomcat para que la aplicaci√≥n funcione correctamente.\n2. Configuraci√≥n de Postgresql {.western} Esta sera la √∫nica tabla a la que accederemos a trav√©s de Postgresql:\ncreate table usuario ( login varchar(15) not null, nombre varchar(100) not null, constraint ix_usuario primary key (login) ); insert into usuario values('cpuente','El profe'); insert into usuario values('chuchi','El nombre del profe');  3. Configuraci√≥n de Tomcat La configuraci√≥n de Tomcat deber√° tener las siguientes caracter√≠sticas:\nEn server.xml (estara en $TOMCAT_HOME/conf) deberemos a√±adir dentro de  las siguientes lineas:\n\u0026lt;GlobalNamingResources\u0026gt; ‚Ä¶.. \u0026lt;Resource name=\"jdbc/anjelica\" auth=\"Container\" type=\"javax.sql.DataSource\" driverClassName=\"org.postgresql.Driver\" url=\"jdbc:postgresql://localhost:5432/MIBASEDATOS\" username=\"USUARIO\" password=\"CONTRASE√ëA\" maxTotal=\"20\" maxIdle=\"10\" maxWaitMillis=\"-1\"/\u0026gt; ‚Ä¶.. \u0026lt;/GlobalNamingResources\u0026gt; Esto se utilizara para configurar nuestra fuente JNDI que permitir√° conectarnos con la base de datos. Para probar esta aplicaci√≥n cambiar los valores de url para que apunten a vuestra base de datos, asi como el username y la password.\nTambi√©n sera necesario a√±adir las siguientes lineas al fichero context.xml dentro de  __de tomcat, que tambi√©n estar√° en $TOMCAT_HOME/conf\n\u0026lt;Context\u0026gt; ‚Ä¶. \u0026lt;ResourceLink name=\"jdbc/anjelica\" global=\"jdbc/anjelica\" type=\"javax.sql.DataSource\"/\u0026gt; ‚Ä¶. \u0026lt;/Context\u0026gt; Con estos dos ficheros ya tendremos nuestro tomcat configurado para que use su propio pool de conexiones al que hemos llamado ‚Äújdbc/anjelica‚Äù.\nAhora debemos a√±adir a Tomcat la librer√≠apara conectarnos a postgresql, en este caso usamos la versi√≥n 42.2.2\n\u0026#8211; postgresql-42.2.2.jar\n4. Configuraci√≥n de la aplicaci√≥n. {.western} \u0026nbsp;\nEn esta aplicaci√≥n usaremos tanto ficheros xml como configuraci√≥n en Java.\nLo primero es configurar nuestro ficheros xml para que Tomcat use Spring, para ello en el directorio src\\main\\webapp\\WEB-INF de nuestra aplicaci√≥n tenderemos estos ficheros.\n applicationContext.xml dispatcher-servlet.xml web.xml  4.1 web.xml {.western} El √∫nico fichero que usa Tomcat es web.xml, y este, a su vez, usa los dos anteriores, de tal manera que b√°sicamente en web.xml , lo primero que hacemos es especificar que use el servlet de Spring y le decimos donde tendr√° la configuraci√≥n para ese servlet. Esto se hace con estas lineas:\n\u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;dispatcher\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt; org.springframework.web.servlet.DispatcherServlet \u0026lt;/servlet-class\u0026gt; \u0026lt;init-param\u0026gt; \u0026lt;param-name\u0026gt;contextConfigLocation\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;/WEB-INF/dispatcher-servlet.xml\u0026lt;/param-value\u0026gt; \u0026lt;/init-param\u0026gt; \u0026lt;load-on-startup\u0026gt;1\u0026lt;/load-on-startup\u0026gt; \u0026lt;/servlet\u0026gt; A continuaci√≥n configuramos el contexto con las siguientes lineas:\n\u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;contextConfigLocation\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;/WEB-INF/applicationContext.xml\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;listener\u0026gt; \u0026lt;listener-class\u0026gt;org.springframework.web.context.ContextLoaderListener\u0026lt;/listener-class\u0026gt; \u0026lt;/listener\u0026gt; 4.2dispatcher-servlet.xml {.western} Para configurar la parte Web de nuestra aplicaci√≥n (el servlet realmente) pondremos las siguientes lineas en el fichero dispatcher-servlet.xml\n\u0026lt;annotation-driven /\u0026gt; \u0026lt;context:component-scan base-package=\"chu.jdbc\" /\u0026gt; \u0026lt;beans:bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\"\u0026gt; \u0026lt;beans:property name=\"prefix\" value=\"/WEB-INF/views/\" /\u0026gt; \u0026lt;beans:property name=\"suffix\" value=\".jsp\" /\u0026gt; \u0026lt;/beans:bean\u0026gt; Con  permitiremos que en nuestra aplicaci√≥n haya anotaciones @Controller y @RequestMapping\nCon  especificaremos que paquete deber√° escanear Spring para buscar anotaciones en los ficheros java. En este caso especificamos que busque en el paquete ‚Äúchu.jdbc‚Äù y sus hijos.\nLas ultimas lineas indican que usaremos JSP y especifica donde tendremos nuestros ficheros jsp.\nTen√©is un excelente documento explicando como hacer esta misma configuraci√≥n usando anotaciones java en la siguiente p√°gina: https://www.baeldung.com/bootstraping-a-web-application-with-spring-and-java-based-configuration\n4.3applicationContext.xml {.western} En este fichero crearemos nuestro DataSource que utilizaremos para conectarnos con el pool de conexiones anteriormente configurado en Tomcat.\nEsto se hace a√±adiendo la siguiente linea:\n\u0026lt;jee:jndi-lookup id=\"dataSource\" jndi-name=\"jdbc/anjelica\" resource-ref=\"true\"/\u0026gt; Ten√©is m√°s documentaci√≥n de lo que hace esta linea en http://www.jtech.ua.es/j2ee/publico/spring-2012-13/sesion01-apuntes.html\nDe todos modos b√°sicamente lo que hace es injectar en nuestra aplicaci√≥n una clase DataSource que luego podremos usar con sentencias como esta:\n@Autowired DataSource ds; 5. La aplicaci√≥n {.western} 5.1 Configuracion JPA y JDBC {.western} En la clase JpaConfig es donde se hace toda la configuraci√≥n que necesitamos para conectarnos a la base de datos.\nPara ello, lo primero especificamos las siguientes configuraciones java\n@Configuration @EnableLoadTimeWeaving @EnableJpaRepositories(\"chu.jdbc\") Explico las directivas, una a una.\n @Configuration Especifica que es una clase de configuraci√≥n, con ello haremos que Spring la cargue y ejecute.\n @EnableLoadTimeWeaving Con esto permitimos a tomcat usar AOP. Si no la ponemos simplemente Tomcat no podr√° hacer uso de Programaci√≥n Orienta a a Aspectos (AOP) y la aplicaci√≥n no funcionara. Mas documentaci√≥n en: https://docs.spring.io/spring/docs/5.0.8.RELEASE/spring-framework-reference/core.html#aop-aj-ltw-environment-tomcat\n @EnableJpaRepositories(\u0026#8220;chu.jdbc\u0026#8221;) especificamos que busque repositorios (clases marcadas con la directiva @Repository) en el paquete chu.jdbc\n  Ahora inyectamos el Datasource que ya tendremos disponible por la configuraci√≥n aplicada anteriormente en nuestro fichero applicationContext.xml\n@Autowired DataSource ds; Lo siguiente es crear nuestro fabrica de controladores de entidades (bueno, en ingles, nuestro EntityManagerFactoryBean), para ello y como usamos una versi√≥n de Hibernate superior a la 4 (con versiones anteriores utilizar√≠amos otra clase), ponemos el siguiente c√≥digo:\n@Bean public LocalContainerEntityManagerFactoryBean entityManagerFactory() { LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean(); em.setDataSource(ds); em.setPackagesToScan(new String[] { \"chu.jdbc\" }); JpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter(); em.setJpaVendorAdapter(vendorAdapter); return em; } Como se puede ver simplemente creamos nuestro LocalContainerEntityManagerFactoryBean , le a√±adimos nuestro DataSource y el adaptador de Hibernate. Tambi√©n le decimos los paquetes que deber√° escanear para buscar ‚ÄúEntity Classes‚Äù (clases que sean entidades, vamos).\nPor ultimo creamos nuestro controlador de transaciones con el siguiente c√≥digo:\n@Bean public PlatformTransactionManager transactionManager( EntityManagerFactory emf){ JpaTransactionManager transactionManager = new JpaTransactionManager(); transactionManager.setEntityManagerFactory(emf); return transactionManager; } Ahora ya solo falta crear nuestro ficherito hibernate.cfg.xml en nuestro directorio de resources, pero en el solamente tenemos lo siguiente:\n\u0026lt;?xml version=\"1.0\" encoding=\"UTF-8\"?\u0026gt; \u0026lt;!DOCTYPE hibernate-configuration PUBLIC \"-//Hibernate/Hibernate Configuration DTD 3.0//EN\" \"http://hibernate.org/dtd/hibernate-configuration-3.0.dtd\"\u0026gt; \u0026lt;hibernate-configuration\u0026gt; \u0026lt;session-factory\u0026gt; \u0026lt;property name=\"hibernate.dialect\"\u0026gt;org.hibernate.dialect.PostgreSQLDialect\u0026lt;/property\u0026gt; \u0026lt;/session-factory\u0026gt; \u0026lt;/hibernate-configuration\u0026gt; Es decir, simplemente definimos que vamos a usar una base de datos Postgresql. Este fichero debe existir. Cosas de Hibernate que hay que complacer.\nY voila nuestro entorno para JPA + Hibernate ya esta configurado y listo para funcionar.\nEn la siguiente parte explicare como crear un respositorio y la magia que hay detras.\n¬°¬° Hasta la proxima, chabales!!\n"
},
{
	"uri": "http://ww2.profesor-p.com/tags/angular/",
	"title": "Angular",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/angular/",
	"title": "Angular",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/angular-6/",
	"title": "Angular 6",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/angular6/",
	"title": "Angular6",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/contacto/experiencia_basesdatos/",
	"title": "Bases de Datos",
	"tags": ["experiencia"],
	"description": "",
	"content": "Experiencia como administrador de Base de Datos:\n Informix \u0026#8211; 10 a√±os Oracle \u0026#8211; 1 a√±o Postgresql \u0026#8211; 2 a√±os MYSQL \u0026#8211; 6 Meses SQL SERVER \u0026#8211; 3 Meses  "
},
{
	"uri": "http://ww2.profesor-p.com/tags/beans/",
	"title": "Beans",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/",
	"title": "Bienvenido a mi p√°gina",
	"tags": [],
	"description": "",
	"content": " ¬°¬°El profe os da la bienvenida!! En este blog intentare ir poniendo cositas interesantes sobre las cosas que voy viendo en internet, a poder ser, que sean did√°cticas como ejemplos de como hacer una cosa e incluso dos. üòÑ\nPondre art√≠culos sobre inform√°tica, incidiendo sobre todo en el mundo Java y especificamente en Spring.\nTambien encontraras articulos sobre JPA, Hibernate, Spring boot, Hugo (con lo cual esta hecha esta herramienta), Kafka y otros temas.\nEn el men√∫ lateral ire poniendo los enlaces intentando agruparlos por tematica de tal manera que se cree una especie de libro.\nPor supuesto siempre puedes utilizar el buscador de la izquierda y usar el buscador por tem√°tica. por ejemplo si quieres buscar articulos sobre Java, podrias ir a www.profesor-p/es/tags/java/\nEspero que encontreis utiles las entradas y por supuesto cualquier comentario sera bienvenido.\nAqu√≠ teneis los √∫ltimos articulos escritos:\n Java  Java Este es un caj√≥n desastre con articulos sobre diferentes temas.\n Spring  Articulos sobre tem√°s basicos y algunos m√°s avanzadosaa\n Hugo  Articulos sobre HUGO y como crear paginas web estaticas din√°micamente.\n Angular  Articulos diversos sobre Angular\n DBA  Enlaces disponibles:\n J2EE  Ejemplos usando java EE. (La competencia de Spring üòÑ ) Aplicaci√≥n CRUD usando REST en JavaEE Buenas, chicos, en esta ocasi√≥n voy a explicar como hacer una aplicaci√≥n CRUD, que sirva peticiones REST con el protocolo JSON, usando JavaEE y Glasfish como servidor de aplicaciones. En esta aplicaci√≥n actualizaremos y consultaremos una peque√±a tabla a trav√©s de diferentes peticiones REST. Si bien es cierto que JavaEE no soporta oficialmente JSON en sus especificaciones, la realidad es que es muy f√°cil el realizar una aplicaci√≥n totalmente funcional y muy f√°cilmente con la libreria JACKSON.\n Contacto  Mi nombre es Jes√∫s Javier Puente,¬†vivo¬†en Logro√±o, apasionado de la inform√°tica,¬†soy programador desde hace demasiados a√±os, ademas de Administrador de sistemas, DBA.\n Acerca de  Este es mi blog profesional, hecho con mimo personal.\nDetr√°s del Profesor P. esta Jes√∫s Javier Puente S√°nchez. Un analista/programador, que tambi√©n es administrador de sistemas y bases de datos. Defensor del software libre, y con varios ERPs a sus espaldas, he querido aportar mi granito de arena a la comunidad, creando Anjelica.\n ERP Anjelica  Para aquellas peque√±as empresas que necesitan tener una trazabilidad sencilla pero potente, y ademas gratis, prueba mi ERP. Totalmente funcional, te sorprender√° gratamente. M√°s informaci√≥n aqu√≠.\n "
},
{
	"uri": "http://ww2.profesor-p.com/tags/bootstrap/",
	"title": "Bootstrap",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/bootstrap/",
	"title": "Bootstrap",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/cache/",
	"title": "Cache",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/cache/",
	"title": "Cache",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/cloud/",
	"title": "Cloud",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/cloud/",
	"title": "Cloud",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/crud/",
	"title": "Crud",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/crud/",
	"title": "Crud",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/curso/",
	"title": "Curso",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/docker/",
	"title": "Docker",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/docker/",
	"title": "Docker",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/experiencia/",
	"title": "Experiencia",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/experiencia/",
	"title": "Experiencia",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/contacto/experiencia_laboral/",
	"title": "Experiencia Laboral",
	"tags": ["experiencia"],
	"description": "Experiencia laboral",
	"content": "Tengo m√°s de 30 a√±os de experiencia en el mundo de la inform√°tica.¬†Empece en los a√±os 80 como freelance, realizando videojuegos, usando ensamblador como lenguaje de programaci√≥n. A partir de ah√≠ he trabajado de analista, administrador de sistemas y DBA.\nSoy miembro de grupos como AULIR (Asociacion Usuarios de Linux de La Rioja), y GDG (Google Developer Group). La inform√°tica es mi trabajo y, ademas, mi pasi√≥n, por lo cual siempre he estado y estoy aprendiendo m√∫ltiples lenguajes y tecnolog√≠as de forma autodidacta.\nTengo amplia experiencia como programador, administrador de sistemas y administrador de bases de datos.¬†En est√° pagina pueden ver un resumen de los lenguajes en los que he programado y en esta otra, mi experiencia como administrador de sistemas. Para terminar,estas son las bases de datos que he administrado.\nEste es un¬†resumen de mi curriculum en orden cronol√≥gico:\n 1989-1992 ¬†Programaci√≥n de un ERP completo en Informix 4GL, migrando la soluci√≥n ya existente en Cobol. 1992-1996 Desarrollo de una gesti√≥n completa en Dbase compuesta de almac√©n, facturaci√≥n, control de comerciales y caja. Al cabo de 2 a√±os se migra el programa a Visual Dbase 5\nEn VisualBasic realizo una serie de programas de control de presencia.\n 1996 \u0026#8211; 1999 Migraci√≥n y mejora del antiguo ERP de Informix 4GL a Java, usando Swing. Se dise√±a todo un framework propio.\n 1999 \u0026#8211; 2003 Realizar labores de administrador de Unix (Solaris) y base datos Informix.\nAnalista-Programador en Java, utilizando tanto entorno Web (JSP) como Swing para entorno gr√°fico.\nAdministrar servidores de correo (sendmail y qmail), DNS (bind), radius, firewall,etc.\n 2004 \u0026#8211; 2010 Administrador de un cluster en HP-UX. Administrador de sistemas Linux (CENTOS y Suse)\nMantenimiento y configuraci√≥n de los servicios Web (Apache), Tomcat, Postfix, Antivirus,\nAntiSpam, DNS y el Firewall\nAdministrador de la base de datos principal¬†del Hospital de Calahorra implementada en Informix, ademas de¬†bases de datos Oracle\n(versi√≥n 9 y 10), Postgres y Mysql, que se utilizan en diferentes √°reas del hospital.\n 2010 ‚Äì 2016 Teniendo como cliente final al servicio riojano de Salud (SERIS), mi labor es de administrador de Sistemas, dedic√°ndome especialmente al mundo Linux y base de datos\nrelacionales (Informix, Oracle, SQLServer, etc.). Trabajo con VMWARE como entorno de virtualizaci√≥n.\nConfiguraci√≥n e instalaci√≥n de diversos servicios (Servidores Web, Samba, LDAP, Tomcat, SVN, etc).\nConfiguraci√≥n entorno de escritorios remotos usando Citrix.\nConfiguraci√≥n y mantenimiento de sistemas de almacenamientos (EVAS y 3PAR) as√≠ como su correspondiente electr√≥nica de red.\n 2016 \u0026#8211; 2018 Analista/ Programador, en Java. Realizaci√≥n de un ERP completo, enfocado a la trazabilidad.¬†Administrador de sistemas.\n 2018 \u0026#8211; Actual Analista / Programador de Java en GFI Espa√±a.\n  "
},
{
	"uri": "http://ww2.profesor-p.com/tags/filters/",
	"title": "Filters",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/formularios/",
	"title": "Formularios",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/frontend/",
	"title": "Frontend",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/gateway/",
	"title": "Gateway",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/glassfish/",
	"title": "Glassfish",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/glassfish/",
	"title": "Glassfish",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/h2/",
	"title": "H2",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/h2/",
	"title": "H2",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/hibernate/",
	"title": "Hibernate",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/hibernate/",
	"title": "Hibernate",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/html/",
	"title": "Html",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/html/",
	"title": "Html",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/hugo/",
	"title": "Hugo",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/hugo/",
	"title": "Hugo",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/i18n/",
	"title": "I18n",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/i18n/",
	"title": "I18n",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/internacionalizacion/",
	"title": "Internacionalizacion",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/java/",
	"title": "Java",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/java/",
	"title": "Java",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/java-ee/",
	"title": "Java Ee",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/javaee/",
	"title": "Javaee",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/javaee/",
	"title": "Javaee",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/jdbc/",
	"title": "Jdbc",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/jdbc/",
	"title": "Jdbc",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/jndi/",
	"title": "Jndi",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/jndi/",
	"title": "Jndi",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/jpa/",
	"title": "Jpa",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/jpa/",
	"title": "Jpa",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/jquery/",
	"title": "Jquery",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/jquery/",
	"title": "Jquery",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/json/",
	"title": "Json",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/json/",
	"title": "Json",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/jsp/",
	"title": "Jsp",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/jstl/",
	"title": "Jstl",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/jstl/",
	"title": "Jstl",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/junit/",
	"title": "Junit",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/junit/",
	"title": "Junit",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/kafka/",
	"title": "Kafka",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/kafka/",
	"title": "Kafka",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/kotlin/",
	"title": "Kotlin",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/kotlin/",
	"title": "Kotlin",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/l/",
	"title": "L",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/lambda/",
	"title": "Lambda",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/lambda/",
	"title": "Lambda",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/contacto/experiencia_lenguajesprogramacion/",
	"title": "Lenguajes  de programaci√≥n",
	"tags": ["experiencia"],
	"description": "",
	"content": " JAVA - 15 A√±os experiencia. Trabajando en entornos: SWING, SPRING y J2EE Informix 4GL \u0026#8211; 4 a√±os experiencia. Ensamblador¬†\u0026#8211; 4 a√±os experiencia. C - 2 A√±os experiencia. PHP \u0026#8211; 6 Meses experiencia. PERL¬†\u0026#8211; 6 Meses experiencia. PHP \u0026#8211; 6 Meses experiencia. KOTLIN \u0026#8211; 6 Meses experiencia. Android¬†\u0026#8211; 6 Meses experiencia. Angular¬†\u0026#8211; 9 Meses experiencia    "
},
{
	"uri": "http://ww2.profesor-p.com/tags/linux/",
	"title": "Linux",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/microservicios/",
	"title": "Microservicios",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/mvc/",
	"title": "Mvc",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/mvc/",
	"title": "Mvc",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/netbeans/",
	"title": "Netbeans",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/netbeans/",
	"title": "Netbeans",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/netbeans9/",
	"title": "Netbeans9",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/oauth2/",
	"title": "Oauth2",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/oauth2/",
	"title": "Oauth2",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/pooper/",
	"title": "Pooper",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/pooper/",
	"title": "Pooper",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/profiles/",
	"title": "Profiles",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/profiles/",
	"title": "Profiles",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/reactivo/",
	"title": "Reactivo",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/rest/",
	"title": "Rest",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/rest/",
	"title": "Rest",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/routes/",
	"title": "Routes",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/security/",
	"title": "Security",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/security/",
	"title": "Security",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/seguridad/",
	"title": "Seguridad",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/seguridad/",
	"title": "Seguridad",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/sin-categoria/",
	"title": "Sin Categoria",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/sin-categor%C3%ADa/",
	"title": "Sin Categor√≠a",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/contacto/experiencia_sistemas/",
	"title": "Sistemas",
	"tags": ["experiencia"],
	"description": "",
	"content": "Experiencia como administrador sistemas\n HPUX \u0026#8211; 6 A√±os Linux \u0026#8211; 10 a√±os  Centos, Debian, Ubuntu.  Windows¬†\u0026#8211; 1 a√±o VMWARE \u0026#8211; 4 a√±os CITRIX \u0026#8211; 1 A√±o  "
},
{
	"uri": "http://ww2.profesor-p.com/tags/spring/",
	"title": "Spring",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/spring/",
	"title": "Spring",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/spring-boot/",
	"title": "Spring Boot",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/spring-boot/",
	"title": "Spring Boot",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/test/",
	"title": "Test",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/thymeleaf/",
	"title": "Thymeleaf",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/thymeleaf/",
	"title": "Thymeleaf",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/tomcat/",
	"title": "Tomcat",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/tomcat/",
	"title": "Tomcat",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/web/",
	"title": "Web",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/web/",
	"title": "Web",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/webflow/",
	"title": "Webflow",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/webflow/",
	"title": "Webflow",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/tags/zuul/",
	"title": "Zuul",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://ww2.profesor-p.com/categories/zuul/",
	"title": "Zuul",
	"tags": [],
	"description": "",
	"content": ""
}]